(()=>{var e,t,r,i,n,s,o,a,l,c,u,p,h,d,f,b,g,m,y,v,w,_,E,S,I,$,T,C,R,M,x,O,N,A,k,P,U,D,B,L,q,V=function(e,t){return(V=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function F(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}V(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function j(e,t){var r,i,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(l){return function(a){if(r)throw TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}function z(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function W(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,s=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return o}function H(e,t,r){if(r||2==arguments.length)for(var i,n=0,s=t.length;n<s;n++)!i&&n in t||(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))}function K(e){return this instanceof K?(this.v=e,this):new K(e)}function G(e){return"function"==typeof e}function Q(e){var t=e(function(e){Error.call(e),e.stack=Error().stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}"function"==typeof SuppressedError&&SuppressedError;var J=Q(function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}});function Y(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var X=function(){var e;function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e,t,r,i,n,s=this._parentage;if(s){if(this._parentage=null,Array.isArray(s))try{for(var o=z(s),a=o.next();!a.done;a=o.next())a.value.remove(this)}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}else s.remove(this)}var l=this.initialTeardown;if(G(l))try{l()}catch(e){n=e instanceof J?e.errors:[e]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var u=z(c),p=u.next();!p.done;p=u.next()){var h=p.value;try{et(h)}catch(e){n=null!=n?n:[],e instanceof J?n=H(H([],W(n)),W(e.errors)):n.push(e)}}}catch(e){r={error:e}}finally{try{p&&!p.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}}if(n)throw new J(n)}},t.prototype.add=function(e){var r;if(e&&e!==this){if(this.closed)et(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(e)}}},t.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},t.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},t.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&Y(t,e)},t.prototype.remove=function(e){var r=this._finalizers;r&&Y(r,e),e instanceof t&&e._removeParent(this)},t.EMPTY=((e=new t).closed=!0,e),t}(),Z=X.EMPTY;function ee(e){return e instanceof X||e&&"closed"in e&&G(e.remove)&&G(e.add)&&G(e.unsubscribe)}function et(e){G(e)?e():e.unsubscribe()}var er={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},ei={setTimeout:function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var n=ei.delegate;return(null==n?void 0:n.setTimeout)?n.setTimeout.apply(n,H([e,t],W(r))):setTimeout.apply(void 0,H([e,t],W(r)))},clearTimeout:function(e){var t=ei.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function en(e){ei.setTimeout(function(){var t=er.onUnhandledError;if(t)t(e);else throw e})}function es(){}var eo=ea("C",void 0,void 0);function ea(e,t,r){return{kind:e,value:t,error:r}}var el=null;function ec(e){if(er.useDeprecatedSynchronousErrorHandling){var t=!el;if(t&&(el={errorThrown:!1,error:null}),e(),t){var r=el,i=r.errorThrown,n=r.error;if(el=null,i)throw n}}else e()}var eu=function(e){function t(t){var r=e.call(this)||this;return r.isStopped=!1,t?(r.destination=t,ee(t)&&t.add(r)):r.destination=em,r}return F(t,e),t.create=function(e,t,r){return new ef(e,t,r)},t.prototype.next=function(e){this.isStopped?eg(ea("N",e,void 0),this):this._next(e)},t.prototype.error=function(e){this.isStopped?eg(ea("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?eg(eo,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(X),ep=Function.prototype.bind;function eh(e,t){return ep.call(e,t)}var ed=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){eb(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){eb(e)}else eb(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){eb(e)}},e}(),ef=function(e){function t(t,r,i){var n,s,o=e.call(this)||this;return G(t)||!t?n={next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=i?i:void 0}:o&&er.useDeprecatedNextContext?((s=Object.create(t)).unsubscribe=function(){return o.unsubscribe()},n={next:t.next&&eh(t.next,s),error:t.error&&eh(t.error,s),complete:t.complete&&eh(t.complete,s)}):n=t,o.destination=new ed(n),o}return F(t,e),t}(eu);function eb(e){er.useDeprecatedSynchronousErrorHandling?er.useDeprecatedSynchronousErrorHandling&&el&&(el.errorThrown=!0,el.error=e):en(e)}function eg(e,t){var r=er.onStoppedNotification;r&&ei.setTimeout(function(){return r(e,t)})}var em={closed:!0,next:es,error:function(e){throw e},complete:es},ey="function"==typeof Symbol&&Symbol.observable||"@@observable";function ev(e){return e}function ew(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e_(e)}function e_(e){return 0===e.length?ev:1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}}var eE=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var i,n=this,s=(i=e)&&i instanceof eu||i&&G(i.next)&&G(i.error)&&G(i.complete)&&ee(i)?e:new ef(e,t,r);return ec(function(){var e=n.operator,t=n.source;s.add(e?e.call(s,t):t?n._subscribe(s):n._trySubscribe(s))}),s},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var r=this;return new(t=eS(t))(function(t,i){var n=new ef({next:function(t){try{e(t)}catch(e){i(e),n.unsubscribe()}},error:i,complete:t});r.subscribe(n)})},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[ey]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e_(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=eS(e))(function(e,r){var i;t.subscribe(function(e){return i=e},function(e){return r(e)},function(){return e(i)})})},e.create=function(t){return new e(t)},e}();function eS(e){var t;return null!==(t=null!=e?e:er.Promise)&&void 0!==t?t:Promise}var eI=Q(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),e$=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return F(t,e),t.prototype.lift=function(e){var t=new eT(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new eI},t.prototype.next=function(e){var t=this;ec(function(){var r,i;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var n=z(t.currentObservers),s=n.next();!s.done;s=n.next())s.value.next(e)}catch(e){r={error:e}}finally{try{s&&!s.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}}})},t.prototype.error=function(e){var t=this;ec(function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var r=t.observers;r.length;)r.shift().error(e)}})},t.prototype.complete=function(){var e=this;ec(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,r=this.hasError,i=this.isStopped,n=this.observers;return r||i?Z:(this.currentObservers=null,n.push(e),new X(function(){t.currentObservers=null,Y(n,e)}))},t.prototype._checkFinalizedStatuses=function(e){var t=this.hasError,r=this.thrownError,i=this.isStopped;t?e.error(r):i&&e.complete()},t.prototype.asObservable=function(){var e=new eE;return e.source=this,e},t.create=function(e,t){return new eT(e,t)},t}(eE),eT=function(e){function t(t,r){var i=e.call(this)||this;return i.destination=t,i.source=r,i}return F(t,e),t.prototype.next=function(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===r||r.call(t,e)},t.prototype.error=function(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===r||r.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,r;return null!==(r=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==r?r:Z},t}(e$),eC=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._value=null,t._hasValue=!1,t._isComplete=!1,t}return F(t,e),t.prototype._checkFinalizedStatuses=function(e){var t=this.hasError,r=this._hasValue,i=this._value,n=this.thrownError,s=this.isStopped,o=this._isComplete;t?e.error(n):(s||o)&&(r&&e.next(i),e.complete())},t.prototype.next=function(e){this.isStopped||(this._value=e,this._hasValue=!0)},t.prototype.complete=function(){var t=this._hasValue,r=this._value;this._isComplete||(this._isComplete=!0,t&&e.prototype.next.call(this,r),e.prototype.complete.call(this))},t}(e$),eR=function(e){function t(t){var r=e.call(this)||this;return r._value=t,r}return F(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var r=e.prototype._subscribe.call(this,t);return r.closed||t.next(this._value),r},t.prototype.getValue=function(){var e=this.hasError,t=this.thrownError,r=this._value;if(e)throw t;return this._throwIfClosed(),r},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(e$),eM=Array.isArray,ex=Object.getPrototypeOf,eO=Object.prototype,eN=Object.keys,eA=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function ek(e){return G(null==e?void 0:e.then)}function eP(e){return Symbol.asyncIterator&&G(null==e?void 0:e[Symbol.asyncIterator])}function eU(e){return TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var eD="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function eB(e){return G(null==e?void 0:e[eD])}function eL(e){return function(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var i,n=r.apply(e,t||[]),s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(e){n[e]&&(i[e]=function(t){return new Promise(function(r,i){s.push([e,t,r,i])>1||a(e,t)})})}function a(e,t){try{var r;(r=n[e](t)).value instanceof K?Promise.resolve(r.value.v).then(l,c):u(s[0][2],r)}catch(e){u(s[0][3],e)}}function l(e){a("next",e)}function c(e){a("throw",e)}function u(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}}(this,arguments,function(){var t,r,i;return j(this,function(n){switch(n.label){case 0:t=e.getReader(),n.label=1;case 1:n.trys.push([1,,9,10]),n.label=2;case 2:return[4,K(t.read())];case 3:if(i=(r=n.sent()).value,!r.done)return[3,5];return[4,K(void 0)];case 4:return[2,n.sent()];case 5:return[4,K(i)];case 6:return[4,n.sent()];case 7:return n.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function eq(e){return G(null==e?void 0:e.getReader)}function eV(e){if(e instanceof eE)return e;if(null!=e){if(G(e[ey]))return new eE(function(t){var r=e[ey]();if(G(r.subscribe))return r.subscribe(t);throw TypeError("Provided object does not correctly implement Symbol.observable")});if(eA(e))return new eE(function(t){for(var r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()});if(ek(e))return new eE(function(t){e.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,en)});if(eP(e))return eF(e);if(eB(e))return new eE(function(t){var r,i;try{for(var n=z(e),s=n.next();!s.done;s=n.next()){var o=s.value;if(t.next(o),t.closed)return}}catch(e){r={error:e}}finally{try{s&&!s.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}t.complete()});if(eq(e))return eF(eL(e))}throw eU(e)}function eF(e){return new eE(function(t){(function(e,t){var r,i,n,s,o,a,l,c;return o=this,a=void 0,l=void 0,c=function(){var o;return j(this,function(a){switch(a.label){case 0:a.trys.push([0,5,6,11]),r=function(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=z(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(r){t[r]=e[r]&&function(t){return new Promise(function(i,n){(function(e,t,r,i){Promise.resolve(i).then(function(t){e({value:t,done:r})},t)})(i,n,(t=e[r](t)).done,t.value)})}}}(e),a.label=1;case 1:return[4,r.next()];case 2:if((i=a.sent()).done)return[3,4];if(o=i.value,t.next(o),t.closed)return[2];a.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return n={error:a.sent()},[3,11];case 6:if(a.trys.push([6,,9,10]),!(i&&!i.done&&(s=r.return)))return[3,8];return[4,s.call(r)];case 7:a.sent(),a.label=8;case 8:return[3,10];case 9:if(n)throw n.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})},new(l||(l=Promise))(function(e,t){function r(e){try{n(c.next(e))}catch(e){t(e)}}function i(e){try{n(c.throw(e))}catch(e){t(e)}}function n(t){var n;t.done?e(t.value):((n=t.value)instanceof l?n:new l(function(e){e(n)})).then(r,i)}n((c=c.apply(o,a||[])).next())})})(e,t).catch(function(e){return t.error(e)})})}function ej(e,t,r,i,n){void 0===i&&(i=0),void 0===n&&(n=!1);var s=t.schedule(function(){r(),n?e.add(this.schedule(null,i)):this.unsubscribe()},i);if(e.add(s),!n)return s}function ez(e){return function(t){if(G(null==t?void 0:t.lift))return t.lift(function(t){try{return e(t,this)}catch(e){this.error(e)}});throw TypeError("Unable to lift unknown Observable type")}}function eW(e,t,r,i,n){return new eH(e,t,r,i,n)}var eH=function(e){function t(t,r,i,n,s,o){var a=e.call(this,t)||this;return a.onFinalize=s,a.shouldUnsubscribe=o,a._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=n?function(e){try{n(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=i?function(){try{i()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return F(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),r||null===(t=this.onFinalize)||void 0===t||t.call(this)}},t}(eu);function eK(e,t){return void 0===t&&(t=0),ez(function(r,i){r.subscribe(eW(i,function(r){return ej(i,e,function(){return i.next(r)},t)},function(){return ej(i,e,function(){return i.complete()},t)},function(r){return ej(i,e,function(){return i.error(r)},t)}))})}function eG(e,t){return void 0===t&&(t=0),ez(function(r,i){i.add(e.schedule(function(){return r.subscribe(i)},t))})}function eQ(e,t){if(!e)throw Error("Iterable cannot be null");return new eE(function(r){ej(r,t,function(){var i=e[Symbol.asyncIterator]();ej(r,t,function(){i.next().then(function(e){e.done?r.complete():r.next(e.value)})},0,!0)})})}function eJ(e,t){return t?function(e,t){if(null!=e){if(G(e[ey]))return eV(e).pipe(eG(t),eK(t));if(eA(e))return new eE(function(r){var i=0;return t.schedule(function(){i===e.length?r.complete():(r.next(e[i++]),r.closed||this.schedule())})});if(ek(e))return eV(e).pipe(eG(t),eK(t));if(eP(e))return eQ(e,t);if(eB(e))return new eE(function(r){var i;return ej(r,t,function(){i=e[eD](),ej(r,t,function(){var e,t,n;try{t=(e=i.next()).value,n=e.done}catch(e){r.error(e);return}n?r.complete():r.next(t)},0,!0)}),function(){return G(null==i?void 0:i.return)&&i.return()}});if(eq(e))return eQ(eL(e),t)}throw eU(e)}(e,t):eV(e)}function eY(e,t){return ez(function(r,i){var n=0;r.subscribe(eW(i,function(r){i.next(e.call(t,r,n++))}))})}var eX=Array.isArray;function eZ(e){return eY(function(t){return eX(t)?e.apply(void 0,H([],W(t))):e(t)})}function e0(e){return e&&G(e.schedule)}function e1(e){return e[e.length-1]}function e2(e){return G(e1(e))?e.pop():void 0}function e5(e){return e0(e1(e))?e.pop():void 0}function e4(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e5(e),i=e2(e),n=function(e){if(1===e.length){var t=e[0];if(eM(t))return{args:t,keys:null};if(t&&"object"==typeof t&&ex(t)===eO){var r=eN(t);return{args:r.map(function(e){return t[e]}),keys:r}}}return{args:e,keys:null}}(e),s=n.args,o=n.keys;if(0===s.length)return eJ([],r);var a=new eE(e3(s,r,o?function(e){return o.reduce(function(t,r,i){return t[r]=e[i],t},{})}:ev));return i?a.pipe(eZ(i)):a}function e3(e,t,r){return void 0===r&&(r=ev),function(i){var n;n=function(){for(var n=e.length,s=Array(n),o=n,a=n,l=function(n){var l;l=function(){var l=eJ(e[n],t),c=!1;l.subscribe(eW(i,function(e){s[n]=e,!c&&(c=!0,a--),a||i.next(r(s.slice()))},function(){--o||i.complete()}))},t?ej(i,t,l):l()},c=0;c<n;c++)l(c)},t?ej(i,t,n):n()}}function e6(e,t,r,i,n,s,o,a){var l=[],c=0,u=0,p=!1,h=function(){!p||l.length||c||t.complete()},d=function(e){return c<i?f(e):l.push(e)},f=function(e){s&&t.next(e),c++;var a=!1;eV(r(e,u++)).subscribe(eW(t,function(e){null==n||n(e),s?d(e):t.next(e)},function(){a=!0},void 0,function(){if(a)try{for(c--;l.length&&c<i;)!function(){var e=l.shift();o?ej(t,o,function(){return f(e)}):f(e)}();h()}catch(e){t.error(e)}}))};return e.subscribe(eW(t,d,function(){p=!0,h()})),function(){null==a||a()}}function e9(e,t,r){return(void 0===r&&(r=1/0),G(t))?e9(function(r,i){return eY(function(e,n){return t(r,e,i,n)})(eV(e(r,i)))},r):("number"==typeof t&&(r=t),ez(function(t,i){return e6(t,i,e,r)}))}function e7(e){return void 0===e&&(e=1/0),e9(ev,e)}function e8(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e7(1)(eJ(e,e5(e)))}function te(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e5(e);return ez(function(t,i){e7(1)(eJ(H([t],W(e)),r)).subscribe(i)})}function tt(e){return new eE(function(t){eV(e()).subscribe(t)})}var tr=new eE(function(e){return e.complete()});function ti(e,t){return ez(function(r,i){var n=0;r.subscribe(eW(i,function(r){return e.call(t,r,n++)&&i.next(r)}))})}var tn=Q(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}});function ts(e,t){var r="object"==typeof t;return new Promise(function(i,n){var s=new ef({next:function(e){i(e),s.unsubscribe()},error:n,complete:function(){r?i(t.defaultValue):n(new tn)}});e.subscribe(s)})}var to=["addListener","removeListener"],ta=["addEventListener","removeEventListener"],tl=["on","off"];function tc(e,t,r,i){if(G(r)&&(i=r,r=void 0),i)return tc(e,t,r).pipe(eZ(i));var n=W(G(e.addEventListener)&&G(e.removeEventListener)?ta.map(function(i){return function(n){return e[i](t,n,r)}}):G(e.addListener)&&G(e.removeListener)?to.map(tu(e,t)):G(e.on)&&G(e.off)?tl.map(tu(e,t)):[],2),s=n[0],o=n[1];if(!s&&eA(e))return e9(function(e){return tc(e,t,r)})(eV(e));if(!s)throw TypeError("Invalid event target");return new eE(function(e){var t=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.next(1<t.length?t:t[0])};return s(t),function(){return o(t)}})}function tu(e,t){return function(r){return function(i){return e[r](t,i)}}}var tp=function(e){function t(t,r){return e.call(this)||this}return F(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(X),th={setInterval:function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var n=th.delegate;return(null==n?void 0:n.setInterval)?n.setInterval.apply(n,H([e,t],W(r))):setInterval.apply(void 0,H([e,t],W(r)))},clearInterval:function(e){var t=th.delegate;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},td=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.scheduler=t,i.work=r,i.pending=!1,i}return F(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var r,i=this.id,n=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(n,i,t)),this.pending=!0,this.delay=t,this.id=null!==(r=this.id)&&void 0!==r?r:this.requestAsyncId(n,this.id,t),this},t.prototype.requestAsyncId=function(e,t,r){return void 0===r&&(r=0),th.setInterval(e.flush.bind(e,this),r)},t.prototype.recycleAsyncId=function(e,t,r){if(void 0===r&&(r=0),null!=r&&this.delay===r&&!1===this.pending)return t;null!=t&&th.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return Error("executing a cancelled action");this.pending=!1;var r=this._execute(e,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var r,i=!1;try{this.work(e)}catch(e){i=!0,r=e||Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,r=this.scheduler,i=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Y(i,this),null!=t&&(this.id=this.recycleAsyncId(r,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(tp),tf={now:function(){return(tf.delegate||Date).now()},delegate:void 0},tb=function(){function e(t,r){void 0===r&&(r=e.now),this.schedulerActionCtor=t,this.now=r}return e.prototype.schedule=function(e,t,r){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},e.now=tf.now,e}(),tg=new(function(e){function t(t,r){void 0===r&&(r=tb.now);var i=e.call(this,t,r)||this;return i.actions=[],i._active=!1,i}return F(t,e),t.prototype.flush=function(e){var t,r=this.actions;if(this._active){r.push(e);return}this._active=!0;do if(t=e.execute(e.state,e.delay))break;while(e=r.shift())if(this._active=!1,t){for(;e=r.shift();)e.unsubscribe();throw t}},t}(tb))(td);function tm(e){return e instanceof Date&&!isNaN(e)}function ty(e,t,r){void 0===e&&(e=0),void 0===r&&(r=tg);var i=-1;return null!=t&&(e0(t)?r=t:i=t),new eE(function(t){var n=tm(e)?+e-r.now():e;n<0&&(n=0);var s=0;return r.schedule(function(){t.closed||(t.next(s++),0<=i?this.schedule(void 0,i):t.complete())},n)})}function tv(e,t){var r="object"==typeof t;return new Promise(function(i,n){var s,o=!1;e.subscribe({next:function(e){s=e,o=!0},error:n,complete:function(){o?i(s):r?i(t.defaultValue):n(new tn)}})})}function tw(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=e5(t),n=(e=1/0,"number"==typeof e1(t)?t.pop():e);return t.length?1===t.length?eV(t[0]):e7(n)(eJ(t,i)):tr}var t_=new eE(es);function tE(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e5(e);return eJ(e,r)}var tS=Array.isArray;function tI(e){return 1===e.length&&tS(e[0])?e[0]:e}function t$(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return 1===(t=tI(t)).length?eV(t[0]):new eE((e=t,function(t){for(var r=[],i=function(i){r.push(eV(e[i]).subscribe(eW(t,function(e){if(r){for(var n=0;n<r.length;n++)n!==i&&r[n].unsubscribe();r=null}t.next(e)})))},n=0;r&&!t.closed&&n<e.length;n++)i(n)}))}var tT=function(e){function t(t,r,i){void 0===t&&(t=1/0),void 0===r&&(r=1/0),void 0===i&&(i=tf);var n=e.call(this)||this;return n._bufferSize=t,n._windowTime=r,n._timestampProvider=i,n._buffer=[],n._infiniteTimeWindow=!0,n._infiniteTimeWindow=r===1/0,n._bufferSize=Math.max(1,t),n._windowTime=Math.max(1,r),n}return F(t,e),t.prototype.next=function(t){var r=this.isStopped,i=this._buffer,n=this._infiniteTimeWindow,s=this._timestampProvider,o=this._windowTime;!r&&(i.push(t),n||i.push(s.now()+o)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),r=this._infiniteTimeWindow,i=this._buffer.slice(),n=0;n<i.length&&!e.closed;n+=r?1:2)e.next(i[n]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this._bufferSize,t=this._timestampProvider,r=this._buffer,i=this._infiniteTimeWindow,n=(i?1:2)*e;if(e<1/0&&n<r.length&&r.splice(0,r.length-n),!i){for(var s=t.now(),o=0,a=1;a<r.length&&r[a]<=s;a+=2)o=a;o&&r.splice(0,o+1)}},t}(e$);function tC(e,t){return ez(function(r,i){var n=null,s=0,o=!1,a=function(){return o&&!n&&i.complete()};r.subscribe(eW(i,function(r){null==n||n.unsubscribe();var o=0,l=s++;eV(e(r,l)).subscribe(n=eW(i,function(e){return i.next(t?t(r,e,l,o++):e)},function(){n=null,a()}))},function(){o=!0,a()}))})}function tR(e,t){var r=G(e)?e:function(){return e},i=function(e){return e.error(r())};return new eE(t?function(e){return t.schedule(i,0,e)}:i)}var tM=Q(function(e){return function(t){void 0===t&&(t=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}});function tx(e,t){var r=tm(e)?{first:e}:"number"==typeof e?{each:e}:e,i=r.first,n=r.each,s=r.with,o=void 0===s?tO:s,a=r.scheduler,l=void 0===a?null!=t?t:tg:a,c=r.meta,u=void 0===c?null:c;if(null==i&&null==n)throw TypeError("No timeout provided.");return ez(function(e,t){var r,s,a=null,c=0,p=function(e){s=ej(t,l,function(){try{r.unsubscribe(),eV(o({meta:u,lastValue:a,seen:c})).subscribe(t)}catch(e){t.error(e)}},e)};r=e.subscribe(eW(t,function(e){null==s||s.unsubscribe(),c++,t.next(a=e),n>0&&p(n)},void 0,void 0,function(){(null==s?void 0:s.closed)||null==s||s.unsubscribe(),a=null})),c||p(null!=i?"number"==typeof i?i:+i-l.now():n)})}function tO(e){throw new tM(e)}function tN(e){return ez(function(t,r){var i,n=null,s=!1;n=t.subscribe(eW(r,void 0,void 0,function(o){i=eV(e(o,tN(e)(t))),n?(n.unsubscribe(),n=null,i.subscribe(r)):s=!0})),s&&(n.unsubscribe(),n=null,i.subscribe(r))})}function tA(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e2(e);return r?ew(tA.apply(void 0,H([],W(e))),eZ(r)):ez(function(t,r){e3(H([t],W(tI(e))))(r)})}function tk(e,t){return void 0===t&&(t=ev),e=null!=e?e:tP,ez(function(r,i){var n,s=!0;r.subscribe(eW(i,function(r){var o=t(r);(s||!e(n,o))&&(s=!1,n=o,i.next(r))}))})}function tP(e,t){return e===t}function tU(e,t,r){return void 0===t&&(t=1/0),t=1>(t||0)?1/0:t,ez(function(i,n){return e6(i,n,e,t,void 0,!0,r)})}function tD(e){return ez(function(t,r){try{t.subscribe(r)}finally{r.add(e)}})}function tB(e){return e<=0?function(){return tr}:ez(function(t,r){var i=0;t.subscribe(eW(r,function(t){++i<=e&&(r.next(t),e<=i&&r.complete())}))})}function tL(e){return ez(function(t,r){var i=!1;t.subscribe(eW(r,function(e){i=!0,r.next(e)},function(){i||r.next(e),r.complete()}))})}function tq(e,t){var r=arguments.length>=2;return function(i){var n;return i.pipe(e?ti(function(t,r){return e(t,r,i)}):ev,tB(1),r?tL(t):(n=function(){return new tn},ez(function(e,t){var r=!1;e.subscribe(eW(t,function(e){r=!0,t.next(e)},function(){return r?t.complete():t.error(n())}))})))}}function tV(e){void 0===e&&(e={});var t=e.connector,r=void 0===t?function(){return new e$}:t,i=e.resetOnError,n=void 0===i||i,s=e.resetOnComplete,o=void 0===s||s,a=e.resetOnRefCountZero,l=void 0===a||a;return function(e){var t,i,s,a=0,c=!1,u=!1,p=function(){null==i||i.unsubscribe(),i=void 0},h=function(){p(),t=s=void 0,c=u=!1},d=function(){var e=t;h(),null==e||e.unsubscribe()};return ez(function(e,f){a++,u||c||p();var b=s=null!=s?s:r();f.add(function(){0!=--a||u||c||(i=tF(d,l))}),b.subscribe(f),!t&&a>0&&(t=new ef({next:function(e){return b.next(e)},error:function(e){u=!0,p(),i=tF(h,n,e),b.error(e)},complete:function(){c=!0,p(),i=tF(h,o),b.complete()}}),eV(e).subscribe(t))})(e)}}function tF(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(!0===t){e();return}if(!1!==t){var n=new ef({next:function(){n.unsubscribe(),e()}});return eV(t.apply(void 0,H([],W(r)))).subscribe(n)}}function tj(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e5(e);return ez(function(t,i){(r?e8(e,t,r):e8(e,t)).subscribe(i)})}function tz(e){return ez(function(t,r){eV(e).subscribe(eW(r,function(){return r.complete()},es)),r.closed||t.subscribe(r)})}function tW(e,t){return void 0===t&&(t=!1),ez(function(r,i){var n=0;r.subscribe(eW(i,function(r){var s=e(r,n++);(s||t)&&i.next(r),s||i.complete()}))})}function tH(e,t,r){var i=G(e)||t||r?{next:e,error:t,complete:r}:e;return i?ez(function(e,t){null===(r=i.subscribe)||void 0===r||r.call(i);var r,n=!0;e.subscribe(eW(t,function(e){var r;null===(r=i.next)||void 0===r||r.call(i,e),t.next(e)},function(){var e;n=!1,null===(e=i.complete)||void 0===e||e.call(i),t.complete()},function(e){var r;n=!1,null===(r=i.error)||void 0===r||r.call(i,e),t.error(e)},function(){var e,t;n&&(null===(e=i.unsubscribe)||void 0===e||e.call(i)),null===(t=i.finalize)||void 0===t||t.call(i)}))}):ev}function tK(e){return Array.from(e.entries()).reduce((e,[t,r])=>(e[t]=r,e),{})}(e=y||(y={})).orElse=function(e,t){return void 0!==e?e:"function"==typeof t?t():t},e.orElseThrow=function(e,t){if(void 0!==e)return e;throw t()},(t=v||(v={})).coerce=function(e,t){return null==e?y.orElse(t&&t.coerceNullOrUndefined,!0)?[]:e:Array.isArray(e)?e:[e]},t.isEqual=function(e,t,r){return e===t||!!e&&!!t&&e.length===t.length&&(r?.exactOrder??!0?e.every((e,r)=>e===t[r]):e.every(e=>t.includes(e))&&t.every(t=>e.includes(t)))},t.remove=function(e,t,r){let i=y.orElse(r&&r.firstOnly,!1),n="function"==typeof t?()=>e.findIndex(t):()=>e.indexOf(t),s=[];for(let t=n();-1!==t&&(s.push(...e.splice(t,1)),!i);t=n());return s},t.distinct=function(e,t=ev){let r=new Set(e.map(t));return e.filter(e=>r.delete(t(e)))},t.intersect=function(...e){let t=e.filter(e=>null!=e);if(!t.length)return[];let r=t.pop();return t.reduce((e,t)=>e.filter(e=>t.includes(e)),[...r])},t.last=function(e,t){if(e){if(!t)return e[e.length-1];for(let r=e.length-1;r>=0;r--)if(t(e[r]))return e[r]}},(w||(w={})).isEqual=function(e,t){return e===t||!!e&&!!t&&Object.keys(e).length===Object.keys(t).length&&Object.entries(e).every(([e,r])=>t[e]===r)},(r=_||(_={})).coerce=function(e,t){if(null==e)return y.orElse(t&&t.coerceNullOrUndefined,!0)?{}:e;if(e instanceof Map)return tK(e);try{let t=new Map(e);return tK(t)}catch{}return e},r.withoutUndefinedEntries=function(e){return Object.entries(e).reduce((e,[t,r])=>(void 0!==r&&(e[t]=r),e),{})},(i=E||(E={})).coerce=function(e,t){if(null==e)return y.orElse(t&&t.coerceNullOrUndefined,!0)?new Map:e;if(e instanceof Map)return e;try{return new Map(e)}catch{}return Object.entries(e).reduce((e,[t,r])=>e.set(t,r),new Map)},i.addSetValue=function(e,t,r){let i=e.get(t)||new Set;return e.set(t,i.add(r))},i.removeSetValue=function(e,t,r){let i;let n=e.get(t)||new Set;return(i="function"==typeof r?Array.from(n).filter(r).reduce((e,t)=>n.delete(t)||e,!1):n.delete(r))&&!n.size&&e.delete(t),i},i.addListValue=function(e,t,r){let i=e.get(t)||[];return e.set(t,i.concat(r))},i.removeListValue=function(e,t,r){let i=e.get(t)||[],n=v.remove(i,r,{firstOnly:!1}).length>0;return n&&!i.length&&e.delete(t),n},(S||(S={})).coerce=function(e){return e instanceof eE?e:e instanceof Promise?eJ(e):tE(e)};let tG=new class{constructor(){this._beanRegistry=new Map,this._decoratorRegistry=new Map,this._initializers=[],this._sequence=0,this._runlevel$=new eR(-1),this._eagerBeansConstructed=!1,this._started=!1}register(e,t){if(!e)throw Error("[BeanRegisterError] Missing bean lookup symbol.");t&&Object.keys(t).some(e=>e.startsWith("use"))||(t={...t,useClass:e}),tY(e,t);let r=y.orElse(t.multi,!1);if(r&&this._beanRegistry.has(e)&&Array.from(this._beanRegistry.get(e)).some(e=>!e.multi))throw Error("[BeanRegisterError] Trying to register a bean as 'multi-bean' on a symbol that has already registered a 'non-multi-bean'. This is probably not what was intended.");if(!r&&this._beanRegistry.has(e)&&Array.from(this._beanRegistry.get(e)).some(e=>e.multi))throw Error("[BeanRegisterError] Trying to register a bean on a symbol that has already registered a 'multi-bean'. This is probably not what was intended.");!r&&this._beanRegistry.has(e)&&this.disposeBean(this._beanRegistry.get(e).values().next().value);let i={symbol:e,beanConstructFn:tJ(t),eager:y.orElse(t.eager||void 0!==t.useValue,!1),multi:r,instructions:t,constructing:!1};if(r){let t=this._beanRegistry.get(e)||new Set;this._beanRegistry.set(e,t.add(i))}else this._beanRegistry.set(e,new Set([i]));return i.eager&&this._eagerBeansConstructed&&this.getOrConstructBeanInstance(i),{unregister:()=>this.disposeBean(i)}}registerIfAbsent(e,t){if(!e)throw Error("[BeanRegisterError] Missing bean lookup symbol.");return this._beanRegistry.has(e)?{unregister:es}:this.register(e,t)}registerDecorator(e,t){if(this._started)throw Error("[BeanManagerLifecycleError] Decorators can only be registered before starting the bean manager.");if(!e)throw Error("[BeanDecoratorRegisterError] A decorator requires a symbol.");tY(e,t);let r=tJ(t)();E.addListValue(this._decoratorRegistry,e,r)}registerInitializer(e){if(this._started)throw Error("[BeanManagerLifecycleError] Initializers can only be registered before starting the bean manager.");let t=(()=>{if("function"==typeof e)return{fn:e};if(void 0!==e.runlevel&&e.runlevel<0)throw Error(`[InitializerRegisterError] The runlevel of an initializer must be >= 0, but was ${e.runlevel}.`);if(e.useFunction)return{fn:e.useFunction,runlevel:e.runlevel};if(e.useClass){let t=e.useClass;return{fn:()=>new t().init(),runlevel:e.runlevel}}if(e.useExisting){let t=e.useExisting;return{fn:()=>tG.get(t).init(),runlevel:e.runlevel}}throw Error("[NullInitializerError] No initializer specified.")})();this._initializers.push(t)}get(e,t){let r=this.all(e);switch(r.length){case 0:if(t?.orElseGet!==void 0)return t.orElseGet;if(t?.orElseSupply)return t.orElseSupply();throw Error(`[NullBeanError] No bean registered under the symbol '${tX(e)}'.`);case 1:return r[0];default:throw Error(`[MultiBeanError] Multiple beans registered under the symbol '${tX(e)}'.`)}}opt(e){return this.get(e,{orElseSupply:()=>void 0})}all(e){let t=Array.from(this._beanRegistry.get(e)||new Set);if(!t||!t.length)return[];if(t.some(e=>e.constructing))throw Error(`[BeanConstructError] Circular bean construction cycle detected [bean={${tX(e)}}].`);return t.map(e=>this.getOrConstructBeanInstance(e))}async start(e){if(this._started)throw Error("[BeanManagerLifecycleError] Bean manager already started.");let t=e?.initializerDefaultRunlevel??0,r=e?.eagerBeanConstructRunlevel??(0===this._initializers.length?t+1:Math.max(...this._initializers.map(e=>e.runlevel??t))+1);this.registerInitializer({useFunction:async()=>{this.constructEagerBeans(),this._eagerBeansConstructed=!0},runlevel:r}),await this.runInitializers(t),this._started=!0}destroy(){this.getBeanInfos().sort(tQ).forEach(e=>this.disposeBean(e)),this._beanRegistry.clear(),this._decoratorRegistry.clear(),this._initializers.length=0,this._runlevel$.next(-1),this._eagerBeansConstructed=!1,this._started=!1}disposeBean(e){if((e.instructions.useClass||e.instructions.useFactory)&&e.instance&&"function"==typeof e.instance.preDestroy)try{e.instance.preDestroy()}catch(e){console?.error("Bean threw an error in `preDestroy`",e)}e.instance=void 0,e.constructing=!1,E.removeSetValue(this._beanRegistry,e.symbol,e)}async whenRunlevel(e){return ts(this._runlevel$.pipe(ti(t=>t>=e))).then(()=>Promise.resolve())}getBeanInfos(){return Array.from(this._beanRegistry.values()).reduce((e,t)=>e.concat(Array.from(t)),[])}async runInitializers(e){let t=this._initializers.reduce((t,r)=>E.addListValue(t,r.runlevel??e,r.fn),new Map);for(let e of Array.from(t.keys()).sort((e,t)=>e-t)){this._runlevel$.next(e);try{await Promise.all(t.get(e).map(e=>e()))}catch(t){throw Error(`[InitializerError] Initializer rejected with an error: ${t} [runlevel=${e}]`)}}}constructEagerBeans(){this.getBeanInfos().filter(e=>e.eager).forEach(e=>this.getOrConstructBeanInstance(e))}getOrConstructBeanInstance(e){if(e.instance)return e.instance;e.constructing=!0;try{let t=e.beanConstructFn(),r=this._decoratorRegistry.get(e.symbol)||[];return e.instance=[...r].reverse().reduce((e,t)=>t.decorate(e),t),e.constructInstant=++this._sequence,e.instance}finally{e.constructing=!1}}};function tQ(e,t){return(e.instructions.destroyOrder??0)<(t.instructions.destroyOrder??0)?-1:(e.instructions.destroyOrder??0)>(t.instructions.destroyOrder??0)?1:(t.constructInstant??0)-(e.constructInstant??0)}function tJ(e){if(void 0!==e.useValue){let t=e.useValue;return()=>t}if(e.useClass){let t=e.useClass;return()=>new t}if(e.useFactory){let t=e.useFactory;return()=>t()}if(e.useExisting){let t=e.useExisting;return()=>tG.get(t)}throw Error("[BeanConstructError] Missing bean construction strategy")}function tY(e,t){switch(Object.keys(t).filter(e=>e.startsWith("use")).length){case 0:throw Error(`[BeanRegisterError] Missing bean construction strategy. Expected one of 'useValue', 'useClass', 'useFactory' or 'useExisting' [bean=${e.toString()}, instructions=${JSON.stringify(t)}]`);case 1:break;default:throw Error(`[BeanRegisterError] Multiple bean construction strategies specified. Expected one of 'useValue', 'useClass', 'useFactory' or 'useExisting' [bean=${e.toString()}, instructions=${JSON.stringify(t)}]`)}if(Object.keys(t).includes("useValue")&&void 0===t.useValue)throw Error(`[BeanRegisterError] Passing \`undefined\` as bean value is not supported [bean=${e.toString()}].`)}function tX(e){return"function"==typeof e?e.name:e.toString()}let tZ=function*(){let e=[];for(let t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);for(;;){let t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0,s=e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&r]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[63&i|128]+e[i>>8&255]+"-"+e[i>>16&255]+e[i>>24&255]+e[255&n]+e[n>>8&255]+e[n>>16&255]+e[n>>24&255];yield s}}();var t0=Object.freeze({__proto__:null,randomUUID:function(){return tZ.next().value}});function t1(e){return e?tC(t=>{if(!t.length)return tE([]);let r=t.map(e);return r.every(e=>"boolean"==typeof e)?tE(t.filter((e,t)=>r[t])):e4(r.map(e=>S.coerce(e).pipe(tL(!1),tN(()=>tE(!1))))).pipe(tk((e,t)=>v.isEqual(e,t)),eY(e=>t.filter((t,r)=>e[r])))}):e=>e}function t2(e){return eY(t=>t.map(t=>e(t)))}function t5(e){let t=eJ(e).pipe(tB(1),e9(()=>tr),tV({resetOnComplete:!1,resetOnError:!1,resetOnRefCountZero:!1}));return e9(e=>e8(t,tE(e)))}(n=I||(I={}))[n.Starting=1]="Starting",n[n.Started=2]="Started",n[n.Stopping=3]="Stopping",n[n.Stopped=4]="Stopped",(s=$||($={}))[s.Zero=0]="Zero",s[s.One=1]="One",s[s.Two=2]="Two",s[s.Three=3]="Three",(o=T||(T={})).Activator="activator",o.Microfrontend="microfrontend";let t4=Symbol("IS_PLATFORM_HOST"),t3=Symbol("APP_IDENTITY"),t6="ɵACTIVATION_CONTEXT",t9=Symbol("ɵVERSION"),t7=Symbol("ɵWINDOW_TOP");class t8{}class re{constructor(){this._destroy$=new e$,t$(tc(window,"beforeunload"),tc(window,"unload")).pipe(tB(1),tz(this._destroy$)).subscribe(()=>{rs.destroy()})}preDestroy(){this._destroy$.next()}}class rt{}class rr{debug(e,...t){this.log("debug",e,t)}info(e,...t){this.log("info",e,t)}warn(e,...t){this.log("warn",e,t)}error(e,...t){this.log("error",e,t)}log(e,t,r){let i=r[0]instanceof rn?r.shift():{appSymbolicName:tG.get(t3),version:tG.get(t9)},n=[].concat(i.version?`[@scion/microfrontend-platform@${i.version}]`:"[@scion/microfrontend-platform]").concat(`[${i.appSymbolicName}]`).join("");if(console&&"function"==typeof console[e]){let i=console[e];r?.length?i(`${n} ${t}`,...r):i(`${n} ${t}`)}}}let ri=new class extends rt{debug(e,...t){}info(e,...t){}warn(e,...t){}error(e,...t){}};class rn{constructor(e,t){this.appSymbolicName=e,this.version=t}}class rs{static{this._state$=new eR(I.Stopped)}constructor(){}static async startPlatform(e){if(this.state===I.Started)return Promise.reject(Error("[MicrofrontendPlatformStartupError] Platform already started"));try{return e?.(),await this.enterState(I.Starting),await tG.start({eagerBeanConstructRunlevel:$.One,initializerDefaultRunlevel:$.Two}),await this.enterState(I.Started),Promise.resolve()}catch(e){return await this.destroy(),Promise.reject(Error(`[MicrofrontendPlatformStartupError] Microfrontend platform failed to start: ${e}`))}}static async destroy(){await this.enterState(I.Stopping),tG.destroy(),await this.enterState(I.Stopped)}static get state(){return this._state$.getValue()}static get state$(){return this._state$}static async whenState(e){return new Promise((t,r)=>{this._state$.pipe(tq(t=>t===e)).subscribe({error:r,complete:t})})}static async enterState(e){if((this.state===I.Stopped?-1:this.state)>=e)throw Error(`[PlatformStateError] Failed to enter platform state [prevState=${I[this.state]}, newState=${I[e]}].`);this._state$.next(e),await this.whenState(e)}}function ro(e){tG.register(t4,{useValue:e.isPlatformHost}),tG.register(t3,{useValue:e.symbolicName}),tG.registerIfAbsent(t7,{useValue:window.top}),tG.registerIfAbsent(t9,{useValue:"1.2.2",destroyOrder:C.CORE}),tG.registerIfAbsent(t8,{useClass:re,eager:!0}),tG.registerIfAbsent(rt,{useClass:rr,destroyOrder:C.CORE})}(a=C||(C={}))[a.CORE=Number.MAX_SAFE_INTEGER]="CORE",a[a.BROKER=a.CORE-1]="BROKER",a[a.MESSAGING=a.BROKER-1]="MESSAGING";class ra{}class rl{}class rc{intercept(e){e.intentions=[...e.intentions||[],...tG.get(ra).activatorApiDisabled?[]:[{type:T.Activator,qualifier:{"*":"*"}}]]}}class ru{}class rp{}function rh(e){return tz(tG.get(rp).subscriberCount$(e).pipe(tq(e=>0===e)))}function rd(){return ew(e9(e=>{let t=e.headers.get(O.Status)??A.OK;if(t<400)return tE(e);if("string"==typeof e.body){let r=e.body;return tR(()=>new rb(r,t,e))}switch(t){case A.BAD_REQUEST:return tR(()=>new rb("The receiver could not understand the request due to invalid syntax.",t,e));case A.NOT_FOUND:return tR(()=>new rb("The receiver could not find the requested resource.",t,e));case A.ERROR:return tR(()=>new rb("The receiver encountered an internal error.",t,e));default:return tR(()=>new rb("Request error.",t,e))}}),tW(e=>e.headers.get(O.Status)!==A.TERMINAL,!0),ti(e=>e.headers.get(O.Status)!==A.TERMINAL||void 0!==e.body))}function rf(){return eY(e=>e.body)}(l=R||(R={})).ClientToBroker="sci://microfrontend-platform/client-to-broker",l.BrokerToClient="sci://microfrontend-platform/broker-to-client",l.MicrofrontendToOutlet="sci://microfrontend-platform/microfrontend-to-outlet",(c=M||(M={})).TopicSubscribe="topic-subscribe",c.TopicUnsubscribe="topic-unsubscribe",c.IntentSubscribe="intent-subscribe",c.IntentUnsubscribe="intent-unsubscribe",c.Topic="topic",c.Intent="intent",c.ClientConnect="client-connect",c.ClientDisconnect="client-disconnect",(u=x||(x={})).RequestSubscriberCount="ɵREQUEST_SUBSCRIBER_COUNT",u.FocusIn="ɵFOCUS_IN",u.IsFocusWithin="ɵIS_FOCUS_WITHIN",u.HasFocus="ɵHAS_FOCUS",u.PlatformProperties="ɵPLATFORM_PROPERTIES",u.Applications="ɵAPPLICATIONS",u.LookupCapabilities="ɵLOOKUP_CAPABILITIES",u.LookupIntentions="ɵLOOKUP_INTENTIONS",u.RegisterCapability="ɵREGISTER_CAPABILITY",u.UnregisterCapabilities="ɵUNREGISTER_CAPABILITIES",u.RegisterIntention="ɵREGISTER_INTENTION",u.UnregisterIntentions="ɵUNREGISTER_INTENTIONS",u.IsApplicationQualifiedForCapability="ɵIS_APPLICATION_QUALIFIED_FOR_CAPABILITY",u.platformVersion=function(e){return`\u{275}application/${e}/platform/version`},u.ping=function(e){return`\u{275}client/${e}/ping`},(p=O||(O={})).ClientId="ɵCLIENT_ID",p.AppSymbolicName="ɵAPP_SYMBOLIC_NAME",p.MessageId="ɵMESSAGE_ID",p.ReplyTo="ɵREPLY_TO",p.Timestamp="ɵTIMESTAMP",p.Version="ɵVERSION",p.Method="ɵMETHOD",p.Status="ɵSTATUS",p["ɵSubscriberId"]="ɵSUBSCRIBER_ID",(h=N||(N={})).GET="GET",h.DELETE="DELETE",h.PUT="PUT",h.POST="POST",h.OBSERVE="OBSERVE",(d=A||(A={}))[d.OK=200]="OK",d[d.TERMINAL=250]="TERMINAL",d[d.BAD_REQUEST=400]="BAD_REQUEST",d[d.NOT_FOUND=404]="NOT_FOUND",d[d.ERROR=500]="ERROR";class rb extends Error{constructor(e,t,r){super(e),this.status=t,this.msg=r,this.name="RequestError"}}!function(e){function t(e){return e.startsWith(":")&&e.length>1}function r(e){return e?.split("/").filter(Boolean)??[]}e.containsWildcardSegments=function(e){return r(e).some(t)},e.containsEmptySegments=function(e){return e.split("/").some(e=>!e.length)},e.isWildcardSegment=t,e.split=r,e.computeWildcardSegmentPermutations=function t(r,i){let n="string"==typeof r?e.split(r):r;return 1===n.length?[n[0],i]:t(n.slice(1),i).reduce((e,t)=>(e.push(`${n[0]}/${t}`),e.push(`${i}/${t}`),e),[])},e.replaceWildcardSegments=function(e,t){return e.replace(/:[^/]+/g,t)},e.validateTopic=function(t,r){return t?e.containsEmptySegments(t)?Error(`[IllegalTopicError] Topic must not contain empty segments [topic='${t}']`):r.exactTopic&&e.containsWildcardSegments(t)?Error(`[IllegalTopicError] Topic must be exact, i.e., not contain wildcard segments [topic='${t}']`):null:Error("[IllegalTopicError] Topic must not be `null`, `undefined` or empty")}}(k||(k={}));class rg{constructor(e){if(this._patternSegments=k.split(e),!this._patternSegments.length)throw Error("[TopicMatcherError] Invalid pattern syntax. The pattern must consist of one or more topic segments, each separated by a forward slash.")}match(e){let t=k.split(e),r=this._patternSegments;if(!t.length)throw Error("[TopicMatcherError] Invalid topic. The topic must consist of one or more segments, each separated by a forward slash.");if(t.some(k.isWildcardSegment))throw Error("[TopicMatcherError] Invalid topic. Wildcard segments not allowed in an exact topic.");return r.length!==t.length?{matches:!1}:v.isEqual(t,r,{exactOrder:!0})?{matches:!0,params:new Map}:r.some(k.isWildcardSegment)&&r.every((e,r)=>e===t[r]||k.isWildcardSegment(e))?{matches:!0,params:r.reduce((e,r,i)=>k.isWildcardSegment(r)?e.set(r.substring(1),t[i]):e,new Map)}:{matches:!1}}}function rm(e){return ti(t=>{let r=t.data;return r?.transport===e&&!!r.channel&&!!r.message?.headers})}function ry(...e){let t=new Set(v.coerce(e));return ti(e=>t.has(e.data.channel))}function rv(e){return ew(ry(M.Topic),ti(t=>{let r=t.data.message.topic;return!!r&&new rg(e).match(r).matches}))}function rw(){return eY(e=>e.data.message)}function r_(e){let t;try{t=e()}catch(e){tG.opt(rt)?.error("[UnexpectedError] An unexpected error occurred.",e);return}return t instanceof Promise?t.catch(e=>{tG.opt(rt)?.error("[UnexpectedError] An unexpected error occurred.",e)}):t}function rE(e){return e instanceof Error?e.message:`${e}`}class rS{}function rI(){return e=>tG.opt(rS)?.decorate$(e)??e}class r${constructor(e){this._selectors=new Map,this._sourceError$=new e$,this._sourceComplete$=new e$,this._destroy$=new e$;let{source$:t,keySelector:r}=e;t.pipe(tz(this._destroy$)).subscribe({next:e=>{let t=r(e);this._selectors.get(t)?.forEach(t=>t.next(e))},error:e=>this._sourceError$.error(e),complete:()=>this._sourceComplete$.next()})}select$(e){return new eE(t=>{let r=new e$;E.addListValue(this._selectors,e,r);let i=tw(r,this._sourceError$).pipe(tz(this._sourceComplete$)).subscribe(t);return()=>{E.removeListValue(this._selectors,e,r),i.unsubscribe()}})}ɵsubscriberCount(){return Array.from(this._selectors.values()).reduce((e,t)=>e+t.length,0)}disconnect(){this._destroy$.next()}}class rT{}class rC{constructor(){console.log("[NullBrokerGateway] Using 'NullBrokerGateway'. Messages cannot be sent or received.")}isConnected(){return Promise.resolve(!0)}get message$(){return t_}async postMessage(e,t){return Promise.resolve()}requestReply$(e,t){return t_}subscribe$(e){return t_}}class rR{constructor(e){this._platformStopping$=new tT(1),this._session=null,this._session$=new eC,this._message$=new e$,this._selectMessagesByTopic=new r$({source$:this._message$.pipe(ry(M.Topic)),keySelector:e=>e.data.message.topic}),this._selectMessagesBySubscriberIdHeader=new r$({source$:this._message$,keySelector:e=>e.data.message.headers.get(O.ɵSubscriberId)}),this._appSymbolicName=tG.get(t3),this._brokerDiscoverTimeout=e?.brokerDiscoverTimeout??1e4,this._messageDeliveryTimeout=e?.messageDeliveryTimeout??1e4}async init(){try{let e=await this.connectToBroker();this.installBrokerMessageListener(e),this.installPingReplier(e),this._session=e,this._session$.next(e),this._session$.complete()}catch(e){throw this._session$.error(e),e}}isConnected(){return tv(this._session$).then(()=>!0).catch(()=>!1)}get session(){return this._session}async postMessage(e,t){if(rM())throw P.PLATFORM_STOPPED_ERROR;let r=this._session||await tv(this._session$),i=t0.randomUUID(),n={transport:R.ClientToBroker,channel:e,message:t};n.message.headers.set(O.MessageId,i).set(O.Timestamp,Date.now()).set(O.AppSymbolicName,this._appSymbolicName).set(O.ClientId,r.clientId);let s=new e$,o=new Promise((e,t)=>{tw(this._selectMessagesByTopic.select$(i),s).pipe(tB(1),rw(),tx({first:this._messageDeliveryTimeout,with:()=>tR(()=>P.MESSAGE_DISPATCH_ERROR(this._messageDeliveryTimeout,n))}),e9(e=>e.body.ok?tr:tR(()=>Error(e.body.details))),tz(this._platformStopping$)).subscribe({error:t,complete:e})});try{r.broker.window.postMessage(n,r.broker.origin)}catch(e){s.error(e)}await o}requestReply$(e,t){return new eE(r=>{if(rM())return r.error(P.PLATFORM_STOPPED_ERROR),es;let i=t0.randomUUID(),n=t0.randomUUID(),s=new e$,o=new e$;return t.headers.set(O.ReplyTo,i).set(O.ɵSubscriberId,n),tw(this._selectMessagesBySubscriberIdHeader.select$(n),o).pipe(ry(M.Topic),rw(),rI(),tz(tw(this._platformStopping$,s)),tD(()=>this.unsubscribe({unsubscribeChannel:M.TopicUnsubscribe,subscriberId:n,logContext:`[subscriberId=${n}, topic=${i}]`}))).subscribe({next:e=>r.next(e),error:e=>r.error(e),complete:es}),this.postMessage(e,t).catch(e=>o.error(e)),()=>s.next()})}subscribe$(e){let{messageChannel:t,subscribeChannel:r,unsubscribeChannel:i,newSubscribeCommand:n}=e;return new eE(e=>{if(rM())return e.error(P.PLATFORM_STOPPED_ERROR),es;let s=t0.randomUUID(),o=new e$,a=new e$;return tw(this._selectMessagesBySubscriberIdHeader.select$(s),a).pipe(ry(t),rw(),rI(),tz(tw(this._platformStopping$,o)),tD(()=>this.unsubscribe({unsubscribeChannel:i,subscriberId:s,logContext:JSON.stringify(n(s))}))).subscribe({next:t=>e.next(t),error:t=>e.error(t),complete:es}),this.postMessage(r,n(s)).catch(e=>a.error(e)),()=>o.next()})}async unsubscribe(e){if(rM())return;let{unsubscribeChannel:t,subscriberId:r,logContext:i}=e,n={subscriberId:r,headers:new Map};try{await this.postMessage(t,n)}catch(e){tG.get(rt,{orElseGet:ri}).error(`[UnsubscribeError] Failed to unsubscribe from destination: '${i}'. Caused by: ${e}`)}}installBrokerMessageListener(e){var t,r;tc(window,"message").pipe((t=e.broker.window,ti(e=>e.source===t)),(r=e.broker.origin,ti(e=>e.origin===r)),rm(R.BrokerToClient),eY(e=>{let t=e.data;if(t.message.headers=new Map(t.message.headers||[]),t.channel===M.Intent){let e=t.message;e.intent.params=new Map(e.intent.params||[])}if(t.channel===M.Topic){let e=t.message;e.params=new Map(e.params||[])}return e}),tz(this._platformStopping$)).subscribe(this._message$)}installPingReplier(e){tG.get(t4)||tG.get(rp).observe$(x.ping(e.clientId)).pipe(tz(this._platformStopping$)).subscribe(e=>r_(()=>{let t=e.headers.get(O.ReplyTo);tG.get(rp).publish(t,void 0,{headers:new Map().set(O.Status,A.TERMINAL)}).then()}))}connectToBroker(){let e=t0.randomUUID(),t=ts(tc(window,"message").pipe(rm(R.BrokerToClient),rv(e),e9(e=>{let t=e.data.message.body;return t?.returnCode!=="accepted"?tR(()=>Error(`${t?.returnMessage??"UNEXPECTED: Empty broker discovery response"} [code: '${t?.returnCode??"n/a"}']`)):tE({clientId:t.clientId,broker:{window:e.source,origin:e.origin}})}),tx({first:this._brokerDiscoverTimeout,with:()=>tR(()=>P.BROKER_DISCOVER_ERROR(this._brokerDiscoverTimeout))}),tH({error:e=>tG.get(rt,{orElseGet:ri}).error(rE(e))}),tz(this._platformStopping$))),r={transport:R.ClientToBroker,channel:M.ClientConnect,message:{headers:new Map().set(O.MessageId,t0.randomUUID()).set(O.Timestamp,Date.now()).set(O.AppSymbolicName,this._appSymbolicName).set(O.ReplyTo,e).set(O.Version,tG.get(t9))}};if(tG.get(t4))window.postMessage(r,window.origin);else if(window===tG.get(t7)){let e=this.collectWindowHierarchy();ty(0,25).pipe(tz(t.catch(()=>null))).subscribe(()=>{e.forEach(e=>e.postMessage(r,"*"))})}else this.collectWindowHierarchy().forEach(e=>e.postMessage(r,"*"));return t}disconnectFromBroker(){if(!this._session)return;let e={transport:R.ClientToBroker,channel:M.ClientDisconnect,message:{headers:new Map().set(O.MessageId,t0.randomUUID()).set(O.Timestamp,Date.now()).set(O.AppSymbolicName,this._appSymbolicName).set(O.ClientId,this._session.clientId)}};try{this._session.broker.window.postMessage(e,this._session.broker.origin)}catch(e){tG.get(rt,{orElseGet:ri}).warn(`[ClientDisconnectError] Failed to disconnect from the broker. Caused by: ${e}`)}}collectWindowHierarchy(){let e=[];for(let t=window;t!==tG.get(t7);t=t.parent)e.unshift(t);return e.unshift(tG.get(t7)),e}preDestroy(){this.disconnectFromBroker(),this._platformStopping$.next(),this._selectMessagesByTopic.disconnect(),this._selectMessagesBySubscriberIdHeader.disconnect()}}function rM(){return rs.state>=I.Stopped}(f=P||(P={})).PLATFORM_STOPPED_ERROR=Error("[GatewayError] Platform is stopped. Messages cannot be published or received."),f.MESSAGE_DISPATCH_ERROR=function(e,t){return Error(`[GatewayError] No acknowledgement received within ${e}ms for a message sent to the broker. [msg=${JSON.stringify(t,(e,t)=>t instanceof Map?_.coerce(t):t)}]`)},f.BROKER_DISCOVER_ERROR=function(e){return Error(`[GatewayError] Message broker not discovered within ${e}ms. Messages cannot be published or received.`)};class rx{constructor(){this._properties=new Map}async init(){if(tG.get(rT) instanceof rC)return;let e=tG.get(rp).observe$(x.PlatformProperties);this._properties=await ts(e.pipe(rf(),eY(e=>E.coerce(e))))}contains(e){return this._properties.has(e)}get(e,t){if(this._properties.has(e))return this._properties.get(e);if(void 0!==t)return t;throw Error(`[PropertyNotFoundError] No property of given name found [prop=${e}]`)}properties(){return this._properties}}class rO{fetch(e,t){return fetch(e,t)}}class rN{}let rA=/^(https?:\/\/)|(blob:)/;(b=U||(U={})).isAbsoluteUrl=function(e){return"about:blank"===e||rA.test(e)},b.newUrl=function(e,t){if(t){let r=new URL(t);return r.pathname&&!r.pathname.endsWith("/")&&(r.pathname+="/"),new URL(e,r)}return new URL(e)},b.ensureTrailingSlash=function(e){return e.endsWith("/")?e:e+"/"};class rk{constructor(){this._applications=new Map}static{this.SYMBOLIC_NAME_REGEXP=/^[a-z0-9-]+$/}async registerApplication(e,t){if(y.orElseThrow(e.symbolicName,()=>Error(`[ApplicationRegistrationError] Invalid application config. Missing required property 'symbolicName'. [appConfig="${JSON.stringify(e)}", manifest="${JSON.stringify(t)}"]`)),y.orElseThrow(e.manifestUrl,()=>Error(`[ApplicationRegistrationError] Invalid application config. Missing required property 'manifestUrl'. [appConfig="${JSON.stringify(e)}", manifest="${JSON.stringify(t)}"]`)),!rk.SYMBOLIC_NAME_REGEXP.test(e.symbolicName))throw Error(`[ApplicationRegistrationError] Symbolic name must be lowercase and contain alphanumeric and dash characters [symbolicName='${e.symbolicName}'].`);if(Array.from(this._applications.values()).some(t=>t.symbolicName===e.symbolicName))throw Error(`[ApplicationRegistrationError] Symbolic name must be unique [symbolicName='${e.symbolicName}'].`);let r=this.computeBaseUrl(e,t);for(let i of(this._applications.set(e.symbolicName,{symbolicName:e.symbolicName,name:t.name??e.symbolicName,baseUrl:r,manifestUrl:U.newUrl(e.manifestUrl,U.isAbsoluteUrl(e.manifestUrl)?e.manifestUrl:window.origin).toString(),manifestLoadTimeout:e.manifestLoadTimeout??tG.get(ra).manifestLoadTimeout,activatorLoadTimeout:e.activatorLoadTimeout??tG.get(ra).activatorLoadTimeout,allowedMessageOrigins:new Set(v.coerce(e.secondaryOrigin)).add(U.newUrl(r).origin),scopeCheckDisabled:y.orElse(e.scopeCheckDisabled,!1),intentionCheckDisabled:y.orElse(e.intentionCheckDisabled,!1),intentionRegisterApiDisabled:y.orElse(e.intentionRegisterApiDisabled,!0)}),t.capabilities??[]))try{await tG.get(rN).registerCapability(i,e.symbolicName)}catch(t){tG.get(rt).error(`[CapabilityRegisterError] Failed to register capability for application '${e.symbolicName}'. [capability=${JSON.stringify(i)}]`,t)}t.intentions?.forEach(t=>{try{tG.get(rN).registerIntention(t,e.symbolicName)}catch(r){tG.get(rt).error(`[IntentionRegisterError] Failed to register intention for application '${e.symbolicName}' [intention=${JSON.stringify(t)}].`,r)}})}getApplication(e,t){let r=this._applications.get(e);if(!r&&!t)throw Error(`[NullApplicationError] No application registered under the symbolic name '${e}'.`);return r??null}getApplications(){return Array.from(this._applications.values())}isScopeCheckDisabled(e){return y.orElseThrow(this._applications.get(e),()=>Error(`[NullApplicationError] No application registered under the symbolic name '${e}'.`)).scopeCheckDisabled}isIntentionRegisterApiDisabled(e){return y.orElseThrow(this._applications.get(e),()=>Error(`[NullApplicationError] No application registered under the symbolic name '${e}'.`)).intentionRegisterApiDisabled}isIntentionCheckDisabled(e){return y.orElseThrow(this._applications.get(e),()=>Error(`[NullApplicationError] No application registered under the symbolic name '${e}'.`)).intentionCheckDisabled}computeBaseUrl(e,t){let r=U.isAbsoluteUrl(e.manifestUrl)?U.newUrl(e.manifestUrl):U.newUrl(e.manifestUrl,window.origin);return t.baseUrl?U.isAbsoluteUrl(t.baseUrl)?U.ensureTrailingSlash(t.baseUrl):U.ensureTrailingSlash(U.newUrl(t.baseUrl,r.origin).toString()):U.ensureTrailingSlash(r.origin)}}class rP{constructor(e){this._pattern=e||{},this._patternKeys=Object.keys(this._pattern)}matches(e){let t=e||{},r=Object.keys(t),{_patternKeys:i,_pattern:n}=this;return!(!i.includes("*")&&r.some(e=>!i.includes(e)))&&i.filter(e=>"*"!==e).every(e=>n[e]===t[e]||"*"===n[e]&&void 0!==t[e]&&null!==t[e])}}class rU{constructor(){this._objectById=new Map,this._objectsByType=new Map,this._objectsByApplication=new Map,this._add$=new e$,this._remove$=new e$}add(e){this._objectById.set(e.metadata.id,e),E.addListValue(this._objectsByType,e.type,e),E.addListValue(this._objectsByApplication,e.metadata.appSymbolicName,e),this._add$.next(e)}remove(e){let t=this.find(e);this._remove(t)}find(e){let t=void 0!==e.id,r=void 0!==e.type,i=void 0!==e.appSymbolicName;return v.intersect(t?v.coerce(this._objectById.get(e.id)):void 0,r?v.coerce(this._objectsByType.get(e.type)):void 0,i?v.coerce(this._objectsByApplication.get(e.appSymbolicName)):void 0,t||r||i?void 0:Array.from(this._objectById.values())).filter(t=>void 0===e.qualifier||("function"==typeof e.qualifier?e.qualifier(t.qualifier||{}):new rP(e.qualifier).matches(t.qualifier)))}findById(e,t){let r=this._objectById.get(e);if(!r&&!t)throw Error(`[NullManifestObjectError] Manifest object '${e}' not found.`);return r??null}get change$(){return tw(this.add$,this.remove$).pipe(eY(()=>void 0))}get add$(){return this._add$}get remove$(){return this._remove$}_remove(e){let t=new Set;e.forEach(e=>{let r=e.metadata.id;this._objectById.delete(r)&&(E.removeListValue(this._objectsByType,e.type,e=>e.metadata?.id===r),E.removeListValue(this._objectsByApplication,e.metadata.appSymbolicName,e=>e.metadata?.id===r),t.add(e))}),t.size&&this._remove$.next(e)}}class rD{}!function(e){let t=new Set().add("string").add("number").add("boolean");e.validateQualifier=function(e,r){return e&&0!==Object.keys(e).length?r.exactQualifier&&Object.entries(e).some(([e,t])=>"*"===e||"*"===t)?Error(`[IllegalQualifierError] Qualifier must be exact, i.e., not contain wildcards. [qualifier='${JSON.stringify(e)}']`):Object.values(e).some(e=>""===e||null==e)?Error(`[IllegalQualifierError] Qualifier must not contain empty, \`null\`, or \`undefined\` entries. [qualifier='${JSON.stringify(e)}']`):Object.values(e).some(e=>!t.has(typeof e))?Error(`[IllegalQualifierError] Qualifier contains entries with an illegal data type. Supported data types are [${[...t].join(", ")}]. [qualifier='${JSON.stringify(e)}']`):null:null}}(D||(D={}));class rB{constructor(){this._subscriptions=new Set,this._capabilityStore=new rU,this._intentionStore=new rU,this.capabilityRegister$=this._capabilityStore.add$,this.capabilityUnregister$=this._capabilityStore.remove$,this.installCapabilityRegisterRequestHandler(),this.installCapabilityUnregisterRequestHandler(),this.installIntentionRegisterRequestHandler(),this.installIntentionUnregisterRequestHandler(),this.installCapabilitiesLookupRequestHandler(),this.installIntentionsLookupRequestHandler(),this.installIsApplicationQualifiedRequestHandler(),this.installVersionLookupHandler()}resolveCapabilitiesByIntent(e,t){let r=D.validateQualifier(e.qualifier,{exactQualifier:!0});if(r)throw r;let i={type:e.type,qualifier:e.qualifier||{}};return this._capabilityStore.find(i).filter(e=>this.isApplicationQualifiedForCapability(t,e))}hasIntention(e,t){let r=D.validateQualifier(e.qualifier,{exactQualifier:!0});if(r)throw r;let i={appSymbolicName:t,type:e.type};return tG.get(rk).isIntentionCheckDisabled(t)||this._intentionStore.find({...i,qualifier:t=>new rP(t).matches(e.qualifier)}).length>0||this._capabilityStore.find({...i,qualifier:e.qualifier||{}}).length>0}isApplicationQualifiedForCapability(e,t){if(t.metadata.appSymbolicName===e)return!0;let r=tG.get(rk).isScopeCheckDisabled(e),i=tG.get(rk).isIntentionCheckDisabled(e);return(r||!t.private)&&(i||this.hasIntentionForCapability(e,t))}hasIntentionForCapability(e,t){return this._intentionStore.find({appSymbolicName:e,type:t.type,qualifier:e=>new rP(e).matches(t.qualifier)}).length>0}async registerCapability(e,t){if(!e)throw Error("[CapabilityRegisterError] Capability must not be null or undefined.");if(!e.type)throw Error("[CapabilityRegisterError] Missing capability property: type");let r=D.validateQualifier(e.qualifier,{exactQualifier:!0});if(r)throw r;!function(e){if(!e?.length)return;let t=e.filter(e=>!e.deprecated).map(e=>e.name);e.forEach(e=>{if(void 0===e.required)throw Error(`[CapabilityParamError] Parameter '${e.name}' must be explicitly defined as required or optional.`);if(void 0!==e.deprecated){if(e.required)throw Error(`[CapabilityParamError] Deprecated parameters must be optional, not required. Alternatively, deprecated parameters can define a mapping to a required parameter via the 'useInstead' property. [param='${e.name}']`);if("object"==typeof e.deprecated&&e.deprecated.useInstead&&!t.includes(e.deprecated.useInstead))throw Error(`[CapabilityParamError] The deprecated parameter '${e.name}' defines an invalid substitute '${e.deprecated.useInstead}'. Valid substitutes are: [${t}]`)}return e})}(e.params);let i=await rq({...e,qualifier:e.qualifier??{},params:e.params??[],private:e.private??!0,metadata:{id:t0.randomUUID(),appSymbolicName:t}});return this._capabilityStore.add(i),i.metadata.id}unregisterCapabilities(e,t){this._capabilityStore.remove({...t,appSymbolicName:e})}registerIntention(e,t){if(!e)throw Error("[IntentionRegisterError] Intention must not be null or undefined.");if(!e.type)throw Error("[IntentionRegisterError] Missing intention property: type");let r=D.validateQualifier(e.qualifier,{exactQualifier:!1});if(r)throw r;let i={...e,metadata:{id:t0.randomUUID(),appSymbolicName:t}};return this._intentionStore.add(i),i.metadata.id}unregisterIntention(e,t){this._intentionStore.remove({...t,appSymbolicName:e})}installCapabilityRegisterRequestHandler(){this._subscriptions.add(tG.get(rp).onMessage(x.RegisterCapability,e=>{let t=e.body,r=e.headers.get(O.AppSymbolicName);return this.registerCapability(t,r)}))}installCapabilityUnregisterRequestHandler(){this._subscriptions.add(tG.get(rp).onMessage(x.UnregisterCapabilities,e=>{let t=e.body||{},r=e.headers.get(O.AppSymbolicName);this.unregisterCapabilities(r,t)}))}installIntentionRegisterRequestHandler(){this._subscriptions.add(tG.get(rp).onMessage(x.RegisterIntention,e=>{let t=e.body,r=e.headers.get(O.AppSymbolicName);return rL(r),this.registerIntention(t,r)}))}installIntentionUnregisterRequestHandler(){this._subscriptions.add(tG.get(rp).onMessage(x.UnregisterIntentions,e=>{let t=e.body||{},r=e.headers.get(O.AppSymbolicName);rL(r),this.unregisterIntention(r,t)}))}installCapabilitiesLookupRequestHandler(){this._subscriptions.add(tG.get(rp).onMessage(x.LookupCapabilities,e=>{let t=e.headers.get(O.AppSymbolicName),r=e.body||{},i=D.validateQualifier(r.qualifier,{exactQualifier:!1});if(i)throw i;let n=tw(this._capabilityStore.change$,this._intentionStore.change$),s=tt(()=>tE(this._capabilityStore.find(r)));return s.pipe(tU(()=>n.pipe(tB(1),e9(()=>s))),t1(e=>this.isApplicationQualifiedForCapability(t,e)),tk((e,t)=>JSON.stringify(e)===JSON.stringify(t)))}))}installIntentionsLookupRequestHandler(){this._subscriptions.add(tG.get(rp).onMessage(x.LookupIntentions,e=>{let t=e.body||{},r=D.validateQualifier(t.qualifier,{exactQualifier:!1});if(r)throw r;let i=tt(()=>tE(this._intentionStore.find(t)));return i.pipe(tU(()=>this._intentionStore.change$.pipe(tB(1),e9(()=>i))),tk((e,t)=>JSON.stringify(e)===JSON.stringify(t)))}))}installIsApplicationQualifiedRequestHandler(){this._subscriptions.add(tG.get(rp).onMessage(x.IsApplicationQualifiedForCapability,e=>tw(this._intentionStore.change$,this._capabilityStore.change$).pipe(tj(void 0),eY(()=>{let t=tG.get(rk).getApplication(e.body.appSymbolicName),r=this._capabilityStore.findById(e.body.capabilityId);return this.isApplicationQualifiedForCapability(t.symbolicName,r)}),tk())))}installVersionLookupHandler(){this._subscriptions.add(tG.get(rp).onMessage(x.platformVersion(":appSymbolicName"),e=>{let t=e.params.get("appSymbolicName"),r=tG.get(ru).register$.pipe(ti(e=>e.application.symbolicName===t)),i=tt(()=>{let e=tG.get(ru).getByApplication(t);return e.length?tE(e[0].version):tr});return i.pipe(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return te.apply(void 0,H([],W(e)))}(r.pipe(e9(()=>i))),tB(1))}))}preDestroy(){this._subscriptions.forEach(e=>e.unsubscribe())}}function rL(e){if(tG.get(rk).isIntentionRegisterApiDisabled(e))throw Error(`[IntentionRegisterError] The 'Intention Registration API' is disabled for the application '${e}'. Contact the platform administrator to enable this API.`)}async function rq(e){for(let t of tG.all(rD))e=await t.intercept(e);return e}class rV{constructor(){this._focusOwner$=new eR(void 0),this._subscriptions=new Set,this._subscriptions.add(this.monitorFocusInEvents()),this._subscriptions.add(this.replyToIsFocusWithinRequests()),this._subscriptions.add(this.replyToHasFocusRequests())}monitorFocusInEvents(){return tG.get(rp).observe$(x.FocusIn).pipe(eY(e=>e.headers.get(O.ClientId)),tk()).subscribe(e=>r_(()=>{this._focusOwner$.next(tG.get(ru).getByClientId(e)||void 0)}))}replyToIsFocusWithinRequests(){return tG.get(rp).onMessage(x.IsFocusWithin,e=>{let t=e.headers.get(O.ClientId);return this._focusOwner$.pipe(eY(e=>this.isFocusWithin(t,e)),tk())})}replyToHasFocusRequests(){return tG.get(rp).onMessage(x.HasFocus,e=>{let t=e.headers.get(O.ClientId);return this._focusOwner$.pipe(eY(e=>e?.id===t),tk())})}isFocusWithin(e,t){for(let r=t;void 0!==r;r=this.getParentClient(r))if(r.id===e)return!0;return!1}getParentClient(e){if(e.window.parent!==e.window)return tG.get(ru).getByWindow(e.window.parent)}preDestroy(){this._subscriptions.forEach(e=>e.unsubscribe())}}class rF{async fetch(e){if(!e.symbolicName)throw Error("[ManifestFetchError] Invalid application config. Missing required property 'symbolicName'.");if(!e.manifestUrl)throw Error("[ManifestFetchError] Invalid application config. Missing required property 'manifestUrl'.");let t=eJ(tG.get(rO).fetch(e.manifestUrl)),r=e.manifestLoadTimeout??tG.get(ra).manifestLoadTimeout,i=await ts(t.pipe(r?tx({first:r,with:()=>tR(()=>Error(`[ManifestFetchError] Failed to fetch manifest for application '${e.symbolicName}'. Timeout of ${r}ms elapsed.`))}):ev));if(!i.ok)throw Error(`[ManifestFetchError] Failed to fetch manifest for application '${e.symbolicName}'. Maybe the application is currently unavailable. [httpStatusCode=${i.status}, httpStatusText=${i.statusText}]`);return await i.json()}}class rj{constructor(){this._destroy$=new e$,this._subscriptions=new Map,this._subscriptionsByApp=new Map,this._subscriptionsByClient=new Map,this._register$=new e$,this._unregister$=new e$,tG.get(ru).unregister$.pipe(tz(this._destroy$)).subscribe(e=>r_(()=>{this.unregister({clientId:e.id})}))}register(e){this._subscriptions.set(e.subscriberId,e),E.addSetValue(this._subscriptionsByApp,e.client.application.symbolicName,e),E.addSetValue(this._subscriptionsByClient,e.client.id,e),this.onRegister?.(e),this._register$.next(e)}unregister(e){let t=this.subscriptions(e);t.forEach(e=>{this._subscriptions.delete(e.subscriberId),E.removeSetValue(this._subscriptionsByApp,e.client.application.symbolicName,e),E.removeSetValue(this._subscriptionsByClient,e.client.id,e),this.onUnregister?.(e),e.notifyUnsubscribe()}),this._unregister$.next(t)}subscriptions(e){let t=e?.subscriberId,r=e?.clientId,i=e?.appSymbolicName;return v.intersect(t?this.subscriptionById(t):void 0,r?this.subscriptionsByClient(r):void 0,i?this.subscriptionsByApp(i):void 0,t||i||r?void 0:Array.from(this._subscriptions.values()))}subscriptionById(e){let t=this._subscriptions.get(e);return t?[t]:[]}subscriptionsByClient(e){let t=this._subscriptionsByClient.get(e);return t?Array.from(t):[]}subscriptionsByApp(e){let t=this._subscriptionsByApp.get(e);return t?Array.from(t):[]}get register$(){return this._register$}get unregister$(){return this._unregister$}preDestroy(){this._destroy$.next()}}class rz{constructor(e,t){this.subscriberId=e,this.client=t,this.whenUnsubscribe=new Promise(e=>this.notifyUnsubscribe=e)}}let rW=":ɵANY";class rH extends rj{constructor(){super(...arguments),this._subscriptionsByTopic=new Map}onRegister(e){let t=k.replaceWildcardSegments(e.topic,rW);E.addSetValue(this._subscriptionsByTopic,t,e)}onUnregister(e){let t=k.replaceWildcardSegments(e.topic,rW);E.removeSetValue(this._subscriptionsByTopic,t,e)}subscriptions(e){let t=e?.topic,r=e?.subscriberId,i=e?.clientId,n=e?.appSymbolicName;return v.intersect(t?this.subscriptionsByTopic(t):void 0,r||n||i?super.subscriptions(e):void 0,r||n||i||t?void 0:super.subscriptions())}subscriptionsByTopic(e){let t=[];return k.computeWildcardSegmentPermutations(e,rW).forEach(e=>{t.push(...this._subscriptionsByTopic.get(e)||[])}),t}subscriptionCount$(e){let t=k.validateTopic(e,{exactTopic:!0});return t?tR(()=>t):new eE(t=>{let r=new e$,i=this.subscriptions({topic:e}).length;return t.next(i),this.register$.pipe(ti(t=>t.matches(e)),tz(r)).subscribe(()=>{i++,t.next(i)}),this.unregister$.pipe(t1(t=>t.matches(e)),ti(e=>e.length>0),tz(r)).subscribe(e=>{i-=e.length,t.next(i)}),()=>r.next()})}}class rK extends rz{constructor(e,t,r){super(t,r),this.topic=e}matches(e){return e===this.topic||new rg(this.topic).match(e).matches}}class rG{}class rQ{}function rJ(e,t){let r=new class extends rY{handle(e){return t(e)}},i=e.reduceRight((e,t)=>new class extends rY{handle(r){return t.intercept(r,e)}},r);return new class{interceptAndPublish(e){return i.handle(e)}}}class rY{}let rX=/(?<major>\d+)\.(?<minor>\d+)\.(?<patch>\d+)(-(?<prerelease>.+))?/;class rZ{constructor(){}static major(e){return r0(e??"0.0.0").major}static lt(e,t){return 0>function(e,t){if(!e&&t)return -1;if(!e&&!t)return 0;if(e&&!t)return 1;let r=r0(e),i=r0(t),n=Math.sign(r.major-i.major);if(0!==n)return n;let s=Math.sign(r.minor-i.minor);if(0!==s)return s;let o=Math.sign(r.patch-i.patch);return 0!==o?o:function(e,t){if(e.preRelease&&!t.preRelease)return -1;if(!e.preRelease&&!t.preRelease)return 0;if(!e.preRelease&&t.preRelease)return 1;for(let r=0;r<Math.max(e.preRelease.length,t.preRelease.length);r++){let i=e.preRelease[r],n=t.preRelease[r];if(void 0===i)return -1;if(void 0===n)return 1;if("number"==typeof i&&"string"==typeof n)return -1;if("string"==typeof i&&"number"==typeof n)return 1;if(i<n)return -1;if(i>n)return 1}return 0}(r,i)}(e,t)}}function r0(e){let t=e.match(rX);if(!t)throw Error(`[SemVerError] Version '${e}' is not a valid semantic version (semver).`);return{major:+t.groups.major,minor:+t.groups.minor,patch:+t.groups.patch,preRelease:t.groups.prerelease?.split(".").map(e=>{let t=+e;return Number.isNaN(t)?e:t})}}let r1=Symbol("CLIENT_PING_INTERVAL"),r2=Symbol("CLIENT_PING_TIMEOUT");class r5{constructor(e,t,r,i,n){this.id=e,this.window=t,this.origin=r,this.application=i,this.version=n??"0.0.0",this.installLivenessDetector()}installLivenessDetector(){var e,t,r,i,n,s,o,a;if(this.application.symbolicName===tG.get(t3))return;let l=tG.get(rp).request$(x.ping(this.id)).pipe(tx(tG.get(r2)),(r=void 0===(t=(e={count:1}).count)?1/0:t,i=e.delay,s=void 0!==(n=e.resetOnSuccess)&&n,r<=0?ev:ez(function(e,t){var n,o=0,a=function(){var l=!1;n=e.subscribe(eW(t,function(e){s&&(o=0),t.next(e)},void 0,function(e){if(o++<r){var s=function(){n?(n.unsubscribe(),n=null,a()):l=!0};if(null!=i){var c="number"==typeof i?ty(i):eV(i(e,o)),u=eW(t,function(){u.unsubscribe(),s()},function(){t.complete()});c.subscribe(u)}else s()}else t.error(e)})),l&&(n.unsubscribe(),n=null,a())};a()})));this._livenessDetector=(void 0===(o=tG.get(r1))&&(o=0),void 0===a&&(a=tg),o<0&&(o=0),ty(o,o,a)).pipe(tC(()=>l)).subscribe({error:()=>{this.logStaleClientWarning(),tG.get(ru).unregisterClient(this)}})}get stale(){return this.window.closed}dispose(){this._livenessDetector?.unsubscribe()}logStaleClientWarning(){tG.get(rt).warn(`[StaleClient] Stale client registration of application '${this.application.symbolicName}' detected.
       Removing stale registration. Most likely, the client could not disconnect from the broker, for example, because the client was
       disposed without notice, i.e., without receiving the browser's "unload" event, or because the browser discarded the 'DISCONNECT'
       message. Typically, the browser discards messages for windows that are already closed or if another page has been loaded into the
       window, both indicating a high load on the client during unloading.`.replace(/\s+/g," "),new rn(this.application.symbolicName,this.version))}}class r4 extends rj{subscriptions(e){return super.subscriptions(e).filter(t=>!e?.intent||t.matches(e.intent))}}class r3 extends rz{constructor(e,t,r){super(t,r),this.selector=e}matches(e){return(!this.selector.type||this.selector.type===e.type)&&(!this.selector.qualifier||!!new rP(this.selector.qualifier).matches(e.qualifier))}}class r6{constructor(){}static not(e){return t=>!e(t)}static{this.alwaysTrue=()=>!0}}class r9{constructor(e){this._requiredParamDefs=[],this._optionalParamDefs=[],this._deprecatedParamDefs=[],e.forEach(e=>{e.required??!0?this._requiredParamDefs.push(e):this._optionalParamDefs.push(e),e.deprecated&&this._deprecatedParamDefs.push(e)})}match(e){let t=new Map(e),r={matches:!0,params:t,missingParams:[],unexpectedParams:[],deprecatedParams:[]};return this._deprecatedParamDefs.filter(e=>t.has(e.name)).forEach(e=>{r.deprecatedParams.push(e);let i=e.deprecated;"object"==typeof i&&i.useInstead&&(t.set(i.useInstead,t.get(e.name)),t.delete(e.name))}),this._requiredParamDefs.filter(e=>!t.has(e.name)||void 0===t.get(e.name)).filter(e=>!this._deprecatedParamDefs.includes(e)).forEach(e=>{r.matches=!1,r.missingParams.push(e)}),Array.from(t.keys()).filter(e=>!this._requiredParamDefs.some(t=>t.name===e)&&!this._optionalParamDefs.some(t=>t.name===e)).forEach(e=>{r.matches=!1,r.unexpectedParams.push(e)}),r.matches||(r.params=void 0),r}}class r7{constructor(){}static validateParams(e){let{intent:t,capability:r}=e,i=e.headers.get(O.AppSymbolicName);t.params=new Map(t.params),t.params.forEach((e,r)=>{void 0===e&&t.params.delete(r)});let n=new r9(r.params||[]).match(t.params);if(!n.matches){let e=function(e,t){let r=JSON.stringify(t,(e,t)=>"params"===e?void 0:t),i=e.missingParams.map(e=>e.name),n=e.unexpectedParams;return`Params of intent do not match expected params of capability. The intent must have required params and not have additional params. [intent=${r}, missingParams=[${i}], unexpectedParams=[${n}]].`}(n,t);throw Error(`[IntentParamValidationError] ${e}`)}n.deprecatedParams.length&&(n.deprecatedParams.forEach(e=>{let r=function(e,t){let r=e.deprecated,i="object"==typeof r&&r.useInstead||void 0,n="object"==typeof r&&r.message||void 0;return[].concat(`Application '${t.appSymbolicName}' passes a deprecated parameter in the intent: '${e.name}'.`).concat(i?`Pass parameter '${i}' instead.`:[]).concat(n||[]).join(" ")}(e,{appSymbolicName:i});tG.get(rt).warn(`[DEPRECATION][4EAC5956] ${r}`,new rn(i),t)}),t.params=n.params)}}class r8{constructor(){this._destroy$=new e$,this._clientRegistry=tG.get(ru),this._topicSubscriptionRegistry=tG.get(rH),this._intentSubscriptionRegistry=tG.get(r4),this._retainedMessageStore=new Map,this._retainedIntentStore=new Map,this._applicationRegistry=tG.get(rk),this._manifestRegistry=tG.get(rN),this._clientMessage$=tc(window,"message").pipe(rm(R.ClientToBroker),ry(M.Intent,M.Topic,M.TopicSubscribe,M.TopicUnsubscribe,M.IntentSubscribe,M.IntentUnsubscribe),t5(tG.whenRunlevel($.Two)),it(),io(),tV()),this.installClientConnectListener(),this.installClientDisconnectListener(),this.installMessageDispatcher(),this.installTopicSubscribeListener(),this.installTopicUnsubscribeListener(),this.installTopicSubscriberCountObserver(),this.sendRetainedMessageOnSubscribe(),this.installIntentDispatcher(),this.installIntentSubscribeListener(),this.installIntentUnsubscribeListener(),this.sendRetainedIntentOnSubscribe(),this.deleteRetainedIntentOnCapabilityUnregister(),this._messagePublisher=this.createMessagePublisher(),this._intentPublisher=this.createIntentPublisher()}init(){return Promise.resolve()}installClientConnectListener(){tc(window,"message").pipe(rm(R.ClientToBroker),ry(M.ClientConnect),t5(tG.whenRunlevel($.One)),io(),tz(this._destroy$)).subscribe(e=>r_(()=>{if(!e.source){tG.get(rt).debug(`[CONNECT] Ignoring stale connect request from "${e.origin}".`);return}let t=e.source,r=e.data,i=r.message.headers.get(O.AppSymbolicName),n=new il(e),s=r.message.headers.get(O.ReplyTo);if(!i){let t=`Client connect attempt rejected: Bad request. [origin='${e.origin}']`;tG.get(rt).warn(`[CONNECT] ${t}`),is(n,{topic:s,body:{returnCode:"refused:bad-request",returnMessage:`[ClientConnectError] ${t}`},headers:new Map});return}let o=this._applicationRegistry.getApplication(i,{orElse:null});if(!o){let e=`Client connect attempt rejected: Unknown client. [app='${i}']`;tG.get(rt).warn(`[CONNECT] ${e}`),is(n,{topic:s,body:{returnCode:"refused:rejected",returnMessage:`[ClientConnectError] ${e}`},headers:new Map});return}if(!o.allowedMessageOrigins.has(e.origin)){let t=`Client connect attempt blocked: Wrong origin [actual='${e.origin}', expected='${Array.from(o.allowedMessageOrigins)}', app='${o.symbolicName}']`;tG.get(rt).warn(`[CONNECT] ${t}`),is(n,{topic:s,body:{returnCode:"refused:blocked",returnMessage:`[ClientConnectError] ${t}`},headers:new Map});return}let a=this._clientRegistry.getByWindow(t);if(a&&a.origin===e.origin&&a.application.symbolicName===o.symbolicName){is(a,{topic:s,body:{returnCode:"accepted",clientId:a.id},headers:new Map});return}let l=new r5(t0.randomUUID(),t,e.origin,o,r.message.headers.get(O.Version));this._clientRegistry.registerClient(l),rZ.major(l.version)!==rZ.major(tG.get(t9))&&tG.get(rt).warn(`[VersionMismatch] Application '${o.symbolicName}' uses a different major version of the @scion/microfrontend-platform than the host application, which may not be compatible. Please upgrade @scion/microfrontend-platform of application '${o.symbolicName}' from version '${l.version}' to version '${tG.get(t9)}'.`,new rn(o.symbolicName,l.version)),is(l,{topic:s,body:{returnCode:"accepted",clientId:l.id},headers:new Map})}))}installClientDisconnectListener(){tc(window,"message").pipe(rm(R.ClientToBroker),ry(M.ClientDisconnect),t5(tG.whenRunlevel($.One)),it(),io(),tz(this._destroy$)).subscribe(e=>r_(()=>{let t=ie(e);this._clientRegistry.unregisterClient(t)}))}installTopicSubscriberCountObserver(){tG.get(rp).observe$(x.RequestSubscriberCount).pipe(tz(this._destroy$)).subscribe(e=>r_(()=>{let t=e.body,r=e.headers.get(O.ReplyTo),i=this._topicSubscriptionRegistry.subscriptionCount$(r).pipe(ti(e=>0===e));this._topicSubscriptionRegistry.subscriptionCount$(t).pipe(tz(tw(this._destroy$,i))).subscribe({next:e=>tG.get(rp).publish(r,e),error:e=>tG.get(rp).publish(r,rE(e),{headers:new Map().set(O.Status,A.ERROR)})})}))}installMessageDispatcher(){this._clientMessage$.pipe(ry(M.Topic),tz(this._destroy$)).subscribe(e=>r_(async()=>{let t=ie(e),r=e.data.message,i=r.headers.get(O.MessageId),n=k.validateTopic(r.topic,{exactTopic:!0});if(n){ii(t,i,n);return}if(r.retain&&!ia(r)&&void 0===r.body){E.removeListValue(this._retainedMessageStore,r.topic,r6.not(ia)),ir(t,i);return}try{let e=this.subscribeForRepliesIfRequest(r,t);r.headers.delete(O.ɵSubscriberId),await this._messagePublisher.interceptAndPublish(r),this.storeMessageIfRetained(r,e),ir(t,i)}catch(e){ii(t,i,e)}}))}installIntentDispatcher(){this._clientMessage$.pipe(ry(M.Intent),tz(this._destroy$)).subscribe(e=>r_(async()=>{let t=ie(e),r=e.data.message,i=r.headers.get(O.MessageId);if(!r.intent){ii(t,i,"[MessagingError] Missing message property: intent");return}if(!r.intent.type){ii(t,i,"[MessagingError] Missing message property: type");return}let n=D.validateQualifier(r.intent.qualifier,{exactQualifier:!0});if(n){ii(t,i,n);return}if(!this._manifestRegistry.hasIntention(r.intent,t.application.symbolicName)){let e=`[NotQualifiedError] Application '${t.application.symbolicName}' is not qualified to publish intents of the type '${r.intent.type}' and qualifier '${JSON.stringify(r.intent.qualifier||{})}'. Ensure to have listed the intention in the application manifest.`;ii(t,i,e);return}let s=this._manifestRegistry.resolveCapabilitiesByIntent(r.intent,t.application.symbolicName);if(0===s.length){ii(t,i,`[NullProviderError] No application found to provide a capability of the type '${r.intent.type}' and qualifiers '${JSON.stringify(r.intent.qualifier||{})}'. Maybe, the capability is not public API or the providing application not available.`);return}if(r.retain&&!ia(r)&&void 0===r.body){s.forEach(e=>{E.removeListValue(this._retainedIntentStore,e.metadata.id,r6.not(ia)),ir(t,i)});return}try{let e=this.subscribeForRepliesIfRequest(r,t);r.headers.delete(O.ɵSubscriberId),await Promise.all(s.map(e=>({...r,capability:e})).map(async t=>{r7.validateParams(t),await this._intentPublisher.interceptAndPublish(t),this.storeIntentIfRetained(t,e)})),ir(t,i)}catch(e){ii(t,i,e)}}))}sendRetainedMessageOnSubscribe(){this._topicSubscriptionRegistry.register$.pipe(tz(this._destroy$)).subscribe(e=>r_(()=>{Array.from(this._retainedMessageStore.values()).flat().filter(t=>e.matches(t.topic)).forEach(t=>this._messagePublisher.interceptAndPublish({...t,headers:new Map(t.headers).set(O.ɵSubscriberId,e.subscriberId)}))}))}sendRetainedIntentOnSubscribe(){this._intentSubscriptionRegistry.register$.pipe(tz(this._destroy$)).subscribe(e=>r_(()=>{Array.from(this._retainedIntentStore.values()).flat().filter(t=>e.client.application.symbolicName===t.capability.metadata.appSymbolicName).filter(t=>e.matches(t.intent)).forEach(t=>this._intentPublisher.interceptAndPublish({...t,headers:new Map(t.headers).set(O.ɵSubscriberId,e.subscriberId)}))}))}deleteRetainedIntentOnCapabilityUnregister(){this._manifestRegistry.capabilityUnregister$.pipe(e9(e=>eJ(e)),tz(this._destroy$)).subscribe(e=>r_(()=>{E.removeListValue(this._retainedIntentStore,e.metadata.id,r6.alwaysTrue)}))}installTopicSubscribeListener(){this._clientMessage$.pipe(ry(M.TopicSubscribe),tz(this._destroy$)).subscribe(e=>r_(()=>{let t=ie(e),r=e.data,i=r.message.headers.get(O.MessageId),n=r.message.topic,s=k.validateTopic(n,{exactTopic:!1});if(s){ii(t,i,s);return}try{let e=y.orElseThrow(r.message.subscriberId,()=>Error("[TopicSubscribeError] Missing property: subscriberId"));this._topicSubscriptionRegistry.register(new rK(n,e,t)),ir(t,i)}catch(e){ii(t,i,e)}}))}installTopicUnsubscribeListener(){this._clientMessage$.pipe(ry(M.TopicUnsubscribe),tz(this._destroy$)).subscribe(e=>r_(()=>{let t=ie(e),r=e.data,i=r.message.headers.get(O.MessageId);try{let e=y.orElseThrow(r.message.subscriberId,()=>Error("[TopicUnsubscribeError] Missing property: subscriberId"));this._topicSubscriptionRegistry.unregister({subscriberId:e}),ir(t,i)}catch(e){ii(t,i,e)}}))}installIntentSubscribeListener(){this._clientMessage$.pipe(ry(M.IntentSubscribe),tz(this._destroy$)).subscribe(e=>r_(()=>{let t=ie(e),r=e.data,i=r.message.headers.get(O.MessageId),n=D.validateQualifier(r.message.selector?.qualifier,{exactQualifier:!1});if(n){ii(t,i,n);return}try{let e=y.orElseThrow(r.message.subscriberId,()=>Error("[IntentSubscribeError] Missing property: subscriberId"));this._intentSubscriptionRegistry.register(new r3(r.message.selector||{},e,t)),ir(t,i)}catch(e){ii(t,i,e)}}))}installIntentUnsubscribeListener(){this._clientMessage$.pipe(ry(M.IntentUnsubscribe),tz(this._destroy$)).subscribe(e=>r_(()=>{let t=ie(e),r=e.data,i=r.message.headers.get(O.MessageId);try{let e=y.orElseThrow(r.message.subscriberId,()=>Error("[IntentUnsubscribeError] Missing property: subscriberId"));this._intentSubscriptionRegistry.unregister({subscriberId:e}),ir(t,i)}catch(e){ii(t,i,e)}}))}createMessagePublisher(){return rJ(tG.all(rG),async e=>{let t=this._topicSubscriptionRegistry.subscriptions({subscriberId:e.headers.get(O.ɵSubscriberId),topic:e.topic});if(ia(e)&&!e.retain&&!t.length)throw Error(`[MessagingError] No subscriber registered to answer the request [topic=${e.topic}]`);t.forEach(t=>r_(()=>is(t,e)))})}createIntentPublisher(){return rJ(tG.all(rQ),async e=>{let t=this._intentSubscriptionRegistry.subscriptions({subscriberId:e.headers.get(O.ɵSubscriberId),appSymbolicName:e.capability.metadata.appSymbolicName,intent:e.intent});if(ia(e)&&!e.retain&&!t.length)throw Error(`[MessagingError] No subscriber registered to answer the intent [intent=${JSON.stringify(e.intent)}]`);t.forEach(t=>r_(()=>(function(e,t){let r={transport:R.BrokerToClient,channel:M.Intent,message:{...t,headers:new Map(t.headers).set(O.ɵSubscriberId,e.subscriberId).set(O.MessageId,t.headers.get(O.MessageId)??t0.randomUUID()).set(O.AppSymbolicName,t.headers.get(O.AppSymbolicName)??tG.get(t3))}},i=e.client;i.stale||i.window.postMessage(r,i.origin)})(t,e)))})}subscribeForRepliesIfRequest(e,t){if(!ia(e))return null;let r=y.orElseThrow(e.headers.get(O.ɵSubscriberId),()=>Error("[MessagingError] Missing message header: subscriberId")),i=new rK(e.headers.get(O.ReplyTo),r,t);return this._topicSubscriptionRegistry.register(i),i}storeMessageIfRetained(e,t){e.retain&&(ia(e)?(y.orElseThrow(t,()=>Error("[InternalMessagingError] An unexpected error occurred. Expected subscription not to be null.")),E.addListValue(this._retainedMessageStore,e.topic,e),t.whenUnsubscribe.then(()=>E.removeListValue(this._retainedMessageStore,e.topic,e))):(E.removeListValue(this._retainedMessageStore,e.topic,r6.not(ia)),E.addListValue(this._retainedMessageStore,e.topic,e)))}storeIntentIfRetained(e,t){if(!e.retain)return;let r=e.capability.metadata.id;ia(e)?(y.orElseThrow(t,()=>Error("[InternalMessagingError] An unexpected error occurred. Expected subscription not to be null.")),E.addListValue(this._retainedIntentStore,r,e),t.whenUnsubscribe.then(()=>E.removeListValue(this._retainedIntentStore,r,e))):(E.removeListValue(this._retainedIntentStore,r,r6.not(ia)),E.addListValue(this._retainedIntentStore,r,e))}preDestroy(){this._destroy$.next()}}function ie(e){let t=e.data.message.headers.get(O.ClientId),r=tG.get(ru).getByClientId(t);if(!r)throw Error(`[NullClientError] Client not found in client registry. [clientId=${t}]`);return r}function it(){return e9(e=>{let t=e.data,r=t.message.headers.get(O.MessageId),i=t.message.headers.get(O.ClientId),n=tG.get(ru).getByClientId(i);return n?e.origin!==n.origin?(null!==e.source&&ii(new il(e),r,`[MessagingError] Message rejected: Wrong origin [actual=${e.origin}, expected=${n.origin}, application=${n.application.symbolicName}]`),tr):null!==e.source&&e.source!==n.window?(ii(new il(e),r,`[MessagingError] Message rejected: Wrong window [origin=${e.origin}]`),tr):tE(e):(null!==e.source&&ii(new il(e),r,`[MessagingError] Message rejected: Client not registered [origin=${e.origin}]`),tr)})}function ir(e,t){is(e,{topic:t,body:{ok:!0},headers:new Map})}function ii(e,t,r){is(e,{topic:t,body:{ok:!1,details:rE(r)},headers:new Map})}function is(e,t){let r={transport:R.BrokerToClient,channel:M.Topic,message:{...t,params:new Map(t.params),headers:new Map(t.headers).set(O.MessageId,t.headers.get(O.MessageId)??t0.randomUUID()).set(O.AppSymbolicName,t.headers.get(O.AppSymbolicName)??tG.get(t3))}};if(e instanceof il)e.window.closed||e.window.postMessage(r,e.origin);else if(e instanceof rK){let i=e.client;r.message.headers.set(O.ɵSubscriberId,e.subscriberId),r.message.params=new rg(e.topic).match(t.topic).params,i.stale||i.window.postMessage(r,i.origin)}else e.stale||e.window.postMessage(r,e.origin)}function io(){return tN((e,t)=>(tG.get(rt).error("[UnexpectedError] An unexpected error occurred.",e),t))}function ia(e){return e.headers.has(O.ReplyTo)}class il{constructor(e){this.window=e.source,this.origin=e.origin}}class ic{constructor(){this._applications=[]}async init(){if(tG.get(rT) instanceof rC)return;let e=tG.get(rp).observe$(x.Applications);this._applications=await ts(e.pipe(rf(),t2(e=>({...e,platformVersion:ts(tG.get(rp).request$(x.platformVersion(e.symbolicName)).pipe(rf()))}))))}get applications(){return this._applications}lookupCapabilities$(e){return tG.get(rp).request$(x.LookupCapabilities,e).pipe(rf())}lookupIntentions$(e){return tG.get(rp).request$(x.LookupIntentions,e).pipe(rf())}registerCapability(e){return tv(tG.get(rp).request$(x.RegisterCapability,e).pipe(rf()))}unregisterCapabilities(e){return new Promise((t,r)=>{tG.get(rp).request$(x.UnregisterCapabilities,e).subscribe({error:r,complete:t})})}registerIntention(e){return tv(tG.get(rp).request$(x.RegisterIntention,e).pipe(rf()))}unregisterIntentions(e){return new Promise((t,r)=>{tG.get(rp).request$(x.UnregisterIntentions,e).subscribe({error:r,complete:t})})}isApplicationQualified$(e,t){let r={appSymbolicName:e,capabilityId:t.capabilityId};return tG.get(rp).request$(x.IsApplicationQualifiedForCapability,r).pipe(rf())}}let iu="ɵCONTEXT_LOOKUP_OPTIONS";!function(e){function t(e){return`context/${e}`}e.contextTreeNamesLookupTopic=function(){return"contexttree/names"},e.contextTreeChangeTopic=function(){return"contexttree/change"},e.contextValueLookupTopic=t,e.newContextValueLookupRequest=function(e,r,i,n){return{transport:R.MicrofrontendToOutlet,channel:M.Topic,message:{topic:t(encodeURIComponent(e)),body:n||[],headers:new Map().set(O.MessageId,t0.randomUUID()).set(O.ReplyTo,r).set(iu,i)}}},e.newContextTreeNamesLookupRequest=function(t,r){return{transport:R.MicrofrontendToOutlet,channel:M.Topic,message:{topic:e.contextTreeNamesLookupTopic(),body:r||new Set,headers:new Map().set(O.MessageId,t0.randomUUID()).set(O.ReplyTo,t)}}},e.newContextTreeObserveRequest=function(t){return{transport:R.MicrofrontendToOutlet,channel:M.Topic,message:{topic:e.contextTreeChangeTopic(),headers:new Map().set(O.MessageId,t0.randomUUID()).set(O.ReplyTo,t)}}},e.RootContextSubscribeEvent="RootContextSubscribeEvent"}(B||(B={}));class ip{constructor(e){this._entries$=new eR(new Map),this._entryChange$=new e$,this._outletDisconnect$=new e$,this._microfrontendRequest$=tc(window,"message").pipe(ti(t=>t.source===e.contentWindow),rm(R.MicrofrontendToOutlet),ry(M.Topic),tV())}set(e,t){this._entries$.next(new Map(this._entries$.getValue()).set(e,t)),this._entryChange$.next({name:e,value:t,type:"set"})}remove(e){let t=new Map(this._entries$.getValue());return!!t.delete(e)&&(this._entries$.next(t),this._entryChange$.next({name:e,type:"remove"}),!0)}get entries$(){return this._entries$}onOutletMount(){this.installContextValueLookupListener(),this.installContextTreeNamesLookupListener(),this.installContextTreeObserveListener()}onOutletUnmount(){this._outletDisconnect$.next()}installContextValueLookupListener(){this._microfrontendRequest$.pipe(rv(B.contextValueLookupTopic(":name")),rw(),tz(this._outletDisconnect$)).subscribe(e=>r_(()=>{let t=decodeURIComponent(new rg(B.contextValueLookupTopic(":name")).match(e.topic).params.get("name")),r=e.headers.get(O.ReplyTo),i=e.headers.get(iu),n=this._entries$.getValue();if(i?.collect){let s=e.body||[];n.has(t)&&void 0!==n.get(t)&&s.push(n.get(t)),tG.get(t4)?tG.get(rp).publish(r,s,{headers:new Map().set(O.Status,A.OK)}):window.parent.postMessage(B.newContextValueLookupRequest(t,r,i,s),"*")}else n.has(t)&&void 0!==n.get(t)?tG.get(rp).publish(r,n.get(t),{headers:new Map().set(O.Status,A.OK)}):tG.get(t4)?tG.get(rp).publish(r,void 0,{headers:new Map().set(O.Status,A.NOT_FOUND)}):window.parent.postMessage(B.newContextValueLookupRequest(t,r,i),"*")}))}installContextTreeNamesLookupListener(){this._microfrontendRequest$.pipe(rv(B.contextTreeNamesLookupTopic()),rw(),tz(this._outletDisconnect$)).subscribe(e=>r_(()=>{let t=e.headers.get(O.ReplyTo),r=new Set([...this._entries$.getValue().keys(),...e.body||[]]);tG.get(t4)?tG.get(rp).publish(t,r,{headers:new Map().set(O.Status,A.OK)}):window.parent.postMessage(B.newContextTreeNamesLookupRequest(t,r),"*")}))}installContextTreeObserveListener(){this._microfrontendRequest$.pipe(rv(B.contextTreeChangeTopic()),rw(),tz(this._outletDisconnect$)).subscribe(e=>r_(()=>{let t=e.headers.get(O.ReplyTo);this._entryChange$.pipe(rh(t),tz(this._outletDisconnect$)).subscribe(e=>{tG.get(rp).publish(t,e)}),tG.get(t4)?tG.get(rp).publish(t,B.RootContextSubscribeEvent):window.parent.postMessage(B.newContextTreeObserveRequest(t),"*")}))}}class ih{assign(e,t,r){let i=this.patchUrl(t.url,r?.url);t.pushStateToSessionHistoryStack?e.contentWindow.location.assign(i):e.contentWindow.location.replace(i)}patchUrl(e,t){return r_(()=>{let r=t?U.newUrl(t):void 0,i=U.newUrl(e);if("about:"===i.protocol||"blob:"===i.protocol||window===tG.get(t7)||i.search||r?.origin===i.origin&&r?.pathname===i.pathname)return e;let n=U.newUrl(e);return n.searchParams.set("_",""),n.toString()})??e}}class id{constructor(e,t,r,i){this.eventType=e;let n=[];n.push(e),r&&(r.control&&n.push("control"),r.alt&&n.push("alt"),r.shift&&n.push("shift"),r.meta&&n.push("meta")),n.push(t.toLowerCase()),this.parts=n.join("."),this.flags=i}withFlags(e){return this.flags=e,this}static fromEvent(e){if(!e)throw Error("[KeystrokeParseError] Cannot create the keystroke from `null` or `undefined`.");return new id(e.type,function(e){switch(e){case".":return"dot";case" ":return"space";default:return e}}(e.key),{control:e.ctrlKey,shift:e.shiftKey,alt:e.altKey,meta:e.metaKey})}static fromString(e){if(!e)throw Error("[KeystrokeParseError] Cannot parse the keystroke from 'null' or 'undefined'.");let t=function(e){let t=e.match(/{(?<flagsDictionary>.*)}/)?.groups.flagsDictionary??null;if(null!==t)return""===t?{}:t.split(";").map(e=>e.split("=")).reduce((t,[r,i])=>"preventDefault"===r?{...t,preventDefault:"true"===i}:(tG.get(rt).warn(`[KeystrokeParseError] Ignore unkown flag '${e}'. Supported flags are: 'preventDefault'.`),t),{})}(e);void 0!==t&&(e=e.substring(0,e.indexOf("{")));let r=e.split(".");if(r.length<2)throw Error(`[KeystrokeParseError] Cannot parse the keystroke '${e}'. Requires at least the event type and keyboard key, and optionally some modifiers. Examples: 'keydown.control.z', 'keydown.escape', 'keyup.enter', 'keydown.control.alt.enter', 'keydown.control.space'`);let i=r[0];if("keydown"!==i&&"keyup"!==i)throw Error(`[KeystrokeParseError] Cannot parse the keystroke '${e}'. Unsupported event type. Supported event types are: 'keydown' or 'keyup'. Examples: 'keydown.control.z', 'keydown.escape', 'keyup.enter', 'keydown.control.alt.enter', 'keydown.control.space'`);let n=r[r.length-1];if(!n||new Set().add("alt").add("shift").add("control").add("meta").has(n.toLowerCase()))throw Error(`[KeystrokeParseError] Cannot parse the keystroke '${e}'. The keyboard key must be the last part. Examples: 'keydown.control.z', 'keydown.escape', 'keyup.enter', 'keydown.control.alt.enter', 'keydown.control.space'`);let s=new Set(r.slice(1,-1)),o=new id(i,n,{control:s.delete("control"),shift:s.delete("shift"),alt:s.delete("alt"),meta:s.delete("meta")},t);if(s.size>0)throw Error(`[KeystrokeParseError] Cannot parse the keystroke '${e}'. Illegal modifier found. Supported modifiers are: 'alt', 'shift', 'control' or 'meta'. Examples: 'keydown.control.z', 'keydown.escape', 'keyup.enter', 'keydown.control.alt.enter', 'keydown.control.space'`);return o}}let ib="ɵPUSH_STATE_TO_SESSION_HISTORY_STACK",ig="ɵSHOW_SPLASH",im="ɵCAPABILITY_ID",iy="sci-router-outlet",iv="name",iw="scrollable",i_="keystrokes",iE=`
  <style>
    :host {
      display: block;
      overflow: hidden;
      position: relative; /* positioning context for splash */
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
      margin: 0;
    }
    
    /* Ensure transparent router-outlet if empty.
     *
     * An iframe is transparent only if the embedded content has the same color scheme as the embedding document.
     * An empty router-outlet loads the 'about:blank' page. This page has the user's preferred OS color scheme,
     * which may be different from the application's color scheme, making the iframe opaque. Therefore, we hide
     * the iframe to make the router-outlet transparent again.
     *
     * More information about iframe transparency:
     * - https://github.com/w3c/csswg-drafts/issues/4772#issuecomment-591553929
     * - https://fvsch.com/transparent-iframes
     */
    :host-context(.sci-empty) iframe {
      display: none;
    }

    div[part="splash"] {
      position: absolute;
      inset: 0;
    }
  </style>
  <iframe src="about:blank" scrolling="yes" marginheight="0" marginwidth="0"></iframe>
  
  <template id="splash">
    <div part="splash" class="e2e-splash">
      <slot></slot>
    </div>  
  </template>
`;class iS extends HTMLElement{constructor(){super(),this._disconnect$=new e$,this._uid=t0.randomUUID(),this._empty$=new eR(!0),this._outletName$=new eR(i$),this._shadowRoot=this.attachShadow({mode:"open"}),this._shadowRoot.innerHTML=iE.trim(),this._iframe=this._shadowRoot.querySelector("iframe"),this._contextProvider=new ip(this._iframe),this._splash=new iC(this._shadowRoot,this._iframe),this.empty$=this._empty$.pipe(tk())}set name(e){e?this.setAttribute(iv,e):this.removeAttribute(iv)}get name(){return this.getAttribute(iv)??void 0}set scrollable(e){e?this.setAttribute(iw,"true"):this.removeAttribute(iw)}get scrollable(){return"true"===this.getAttribute(iw)}set keystrokes(e){e&&e.length?this.setAttribute(i_,q.join(e)):this.removeAttribute(i_)}get keystrokes(){return q.split(this.getAttribute(i_))}setContextValue(e,t){this._contextProvider.set(e,t)}removeContextValue(e){return this._contextProvider.remove(e)}get contextValues$(){return this._contextProvider.entries$}resetPreferredSize(){tG.get(rp).publish(L.preferredSizeTopic(this._uid),null)}get preferredSize(){let e={minWidth:this.style.minWidth||void 0,width:this.style.width||void 0,maxWidth:this.style.maxWidth||void 0,minHeight:this.style.minHeight||void 0,height:this.style.height||void 0,maxHeight:this.style.maxHeight||void 0};if(Object.values(e).some(Boolean))return e}get iframe(){return this._iframe}installOutletContext(){this._outletName$.pipe(tz(this._disconnect$)).subscribe(e=>{let t={name:e,uid:this._uid};this.iframe.name=e,this.setContextValue(iI,t)})}installOutletUrlListener(){this._outletName$.pipe(tC(e=>(function(e){let t=L.urlTopic(e);return tG.get(rp).observe$(t).pipe(eY(e=>({url:e.body||"about:blank",pushStateToSessionHistoryStack:y.orElse(e.headers.get(ib),!1),showSplash:y.orElse(e.headers.get(ig),!1),capabilityId:e.headers.get(im)})))})(e).pipe(tj(null))),tH(e=>this._empty$.next(!e||"about:blank"===e.url)),ez(function(e,t){var r,i=!1;e.subscribe(eW(t,function(e){var n=r;r=e,i&&t.next([n,e]),i=!0}))}),tz(this._disconnect$)).subscribe(([e,t])=>r_(()=>{t?.capabilityId&&t?.capabilityId===e?.capabilityId||(t?.showSplash?this._splash.attach():this._splash.detach()),e&&this.dispatchEvent(new CustomEvent("deactivate",{detail:e.url})),tG.get(ih).assign(this._iframe,t||{url:"about:blank"},e),t&&this.dispatchEvent(new CustomEvent("activate",{detail:t.url}))}))}installPreferredSizeListener(){tG.get(rp).observe$(L.preferredSizeTopic(this._uid)).pipe(rf(),tz(this._disconnect$)).subscribe(e=>{!function(e,t){Object.keys(t).forEach(r=>e.style.setProperty(r,t[r]))}(this,{"min-width":e?.minWidth??null,width:e?.width??null,"max-width":e?.maxWidth??null,"min-height":e?.minHeight??null,height:e?.height??null,"max-height":e?.maxHeight??null})})}installKeyboardEventDispatcher(){tG.get(rp).observe$(L.keyboardEventTopic(this._uid,":eventType")).pipe(tz(this._disconnect$)).subscribe(e=>{let t=e.params.get("eventType");this.dispatchEvent(new KeyboardEvent(t,e.body))})}installFocusWithinEventDispatcher(){var e;tG.get(rp).observe$(L.focusWithinOutletTopic(this._uid)).pipe(rf(),(e=e=>!1===e,ez(function(t,r){var i=!1,n=0;t.subscribe(eW(r,function(t){return(i||(i=!e(t,n++)))&&r.next(t)}))})),tz(this._disconnect$)).subscribe(e=>{this.dispatchEvent(new CustomEvent("focuswithin",{detail:e,bubbles:!1,cancelable:!1}))})}installHostElementDecorator(){this._empty$.pipe(tz(this._disconnect$)).subscribe(e=>{e?this._shadowRoot.host.classList.add("sci-empty"):this._shadowRoot.host.classList.remove("sci-empty")})}installSplashDisposer(){tG.get(rp).observe$(L.signalReadyTopic(this._uid)).pipe(tz(this._disconnect$)).subscribe(()=>{this._splash.detach()})}connectedCallback(){this.installOutletUrlListener(),this.installOutletContext(),this.installPreferredSizeListener(),this.installFocusWithinEventDispatcher(),this.installKeyboardEventDispatcher(),this.installHostElementDecorator(),this.installSplashDisposer(),this._contextProvider.onOutletMount()}disconnectedCallback(){this._disconnect$.next(),this._contextProvider.onOutletUnmount()}static{this.observedAttributes=[iv,iw,i_]}attributeChangedCallback(e,t,r){switch(e){case iv:this._outletName$.next(r||i$);break;case iw:this._iframe.setAttribute("scrolling",null!=r&&"false"!=`${r}`?"yes":"no");break;case i_:q.split(t).forEach(e=>this.removeContextValue(iT+id.fromString(e).parts)),q.split(r).forEach(e=>{let t=id.fromString(e);this.setContextValue(iT+t.parts,t.flags)})}}static define(){return customElements.get(iy)?Promise.resolve():(customElements.define(iy,iS),customElements.whenDefined(iy).then(()=>Promise.resolve()))}}let iI="ɵOUTLET",i$="primary";(g=L||(L={})).urlTopic=function(e){return`sci-router-outlets/${e}/url`},g.signalReadyTopic=function(e){return`sci-router-outlets/${e}/ready`},g.keyboardEventTopic=function(e,t){return`sci-router-outlets/${e}/keyboard-events/${t}`},g.preferredSizeTopic=function(e){return`sci-router-outlets/${e}/preferred-size`},g.focusWithinOutletTopic=function(e){return`sci-router-outlets/${e}/focus-within`},(m=q||(q={})).split=function(e){return e?e.split(","):[]},m.join=function(e){return e.join(",")};let iT="keystroke:";class iC{constructor(e,t){this._shadowRoot=e,this._iframeElement=t,this._template=this._shadowRoot.querySelector("template#splash")}attach(){if(this._element)return;let e=this._template.content.cloneNode(!0);this._element=this._shadowRoot.appendChild(e.querySelector('div[part="splash"]')),this._iframeElement.style.setProperty("visibility","hidden")}detach(){this._element&&(this._element.remove(),this._element=void 0,this._iframeElement.style.removeProperty("visibility"))}}class iR{constructor(){this._destroy$=new e$,this._contextTreeChange$=new e$,this._whenContextTreeChangeListenerInstalled=this.installContextTreeChangeListener(e=>this._contextTreeChange$.next(e))}observe$(e,t){return tG.get(t4)?e8(tE(t?.collect?[]:null),t_):this._contextTreeChange$.pipe(ti(t=>t.name===e),tj(void 0),tC(()=>this.lookupContextValue$(e,t)),rI())}lookup(e,t){return ts(this.observe$(e,t))}isPresent(e){return this.lookup(e).then(e=>null!==e)}names$(){return tG.get(t4)?e8(tE(new Set),t_):this._contextTreeChange$.pipe(tj(void 0),tC(()=>this.lookupContextNames$()),rI())}lookupContextValue$(e,t){return new eE(r=>{let i=t0.randomUUID(),n=new e$,s=B.newContextValueLookupRequest(e,i,t);return tG.get(rp).observe$(i).pipe(tB(1),eY(e=>e.headers.get(O.Status)===A.OK?e.body??null:null),tz(n)).subscribe(r),Promise.all([iM(i),this._whenContextTreeChangeListenerInstalled]).then(()=>window.parent.postMessage(s,"*")).catch(e=>r.error(e)),()=>n.next()})}lookupContextNames$(){return new eE(e=>{let t=t0.randomUUID(),r=new e$,i=B.newContextTreeNamesLookupRequest(t);return tG.get(rp).observe$(t).pipe(tB(1),eY(e=>e.headers.get(O.Status)===A.OK?e.body:new Set),tz(r)).subscribe(e),Promise.all([iM(t),this._whenContextTreeChangeListenerInstalled]).then(()=>window.parent.postMessage(i,"*")).catch(t=>e.error(t)),()=>r.next()})}installContextTreeChangeListener(e){let t=t0.randomUUID(),r=B.newContextTreeObserveRequest(t);return new Promise((i,n)=>{tG.get(rp).observe$(t).pipe(rf(),tz(this._destroy$)).subscribe({next:t=>{t===B.RootContextSubscribeEvent?i():e(t)},error:n}),iM(t).then(()=>window.parent.postMessage(r,"*")).catch(e=>n(e))})}preDestroy(){this._destroy$.next()}}function iM(e){return new Promise((t,r)=>{tG.get(rp).subscriberCount$(e).pipe(tq(e=>1===e)).subscribe({error:r,complete:t})})}class ix{resolve(e,t){let r=U.newUrl(t.relativeTo);if(!r.hash?.startsWith("#/"))return U.newUrl(e,t.relativeTo).toString();{let{pathname:t,search:i,hash:n}=U.newUrl(e,`${r.origin}${r.hash.substring(1)}`);return r.origin+r.pathname+"#"+t+i+n}}}class iO{}class iN{async navigate(e,t){e&&"string"!=typeof e?await this.navigateByIntent(e,t):await this.navigateByUrl(e,t)}async navigateByUrl(e,t){let r=t?.outlet||await this.resolveContextualOutlet()||i$,i=L.urlTopic(r),n=this.computeNavigationUrl(e,t);await tG.get(rp).publish(i,n,{retain:!0,headers:new Map().set(ib,t?.pushStateToSessionHistoryStack??!1).set(ig,t?.showSplash??!1).set(im,t?.ɵcapabilityId)}),null===e&&await tG.get(rp).publish(i,void 0,{retain:!0})}async navigateByIntent(e,t){if(t?.relativeTo)throw Error('[OutletRouterError][UnsupportedOptionError] Unsupported navigation option "relativeTo". This option is not supported in intent-based routing.');let r=await this.resolveContextualOutlet(),i={type:T.Microfrontend,qualifier:e,params:E.coerce(t?.params)},n=tG.get(iO).request$(i,t,{headers:new Map().set(iA,{[ik]:r})});try{await tv(n.pipe(rf()))}catch(e){throw e instanceof rb?e.message:e}}computeNavigationUrl(e,t){if(null==e)return"about:blank";let r=E.coerce(t?.params),i=this.substituteNamedParameters(e,r);if(U.isAbsoluteUrl(i))return i;{let e=t?.relativeTo??window.location.href;return tG.get(ix).resolve(i,{relativeTo:e})}}async resolveContextualOutlet(){if(!await tG.get(iR).isPresent(t6))return(await tG.get(iR).lookup(iI))?.name}substituteNamedParameters(e,t){return e.replace(/:([^/;&?#]+)/g,(e,r)=>void 0!==t.get(r)?t.get(r):e).replace(/(?<delimiter>;)(?<paramName>[^=]+)=:(?<placeholder>[^;#?/]+)/g,()=>"").replace(/(?<delimiter>[?&])(?<paramName>[^=]+)=:(?<placeholder>[^&#]+)/g,(e,t)=>"?"===t?"ɵ__?__":"").replace(/ɵ__\?__&/,"?").replace(/ɵ__\?__/,"")}}let iA="context",ik="outlet";class iP{intercept(e,t){return e.intent.type===T.Microfrontend?this.consumeMicrofrontendIntent(e):t.handle(e)}async consumeMicrofrontendIntent(e){let t=e.headers.get(O.ReplyTo);await this.navigate(e),await tG.get(rp).publish(t,null,{headers:new Map().set(O.Status,A.TERMINAL)})}async navigate(e){let t=e.capability,r=e.body,i=e.intent,n=t.properties?.path;if(null==n)throw Error(`[OutletRouterError][NullPathError] Microfrontend capability has no path to the microfrontend defined. [capability=${JSON.stringify(t)}]`);let s=t.metadata.appSymbolicName,o=tG.get(rk).getApplication(s,{orElse:null});if(!o)throw Error(`[OutletRouterError][NullApplicationError] Unexpected error. No application found with the symbolic name "${s}".`);await tG.get(iN).navigate(n,{...r,outlet:this.resolveTargetOutlet(e),relativeTo:o.baseUrl,params:{...i.qualifier,..._.coerce(i.params)},showSplash:t.properties.showSplash,ɵcapabilityId:t.metadata.id})}resolveTargetOutlet(e){let t=e.capability,r=e.body;return r?.outlet?r.outlet:t.properties.outlet?t.properties.outlet:e.headers.get(iA)?.[ik]||i$}}class iU{constructor(){this._clientsById=new Map,this._clientsByWindow=new Map,this.register$=new e$,this.unregister$=new e$}registerClient(e){let t=this._clientsByWindow.get(e.window);t&&(tG.get(rt).warn(`[StaleClient] Stale client registration detected when loading application '${e.application.symbolicName}'
        into the window of '${t.application.symbolicName}'. Removing stale registration. Most likely, the client could not disconnect
        from the broker, for example, because the client was disposed without notice, i.e., without receiving the browser's "unload" event, or
        because the browser discarded the 'DISCONNECT' message, maybe due to a high load on the client during unloading.`.replace(/\s+/g," "),new rn(t.application.symbolicName,t.version)),this.unregisterClient(t)),this._clientsById.set(e.id,e),this._clientsByWindow.set(e.window,e),this.register$.next(e)}unregisterClient(e){this._clientsById.delete(e.id),this._clientsByWindow.delete(e.window),this.unregister$.next(e),e.dispose()}getByClientId(e){return this._clientsById.get(e)}getByWindow(e){return this._clientsByWindow.get(e)}getByApplication(e){return Array.from(this._clientsById.values()).filter(t=>t.application.symbolicName===e)}preDestroy(){this._clientsById.forEach(e=>this.unregisterClient(e))}}class iD{constructor(){}static createAppConfig(e){var t;return{symbolicName:e.symbolicName,manifestUrl:"string"==typeof(t=e.manifest)?t:function(e){let t=URL.createObjectURL(new Blob([JSON.stringify(e)],{type:"application/json"}));return rs.whenState(I.Stopped).then(()=>URL.revokeObjectURL(t)),t}(t||{name:"Host Application"}),scopeCheckDisabled:e.scopeCheckDisabled,intentionCheckDisabled:e.intentionCheckDisabled,intentionRegisterApiDisabled:e.intentionRegisterApiDisabled}}static interceptManifest(e){tG.all(rl).forEach(t=>t.intercept(e))}}class iB{constructor(){this._progress$=new eR(0),this._done$=new e$,this._hasSubMonitors=!1,this.progress$=this._progress$.pipe(tk(),eY(e=>Math.round(1e4*e)/100),tW(e=>e<100,!0))}split(...e){if(this._hasSubMonitors)throw Error("[IllegalMonitorStateError] Monitor cannot be split multiple times.");this._hasSubMonitors=!0;let t=e.map(()=>new iB);return e4(t.map(e=>e._progress$)).pipe(function(e){let t=e.reduce((e,t)=>e+t,0);return eY(r=>e.reduce((e,i,n)=>e+r[n]*(i/t),0))}(e),tW(e=>e<1,!0),tz(this._done$)).subscribe(e=>{this._progress$.next(e)}),t}splitEven(e){if(e<=0)throw Error(`[IllegalMonitorArgumentError] Monitor split count must be greater than 0, but was ${e}.`);return this.split(...Array(e).fill(1))}done(){this._progress$.next(1),this._done$.next()}}class iL extends iB{}class iq extends iB{}class iV extends iB{}class iF{constructor(e,t){this._hostConfig=e,this._appConfigs=t.filter(e=>!e.exclude)}async install(){let e=iD.createAppConfig(this._hostConfig),t=[e,...this._appConfigs],r=tG.get(iL).splitEven(t.length);await Promise.all(t.map(async t=>{let i=r.shift();try{let r=await tG.get(rF).fetch(t);t===e&&iD.interceptManifest(r),await tG.get(rk).registerApplication(t,r),tG.get(rt).info(`Registered application '${t.symbolicName}' in the SCION Microfrontend Platform.`)}catch(e){tG.get(rt).error(`[AppInstaller] Failed to install application '${t.symbolicName}' in the SCION Microfrontend Platform.`,e)}finally{i.done()}}))}}class ij{async init(){let e=await ts(tG.get(ic).lookupCapabilities$({type:T.Activator})),t=tG.get(iq);if(!e.length){t.done();return}let r=e.filter(this.skipInvalidActivators()).reduce((e,t)=>E.addListValue(e,t.metadata.appSymbolicName,t),new Map),i=t.splitEven(r.size),n=Array.from(r.entries()).reduce((e,[t,r],n)=>e.concat(this.waitForActivatorsToSignalReady(t,r,i[n])),[]);r.forEach(e=>{let t=e[0];e.forEach(e=>this.mountActivator(e,e===t))}),await Promise.all(n)}skipInvalidActivators(){return e=>!!e.properties&&!!e.properties.path||(tG.get(rt).error(`[ActivatorError] Failed to activate the application '${e.metadata.appSymbolicName}'. Missing required 'path' property in the provided activator capability.`,e),!1)}async waitForActivatorsToSignalReady(e,t,r){let i=Date.now(),n=tG.get(rk).getApplication(e).activatorLoadTimeout,s=t.reduce((e,t)=>e.concat(v.coerce(t.properties.readinessTopics)),[]).map(t=>{let r=()=>(tG.get(rt).error(`[ActivatorLoadTimeoutError] Timeout elapsed while waiting for application to signal readiness [app=${e}, timeout=${n}ms, readinessTopic=${t}].`),tr);return new Promise((i,s)=>tG.get(rp).observe$(t).pipe(tq(t=>t.headers.get(O.AppSymbolicName)===e),n?tx({first:n,with:r}):ev).subscribe({error:s,complete:i}))});if(!s.length){r.done();return}await Promise.all(s),r.done(),tG.get(rt).info(`Activator startup of '${e}' took ${Date.now()-i}ms.`)}mountActivator(e,t){let r=tG.get(rk).getApplication(e.metadata.appSymbolicName),i=document.createElement("sci-router-outlet");i.name=t0.randomUUID(),tG.get(iN).navigate(e.properties.path,{outlet:i.name,relativeTo:r.baseUrl}).then(),i.setContextValue(t6,{primary:t,activator:e}),i.classList.add("sci-activator"),i.dataset.app=r.symbolicName,i.style.display="none",i.style.position="absolute",document.body.appendChild(i),rs.whenState(I.Stopped).then(()=>document.body.removeChild(i))}}class iz{constructor(){this.focusWithin$=tG.get(rp).request$(x.IsFocusWithin).pipe(rf()),this.focus$=tG.get(rp).request$(x.HasFocus).pipe(rf())}}class iW{constructor(){this._destroy$=new e$,this.installFocusEventDispatcher().then()}async installFocusEventDispatcher(){await tG.get(iR).isPresent(t6)||(this.publishFocusInEvent(),await this.notifyOutletAboutFocusChange())}publishFocusInEvent(){tG.get(iz).focus$.pipe(tC(e=>e?tr:t$(tc(window,"focusin",{once:!0}),tc(window,"mousedown",{once:!0,capture:!0}))),tz(this._destroy$)).subscribe(()=>{tG.get(rp).publish(x.FocusIn)})}async notifyOutletAboutFocusChange(){let e=await tG.get(iR).lookup(iI);e&&tG.get(iz).focusWithin$.pipe(tz(this._destroy$)).subscribe(t=>{let r=L.focusWithinOutletTopic(e.uid);tG.get(rp).publish(r,t)})}preDestroy(){this._destroy$.next()}}class iH{constructor(){this._destroy$=new e$,this._dispatcherId=t0.randomUUID(),this.installMouseEventDispatcher().then()}async installMouseEventDispatcher(){await tG.get(iR).isPresent(t6)||(this.publishMouseMoveEvent(),this.receiveMouseMoveEvent())}publishMouseMoveEvent(){var e,t;tG.get(iz).focus$.pipe(tC(e=>e?tr:tc(document,"mousemove")),ti(e=>e.buttons===iK),(void 0===e&&(e=tg),t=function(){return ty(20,e)},ez(function(e,r){var i=!1,n=null,s=null,o=!1,a=function(){if(null==s||s.unsubscribe(),s=null,i){i=!1;var e=n;n=null,r.next(e)}o&&r.complete()},l=function(){s=null,o&&r.complete()};e.subscribe(eW(r,function(e){i=!0,n=e,s||eV(t(e)).subscribe(s=eW(r,a,l))},function(){o=!0,i&&s&&!s.closed||r.complete()}))})),tz(this._destroy$)).subscribe(e=>{let t={headers:new Map().set(iG,this._dispatcherId)};tG.get(rp).publish(iQ,[e.screenX,e.screenY],t)})}receiveMouseMoveEvent(){tG.get(iz).focus$.pipe(tC(e=>e?tG.get(rp).observe$(iQ):tr),ti(e=>e.headers.get(iG)!==this._dispatcherId),rf(),tz(this._destroy$)).subscribe(([e,t])=>{let r=new Event("sci-mousemove");r.screenX=e,r.screenY=t,document.dispatchEvent(r)})}preDestroy(){this._destroy$.next()}}let iK=1,iG="ɵDISPATCHER_ID",iQ="ɵMOUSEMOVE";class iJ{constructor(){this._destroy$=new e$,this._dispatcherId=t0.randomUUID(),this.installMouseEventDispatcher().then()}async installMouseEventDispatcher(){await tG.get(iR).isPresent(t6)||(this.publishMouseUpEvent(),this.receiveMouseMoveEvent())}publishMouseUpEvent(){tG.get(iz).focus$.pipe(tC(e=>e?tr:tc(window,"mouseup",{capture:!0})),tz(this._destroy$)).subscribe(()=>{let e={headers:new Map().set(iY,this._dispatcherId)};tG.get(rp).publish(iX,void 0,e)})}receiveMouseMoveEvent(){tG.get(iz).focus$.pipe(tC(e=>e?tG.get(rp).observe$(iX):tr),ti(e=>e.headers.get(iY)!==this._dispatcherId),rf(),tz(this._destroy$)).subscribe(()=>{document.dispatchEvent(new Event("sci-mouseup"))})}preDestroy(){this._destroy$.next()}}let iY="ɵDISPATCHER_ID",iX="ɵMOUSEUP";class iZ{constructor(){this._destroy$=new e$,this._fromDimensionElementChange$=new e$,this._preferredSizePublisher=new i0}setPreferredSize(e){this._preferredSizePublisher.publish(e)}fromDimension(e){if(this._fromDimensionElementChange$.next(),!e){this.resetPreferredSize();return}new eE(t=>{let r=new ResizeObserver(()=>t.next({clientWidth:e.clientWidth,offsetWidth:e.offsetWidth,clientHeight:e.clientHeight,offsetHeight:e.offsetHeight,element:e}));return r.observe(e),()=>{r.disconnect()}}).pipe(tz(tw(this._fromDimensionElementChange$,this._destroy$))).subscribe(e=>{document.body.contains(e.element)?this.setPreferredSize({minWidth:`${e.offsetWidth}px`,width:`${e.offsetWidth}px`,maxWidth:`${e.offsetWidth}px`,minHeight:`${e.offsetHeight}px`,height:`${e.offsetHeight}px`,maxHeight:`${e.offsetHeight}px`}):this.resetPreferredSize()})}resetPreferredSize(){this._preferredSizePublisher.publish(null)}preDestroy(){this._preferredSizePublisher.destroy(),this._destroy$.next()}}class i0{constructor(){this._preferredSize$=new e$,this._destroy$=new e$,this._preferredSize$.pipe(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return tA.apply(void 0,H([],W(e)))}(tG.get(iR).observe$(iI).pipe(ti(Boolean))),tz(this._destroy$)).subscribe(([e,t])=>r_(()=>{let r=L.preferredSizeTopic(t.uid);tG.get(rp).publish(r,e)}))}publish(e){this._preferredSize$.next(e)}destroy(){this._destroy$.next()}}class i1{constructor(){this._destroy$=new e$,this.installKeystrokeDispatcher().then()}async installKeystrokeDispatcher(){!await tG.get(iR).isPresent(iI)||await tG.get(iR).isPresent(t6)||tG.get(iR).names$().pipe(eY(e=>Array.from(e)),t1(e=>e.startsWith(iT)),t2(e=>e.substring(iT.length)),t2(e=>this.observeKeyboardEvent$(e)),tC(e=>tw(...e)),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e2(e);return ez(function(t,i){for(var n=e.length,s=Array(n),o=e.map(function(){return!1}),a=!1,l=function(t){eV(e[t]).subscribe(eW(i,function(e){s[t]=e,!a&&!o[t]&&(o[t]=!0,(a=o.every(ev))&&(o=null))},es))},c=0;c<n;c++)l(c);t.subscribe(eW(i,function(e){if(a){var t=H([e],W(s));i.next(r?r.apply(void 0,H([],W(t))):t)}}))})}(tG.get(iR).observe$(iI)),tz(this._destroy$)).subscribe(([e,t])=>r_(()=>{let r={key:e.key,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey,bubbles:e.bubbles},i=L.keyboardEventTopic(t.uid,e.type);tG.get(rp).publish(i,r)}))}observeKeyboardEvent$(e){return tG.get(iR).observe$(iT+e,{collect:!0}).pipe(tC(t=>{var r;let i=id.fromString(e).withFlags(t.reduceRight((e,t)=>({...e,...t}),{}));return tc(document,i.eventType,{capture:!0}).pipe(ti(e=>e.bubbles&&!!e.key),ti(e=>id.fromEvent(e).parts===i.parts),(r=i.flags,tH(e=>{r?.preventDefault&&e.preventDefault()})))}))}preDestroy(){this._destroy$.next()}}class i2{constructor(e,t){this._callback=t,this._messageClient=tG.get(rp),this.subscription=new X,this.subscription.add(e.subscribe(e=>{e.headers.has(O.ReplyTo)?this.handleMessage(e):this.consumeMessage(e)}))}consumeMessage(e){r_(()=>this._callback(e))}handleMessage(e){var t;let r;let i=e.headers.get(O.ReplyTo),n=rs.state$.pipe(ti(e=>e===I.Stopping));try{r=this._callback(e)}catch(e){r=tR(()=>e)}let s="alive";this.subscription.add((void 0===(t=r)?tr:t instanceof eE?t:t instanceof Promise?eJ(t).pipe(ti(e=>void 0!==e)):tE(t)).pipe(rh(i),tz(n),tD(()=>{if("alive"===s){let e=new Map().set(O.Status,A.TERMINAL);this._messageClient.publish(i,void 0,{headers:e}).then()}})).subscribe({next:e=>{let t=new Map().set(O.Status,A.OK);this._messageClient.publish(i,e,{headers:t}).then()},error:e=>{s="errored";let t=new Map().set(O.Status,A.ERROR);this._messageClient.publish(i,rE(e),{headers:t}).then()},complete:()=>{s="completed";let e=new Map().set(O.Status,A.TERMINAL);this._messageClient.publish(i,void 0,{headers:e}).then()}}))}}class i5{constructor(){this._brokerGateway=tG.get(rT)}publish(e,t,r){let i={topic:e,retain:r?.retain??!1,headers:new Map(r?.headers),body:t};return this._brokerGateway.postMessage(M.Topic,i)}request$(e,t,r){let i=new Map(r?.headers);return tt(()=>{let n={topic:e,retain:r?.retain??!1,headers:new Map(i),body:t};return this._brokerGateway.requestReply$(M.Topic,n).pipe(rd())})}observe$(e){return this._brokerGateway.subscribe$({messageChannel:M.Topic,subscribeChannel:M.TopicSubscribe,unsubscribeChannel:M.TopicUnsubscribe,newSubscribeCommand:t=>({topic:e,subscriberId:t,headers:new Map})})}onMessage(e,t){return new i2(tG.get(rp).observe$(e),t).subscription}subscriberCount$(e){return new eE(t=>{let r=new e$;return this.request$(x.RequestSubscriberCount,e).pipe(rf(),tz(r)).subscribe({next:e=>t.next(e),error:e=>t.error(e),complete:es}),()=>r.next()})}}class i4{constructor(){this._brokerGateway=tG.get(rT)}publish(e,t,r){let i={intent:e,retain:r?.retain??!1,headers:new Map(r?.headers),capability:void 0,body:t};return this._brokerGateway.postMessage(M.Intent,i)}request$(e,t,r){let i=new Map(r?.headers);return tt(()=>{let n={intent:e,retain:r?.retain??!1,headers:new Map(i),capability:void 0,body:t};return this._brokerGateway.requestReply$(M.Intent,n).pipe(rd())})}observe$(e){return this._brokerGateway.subscribe$({messageChannel:M.Intent,subscribeChannel:M.IntentSubscribe,unsubscribeChannel:M.IntentUnsubscribe,newSubscribeCommand:t=>({selector:e,subscriberId:t,headers:new Map})})}onIntent(e,t){return new i2(tG.get(iO).observe$(e),t).subscription}}class i3{constructor(){}static connect(e,t){return rs.startPlatform(()=>{ro({symbolicName:e,isPlatformHost:!1}),i6({...t,connectRunlevel:$.Zero}),tG.registerInitializer({useExisting:rx,runlevel:$.Two}),tG.registerInitializer({useExisting:ic,runlevel:$.Two}),tG.registerInitializer({useFunction:()=>iS.define(),runlevel:$.Two})})}static async isConnected(){if(rs.state===I.Stopped)return!1;let e=tG.opt(rT);return!!e&&e.isConnected()}static signalReady(){tG.get(iR).lookup(iI).then(e=>e?tG.get(rp).publish(L.signalReadyTopic(e.uid)):Promise.reject(Error("[NullOutletContextError] not running in the context of a <sci-router-outlet>.")))}}function i6(e){tG.registerIfAbsent(rp,{useClass:i5,eager:!0,destroyOrder:C.MESSAGING}),tG.registerIfAbsent(iO,{useClass:i4,eager:!0,destroyOrder:C.MESSAGING}),tG.registerIfAbsent(iN),tG.registerIfAbsent(ix),tG.registerIfAbsent(ih),tG.register(iW,{eager:!0}),tG.register(iH,{eager:!0}),tG.register(iJ,{eager:!0}),tG.register(i1,{eager:!0}),tG.register(iZ,{eager:!0}),tG.register(iR),tG.register(ic),tG.register(rx),tG.register(iz),e.connect??!0?(tG.register(rR,{useFactory:()=>new rR(e),destroyOrder:C.MESSAGING}),tG.register(rT,{useExisting:rR}),tG.registerInitializer({useExisting:rR,runlevel:e.connectRunlevel})):tG.register(rT,{useClass:rC})}class i9{constructor(){}static start(e){return rs.startPlatform(()=>{let t=e.host?.symbolicName||"host";ro({symbolicName:t,isPlatformHost:!0}),i6({messageDeliveryTimeout:e.host?.messageDeliveryTimeout,brokerDiscoverTimeout:e.host?.brokerDiscoverTimeout,connectRunlevel:$.One}),tG.register(ra,{useValue:e}),tG.register(rl,{useClass:rc,multi:!0}),tG.register(ru,{useClass:iU,destroyOrder:C.CORE}),tG.registerIfAbsent(rO),tG.register(rN,{useClass:rB,eager:!0}),tG.register(rk,{eager:!0}),tG.register(rV,{eager:!0}),tG.register(r8,{destroyOrder:C.BROKER}),tG.register(rF),tG.register(rH,{destroyOrder:C.BROKER}),tG.register(r4,{destroyOrder:C.BROKER}),tG.register(rQ,{useClass:iP,multi:!0}),function(e){let t={interval:60,timeout:10},r=e?.interval??t.interval,i=e?.timeout??t.timeout,n=r<=2*i;n&&tG.get(rt).warn(`[LivenessProbeConfig] Illegal config provided. The interval [${r}s] must be greater than twice the timeout period [${i}s]. Using platform defaults instead: [interval=${t.interval}s, timeout=${t.timeout}s]`),tG.registerIfAbsent(r1,{useValue:(n?t.interval:r)*1e3}),tG.registerIfAbsent(r2,{useValue:(n?t.timeout:i)*1e3})}(e.liveness),function(){let e=new iB,[t,r,i]=e.split(1,3,5);tG.register(iV,{useValue:e}),tG.register(iL,{useValue:r}),tG.register(iq,{useValue:i}),rs.whenState(I.Started).then(()=>t.done())}(),tG.registerInitializer({useExisting:r8,runlevel:$.Zero}),tG.registerInitializer({useFunction:()=>new iF({...e.host,symbolicName:t},e.applications).install(),runlevel:$.Zero}),tG.registerInitializer({useFunction:()=>tG.get(rp).publish(x.PlatformProperties,e.properties||{},{retain:!0}),runlevel:$.Two}),tG.registerInitializer({useFunction:()=>tG.get(rp).publish(x.Applications,tG.get(rk).getApplications(),{retain:!0}),runlevel:$.Two}),tG.registerInitializer({useFunction:()=>iS.define(),runlevel:$.Two}),tG.registerInitializer({useExisting:rx,runlevel:$.Three}),tG.registerInitializer({useExisting:ic,runlevel:$.Three}),tG.registerInitializer({useClass:ij,runlevel:$.Three})})}static get startupProgress$(){return this._startupProgress$=this._startupProgress$||new eE(e=>{let t=new tT(1),r=tt(()=>tG.get(iV).progress$).pipe(tz(t));return rs.state===I.Stopped?rs.whenState(I.Starting).then(()=>r.subscribe(e)):r.subscribe(e),()=>t.next()}),this._startupProgress$}}window.__SCION_RCP=window.__SCION_RCP||{},window.__SCION_RCP.refs={get MicrofrontendPlatform(){return rs},get MicrofrontendPlatformHost(){return i9},get MicrofrontendPlatformClient(){return i3},get MessageClient(){return tG.get(rp)},get IntentClient(){return tG.get(iO)},get OutletRouter(){return tG.get(iN)},get ManifestService(){return tG.get(ic)},get Beans(){return tG},get MessageInterceptor(){return rG},get IntentInterceptor(){return rQ},get TopicMatcher(){return rg},get QualifierMatcher(){return rP},get UUID(){return t0}}})();
//# sourceMappingURL=refs.js.map
