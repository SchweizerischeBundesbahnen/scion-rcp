(()=>{var e,t,r,i,n,s,o,a,l,c,u,p,h,d,f,b,g,m,y,v,w,_,E,S=function(e,t){return(S=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function I(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}S(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function $(e,t){var r,i,n,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){var c=[a,l];if(r)throw TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(s=0)),s;)try{if(r=1,i&&(n=2&c[0]?i.return:c[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,c[1])).done)return n;switch(i=0,n&&(c=[2&c[0],n.value]),c[0]){case 0:case 1:n=c;break;case 4:return s.label++,{value:c[1],done:!1};case 5:s.label++,i=c[1],c=[0];continue;case 7:c=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===c[0]||2===c[0])){s=0;continue}if(3===c[0]&&(!n||c[1]>n[0]&&c[1]<n[3])){s.label=c[1];break}if(6===c[0]&&s.label<n[1]){s.label=n[1],n=c;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(c);break}n[2]&&s.ops.pop(),s.trys.pop();continue}c=t.call(e,s)}catch(e){c=[6,e],i=0}finally{r=n=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}function T(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function C(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,s=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return o}function R(e,t,r){if(r||2==arguments.length)for(var i,n=0,s=t.length;n<s;n++)!i&&n in t||(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))}function x(e){return this instanceof x?(this.v=e,this):new x(e)}function M(e){return"function"==typeof e}function O(e){var t=e(function(e){Error.call(e),e.stack=Error().stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var N=O(function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}});function A(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var k=function(){var e;function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e,t,r,i,n,s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var o=T(s),a=o.next();!a.done;a=o.next())a.value.remove(this)}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}else s.remove(this);var l=this.initialTeardown;if(M(l))try{l()}catch(e){n=e instanceof N?e.errors:[e]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var u=T(c),p=u.next();!p.done;p=u.next()){var h=p.value;try{D(h)}catch(e){n=null!=n?n:[],e instanceof N?n=R(R([],C(n)),C(e.errors)):n.push(e)}}}catch(e){r={error:e}}finally{try{p&&!p.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}}if(n)throw new N(n)}},t.prototype.add=function(e){var r;if(e&&e!==this)if(this.closed)D(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!=(r=this._finalizers)?r:[]).push(e)}},t.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},t.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},t.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&A(t,e)},t.prototype.remove=function(e){var r=this._finalizers;r&&A(r,e),e instanceof t&&e._removeParent(this)},(e=new t).closed=!0,t.EMPTY=e,t}(),P=k.EMPTY;function U(e){return e instanceof k||e&&"closed"in e&&M(e.remove)&&M(e.add)&&M(e.unsubscribe)}function D(e){M(e)?e():e.unsubscribe()}var B={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},L={setTimeout:function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var n=L.delegate;return(null==n?void 0:n.setTimeout)?n.setTimeout.apply(n,R([e,t],C(r))):setTimeout.apply(void 0,R([e,t],C(r)))},clearTimeout:function(e){var t=L.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function q(e){L.setTimeout(function(){var t=B.onUnhandledError;if(t)t(e);else throw e})}function V(){}var F=j("C",void 0,void 0);function j(e,t,r){return{kind:e,value:t,error:r}}var z=null;function W(e){if(B.useDeprecatedSynchronousErrorHandling){var t=!z;if(t&&(z={errorThrown:!1,error:null}),e(),t){var r=z,i=r.errorThrown,n=r.error;if(z=null,i)throw n}}else e()}var H=function(e){function t(t){var r=e.call(this)||this;return r.isStopped=!1,t?(r.destination=t,U(t)&&t.add(r)):r.destination=Z,r}return I(t,e),t.create=function(e,t,r){return new J(e,t,r)},t.prototype.next=function(e){this.isStopped?X(j("N",e,void 0),this):this._next(e)},t.prototype.error=function(e){this.isStopped?X(j("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?X(F,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(k),K=Function.prototype.bind;function G(e,t){return K.call(e,t)}var Q=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){Y(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){Y(e)}else Y(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){Y(e)}},e}(),J=function(e){function t(t,r,i){var n,s,o=e.call(this)||this;return M(t)||!t?n={next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=i?i:void 0}:o&&B.useDeprecatedNextContext?((s=Object.create(t)).unsubscribe=function(){return o.unsubscribe()},n={next:t.next&&G(t.next,s),error:t.error&&G(t.error,s),complete:t.complete&&G(t.complete,s)}):n=t,o.destination=new Q(n),o}return I(t,e),t}(H);function Y(e){if(B.useDeprecatedSynchronousErrorHandling)B.useDeprecatedSynchronousErrorHandling&&z&&(z.errorThrown=!0,z.error=e);else q(e)}function X(e,t){var r=B.onStoppedNotification;r&&L.setTimeout(function(){return r(e,t)})}var Z={closed:!0,next:V,error:function(e){throw e},complete:V},ee="function"==typeof Symbol&&Symbol.observable||"@@observable";function et(e){return e}function er(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return ei(e)}function ei(e){return 0===e.length?et:1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}}var en=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var i=this,n=!function(e){return e&&e instanceof H||e&&M(e.next)&&M(e.error)&&M(e.complete)&&U(e)}(e)?new J(e,t,r):e;return W(function(){var e=i.operator,t=i.source;n.add(e?e.call(n,t):t?i._subscribe(n):i._trySubscribe(n))}),n},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var r=this;return new(t=es(t))(function(t,i){var n=new J({next:function(t){try{e(t)}catch(e){i(e),n.unsubscribe()}},error:i,complete:t});r.subscribe(n)})},e.prototype._subscribe=function(e){var t;return null==(t=this.source)?void 0:t.subscribe(e)},e.prototype[ee]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return ei(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=es(e))(function(e,r){var i;t.subscribe(function(e){return i=e},function(e){return r(e)},function(){return e(i)})})},e.create=function(t){return new e(t)},e}();function es(e){var t;return null!=(t=null!=e?e:B.Promise)?t:Promise}var eo=O(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),ea=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return I(t,e),t.prototype.lift=function(e){var t=new el(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new eo},t.prototype.next=function(e){var t=this;W(function(){var r,i;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var n=T(t.currentObservers),s=n.next();!s.done;s=n.next())s.value.next(e)}catch(e){r={error:e}}finally{try{s&&!s.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}}})},t.prototype.error=function(e){var t=this;W(function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var r=t.observers;r.length;)r.shift().error(e)}})},t.prototype.complete=function(){var e=this;W(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null==(e=this.observers)?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,r=this.hasError,i=this.isStopped,n=this.observers;return r||i?P:(this.currentObservers=null,n.push(e),new k(function(){t.currentObservers=null,A(n,e)}))},t.prototype._checkFinalizedStatuses=function(e){var t=this.hasError,r=this.thrownError,i=this.isStopped;t?e.error(r):i&&e.complete()},t.prototype.asObservable=function(){var e=new en;return e.source=this,e},t.create=function(e,t){return new el(e,t)},t}(en),el=function(e){function t(t,r){var i=e.call(this)||this;return i.destination=t,i.source=r,i}return I(t,e),t.prototype.next=function(e){var t,r;null==(r=null==(t=this.destination)?void 0:t.next)||r.call(t,e)},t.prototype.error=function(e){var t,r;null==(r=null==(t=this.destination)?void 0:t.error)||r.call(t,e)},t.prototype.complete=function(){var e,t;null==(t=null==(e=this.destination)?void 0:e.complete)||t.call(e)},t.prototype._subscribe=function(e){var t,r;return null!=(r=null==(t=this.source)?void 0:t.subscribe(e))?r:P},t}(ea),ec=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._value=null,t._hasValue=!1,t._isComplete=!1,t}return I(t,e),t.prototype._checkFinalizedStatuses=function(e){var t=this.hasError,r=this._hasValue,i=this._value,n=this.thrownError,s=this.isStopped,o=this._isComplete;t?e.error(n):(s||o)&&(r&&e.next(i),e.complete())},t.prototype.next=function(e){this.isStopped||(this._value=e,this._hasValue=!0)},t.prototype.complete=function(){var t=this._hasValue,r=this._value;this._isComplete||(this._isComplete=!0,t&&e.prototype.next.call(this,r),e.prototype.complete.call(this))},t}(ea),eu=function(e){function t(t){var r=e.call(this)||this;return r._value=t,r}return I(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var r=e.prototype._subscribe.call(this,t);return r.closed||t.next(this._value),r},t.prototype.getValue=function(){var e=this.hasError,t=this.thrownError,r=this._value;if(e)throw t;return this._throwIfClosed(),r},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(ea),ep=Array.isArray,eh=Object.getPrototypeOf,ed=Object.prototype,ef=Object.keys,eb=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function eg(e){return M(null==e?void 0:e.then)}function em(e){return Symbol.asyncIterator&&M(null==e?void 0:e[Symbol.asyncIterator])}function ey(e){return TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var ev="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function ew(e){return M(null==e?void 0:e[ev])}function e_(e){return function(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var i,n=r.apply(e,t||[]),s=[];return i=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",function(e){return function(t){return Promise.resolve(t).then(e,c)}}),i[Symbol.asyncIterator]=function(){return this},i;function o(e,t){n[e]&&(i[e]=function(t){return new Promise(function(r,i){s.push([e,t,r,i])>1||a(e,t)})},t&&(i[e]=t(i[e])))}function a(e,t){try{var r;(r=n[e](t)).value instanceof x?Promise.resolve(r.value.v).then(l,c):u(s[0][2],r)}catch(e){u(s[0][3],e)}}function l(e){a("next",e)}function c(e){a("throw",e)}function u(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}}(this,arguments,function(){var t,r,i;return $(this,function(n){switch(n.label){case 0:t=e.getReader(),n.label=1;case 1:n.trys.push([1,,9,10]),n.label=2;case 2:return[4,x(t.read())];case 3:if(i=(r=n.sent()).value,!r.done)return[3,5];return[4,x(void 0)];case 4:return[2,n.sent()];case 5:return[4,x(i)];case 6:return[4,n.sent()];case 7:return n.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function eE(e){return M(null==e?void 0:e.getReader)}function eS(e){if(e instanceof en)return e;if(null!=e){var t,r,i,n;if(M(e[ee])){return t=e,new en(function(e){var r=t[ee]();if(M(r.subscribe))return r.subscribe(e);throw TypeError("Provided object does not correctly implement Symbol.observable")})}if(eb(e)){return r=e,new en(function(e){for(var t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()})}if(eg(e)){return i=e,new en(function(e){i.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,q)})}if(em(e))return eI(e);if(ew(e)){return n=e,new en(function(e){var t,r;try{for(var i=T(n),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}e.complete()})}if(eE(e))return eI(e_(e))}throw ey(e)}function eI(e){return new en(function(t){(function(e,t){var r,i,n,s,o,a,l,c;return o=this,a=void 0,l=void 0,c=function(){var o;return $(this,function(a){switch(a.label){case 0:a.trys.push([0,5,6,11]),r=function(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=T(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(r){t[r]=e[r]&&function(t){return new Promise(function(i,n){var s,o,a;s=i,o=n,a=(t=e[r](t)).done,Promise.resolve(t.value).then(function(e){s({value:e,done:a})},o)})}}}(e),a.label=1;case 1:return[4,r.next()];case 2:if((i=a.sent()).done)return[3,4];if(o=i.value,t.next(o),t.closed)return[2];a.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return n={error:a.sent()},[3,11];case 6:if(a.trys.push([6,,9,10]),!(i&&!i.done&&(s=r.return)))return[3,8];return[4,s.call(r)];case 7:a.sent(),a.label=8;case 8:return[3,10];case 9:if(n)throw n.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})},new(l||(l=Promise))(function(e,t){function r(e){try{n(c.next(e))}catch(e){t(e)}}function i(e){try{n(c.throw(e))}catch(e){t(e)}}function n(t){var n;t.done?e(t.value):((n=t.value)instanceof l?n:new l(function(e){e(n)})).then(r,i)}n((c=c.apply(o,a||[])).next())})})(e,t).catch(function(e){return t.error(e)})})}function e$(e,t,r,i,n){void 0===i&&(i=0),void 0===n&&(n=!1);var s=t.schedule(function(){r(),n?e.add(this.schedule(null,i)):this.unsubscribe()},i);if(e.add(s),!n)return s}function eT(e){return function(t){if(M(null==t?void 0:t.lift))return t.lift(function(t){try{return e(t,this)}catch(e){this.error(e)}});throw TypeError("Unable to lift unknown Observable type")}}function eC(e,t,r,i,n){return new eR(e,t,r,i,n)}var eR=function(e){function t(t,r,i,n,s,o){var a=e.call(this,t)||this;return a.onFinalize=s,a.shouldUnsubscribe=o,a._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=n?function(e){try{n(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=i?function(){try{i()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return I(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),r||null==(t=this.onFinalize)||t.call(this)}},t}(H);function ex(e,t){return void 0===t&&(t=0),eT(function(r,i){r.subscribe(eC(i,function(r){return e$(i,e,function(){return i.next(r)},t)},function(){return e$(i,e,function(){return i.complete()},t)},function(r){return e$(i,e,function(){return i.error(r)},t)}))})}function eM(e,t){return void 0===t&&(t=0),eT(function(r,i){i.add(e.schedule(function(){return r.subscribe(i)},t))})}function eO(e,t){if(!e)throw Error("Iterable cannot be null");return new en(function(r){e$(r,t,function(){var i=e[Symbol.asyncIterator]();e$(r,t,function(){i.next().then(function(e){e.done?r.complete():r.next(e.value)})},0,!0)})})}function eN(e,t){return t?function(e,t){if(null!=e){if(M(e[ee]))return eS(e).pipe(eM(t),ex(t));if(eb(e))return new en(function(r){var i=0;return t.schedule(function(){i===e.length?r.complete():(r.next(e[i++]),r.closed||this.schedule())})});if(eg(e))return eS(e).pipe(eM(t),ex(t));if(em(e))return eO(e,t);if(ew(e))return new en(function(r){var i;return e$(r,t,function(){i=e[ev](),e$(r,t,function(){var e,t,n;try{t=(e=i.next()).value,n=e.done}catch(e){r.error(e);return}n?r.complete():r.next(t)},0,!0)}),function(){return M(null==i?void 0:i.return)&&i.return()}});if(eE(e))return eO(e_(e),t)}throw ey(e)}(e,t):eS(e)}function eA(e,t){return eT(function(r,i){var n=0;r.subscribe(eC(i,function(r){i.next(e.call(t,r,n++))}))})}var ek=Array.isArray;function eP(e){return eA(function(t){return ek(t)?e.apply(void 0,R([],C(t))):e(t)})}function eU(e){return e&&M(e.schedule)}function eD(e){return e[e.length-1]}function eB(e){return M(eD(e))?e.pop():void 0}function eL(e){return eU(eD(e))?e.pop():void 0}function eq(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=eL(e),i=eB(e),n=function(e){if(1===e.length){var t,r=e[0];if(ep(r))return{args:r,keys:null};if((t=r)&&"object"==typeof t&&eh(t)===ed){var i=ef(r);return{args:i.map(function(e){return r[e]}),keys:i}}}return{args:e,keys:null}}(e),s=n.args,o=n.keys;if(0===s.length)return eN([],r);var a=new en(eV(s,r,o?function(e){return o.reduce(function(t,r,i){return t[r]=e[i],t},{})}:et));return i?a.pipe(eP(i)):a}function eV(e,t,r){return void 0===r&&(r=et),function(i){var n,s,o;n=t,s=function(){for(var n=e.length,s=Array(n),o=n,a=n,l=function(n){var l,c,u;l=t,c=function(){var l=eN(e[n],t),c=!1;l.subscribe(eC(i,function(e){s[n]=e,!c&&(c=!0,a--),a||i.next(r(s.slice()))},function(){--o||i.complete()}))},u=i,l?e$(u,l,c):c()},c=0;c<n;c++)l(c)},o=i,n?e$(o,n,s):s()}}function eF(e,t,r,i,n,s,o,a){var l=[],c=0,u=0,p=!1,h=function(){!p||l.length||c||t.complete()},d=function(e){return c<i?f(e):l.push(e)},f=function(e){s&&t.next(e),c++;var a=!1;eS(r(e,u++)).subscribe(eC(t,function(e){null==n||n(e),s?d(e):t.next(e)},function(){a=!0},void 0,function(){if(a)try{for(c--;l.length&&c<i;)!function(){var e=l.shift();o?e$(t,o,function(){return f(e)}):f(e)}();h()}catch(e){t.error(e)}}))};return e.subscribe(eC(t,d,function(){p=!0,h()})),function(){null==a||a()}}function ej(e,t,r){return(void 0===r&&(r=1/0),M(t))?ej(function(r,i){return eA(function(e,n){return t(r,e,i,n)})(eS(e(r,i)))},r):("number"==typeof t&&(r=t),eT(function(t,i){return eF(t,i,e,r)}))}function ez(e){return void 0===e&&(e=1/0),ej(et,e)}function eW(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return ez(1)(eN(e,eL(e)))}function eH(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=eL(e);return eT(function(t,i){ez(1)(eN(R([t],C(e)),r)).subscribe(i)})}function eK(e){return new en(function(t){eS(e()).subscribe(t)})}var eG=new en(function(e){return e.complete()});function eQ(e,t){return eT(function(r,i){var n=0;r.subscribe(eC(i,function(r){return e.call(t,r,n++)&&i.next(r)}))})}var eJ=O(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}});function eY(e,t){var r="object"==typeof t;return new Promise(function(i,n){var s=new J({next:function(e){i(e),s.unsubscribe()},error:n,complete:function(){r?i(t.defaultValue):n(new eJ)}});e.subscribe(s)})}var eX=["addListener","removeListener"],eZ=["addEventListener","removeEventListener"],e0=["on","off"];function e1(e,t,r,i){if(M(r)&&(i=r,r=void 0),i)return e1(e,t,r).pipe(eP(i));var n,s,o,a=C(M((n=e).addEventListener)&&M(n.removeEventListener)?eZ.map(function(i){return function(n){return e[i](t,n,r)}}):M((s=e).addListener)&&M(s.removeListener)?eX.map(e2(e,t)):M((o=e).on)&&M(o.off)?e0.map(e2(e,t)):[],2),l=a[0],c=a[1];if(!l&&eb(e))return ej(function(e){return e1(e,t,r)})(eS(e));if(!l)throw TypeError("Invalid event target");return new en(function(e){var t=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.next(1<t.length?t:t[0])};return l(t),function(){return c(t)}})}function e2(e,t){return function(r){return function(i){return e[r](t,i)}}}var e5=function(e){function t(t,r){return e.call(this)||this}return I(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(k),e4={setInterval:function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var n=e4.delegate;return(null==n?void 0:n.setInterval)?n.setInterval.apply(n,R([e,t],C(r))):setInterval.apply(void 0,R([e,t],C(r)))},clearInterval:function(e){var t=e4.delegate;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},e3=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.scheduler=t,i.work=r,i.pending=!1,i}return I(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var r,i=this.id,n=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(n,i,t)),this.pending=!0,this.delay=t,this.id=null!=(r=this.id)?r:this.requestAsyncId(n,this.id,t),this},t.prototype.requestAsyncId=function(e,t,r){return void 0===r&&(r=0),e4.setInterval(e.flush.bind(e,this),r)},t.prototype.recycleAsyncId=function(e,t,r){if(void 0===r&&(r=0),null!=r&&this.delay===r&&!1===this.pending)return t;null!=t&&e4.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return Error("executing a cancelled action");this.pending=!1;var r=this._execute(e,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var r,i=!1;try{this.work(e)}catch(e){i=!0,r=e||Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,r=this.scheduler,i=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,A(i,this),null!=t&&(this.id=this.recycleAsyncId(r,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(e5),e6={now:function(){return(e6.delegate||Date).now()},delegate:void 0},e7=function(){function e(t,r){void 0===r&&(r=e.now),this.schedulerActionCtor=t,this.now=r}return e.prototype.schedule=function(e,t,r){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},e.now=e6.now,e}(),e8=new(function(e){function t(t,r){void 0===r&&(r=e7.now);var i=e.call(this,t,r)||this;return i.actions=[],i._active=!1,i}return I(t,e),t.prototype.flush=function(e){var t,r=this.actions;if(this._active)return void r.push(e);this._active=!0;do if(t=e.execute(e.state,e.delay))break;while(e=r.shift())if(this._active=!1,t){for(;e=r.shift();)e.unsubscribe();throw t}},t}(e7))(e3);function e9(e){return e instanceof Date&&!isNaN(e)}function te(e,t,r){void 0===e&&(e=0),void 0===r&&(r=e8);var i=-1;return null!=t&&(eU(t)?r=t:i=t),new en(function(t){var n=e9(e)?e-r.now():e;n<0&&(n=0);var s=0;return r.schedule(function(){t.closed||(t.next(s++),0<=i?this.schedule(void 0,i):t.complete())},n)})}function tt(e,t){var r="object"==typeof t;return new Promise(function(i,n){var s,o=!1;e.subscribe({next:function(e){s=e,o=!0},error:n,complete:function(){o?i(s):r?i(t.defaultValue):n(new eJ)}})})}function tr(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=eL(t),n=(e=1/0,"number"==typeof eD(t)?t.pop():e);return t.length?1===t.length?eS(t[0]):ez(n)(eN(t,i)):eG}var ti=new en(V);function tn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=eL(e);return eN(e,r)}var ts=Array.isArray;function to(e){return 1===e.length&&ts(e[0])?e[0]:e}function ta(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return 1===(t=to(t)).length?eS(t[0]):new en((e=t,function(t){for(var r=[],i=function(i){r.push(eS(e[i]).subscribe(eC(t,function(e){if(r){for(var n=0;n<r.length;n++)n!==i&&r[n].unsubscribe();r=null}t.next(e)})))},n=0;r&&!t.closed&&n<e.length;n++)i(n)}))}var tl=function(e){function t(t,r,i){void 0===t&&(t=1/0),void 0===r&&(r=1/0),void 0===i&&(i=e6);var n=e.call(this)||this;return n._bufferSize=t,n._windowTime=r,n._timestampProvider=i,n._buffer=[],n._infiniteTimeWindow=!0,n._infiniteTimeWindow=r===1/0,n._bufferSize=Math.max(1,t),n._windowTime=Math.max(1,r),n}return I(t,e),t.prototype.next=function(t){var r=this.isStopped,i=this._buffer,n=this._infiniteTimeWindow,s=this._timestampProvider,o=this._windowTime;!r&&(i.push(t),n||i.push(s.now()+o)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),r=this._infiniteTimeWindow,i=this._buffer.slice(),n=0;n<i.length&&!e.closed;n+=r?1:2)e.next(i[n]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this._bufferSize,t=this._timestampProvider,r=this._buffer,i=this._infiniteTimeWindow,n=(i?1:2)*e;if(e<1/0&&n<r.length&&r.splice(0,r.length-n),!i){for(var s=t.now(),o=0,a=1;a<r.length&&r[a]<=s;a+=2)o=a;o&&r.splice(0,o+1)}},t}(ea);function tc(e,t){return eT(function(r,i){var n=null,s=0,o=!1,a=function(){return o&&!n&&i.complete()};r.subscribe(eC(i,function(r){null==n||n.unsubscribe();var o=0,l=s++;eS(e(r,l)).subscribe(n=eC(i,function(e){return i.next(t?t(r,e,l,o++):e)},function(){n=null,a()}))},function(){o=!0,a()}))})}function tu(e,t){var r=M(e)?e:function(){return e},i=function(e){return e.error(r())};return new en(t?function(e){return t.schedule(i,0,e)}:i)}var tp=O(function(e){return function(t){void 0===t&&(t=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}});function th(e,t){var r=e9(e)?{first:e}:"number"==typeof e?{each:e}:e,i=r.first,n=r.each,s=r.with,o=void 0===s?td:s,a=r.scheduler,l=void 0===a?null!=t?t:e8:a,c=r.meta,u=void 0===c?null:c;if(null==i&&null==n)throw TypeError("No timeout provided.");return eT(function(e,t){var r,s,a=null,c=0,p=function(e){s=e$(t,l,function(){try{r.unsubscribe(),eS(o({meta:u,lastValue:a,seen:c})).subscribe(t)}catch(e){t.error(e)}},e)};r=e.subscribe(eC(t,function(e){null==s||s.unsubscribe(),c++,t.next(a=e),n>0&&p(n)},void 0,void 0,function(){(null==s?void 0:s.closed)||null==s||s.unsubscribe(),a=null})),c||p(null!=i?"number"==typeof i?i:i-l.now():n)})}function td(e){throw new tp(e)}function tf(e){return eT(function(t,r){var i,n=null,s=!1;n=t.subscribe(eC(r,void 0,void 0,function(o){i=eS(e(o,tf(e)(t))),n?(n.unsubscribe(),n=null,i.subscribe(r)):s=!0})),s&&(n.unsubscribe(),n=null,i.subscribe(r))})}function tb(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=eB(e);return r?er(tb.apply(void 0,R([],C(e))),eP(r)):eT(function(t,r){eV(R([t],C(to(e))))(r)})}function tg(e,t){return void 0===t&&(t=et),e=null!=e?e:tm,eT(function(r,i){var n,s=!0;r.subscribe(eC(i,function(r){var o=t(r);(s||!e(n,o))&&(s=!1,n=o,i.next(r))}))})}function tm(e,t){return e===t}function ty(e,t,r){return void 0===t&&(t=1/0),t=1>(t||0)?1/0:t,eT(function(i,n){return eF(i,n,e,t,void 0,!0,r)})}function tv(e){return eT(function(t,r){try{t.subscribe(r)}finally{r.add(e)}})}function tw(e){return e<=0?function(){return eG}:eT(function(t,r){var i=0;t.subscribe(eC(r,function(t){++i<=e&&(r.next(t),e<=i&&r.complete())}))})}function t_(e){return eT(function(t,r){var i=!1;t.subscribe(eC(r,function(e){i=!0,r.next(e)},function(){i||r.next(e),r.complete()}))})}function tE(e,t){var r=arguments.length>=2;return function(i){var n;return i.pipe(e?eQ(function(t,r){return e(t,r,i)}):et,tw(1),r?t_(t):(n=function(){return new eJ},eT(function(e,t){var r=!1;e.subscribe(eC(t,function(e){r=!0,t.next(e)},function(){return r?t.complete():t.error(n())}))})))}}function tS(e){void 0===e&&(e={});var t=e.connector,r=void 0===t?function(){return new ea}:t,i=e.resetOnError,n=void 0===i||i,s=e.resetOnComplete,o=void 0===s||s,a=e.resetOnRefCountZero,l=void 0===a||a;return function(e){var t,i,s,a=0,c=!1,u=!1,p=function(){null==i||i.unsubscribe(),i=void 0},h=function(){p(),t=s=void 0,c=u=!1},d=function(){var e=t;h(),null==e||e.unsubscribe()};return eT(function(e,f){a++,u||c||p();var b=s=null!=s?s:r();f.add(function(){0!=--a||u||c||(i=tI(d,l))}),b.subscribe(f),!t&&a>0&&(t=new J({next:function(e){return b.next(e)},error:function(e){u=!0,p(),i=tI(h,n,e),b.error(e)},complete:function(){c=!0,p(),i=tI(h,o),b.complete()}}),eS(e).subscribe(t))})(e)}}function tI(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(!0===t)return void e();if(!1!==t){var n=new J({next:function(){n.unsubscribe(),e()}});return eS(t.apply(void 0,R([],C(r)))).subscribe(n)}}function t$(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=eL(e);return eT(function(t,i){(r?eW(e,t,r):eW(e,t)).subscribe(i)})}function tT(e){return eT(function(t,r){eS(e).subscribe(eC(r,function(){return r.complete()},V)),r.closed||t.subscribe(r)})}function tC(e,t){return void 0===t&&(t=!1),eT(function(r,i){var n=0;r.subscribe(eC(i,function(r){var s=e(r,n++);(s||t)&&i.next(r),s||i.complete()}))})}function tR(e,t,r){var i=M(e)||t||r?{next:e,error:t,complete:r}:e;return i?eT(function(e,t){null==(r=i.subscribe)||r.call(i);var r,n=!0;e.subscribe(eC(t,function(e){var r;null==(r=i.next)||r.call(i,e),t.next(e)},function(){var e;n=!1,null==(e=i.complete)||e.call(i),t.complete()},function(e){var r;n=!1,null==(r=i.error)||r.call(i,e),t.error(e)},function(){var e,t;n&&(null==(e=i.unsubscribe)||e.call(i)),null==(t=i.finalize)||t.call(i)}))}):et}function tx(e){return Array.from(e.entries()).reduce((e,[t,r])=>(e[t]=r,e),{})}!function(e){e.orElse=function(e,t){return void 0!==e?e:"function"==typeof t?t():t},e.orElseThrow=function(e,t){if(void 0!==e)return e;throw t()}}(e||(e={})),function(t){t.coerce=function(t,r){return null==t?e.orElse(r&&r.coerceNullOrUndefined,!0)?[]:t:Array.isArray(t)?t:[t]},t.isEqual=function(e,t,r){return e===t||!!e&&!!t&&e.length===t.length&&(r?.exactOrder??!0?e.every((e,r)=>e===t[r]):e.every(e=>t.includes(e))&&t.every(t=>e.includes(t)))},t.remove=function(t,r,i){let n=e.orElse(i&&i.firstOnly,!1),s="function"==typeof r?()=>t.findIndex(r):()=>t.indexOf(r),o=[];for(let e=s();-1!==e&&(o.push(...t.splice(e,1)),!n);e=s());return o},t.distinct=function(e,t=et){let r=new Set(e.map(t));return e.filter(e=>r.delete(t(e)))},t.intersect=function(...e){let t=e.filter(e=>null!=e);if(!t.length)return[];let r=t.pop();return t.reduce((e,t)=>e.filter(e=>t.includes(e)),[...r])},t.last=function(e,t){if(e){if(!t)return e[e.length-1];for(let r=e.length-1;r>=0;r--)if(t(e[r]))return e[r]}}}(t||(t={})),(r||(r={})).isEqual=function(e,t){return e===t||!!e&&!!t&&Object.keys(e).length===Object.keys(t).length&&Object.entries(e).every(([e,r])=>t[e]===r)},function(t){t.coerce=function(t,r){if(null==t)return e.orElse(r&&r.coerceNullOrUndefined,!0)?{}:t;if(t instanceof Map)return tx(t);try{let e=new Map(t);return tx(e)}catch{}return t},t.withoutUndefinedEntries=function(e){return Object.entries(e).reduce((e,[t,r])=>(void 0!==r&&(e[t]=r),e),{})}}(i||(i={})),function(r){r.coerce=function(t,r){if(null==t)return e.orElse(r&&r.coerceNullOrUndefined,!0)?new Map:t;if(t instanceof Map)return t;try{return new Map(t)}catch{}return Object.entries(t).reduce((e,[t,r])=>e.set(t,r),new Map)},r.addSetValue=function(e,t,r){let i=e.get(t)||new Set;return e.set(t,i.add(r))},r.removeSetValue=function(e,t,r){let i,n=e.get(t)||new Set;return(i="function"==typeof r?Array.from(n).filter(r).reduce((e,t)=>n.delete(t)||e,!1):n.delete(r))&&!n.size&&e.delete(t),i},r.addListValue=function(e,t,r){let i=e.get(t)||[];return e.set(t,i.concat(r))},r.removeListValue=function(e,r,i){let n=e.get(r)||[],s=t.remove(n,i,{firstOnly:!1}).length>0;return s&&!n.length&&e.delete(r),s}}(n||(n={})),(s||(s={})).coerce=function(e){return e instanceof en?e:e instanceof Promise?eN(e):tn(e)};let tM=new class{constructor(){this._beanRegistry=new Map,this._decoratorRegistry=new Map,this._initializers=[],this._sequence=0,this._runlevel$=new eu(-1),this._eagerBeansConstructed=!1,this._started=!1}register(t,r){if(!t)throw Error("[BeanRegisterError] Missing bean lookup symbol.");r&&Object.keys(r).some(e=>e.startsWith("use"))||(r={...r,useClass:t}),tA(t,r);let i=e.orElse(r.multi,!1);if(i&&this._beanRegistry.has(t)&&Array.from(this._beanRegistry.get(t)).some(e=>!e.multi))throw Error("[BeanRegisterError] Trying to register a bean as 'multi-bean' on a symbol that has already registered a 'non-multi-bean'. This is probably not what was intended.");if(!i&&this._beanRegistry.has(t)&&Array.from(this._beanRegistry.get(t)).some(e=>e.multi))throw Error("[BeanRegisterError] Trying to register a bean on a symbol that has already registered a 'multi-bean'. This is probably not what was intended.");!i&&this._beanRegistry.has(t)&&this.disposeBean(this._beanRegistry.get(t).values().next().value);let n={symbol:t,beanConstructFn:tN(r),eager:e.orElse(r.eager||void 0!==r.useValue,!1),multi:i,instructions:r,constructing:!1};if(i){let e=this._beanRegistry.get(t)||new Set;this._beanRegistry.set(t,e.add(n))}else this._beanRegistry.set(t,new Set([n]));return n.eager&&this._eagerBeansConstructed&&this.getOrConstructBeanInstance(n),{unregister:()=>this.disposeBean(n)}}registerIfAbsent(e,t){if(!e)throw Error("[BeanRegisterError] Missing bean lookup symbol.");return this._beanRegistry.has(e)?{unregister:V}:this.register(e,t)}registerDecorator(e,t){if(this._started)throw Error("[BeanManagerLifecycleError] Decorators can only be registered before starting the bean manager.");if(!e)throw Error("[BeanDecoratorRegisterError] A decorator requires a symbol.");tA(e,t);let r=tN(t)();n.addListValue(this._decoratorRegistry,e,r)}registerInitializer(e){if(this._started)throw Error("[BeanManagerLifecycleError] Initializers can only be registered before starting the bean manager.");let t=(()=>{if("function"==typeof e)return{fn:e};if(void 0!==e.runlevel&&e.runlevel<0)throw Error(`[InitializerRegisterError] The runlevel of an initializer must be >= 0, but was ${e.runlevel}.`);if(e.useFunction)return{fn:e.useFunction,runlevel:e.runlevel};if(e.useClass){let t=e.useClass;return{fn:()=>new t().init(),runlevel:e.runlevel}}if(e.useExisting){let t=e.useExisting;return{fn:()=>tM.get(t).init(),runlevel:e.runlevel}}throw Error("[NullInitializerError] No initializer specified.")})();this._initializers.push(t)}get(e,t){let r=this.all(e);switch(r.length){case 0:if(t?.orElseGet!==void 0)return t.orElseGet;if(t?.orElseSupply)return t.orElseSupply();throw Error(`[NullBeanError] No bean registered under the symbol '${tk(e)}'.`);case 1:return r[0];default:throw Error(`[MultiBeanError] Multiple beans registered under the symbol '${tk(e)}'.`)}}opt(e){return this.get(e,{orElseSupply:()=>void 0})}all(e){let t=Array.from(this._beanRegistry.get(e)||new Set);if(!t||!t.length)return[];if(t.some(e=>e.constructing))throw Error(`[BeanConstructError] Circular bean construction cycle detected [bean={${tk(e)}}].`);return t.map(e=>this.getOrConstructBeanInstance(e))}async start(e){if(this._started)throw Error("[BeanManagerLifecycleError] Bean manager already started.");let t=e?.initializerDefaultRunlevel??0,r=e?.eagerBeanConstructRunlevel??(0===this._initializers.length?t+1:Math.max(...this._initializers.map(e=>e.runlevel??t))+1);this.registerInitializer({useFunction:async()=>{this.constructEagerBeans(),this._eagerBeansConstructed=!0},runlevel:r}),await this.runInitializers(t),this._started=!0}destroy(){this.getBeanInfos().sort(tO).forEach(e=>this.disposeBean(e)),this._beanRegistry.clear(),this._decoratorRegistry.clear(),this._initializers.length=0,this._runlevel$.next(-1),this._eagerBeansConstructed=!1,this._started=!1}disposeBean(e){if((e.instructions.useClass||e.instructions.useFactory)&&e.instance&&"function"==typeof e.instance.preDestroy)try{e.instance.preDestroy()}catch(e){console?.error("Bean threw an error in `preDestroy`",e)}e.instance=void 0,e.constructing=!1,n.removeSetValue(this._beanRegistry,e.symbol,e)}async whenRunlevel(e){return eY(this._runlevel$.pipe(eQ(t=>t>=e))).then(()=>Promise.resolve())}getBeanInfos(){return Array.from(this._beanRegistry.values()).reduce((e,t)=>e.concat(Array.from(t)),[])}async runInitializers(e){let t=this._initializers.reduce((t,r)=>n.addListValue(t,r.runlevel??e,r.fn),new Map);for(let e of Array.from(t.keys()).sort((e,t)=>e-t)){this._runlevel$.next(e);try{await Promise.all(t.get(e).map(e=>e()))}catch(t){throw Error(`[InitializerError] Initializer rejected with an error: ${t} [runlevel=${e}]`)}}}constructEagerBeans(){this.getBeanInfos().filter(e=>e.eager).forEach(e=>this.getOrConstructBeanInstance(e))}getOrConstructBeanInstance(e){if(e.instance)return e.instance;e.constructing=!0;try{let t=e.beanConstructFn(),r=this._decoratorRegistry.get(e.symbol)||[];return e.instance=[...r].reverse().reduce((e,t)=>t.decorate(e),t),e.constructInstant=++this._sequence,e.instance}finally{e.constructing=!1}}};function tO(e,t){return(e.instructions.destroyOrder??0)<(t.instructions.destroyOrder??0)?-1:(e.instructions.destroyOrder??0)>(t.instructions.destroyOrder??0)?1:(t.constructInstant??0)-(e.constructInstant??0)}function tN(e){if(void 0!==e.useValue){let t=e.useValue;return()=>t}if(e.useClass){let t=e.useClass;return()=>new t}if(e.useFactory){let t=e.useFactory;return()=>t()}if(e.useExisting){let t=e.useExisting;return()=>tM.get(t)}throw Error("[BeanConstructError] Missing bean construction strategy")}function tA(e,t){switch(Object.keys(t).filter(e=>e.startsWith("use")).length){case 0:throw Error(`[BeanRegisterError] Missing bean construction strategy. Expected one of 'useValue', 'useClass', 'useFactory' or 'useExisting' [bean=${e.toString()}, instructions=${JSON.stringify(t)}]`);case 1:break;default:throw Error(`[BeanRegisterError] Multiple bean construction strategies specified. Expected one of 'useValue', 'useClass', 'useFactory' or 'useExisting' [bean=${e.toString()}, instructions=${JSON.stringify(t)}]`)}if(Object.keys(t).includes("useValue")&&void 0===t.useValue)throw Error(`[BeanRegisterError] Passing \`undefined\` as bean value is not supported [bean=${e.toString()}].`)}function tk(e){return"function"==typeof e?e.name:e.toString()}let tP=function*(){let e=[];for(let t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);for(;;){let t=0xffffffff*Math.random()|0,r=0xffffffff*Math.random()|0,i=0xffffffff*Math.random()|0,n=0xffffffff*Math.random()|0,s=e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&r]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[63&i|128]+e[i>>8&255]+"-"+e[i>>16&255]+e[i>>24&255]+e[255&n]+e[n>>8&255]+e[n>>16&255]+e[n>>24&255];yield s}}();var tU=Object.freeze({__proto__:null,randomUUID:function(){return tP.next().value}});function tD(e){return e?tc(r=>{if(!r.length)return tn([]);let i=r.map(e);return i.every(e=>"boolean"==typeof e)?tn(r.filter((e,t)=>i[t])):eq(i.map(e=>s.coerce(e).pipe(t_(!1),tf(()=>tn(!1))))).pipe(tg((e,r)=>t.isEqual(e,r)),eA(e=>r.filter((t,r)=>e[r])))}):e=>e}function tB(e){return eA(t=>t.map(t=>e(t)))}function tL(e){let t=eN(e).pipe(tw(1),ej(()=>eG),tS({resetOnComplete:!1,resetOnError:!1,resetOnRefCountZero:!1}));return ej(e=>eW(t,tn(e)))}!function(e){e[e.Starting=1]="Starting",e[e.Started=2]="Started",e[e.Stopping=3]="Stopping",e[e.Stopped=4]="Stopped"}(o||(o={})),function(e){e[e.Zero=0]="Zero",e[e.One=1]="One",e[e.Two=2]="Two",e[e.Three=3]="Three"}(a||(a={})),function(e){e.Activator="activator",e.Microfrontend="microfrontend"}(l||(l={}));let tq=Symbol("IS_PLATFORM_HOST"),tV=Symbol("APP_IDENTITY"),tF="ɵACTIVATION_CONTEXT",tj=Symbol("ɵVERSION"),tz=Symbol("ɵWINDOW_TOP");class tW{}class tH{constructor(){this._destroy$=new ea,ta(e1(window,"beforeunload"),e1(window,"unload")).pipe(tw(1),tT(this._destroy$)).subscribe(()=>{tY.destroy()})}preDestroy(){this._destroy$.next()}}class tK{}class tG{debug(e,...t){this.log("debug",e,t)}info(e,...t){this.log("info",e,t)}warn(e,...t){this.log("warn",e,t)}error(e,...t){this.log("error",e,t)}log(e,t,r){let i=r[0]instanceof tJ?r.shift():{appSymbolicName:tM.get(tV),version:tM.get(tj)},n=[].concat(i.version?`[@scion/microfrontend-platform@${i.version}]`:"[@scion/microfrontend-platform]").concat(`[${i.appSymbolicName}]`).join("");if(console&&"function"==typeof console[e]){let i=console[e];r?.length?i(`${n} ${t}`,...r):i(`${n} ${t}`)}}}let tQ=new class extends tK{debug(e){}info(e){}warn(e){}error(e){}};class tJ{constructor(e,t){this.appSymbolicName=e,this.version=t}}class tY{static{this._state$=new eu(o.Stopped)}constructor(){}static async startPlatform(e){if(this.state===o.Started)return Promise.reject(Error("[MicrofrontendPlatformStartupError] Platform already started"));try{return e?.(),await this.enterState(o.Starting),await tM.start({eagerBeanConstructRunlevel:a.One,initializerDefaultRunlevel:a.Two}),await this.enterState(o.Started),Promise.resolve()}catch(e){return await this.destroy(),Promise.reject(Error(`[MicrofrontendPlatformStartupError] Microfrontend platform failed to start: ${e}`))}}static async destroy(){await this.enterState(o.Stopping),tM.destroy(),await this.enterState(o.Stopped)}static get state(){return this._state$.getValue()}static get state$(){return this._state$}static async whenState(e){return new Promise((t,r)=>{this._state$.pipe(tE(t=>t===e)).subscribe({error:r,complete:t})})}static async enterState(e){if((this.state===o.Stopped?-1:this.state)>=e)throw Error(`[PlatformStateError] Failed to enter platform state [prevState=${o[this.state]}, newState=${o[e]}].`);this._state$.next(e),await this.whenState(e)}}function tX(e){tM.register(tq,{useValue:e.isPlatformHost}),tM.register(tV,{useValue:e.symbolicName}),tM.registerIfAbsent(tz,{useValue:window.top}),tM.registerIfAbsent(tj,{useValue:"1.2.2",destroyOrder:c.CORE}),tM.registerIfAbsent(tW,{useClass:tH,eager:!0}),tM.registerIfAbsent(tK,{useClass:tG,destroyOrder:c.CORE})}!function(e){e[e.CORE=Number.MAX_SAFE_INTEGER]="CORE",e[e.BROKER=e.CORE-1]="BROKER",e[e.MESSAGING=e.BROKER-1]="MESSAGING"}(c||(c={}));class tZ{}class t0{}class t1{intercept(e){e.intentions=[...e.intentions||[],...tM.get(tZ).activatorApiDisabled?[]:[{type:l.Activator,qualifier:{"*":"*"}}]]}}class t2{}class t5{}function t4(e){return tT(tM.get(t5).subscriberCount$(e).pipe(tE(e=>0===e)))}function t3(){return er(ej(e=>{let t=e.headers.get(d.Status)??b.OK;if(t<400)return tn(e);if("string"==typeof e.body){let r=e.body;return tu(()=>new t7(r,t,e))}switch(t){case b.BAD_REQUEST:return tu(()=>new t7("The receiver could not understand the request due to invalid syntax.",t,e));case b.NOT_FOUND:return tu(()=>new t7("The receiver could not find the requested resource.",t,e));case b.ERROR:return tu(()=>new t7("The receiver encountered an internal error.",t,e));default:return tu(()=>new t7("Request error.",t,e))}}),tC(e=>e.headers.get(d.Status)!==b.TERMINAL,!0),eQ(e=>e.headers.get(d.Status)!==b.TERMINAL||void 0!==e.body))}function t6(){return eA(e=>e.body)}!function(e){e.ClientToBroker="sci://microfrontend-platform/client-to-broker",e.BrokerToClient="sci://microfrontend-platform/broker-to-client",e.MicrofrontendToOutlet="sci://microfrontend-platform/microfrontend-to-outlet"}(u||(u={})),function(e){e.TopicSubscribe="topic-subscribe",e.TopicUnsubscribe="topic-unsubscribe",e.IntentSubscribe="intent-subscribe",e.IntentUnsubscribe="intent-unsubscribe",e.Topic="topic",e.Intent="intent",e.ClientConnect="client-connect",e.ClientDisconnect="client-disconnect"}(p||(p={})),function(e){e.RequestSubscriberCount="ɵREQUEST_SUBSCRIBER_COUNT",e.FocusIn="ɵFOCUS_IN",e.IsFocusWithin="ɵIS_FOCUS_WITHIN",e.HasFocus="ɵHAS_FOCUS",e.PlatformProperties="ɵPLATFORM_PROPERTIES",e.Applications="ɵAPPLICATIONS",e.LookupCapabilities="ɵLOOKUP_CAPABILITIES",e.LookupIntentions="ɵLOOKUP_INTENTIONS",e.RegisterCapability="ɵREGISTER_CAPABILITY",e.UnregisterCapabilities="ɵUNREGISTER_CAPABILITIES",e.RegisterIntention="ɵREGISTER_INTENTION",e.UnregisterIntentions="ɵUNREGISTER_INTENTIONS",e.IsApplicationQualifiedForCapability="ɵIS_APPLICATION_QUALIFIED_FOR_CAPABILITY",e.platformVersion=function(e){return`\u{275}application/${e}/platform/version`},e.ping=function(e){return`\u{275}client/${e}/ping`}}(h||(h={})),function(e){e.ClientId="ɵCLIENT_ID",e.AppSymbolicName="ɵAPP_SYMBOLIC_NAME",e.MessageId="ɵMESSAGE_ID",e.ReplyTo="ɵREPLY_TO",e.Timestamp="ɵTIMESTAMP",e.Version="ɵVERSION",e.Method="ɵMETHOD",e.Status="ɵSTATUS",e["ɵSubscriberId"]="ɵSUBSCRIBER_ID"}(d||(d={})),function(e){e.GET="GET",e.DELETE="DELETE",e.PUT="PUT",e.POST="POST",e.OBSERVE="OBSERVE"}(f||(f={})),function(e){e[e.OK=200]="OK",e[e.TERMINAL=250]="TERMINAL",e[e.BAD_REQUEST=400]="BAD_REQUEST",e[e.NOT_FOUND=404]="NOT_FOUND",e[e.ERROR=500]="ERROR"}(b||(b={}));class t7 extends Error{constructor(e,t,r){super(e),this.status=t,this.msg=r,this.name="RequestError"}}!function(e){function t(e){return e.startsWith(":")&&e.length>1}function r(e){return e?.split("/").filter(Boolean)??[]}e.containsWildcardSegments=function(e){return r(e).some(t)},e.containsEmptySegments=function(e){return e.split("/").some(e=>!e.length)},e.isWildcardSegment=t,e.split=r,e.computeWildcardSegmentPermutations=function t(r,i){let n="string"==typeof r?e.split(r):r;return 1===n.length?[n[0],i]:t(n.slice(1),i).reduce((e,t)=>(e.push(`${n[0]}/${t}`),e.push(`${i}/${t}`),e),[])},e.replaceWildcardSegments=function(e,t){return e.replace(/:[^/]+/g,t)},e.validateTopic=function(t,r){return t?e.containsEmptySegments(t)?Error(`[IllegalTopicError] Topic must not contain empty segments [topic='${t}']`):r.exactTopic&&e.containsWildcardSegments(t)?Error(`[IllegalTopicError] Topic must be exact, i.e., not contain wildcard segments [topic='${t}']`):null:Error("[IllegalTopicError] Topic must not be `null`, `undefined` or empty")}}(g||(g={}));class t8{constructor(e){if(this._patternSegments=g.split(e),!this._patternSegments.length)throw Error("[TopicMatcherError] Invalid pattern syntax. The pattern must consist of one or more topic segments, each separated by a forward slash.")}match(e){let r=g.split(e),i=this._patternSegments;if(!r.length)throw Error("[TopicMatcherError] Invalid topic. The topic must consist of one or more segments, each separated by a forward slash.");if(r.some(g.isWildcardSegment))throw Error("[TopicMatcherError] Invalid topic. Wildcard segments not allowed in an exact topic.");return i.length!==r.length?{matches:!1}:t.isEqual(r,i,{exactOrder:!0})?{matches:!0,params:new Map}:i.some(g.isWildcardSegment)&&i.every((e,t)=>e===r[t]||g.isWildcardSegment(e))?{matches:!0,params:i.reduce((e,t,i)=>g.isWildcardSegment(t)?e.set(t.substring(1),r[i]):e,new Map)}:{matches:!1}}}function t9(e){return eQ(t=>{let r=t.data;return r?.transport===e&&!!r.channel&&!!r.message?.headers})}function re(...e){let r=new Set(t.coerce(e));return eQ(e=>r.has(e.data.channel))}function rt(e){return er(re(p.Topic),eQ(t=>{let r=t.data.message.topic;return!!r&&new t8(e).match(r).matches}))}function rr(){return eA(e=>e.data.message)}function ri(e){let t;try{t=e()}catch(e){tM.opt(tK)?.error("[UnexpectedError] An unexpected error occurred.",e);return}return t instanceof Promise?t.catch(e=>{tM.opt(tK)?.error("[UnexpectedError] An unexpected error occurred.",e)}):t}function rn(e){return e instanceof Error?e.message:`${e}`}class rs{}function ro(){return e=>tM.opt(rs)?.decorate$(e)??e}class ra{constructor(e){this._selectors=new Map,this._sourceError$=new ea,this._sourceComplete$=new ea,this._destroy$=new ea;let{source$:t,keySelector:r}=e;t.pipe(tT(this._destroy$)).subscribe({next:e=>{let t=r(e);this._selectors.get(t)?.forEach(t=>t.next(e))},error:e=>this._sourceError$.error(e),complete:()=>this._sourceComplete$.next()})}select$(e){return new en(t=>{let r=new ea;n.addListValue(this._selectors,e,r);let i=tr(r,this._sourceError$).pipe(tT(this._sourceComplete$)).subscribe(t);return()=>{n.removeListValue(this._selectors,e,r),i.unsubscribe()}})}ɵsubscriberCount(){return Array.from(this._selectors.values()).reduce((e,t)=>e+t.length,0)}disconnect(){this._destroy$.next()}}class rl{}class rc{constructor(){console.log("[NullBrokerGateway] Using 'NullBrokerGateway'. Messages cannot be sent or received.")}isConnected(){return Promise.resolve(!0)}get message$(){return ti}async postMessage(e,t){return Promise.resolve()}requestReply$(e,t){return ti}subscribe$(e){return ti}}class ru{constructor(e){this._platformStopping$=new tl(1),this._session=null,this._session$=new ec,this._message$=new ea,this._selectMessagesByTopic=new ra({source$:this._message$.pipe(re(p.Topic)),keySelector:e=>e.data.message.topic}),this._selectMessagesBySubscriberIdHeader=new ra({source$:this._message$,keySelector:e=>e.data.message.headers.get(d.ɵSubscriberId)}),this._appSymbolicName=tM.get(tV),this._brokerDiscoverTimeout=e?.brokerDiscoverTimeout??1e4,this._messageDeliveryTimeout=e?.messageDeliveryTimeout??1e4}async init(){try{let e=await this.connectToBroker();this.installBrokerMessageListener(e),this.installPingReplier(e),this._session=e,this._session$.next(e),this._session$.complete()}catch(e){throw this._session$.error(e),e}}isConnected(){return tt(this._session$).then(()=>!0).catch(()=>!1)}get session(){return this._session}async postMessage(e,t){if(rp())throw m.PLATFORM_STOPPED_ERROR;let r=this._session||await tt(this._session$),i=tU.randomUUID(),n={transport:u.ClientToBroker,channel:e,message:t};n.message.headers.set(d.MessageId,i).set(d.Timestamp,Date.now()).set(d.AppSymbolicName,this._appSymbolicName).set(d.ClientId,r.clientId);let s=new ea,o=new Promise((e,t)=>{tr(this._selectMessagesByTopic.select$(i),s).pipe(tw(1),rr(),th({first:this._messageDeliveryTimeout,with:()=>tu(()=>m.MESSAGE_DISPATCH_ERROR(this._messageDeliveryTimeout,n))}),ej(e=>e.body.ok?eG:tu(()=>Error(e.body.details))),tT(this._platformStopping$)).subscribe({error:t,complete:e})});try{r.broker.window.postMessage(n,r.broker.origin)}catch(e){s.error(e)}await o}requestReply$(e,t){return new en(r=>{if(rp())return r.error(m.PLATFORM_STOPPED_ERROR),V;let i=tU.randomUUID(),n=tU.randomUUID(),s=new ea,o=new ea;return t.headers.set(d.ReplyTo,i).set(d.ɵSubscriberId,n),tr(this._selectMessagesBySubscriberIdHeader.select$(n),o).pipe(re(p.Topic),rr(),ro(),tT(tr(this._platformStopping$,s)),tv(()=>this.unsubscribe({unsubscribeChannel:p.TopicUnsubscribe,subscriberId:n,logContext:`[subscriberId=${n}, topic=${i}]`}))).subscribe({next:e=>r.next(e),error:e=>r.error(e),complete:V}),this.postMessage(e,t).catch(e=>o.error(e)),()=>s.next()})}subscribe$(e){let{messageChannel:t,subscribeChannel:r,unsubscribeChannel:i,newSubscribeCommand:n}=e;return new en(e=>{if(rp())return e.error(m.PLATFORM_STOPPED_ERROR),V;let s=tU.randomUUID(),o=new ea,a=new ea;return tr(this._selectMessagesBySubscriberIdHeader.select$(s),a).pipe(re(t),rr(),ro(),tT(tr(this._platformStopping$,o)),tv(()=>this.unsubscribe({unsubscribeChannel:i,subscriberId:s,logContext:JSON.stringify(n(s))}))).subscribe({next:t=>e.next(t),error:t=>e.error(t),complete:V}),this.postMessage(r,n(s)).catch(e=>a.error(e)),()=>o.next()})}async unsubscribe(e){if(rp())return;let{unsubscribeChannel:t,subscriberId:r,logContext:i}=e,n={subscriberId:r,headers:new Map};try{await this.postMessage(t,n)}catch(e){tM.get(tK,{orElseGet:tQ}).error(`[UnsubscribeError] Failed to unsubscribe from destination: '${i}'. Caused by: ${e}`)}}installBrokerMessageListener(e){var t,r;e1(window,"message").pipe((t=e.broker.window,eQ(e=>e.source===t)),(r=e.broker.origin,eQ(e=>e.origin===r)),t9(u.BrokerToClient),eA(e=>{let t=e.data;if(t.message.headers=new Map(t.message.headers||[]),t.channel===p.Intent){let e=t.message;e.intent.params=new Map(e.intent.params||[])}if(t.channel===p.Topic){let e=t.message;e.params=new Map(e.params||[])}return e}),tT(this._platformStopping$)).subscribe(this._message$)}installPingReplier(e){tM.get(tq)||tM.get(t5).observe$(h.ping(e.clientId)).pipe(tT(this._platformStopping$)).subscribe(e=>ri(()=>{let t=e.headers.get(d.ReplyTo);tM.get(t5).publish(t,void 0,{headers:new Map().set(d.Status,b.TERMINAL)}).then()}))}connectToBroker(){let e=tU.randomUUID(),t=eY(e1(window,"message").pipe(t9(u.BrokerToClient),rt(e),ej(e=>{let t=e.data.message.body;return t?.returnCode!=="accepted"?tu(()=>Error(`${t?.returnMessage??"UNEXPECTED: Empty broker discovery response"} [code: '${t?.returnCode??"n/a"}']`)):tn({clientId:t.clientId,broker:{window:e.source,origin:e.origin}})}),th({first:this._brokerDiscoverTimeout,with:()=>tu(()=>m.BROKER_DISCOVER_ERROR(this._brokerDiscoverTimeout))}),tR({error:e=>tM.get(tK,{orElseGet:tQ}).error(rn(e))}),tT(this._platformStopping$))),r={transport:u.ClientToBroker,channel:p.ClientConnect,message:{headers:new Map().set(d.MessageId,tU.randomUUID()).set(d.Timestamp,Date.now()).set(d.AppSymbolicName,this._appSymbolicName).set(d.ReplyTo,e).set(d.Version,tM.get(tj))}};if(tM.get(tq))window.postMessage(r,window.origin);else if(window===tM.get(tz)){let e=this.collectWindowHierarchy();te(0,25).pipe(tT(t.catch(()=>null))).subscribe(()=>{e.forEach(e=>e.postMessage(r,"*"))})}else this.collectWindowHierarchy().forEach(e=>e.postMessage(r,"*"));return t}disconnectFromBroker(){if(!this._session)return;let e={transport:u.ClientToBroker,channel:p.ClientDisconnect,message:{headers:new Map().set(d.MessageId,tU.randomUUID()).set(d.Timestamp,Date.now()).set(d.AppSymbolicName,this._appSymbolicName).set(d.ClientId,this._session.clientId)}};try{this._session.broker.window.postMessage(e,this._session.broker.origin)}catch(e){tM.get(tK,{orElseGet:tQ}).warn(`[ClientDisconnectError] Failed to disconnect from the broker. Caused by: ${e}`)}}collectWindowHierarchy(){let e=[];for(let t=window;t!==tM.get(tz);t=t.parent)e.unshift(t);return e.unshift(tM.get(tz)),e}preDestroy(){this.disconnectFromBroker(),this._platformStopping$.next(),this._selectMessagesByTopic.disconnect(),this._selectMessagesBySubscriberIdHeader.disconnect()}}function rp(){return tY.state>=o.Stopped}!function(e){e.PLATFORM_STOPPED_ERROR=Error("[GatewayError] Platform is stopped. Messages cannot be published or received."),e.MESSAGE_DISPATCH_ERROR=function(e,t){return Error(`[GatewayError] No acknowledgement received within ${e}ms for a message sent to the broker. [msg=${JSON.stringify(t,(e,t)=>t instanceof Map?i.coerce(t):t)}]`)},e.BROKER_DISCOVER_ERROR=function(e){return Error(`[GatewayError] Message broker not discovered within ${e}ms. Messages cannot be published or received.`)}}(m||(m={}));class rh{constructor(){this._properties=new Map}async init(){if(tM.get(rl)instanceof rc)return;let e=tM.get(t5).observe$(h.PlatformProperties);this._properties=await eY(e.pipe(t6(),eA(e=>n.coerce(e))))}contains(e){return this._properties.has(e)}get(e,t){if(this._properties.has(e))return this._properties.get(e);if(void 0!==t)return t;throw Error(`[PropertyNotFoundError] No property of given name found [prop=${e}]`)}properties(){return this._properties}}class rd{fetch(e,t){return fetch(e,t)}}class rf{}let rb=/^(https?:\/\/)|(blob:)/;!function(e){e.isAbsoluteUrl=function(e){return"about:blank"===e||rb.test(e)},e.newUrl=function(e,t){if(t){let r=new URL(t);return r.pathname&&!r.pathname.endsWith("/")&&(r.pathname+="/"),new URL(e,r)}return new URL(e)},e.ensureTrailingSlash=function(e){return e.endsWith("/")?e:e+"/"}}(y||(y={}));class rg{constructor(){this._applications=new Map}static{this.SYMBOLIC_NAME_REGEXP=/^[a-z0-9-]+$/}async registerApplication(r,i){if(e.orElseThrow(r.symbolicName,()=>Error(`[ApplicationRegistrationError] Invalid application config. Missing required property 'symbolicName'. [appConfig="${JSON.stringify(r)}", manifest="${JSON.stringify(i)}"]`)),e.orElseThrow(r.manifestUrl,()=>Error(`[ApplicationRegistrationError] Invalid application config. Missing required property 'manifestUrl'. [appConfig="${JSON.stringify(r)}", manifest="${JSON.stringify(i)}"]`)),!rg.SYMBOLIC_NAME_REGEXP.test(r.symbolicName))throw Error(`[ApplicationRegistrationError] Symbolic name must be lowercase and contain alphanumeric and dash characters [symbolicName='${r.symbolicName}'].`);if(Array.from(this._applications.values()).some(e=>e.symbolicName===r.symbolicName))throw Error(`[ApplicationRegistrationError] Symbolic name must be unique [symbolicName='${r.symbolicName}'].`);let n=this.computeBaseUrl(r,i);for(let s of(this._applications.set(r.symbolicName,{symbolicName:r.symbolicName,name:i.name??r.symbolicName,baseUrl:n,manifestUrl:y.newUrl(r.manifestUrl,y.isAbsoluteUrl(r.manifestUrl)?r.manifestUrl:window.origin).toString(),manifestLoadTimeout:r.manifestLoadTimeout??tM.get(tZ).manifestLoadTimeout,activatorLoadTimeout:r.activatorLoadTimeout??tM.get(tZ).activatorLoadTimeout,allowedMessageOrigins:new Set(t.coerce(r.secondaryOrigin)).add(y.newUrl(n).origin),scopeCheckDisabled:e.orElse(r.scopeCheckDisabled,!1),intentionCheckDisabled:e.orElse(r.intentionCheckDisabled,!1),intentionRegisterApiDisabled:e.orElse(r.intentionRegisterApiDisabled,!0)}),i.capabilities??[]))try{await tM.get(rf).registerCapability(s,r.symbolicName)}catch(e){tM.get(tK).error(`[CapabilityRegisterError] Failed to register capability for application '${r.symbolicName}'. [capability=${JSON.stringify(s)}]`,e)}i.intentions?.forEach(e=>{try{tM.get(rf).registerIntention(e,r.symbolicName)}catch(t){tM.get(tK).error(`[IntentionRegisterError] Failed to register intention for application '${r.symbolicName}' [intention=${JSON.stringify(e)}].`,t)}})}getApplication(e,t){let r=this._applications.get(e);if(!r&&!t)throw Error(`[NullApplicationError] No application registered under the symbolic name '${e}'.`);return r??null}getApplications(){return Array.from(this._applications.values())}isScopeCheckDisabled(t){return e.orElseThrow(this._applications.get(t),()=>Error(`[NullApplicationError] No application registered under the symbolic name '${t}'.`)).scopeCheckDisabled}isIntentionRegisterApiDisabled(t){return e.orElseThrow(this._applications.get(t),()=>Error(`[NullApplicationError] No application registered under the symbolic name '${t}'.`)).intentionRegisterApiDisabled}isIntentionCheckDisabled(t){return e.orElseThrow(this._applications.get(t),()=>Error(`[NullApplicationError] No application registered under the symbolic name '${t}'.`)).intentionCheckDisabled}computeBaseUrl(e,t){let r=y.isAbsoluteUrl(e.manifestUrl)?y.newUrl(e.manifestUrl):y.newUrl(e.manifestUrl,window.origin);return t.baseUrl?y.isAbsoluteUrl(t.baseUrl)?y.ensureTrailingSlash(t.baseUrl):y.ensureTrailingSlash(y.newUrl(t.baseUrl,r.origin).toString()):y.ensureTrailingSlash(r.origin)}}class rm{constructor(e){this._pattern=e||{},this._patternKeys=Object.keys(this._pattern)}matches(e){let t=e||{},r=Object.keys(t),{_patternKeys:i,_pattern:n}=this;return!(!i.includes("*")&&r.some(e=>!i.includes(e)))&&i.filter(e=>"*"!==e).every(e=>n[e]===t[e]||"*"===n[e]&&void 0!==t[e]&&null!==t[e])}}class ry{constructor(){this._objectById=new Map,this._objectsByType=new Map,this._objectsByApplication=new Map,this._add$=new ea,this._remove$=new ea}add(e){this._objectById.set(e.metadata.id,e),n.addListValue(this._objectsByType,e.type,e),n.addListValue(this._objectsByApplication,e.metadata.appSymbolicName,e),this._add$.next(e)}remove(e){let t=this.find(e);this._remove(t)}find(e){let r=void 0!==e.id,i=void 0!==e.type,n=void 0!==e.appSymbolicName;return t.intersect(r?t.coerce(this._objectById.get(e.id)):void 0,i?t.coerce(this._objectsByType.get(e.type)):void 0,n?t.coerce(this._objectsByApplication.get(e.appSymbolicName)):void 0,r||i||n?void 0:Array.from(this._objectById.values())).filter(t=>void 0===e.qualifier||("function"==typeof e.qualifier?e.qualifier(t.qualifier||{}):new rm(e.qualifier).matches(t.qualifier)))}findById(e,t){let r=this._objectById.get(e);if(!r&&!t)throw Error(`[NullManifestObjectError] Manifest object '${e}' not found.`);return r??null}get change$(){return tr(this.add$,this.remove$).pipe(eA(()=>void 0))}get add$(){return this._add$}get remove$(){return this._remove$}_remove(e){let t=new Set;e.forEach(e=>{let r=e.metadata.id;this._objectById.delete(r)&&(n.removeListValue(this._objectsByType,e.type,e=>e.metadata?.id===r),n.removeListValue(this._objectsByApplication,e.metadata.appSymbolicName,e=>e.metadata?.id===r),t.add(e))}),t.size&&this._remove$.next(e)}}class rv{}!function(e){let t=new Set().add("string").add("number").add("boolean");e.validateQualifier=function(e,r){return e&&0!==Object.keys(e).length?r.exactQualifier&&Object.entries(e).some(([e,t])=>"*"===e||"*"===t)?Error(`[IllegalQualifierError] Qualifier must be exact, i.e., not contain wildcards. [qualifier='${JSON.stringify(e)}']`):Object.values(e).some(e=>""===e||null==e)?Error(`[IllegalQualifierError] Qualifier must not contain empty, \`null\`, or \`undefined\` entries. [qualifier='${JSON.stringify(e)}']`):Object.values(e).some(e=>!t.has(typeof e))?Error(`[IllegalQualifierError] Qualifier contains entries with an illegal data type. Supported data types are [${[...t].join(", ")}]. [qualifier='${JSON.stringify(e)}']`):null:null}}(v||(v={}));class rw{constructor(){this._subscriptions=new Set,this._capabilityStore=new ry,this._intentionStore=new ry,this.capabilityRegister$=this._capabilityStore.add$,this.capabilityUnregister$=this._capabilityStore.remove$,this.installCapabilityRegisterRequestHandler(),this.installCapabilityUnregisterRequestHandler(),this.installIntentionRegisterRequestHandler(),this.installIntentionUnregisterRequestHandler(),this.installCapabilitiesLookupRequestHandler(),this.installIntentionsLookupRequestHandler(),this.installIsApplicationQualifiedRequestHandler(),this.installVersionLookupHandler()}resolveCapabilitiesByIntent(e,t){let r=v.validateQualifier(e.qualifier,{exactQualifier:!0});if(r)throw r;let i={type:e.type,qualifier:e.qualifier||{}};return this._capabilityStore.find(i).filter(e=>this.isApplicationQualifiedForCapability(t,e))}hasIntention(e,t){let r=v.validateQualifier(e.qualifier,{exactQualifier:!0});if(r)throw r;let i={appSymbolicName:t,type:e.type};return tM.get(rg).isIntentionCheckDisabled(t)||this._intentionStore.find({...i,qualifier:t=>new rm(t).matches(e.qualifier)}).length>0||this._capabilityStore.find({...i,qualifier:e.qualifier||{}}).length>0}isApplicationQualifiedForCapability(e,t){if(t.metadata.appSymbolicName===e)return!0;let r=tM.get(rg).isScopeCheckDisabled(e),i=tM.get(rg).isIntentionCheckDisabled(e);return(r||!t.private)&&(i||this.hasIntentionForCapability(e,t))}hasIntentionForCapability(e,t){return this._intentionStore.find({appSymbolicName:e,type:t.type,qualifier:e=>new rm(e).matches(t.qualifier)}).length>0}async registerCapability(e,t){if(!e)throw Error("[CapabilityRegisterError] Capability must not be null or undefined.");if(!e.type)throw Error("[CapabilityRegisterError] Missing capability property: type");let r=v.validateQualifier(e.qualifier,{exactQualifier:!0});if(r)throw r;!function(e){if(!e?.length)return;let t=e.filter(e=>!e.deprecated).map(e=>e.name);e.forEach(e=>{if(void 0===e.required)throw Error(`[CapabilityParamError] Parameter '${e.name}' must be explicitly defined as required or optional.`);if(void 0!==e.deprecated){if(e.required)throw Error(`[CapabilityParamError] Deprecated parameters must be optional, not required. Alternatively, deprecated parameters can define a mapping to a required parameter via the 'useInstead' property. [param='${e.name}']`);if("object"==typeof e.deprecated&&e.deprecated.useInstead&&!t.includes(e.deprecated.useInstead))throw Error(`[CapabilityParamError] The deprecated parameter '${e.name}' defines an invalid substitute '${e.deprecated.useInstead}'. Valid substitutes are: [${t}]`)}return e})}(e.params);let i=await rE({...e,qualifier:e.qualifier??{},params:e.params??[],private:e.private??!0,metadata:{id:tU.randomUUID(),appSymbolicName:t}});return this._capabilityStore.add(i),i.metadata.id}unregisterCapabilities(e,t){this._capabilityStore.remove({...t,appSymbolicName:e})}registerIntention(e,t){if(!e)throw Error("[IntentionRegisterError] Intention must not be null or undefined.");if(!e.type)throw Error("[IntentionRegisterError] Missing intention property: type");let r=v.validateQualifier(e.qualifier,{exactQualifier:!1});if(r)throw r;let i={...e,metadata:{id:tU.randomUUID(),appSymbolicName:t}};return this._intentionStore.add(i),i.metadata.id}unregisterIntention(e,t){this._intentionStore.remove({...t,appSymbolicName:e})}installCapabilityRegisterRequestHandler(){this._subscriptions.add(tM.get(t5).onMessage(h.RegisterCapability,e=>{let t=e.body,r=e.headers.get(d.AppSymbolicName);return this.registerCapability(t,r)}))}installCapabilityUnregisterRequestHandler(){this._subscriptions.add(tM.get(t5).onMessage(h.UnregisterCapabilities,e=>{let t=e.body||{},r=e.headers.get(d.AppSymbolicName);this.unregisterCapabilities(r,t)}))}installIntentionRegisterRequestHandler(){this._subscriptions.add(tM.get(t5).onMessage(h.RegisterIntention,e=>{let t=e.body,r=e.headers.get(d.AppSymbolicName);return r_(r),this.registerIntention(t,r)}))}installIntentionUnregisterRequestHandler(){this._subscriptions.add(tM.get(t5).onMessage(h.UnregisterIntentions,e=>{let t=e.body||{},r=e.headers.get(d.AppSymbolicName);r_(r),this.unregisterIntention(r,t)}))}installCapabilitiesLookupRequestHandler(){this._subscriptions.add(tM.get(t5).onMessage(h.LookupCapabilities,e=>{let t=e.headers.get(d.AppSymbolicName),r=e.body||{},i=v.validateQualifier(r.qualifier,{exactQualifier:!1});if(i)throw i;let n=tr(this._capabilityStore.change$,this._intentionStore.change$),s=eK(()=>tn(this._capabilityStore.find(r)));return s.pipe(ty(()=>n.pipe(tw(1),ej(()=>s))),tD(e=>this.isApplicationQualifiedForCapability(t,e)),tg((e,t)=>JSON.stringify(e)===JSON.stringify(t)))}))}installIntentionsLookupRequestHandler(){this._subscriptions.add(tM.get(t5).onMessage(h.LookupIntentions,e=>{let t=e.body||{},r=v.validateQualifier(t.qualifier,{exactQualifier:!1});if(r)throw r;let i=eK(()=>tn(this._intentionStore.find(t)));return i.pipe(ty(()=>this._intentionStore.change$.pipe(tw(1),ej(()=>i))),tg((e,t)=>JSON.stringify(e)===JSON.stringify(t)))}))}installIsApplicationQualifiedRequestHandler(){this._subscriptions.add(tM.get(t5).onMessage(h.IsApplicationQualifiedForCapability,e=>tr(this._intentionStore.change$,this._capabilityStore.change$).pipe(t$(void 0),eA(()=>{let t=tM.get(rg).getApplication(e.body.appSymbolicName),r=this._capabilityStore.findById(e.body.capabilityId);return this.isApplicationQualifiedForCapability(t.symbolicName,r)}),tg())))}installVersionLookupHandler(){this._subscriptions.add(tM.get(t5).onMessage(h.platformVersion(":appSymbolicName"),e=>{let t=e.params.get("appSymbolicName"),r=tM.get(t2).register$.pipe(eQ(e=>e.application.symbolicName===t)),i=eK(()=>{let e=tM.get(t2).getByApplication(t);return e.length?tn(e[0].version):eG});return i.pipe(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return eH.apply(void 0,R([],C(e)))}(r.pipe(ej(()=>i))),tw(1))}))}preDestroy(){this._subscriptions.forEach(e=>e.unsubscribe())}}function r_(e){if(tM.get(rg).isIntentionRegisterApiDisabled(e))throw Error(`[IntentionRegisterError] The 'Intention Registration API' is disabled for the application '${e}'. Contact the platform administrator to enable this API.`)}async function rE(e){for(let t of tM.all(rv))e=await t.intercept(e);return e}class rS{constructor(){this._focusOwner$=new eu(void 0),this._subscriptions=new Set,this._subscriptions.add(this.monitorFocusInEvents()),this._subscriptions.add(this.replyToIsFocusWithinRequests()),this._subscriptions.add(this.replyToHasFocusRequests())}monitorFocusInEvents(){return tM.get(t5).observe$(h.FocusIn).pipe(eA(e=>e.headers.get(d.ClientId)),tg()).subscribe(e=>ri(()=>{this._focusOwner$.next(tM.get(t2).getByClientId(e)||void 0)}))}replyToIsFocusWithinRequests(){return tM.get(t5).onMessage(h.IsFocusWithin,e=>{let t=e.headers.get(d.ClientId);return this._focusOwner$.pipe(eA(e=>this.isFocusWithin(t,e)),tg())})}replyToHasFocusRequests(){return tM.get(t5).onMessage(h.HasFocus,e=>{let t=e.headers.get(d.ClientId);return this._focusOwner$.pipe(eA(e=>e?.id===t),tg())})}isFocusWithin(e,t){for(let r=t;void 0!==r;r=this.getParentClient(r))if(r.id===e)return!0;return!1}getParentClient(e){if(e.window.parent!==e.window)return tM.get(t2).getByWindow(e.window.parent)}preDestroy(){this._subscriptions.forEach(e=>e.unsubscribe())}}class rI{async fetch(e){if(!e.symbolicName)throw Error("[ManifestFetchError] Invalid application config. Missing required property 'symbolicName'.");if(!e.manifestUrl)throw Error("[ManifestFetchError] Invalid application config. Missing required property 'manifestUrl'.");let t=eN(tM.get(rd).fetch(e.manifestUrl)),r=e.manifestLoadTimeout??tM.get(tZ).manifestLoadTimeout,i=await eY(t.pipe(r?th({first:r,with:()=>tu(()=>Error(`[ManifestFetchError] Failed to fetch manifest for application '${e.symbolicName}'. Timeout of ${r}ms elapsed.`))}):et));if(!i.ok)throw Error(`[ManifestFetchError] Failed to fetch manifest for application '${e.symbolicName}'. Maybe the application is currently unavailable. [httpStatusCode=${i.status}, httpStatusText=${i.statusText}]`);return await i.json()}}class r${constructor(){this._destroy$=new ea,this._subscriptions=new Map,this._subscriptionsByApp=new Map,this._subscriptionsByClient=new Map,this._register$=new ea,this._unregister$=new ea,tM.get(t2).unregister$.pipe(tT(this._destroy$)).subscribe(e=>ri(()=>{this.unregister({clientId:e.id})}))}register(e){this._subscriptions.set(e.subscriberId,e),n.addSetValue(this._subscriptionsByApp,e.client.application.symbolicName,e),n.addSetValue(this._subscriptionsByClient,e.client.id,e),this.onRegister?.(e),this._register$.next(e)}unregister(e){let t=this.subscriptions(e);t.forEach(e=>{this._subscriptions.delete(e.subscriberId),n.removeSetValue(this._subscriptionsByApp,e.client.application.symbolicName,e),n.removeSetValue(this._subscriptionsByClient,e.client.id,e),this.onUnregister?.(e),e.notifyUnsubscribe()}),this._unregister$.next(t)}subscriptions(e){let r=e?.subscriberId,i=e?.clientId,n=e?.appSymbolicName;return t.intersect(r?this.subscriptionById(r):void 0,i?this.subscriptionsByClient(i):void 0,n?this.subscriptionsByApp(n):void 0,r||n||i?void 0:Array.from(this._subscriptions.values()))}subscriptionById(e){let t=this._subscriptions.get(e);return t?[t]:[]}subscriptionsByClient(e){let t=this._subscriptionsByClient.get(e);return t?Array.from(t):[]}subscriptionsByApp(e){let t=this._subscriptionsByApp.get(e);return t?Array.from(t):[]}get register$(){return this._register$}get unregister$(){return this._unregister$}preDestroy(){this._destroy$.next()}}class rT{constructor(e,t){this.subscriberId=e,this.client=t,this.whenUnsubscribe=new Promise(e=>this.notifyUnsubscribe=e)}}let rC=":ɵANY";class rR extends r${constructor(){super(...arguments),this._subscriptionsByTopic=new Map}onRegister(e){let t=g.replaceWildcardSegments(e.topic,rC);n.addSetValue(this._subscriptionsByTopic,t,e)}onUnregister(e){let t=g.replaceWildcardSegments(e.topic,rC);n.removeSetValue(this._subscriptionsByTopic,t,e)}subscriptions(e){let r=e?.topic,i=e?.subscriberId,n=e?.clientId,s=e?.appSymbolicName;return t.intersect(r?this.subscriptionsByTopic(r):void 0,i||s||n?super.subscriptions(e):void 0,i||s||n||r?void 0:super.subscriptions())}subscriptionsByTopic(e){let t=[];return g.computeWildcardSegmentPermutations(e,rC).forEach(e=>{t.push(...this._subscriptionsByTopic.get(e)||[])}),t}subscriptionCount$(e){let t=g.validateTopic(e,{exactTopic:!0});return t?tu(()=>t):new en(t=>{let r=new ea,i=this.subscriptions({topic:e}).length;return t.next(i),this.register$.pipe(eQ(t=>t.matches(e)),tT(r)).subscribe(()=>{i++,t.next(i)}),this.unregister$.pipe(tD(t=>t.matches(e)),eQ(e=>e.length>0),tT(r)).subscribe(e=>{i-=e.length,t.next(i)}),()=>r.next()})}}class rx extends rT{constructor(e,t,r){super(t,r),this.topic=e}matches(e){return e===this.topic||new t8(this.topic).match(e).matches}}class rM{}class rO{}function rN(e,t){let r=new class extends rA{handle(e){return t(e)}},i=e.reduceRight((e,t)=>new class extends rA{handle(r){return t.intercept(r,e)}},r);return new class{interceptAndPublish(e){return i.handle(e)}}}class rA{}let rk=/(?<major>\d+)\.(?<minor>\d+)\.(?<patch>\d+)(-(?<prerelease>.+))?/;class rP{constructor(){}static major(e){return rU(e??"0.0.0").major}static lt(e,t){return 0>function(e,t){if(!e&&t)return -1;if(!e&&!t)return 0;if(e&&!t)return 1;let r=rU(e),i=rU(t),n=Math.sign(r.major-i.major);if(0!==n)return n;let s=Math.sign(r.minor-i.minor);if(0!==s)return s;let o=Math.sign(r.patch-i.patch);return 0!==o?o:function(e,t){if(e.preRelease&&!t.preRelease)return -1;if(!e.preRelease&&!t.preRelease)return 0;if(!e.preRelease&&t.preRelease)return 1;for(let r=0;r<Math.max(e.preRelease.length,t.preRelease.length);r++){let i=e.preRelease[r],n=t.preRelease[r];if(void 0===i)return -1;if(void 0===n)return 1;if("number"==typeof i&&"string"==typeof n)return -1;if("string"==typeof i&&"number"==typeof n)return 1;if(i<n)return -1;if(i>n)return 1}return 0}(r,i)}(e,t)}}function rU(e){let t=e.match(rk);if(!t)throw Error(`[SemVerError] Version '${e}' is not a valid semantic version (semver).`);return{major:+t.groups.major,minor:+t.groups.minor,patch:+t.groups.patch,preRelease:t.groups.prerelease?.split(".").map(e=>{let t=+e;return Number.isNaN(t)?e:t})}}let rD=Symbol("CLIENT_PING_INTERVAL"),rB=Symbol("CLIENT_PING_TIMEOUT");class rL{constructor(e,t,r,i,n){this.id=e,this.window=t,this.origin=r,this.application=i,this.version=n??"0.0.0",this.installLivenessDetector()}installLivenessDetector(){var e,t,r,i,n,s,o,a;if(this.application.symbolicName===tM.get(tV))return;let l=tM.get(t5).request$(h.ping(this.id)).pipe(th(tM.get(rB)),(r=void 0===(t=(e={count:1}).count)?1/0:t,i=e.delay,s=void 0!==(n=e.resetOnSuccess)&&n,r<=0?et:eT(function(e,t){var n,o=0,a=function(){var l=!1;n=e.subscribe(eC(t,function(e){s&&(o=0),t.next(e)},void 0,function(e){if(o++<r){var s=function(){n?(n.unsubscribe(),n=null,a()):l=!0};if(null!=i){var c="number"==typeof i?te(i):eS(i(e,o)),u=eC(t,function(){u.unsubscribe(),s()},function(){t.complete()});c.subscribe(u)}else s()}else t.error(e)})),l&&(n.unsubscribe(),n=null,a())};a()})));this._livenessDetector=(void 0===(o=tM.get(rD))&&(o=0),void 0===a&&(a=e8),o<0&&(o=0),te(o,o,a)).pipe(tc(()=>l)).subscribe({error:()=>{this.logStaleClientWarning(),tM.get(t2).unregisterClient(this)}})}get stale(){return this.window.closed}dispose(){this._livenessDetector?.unsubscribe()}logStaleClientWarning(){tM.get(tK).warn(`[StaleClient] Stale client registration of application '${this.application.symbolicName}' detected.
       Removing stale registration. Most likely, the client could not disconnect from the broker, for example, because the client was
       disposed without notice, i.e., without receiving the browser's "unload" event, or because the browser discarded the 'DISCONNECT'
       message. Typically, the browser discards messages for windows that are already closed or if another page has been loaded into the
       window, both indicating a high load on the client during unloading.`.replace(/\s+/g," "),new tJ(this.application.symbolicName,this.version))}}class rq extends r${subscriptions(e){return super.subscriptions(e).filter(t=>!e?.intent||t.matches(e.intent))}}class rV extends rT{constructor(e,t,r){super(t,r),this.selector=e}matches(e){return(!this.selector.type||this.selector.type===e.type)&&(!this.selector.qualifier||!!new rm(this.selector.qualifier).matches(e.qualifier))}}class rF{constructor(){}static not(e){return t=>!e(t)}static{this.alwaysTrue=()=>!0}}class rj{constructor(e){this._requiredParamDefs=[],this._optionalParamDefs=[],this._deprecatedParamDefs=[],e.forEach(e=>{e.required??!0?this._requiredParamDefs.push(e):this._optionalParamDefs.push(e),e.deprecated&&this._deprecatedParamDefs.push(e)})}match(e){let t=new Map(e),r={matches:!0,params:t,missingParams:[],unexpectedParams:[],deprecatedParams:[]};return this._deprecatedParamDefs.filter(e=>t.has(e.name)).forEach(e=>{r.deprecatedParams.push(e);let i=e.deprecated;"object"==typeof i&&i.useInstead&&(t.set(i.useInstead,t.get(e.name)),t.delete(e.name))}),this._requiredParamDefs.filter(e=>!t.has(e.name)||void 0===t.get(e.name)).filter(e=>!this._deprecatedParamDefs.includes(e)).forEach(e=>{r.matches=!1,r.missingParams.push(e)}),Array.from(t.keys()).filter(e=>!this._requiredParamDefs.some(t=>t.name===e)&&!this._optionalParamDefs.some(t=>t.name===e)).forEach(e=>{r.matches=!1,r.unexpectedParams.push(e)}),r.matches||(r.params=void 0),r}}class rz{constructor(){}static validateParams(e){let{intent:t,capability:r}=e,i=e.headers.get(d.AppSymbolicName);t.params=new Map(t.params),t.params.forEach((e,r)=>{void 0===e&&t.params.delete(r)});let n=new rj(r.params||[]).match(t.params);if(!n.matches){let e=function(e,t){let r=JSON.stringify(t,(e,t)=>"params"===e?void 0:t),i=e.missingParams.map(e=>e.name),n=e.unexpectedParams;return`Params of intent do not match expected params of capability. The intent must have required params and not have additional params. [intent=${r}, missingParams=[${i}], unexpectedParams=[${n}]].`}(n,t);throw Error(`[IntentParamValidationError] ${e}`)}n.deprecatedParams.length&&(n.deprecatedParams.forEach(e=>{let r=function(e,t){let r=e.deprecated,i="object"==typeof r&&r.useInstead||void 0,n="object"==typeof r&&r.message||void 0;return[].concat(`Application '${t.appSymbolicName}' passes a deprecated parameter in the intent: '${e.name}'.`).concat(i?`Pass parameter '${i}' instead.`:[]).concat(n||[]).join(" ")}(e,{appSymbolicName:i});tM.get(tK).warn(`[DEPRECATION][4EAC5956] ${r}`,new tJ(i),t)}),t.params=n.params)}}class rW{constructor(){this._destroy$=new ea,this._clientRegistry=tM.get(t2),this._topicSubscriptionRegistry=tM.get(rR),this._intentSubscriptionRegistry=tM.get(rq),this._retainedMessageStore=new Map,this._retainedIntentStore=new Map,this._applicationRegistry=tM.get(rg),this._manifestRegistry=tM.get(rf),this._clientMessage$=e1(window,"message").pipe(t9(u.ClientToBroker),re(p.Intent,p.Topic,p.TopicSubscribe,p.TopicUnsubscribe,p.IntentSubscribe,p.IntentUnsubscribe),tL(tM.whenRunlevel(a.Two)),rK(),rY(),tS()),this.installClientConnectListener(),this.installClientDisconnectListener(),this.installMessageDispatcher(),this.installTopicSubscribeListener(),this.installTopicUnsubscribeListener(),this.installTopicSubscriberCountObserver(),this.sendRetainedMessageOnSubscribe(),this.installIntentDispatcher(),this.installIntentSubscribeListener(),this.installIntentUnsubscribeListener(),this.sendRetainedIntentOnSubscribe(),this.deleteRetainedIntentOnCapabilityUnregister(),this._messagePublisher=this.createMessagePublisher(),this._intentPublisher=this.createIntentPublisher()}init(){return Promise.resolve()}installClientConnectListener(){e1(window,"message").pipe(t9(u.ClientToBroker),re(p.ClientConnect),tL(tM.whenRunlevel(a.One)),rY(),tT(this._destroy$)).subscribe(e=>ri(()=>{if(!e.source)return void tM.get(tK).debug(`[CONNECT] Ignoring stale connect request from "${e.origin}".`);let t=e.source,r=e.data,i=r.message.headers.get(d.AppSymbolicName),n=new rZ(e),s=r.message.headers.get(d.ReplyTo);if(!i){let t=`Client connect attempt rejected: Bad request. [origin='${e.origin}']`;tM.get(tK).warn(`[CONNECT] ${t}`),rJ(n,{topic:s,body:{returnCode:"refused:bad-request",returnMessage:`[ClientConnectError] ${t}`},headers:new Map});return}let o=this._applicationRegistry.getApplication(i,{orElse:null});if(!o){let e=`Client connect attempt rejected: Unknown client. [app='${i}']`;tM.get(tK).warn(`[CONNECT] ${e}`),rJ(n,{topic:s,body:{returnCode:"refused:rejected",returnMessage:`[ClientConnectError] ${e}`},headers:new Map});return}if(!o.allowedMessageOrigins.has(e.origin)){let t=`Client connect attempt blocked: Wrong origin [actual='${e.origin}', expected='${Array.from(o.allowedMessageOrigins)}', app='${o.symbolicName}']`;tM.get(tK).warn(`[CONNECT] ${t}`),rJ(n,{topic:s,body:{returnCode:"refused:blocked",returnMessage:`[ClientConnectError] ${t}`},headers:new Map});return}let a=this._clientRegistry.getByWindow(t);if(a&&a.origin===e.origin&&a.application.symbolicName===o.symbolicName)return void rJ(a,{topic:s,body:{returnCode:"accepted",clientId:a.id},headers:new Map});let l=new rL(tU.randomUUID(),t,e.origin,o,r.message.headers.get(d.Version));this._clientRegistry.registerClient(l),rP.major(l.version)!==rP.major(tM.get(tj))&&tM.get(tK).warn(`[VersionMismatch] Application '${o.symbolicName}' uses a different major version of the @scion/microfrontend-platform than the host application, which may not be compatible. Please upgrade @scion/microfrontend-platform of application '${o.symbolicName}' from version '${l.version}' to version '${tM.get(tj)}'.`,new tJ(o.symbolicName,l.version)),rJ(l,{topic:s,body:{returnCode:"accepted",clientId:l.id},headers:new Map})}))}installClientDisconnectListener(){e1(window,"message").pipe(t9(u.ClientToBroker),re(p.ClientDisconnect),tL(tM.whenRunlevel(a.One)),rK(),rY(),tT(this._destroy$)).subscribe(e=>ri(()=>{let t=rH(e);this._clientRegistry.unregisterClient(t)}))}installTopicSubscriberCountObserver(){tM.get(t5).observe$(h.RequestSubscriberCount).pipe(tT(this._destroy$)).subscribe(e=>ri(()=>{let t=e.body,r=e.headers.get(d.ReplyTo),i=this._topicSubscriptionRegistry.subscriptionCount$(r).pipe(eQ(e=>0===e));this._topicSubscriptionRegistry.subscriptionCount$(t).pipe(tT(tr(this._destroy$,i))).subscribe({next:e=>tM.get(t5).publish(r,e),error:e=>tM.get(t5).publish(r,rn(e),{headers:new Map().set(d.Status,b.ERROR)})})}))}installMessageDispatcher(){this._clientMessage$.pipe(re(p.Topic),tT(this._destroy$)).subscribe(e=>ri(async()=>{let t=rH(e),r=e.data.message,i=r.headers.get(d.MessageId),s=g.validateTopic(r.topic,{exactTopic:!0});if(s)return void rQ(t,i,s);if(r.retain&&!rX(r)&&void 0===r.body){n.removeListValue(this._retainedMessageStore,r.topic,rF.not(rX)),rG(t,i);return}try{let e=this.subscribeForRepliesIfRequest(r,t);r.headers.delete(d.ɵSubscriberId),await this._messagePublisher.interceptAndPublish(r),this.storeMessageIfRetained(r,e),rG(t,i)}catch(e){rQ(t,i,e)}}))}installIntentDispatcher(){this._clientMessage$.pipe(re(p.Intent),tT(this._destroy$)).subscribe(e=>ri(async()=>{let t=rH(e),r=e.data.message,i=r.headers.get(d.MessageId);if(!r.intent)return void rQ(t,i,"[MessagingError] Missing message property: intent");if(!r.intent.type)return void rQ(t,i,"[MessagingError] Missing message property: type");let s=v.validateQualifier(r.intent.qualifier,{exactQualifier:!0});if(s)return void rQ(t,i,s);if(!this._manifestRegistry.hasIntention(r.intent,t.application.symbolicName)){let e=`[NotQualifiedError] Application '${t.application.symbolicName}' is not qualified to publish intents of the type '${r.intent.type}' and qualifier '${JSON.stringify(r.intent.qualifier||{})}'. Ensure to have listed the intention in the application manifest.`;rQ(t,i,e);return}let o=this._manifestRegistry.resolveCapabilitiesByIntent(r.intent,t.application.symbolicName);if(0===o.length)return void rQ(t,i,`[NullProviderError] No application found to provide a capability of the type '${r.intent.type}' and qualifiers '${JSON.stringify(r.intent.qualifier||{})}'. Maybe, the capability is not public API or the providing application not available.`);if(r.retain&&!rX(r)&&void 0===r.body)return void o.forEach(e=>{n.removeListValue(this._retainedIntentStore,e.metadata.id,rF.not(rX)),rG(t,i)});try{let e=this.subscribeForRepliesIfRequest(r,t);r.headers.delete(d.ɵSubscriberId),await Promise.all(o.map(e=>({...r,capability:e})).map(async t=>{rz.validateParams(t),await this._intentPublisher.interceptAndPublish(t),this.storeIntentIfRetained(t,e)})),rG(t,i)}catch(e){rQ(t,i,e)}}))}sendRetainedMessageOnSubscribe(){this._topicSubscriptionRegistry.register$.pipe(tT(this._destroy$)).subscribe(e=>ri(()=>{Array.from(this._retainedMessageStore.values()).flat().filter(t=>e.matches(t.topic)).forEach(t=>this._messagePublisher.interceptAndPublish({...t,headers:new Map(t.headers).set(d.ɵSubscriberId,e.subscriberId)}))}))}sendRetainedIntentOnSubscribe(){this._intentSubscriptionRegistry.register$.pipe(tT(this._destroy$)).subscribe(e=>ri(()=>{Array.from(this._retainedIntentStore.values()).flat().filter(t=>e.client.application.symbolicName===t.capability.metadata.appSymbolicName).filter(t=>e.matches(t.intent)).forEach(t=>this._intentPublisher.interceptAndPublish({...t,headers:new Map(t.headers).set(d.ɵSubscriberId,e.subscriberId)}))}))}deleteRetainedIntentOnCapabilityUnregister(){this._manifestRegistry.capabilityUnregister$.pipe(ej(e=>eN(e)),tT(this._destroy$)).subscribe(e=>ri(()=>{n.removeListValue(this._retainedIntentStore,e.metadata.id,rF.alwaysTrue)}))}installTopicSubscribeListener(){this._clientMessage$.pipe(re(p.TopicSubscribe),tT(this._destroy$)).subscribe(t=>ri(()=>{let r=rH(t),i=t.data,n=i.message.headers.get(d.MessageId),s=i.message.topic,o=g.validateTopic(s,{exactTopic:!1});if(o)return void rQ(r,n,o);try{let t=e.orElseThrow(i.message.subscriberId,()=>Error("[TopicSubscribeError] Missing property: subscriberId"));this._topicSubscriptionRegistry.register(new rx(s,t,r)),rG(r,n)}catch(e){rQ(r,n,e)}}))}installTopicUnsubscribeListener(){this._clientMessage$.pipe(re(p.TopicUnsubscribe),tT(this._destroy$)).subscribe(t=>ri(()=>{let r=rH(t),i=t.data,n=i.message.headers.get(d.MessageId);try{let t=e.orElseThrow(i.message.subscriberId,()=>Error("[TopicUnsubscribeError] Missing property: subscriberId"));this._topicSubscriptionRegistry.unregister({subscriberId:t}),rG(r,n)}catch(e){rQ(r,n,e)}}))}installIntentSubscribeListener(){this._clientMessage$.pipe(re(p.IntentSubscribe),tT(this._destroy$)).subscribe(t=>ri(()=>{let r=rH(t),i=t.data,n=i.message.headers.get(d.MessageId),s=v.validateQualifier(i.message.selector?.qualifier,{exactQualifier:!1});if(s)return void rQ(r,n,s);try{let t=e.orElseThrow(i.message.subscriberId,()=>Error("[IntentSubscribeError] Missing property: subscriberId"));this._intentSubscriptionRegistry.register(new rV(i.message.selector||{},t,r)),rG(r,n)}catch(e){rQ(r,n,e)}}))}installIntentUnsubscribeListener(){this._clientMessage$.pipe(re(p.IntentUnsubscribe),tT(this._destroy$)).subscribe(t=>ri(()=>{let r=rH(t),i=t.data,n=i.message.headers.get(d.MessageId);try{let t=e.orElseThrow(i.message.subscriberId,()=>Error("[IntentUnsubscribeError] Missing property: subscriberId"));this._intentSubscriptionRegistry.unregister({subscriberId:t}),rG(r,n)}catch(e){rQ(r,n,e)}}))}createMessagePublisher(){return rN(tM.all(rM),async e=>{let t=this._topicSubscriptionRegistry.subscriptions({subscriberId:e.headers.get(d.ɵSubscriberId),topic:e.topic});if(rX(e)&&!e.retain&&!t.length)throw Error(`[MessagingError] No subscriber registered to answer the request [topic=${e.topic}]`);t.forEach(t=>ri(()=>rJ(t,e)))})}createIntentPublisher(){return rN(tM.all(rO),async e=>{let t=this._intentSubscriptionRegistry.subscriptions({subscriberId:e.headers.get(d.ɵSubscriberId),appSymbolicName:e.capability.metadata.appSymbolicName,intent:e.intent});if(rX(e)&&!e.retain&&!t.length)throw Error(`[MessagingError] No subscriber registered to answer the intent [intent=${JSON.stringify(e.intent)}]`);t.forEach(t=>ri(()=>(function(e,t){let r={transport:u.BrokerToClient,channel:p.Intent,message:{...t,headers:new Map(t.headers).set(d.ɵSubscriberId,e.subscriberId).set(d.MessageId,t.headers.get(d.MessageId)??tU.randomUUID()).set(d.AppSymbolicName,t.headers.get(d.AppSymbolicName)??tM.get(tV))}},i=e.client;i.stale||i.window.postMessage(r,i.origin)})(t,e)))})}subscribeForRepliesIfRequest(t,r){if(!rX(t))return null;let i=e.orElseThrow(t.headers.get(d.ɵSubscriberId),()=>Error("[MessagingError] Missing message header: subscriberId")),n=new rx(t.headers.get(d.ReplyTo),i,r);return this._topicSubscriptionRegistry.register(n),n}storeMessageIfRetained(t,r){t.retain&&(rX(t)?(e.orElseThrow(r,()=>Error("[InternalMessagingError] An unexpected error occurred. Expected subscription not to be null.")),n.addListValue(this._retainedMessageStore,t.topic,t),r.whenUnsubscribe.then(()=>n.removeListValue(this._retainedMessageStore,t.topic,t))):(n.removeListValue(this._retainedMessageStore,t.topic,rF.not(rX)),n.addListValue(this._retainedMessageStore,t.topic,t)))}storeIntentIfRetained(t,r){if(!t.retain)return;let i=t.capability.metadata.id;rX(t)?(e.orElseThrow(r,()=>Error("[InternalMessagingError] An unexpected error occurred. Expected subscription not to be null.")),n.addListValue(this._retainedIntentStore,i,t),r.whenUnsubscribe.then(()=>n.removeListValue(this._retainedIntentStore,i,t))):(n.removeListValue(this._retainedIntentStore,i,rF.not(rX)),n.addListValue(this._retainedIntentStore,i,t))}preDestroy(){this._destroy$.next()}}function rH(e){let t=e.data.message.headers.get(d.ClientId),r=tM.get(t2).getByClientId(t);if(!r)throw Error(`[NullClientError] Client not found in client registry. [clientId=${t}]`);return r}function rK(){return ej(e=>{let t=e.data,r=t.message.headers.get(d.MessageId),i=t.message.headers.get(d.ClientId),n=tM.get(t2).getByClientId(i);return n?e.origin!==n.origin?(null!==e.source&&rQ(new rZ(e),r,`[MessagingError] Message rejected: Wrong origin [actual=${e.origin}, expected=${n.origin}, application=${n.application.symbolicName}]`),eG):null!==e.source&&e.source!==n.window?(rQ(new rZ(e),r,`[MessagingError] Message rejected: Wrong window [origin=${e.origin}]`),eG):tn(e):(null!==e.source&&rQ(new rZ(e),r,`[MessagingError] Message rejected: Client not registered [origin=${e.origin}]`),eG)})}function rG(e,t){rJ(e,{topic:t,body:{ok:!0},headers:new Map})}function rQ(e,t,r){rJ(e,{topic:t,body:{ok:!1,details:rn(r)},headers:new Map})}function rJ(e,t){let r={transport:u.BrokerToClient,channel:p.Topic,message:{...t,params:new Map(t.params),headers:new Map(t.headers).set(d.MessageId,t.headers.get(d.MessageId)??tU.randomUUID()).set(d.AppSymbolicName,t.headers.get(d.AppSymbolicName)??tM.get(tV))}};if(e instanceof rZ)e.window.closed||e.window.postMessage(r,e.origin);else if(e instanceof rx){let i=e.client;r.message.headers.set(d.ɵSubscriberId,e.subscriberId),r.message.params=new t8(e.topic).match(t.topic).params,i.stale||i.window.postMessage(r,i.origin)}else e.stale||e.window.postMessage(r,e.origin)}function rY(){return tf((e,t)=>(tM.get(tK).error("[UnexpectedError] An unexpected error occurred.",e),t))}function rX(e){return e.headers.has(d.ReplyTo)}class rZ{constructor(e){this.window=e.source,this.origin=e.origin}}class r0{constructor(){this._applications=[]}async init(){if(tM.get(rl)instanceof rc)return;let e=tM.get(t5).observe$(h.Applications);this._applications=await eY(e.pipe(t6(),tB(e=>({...e,platformVersion:eY(tM.get(t5).request$(h.platformVersion(e.symbolicName)).pipe(t6()))}))))}get applications(){return this._applications}lookupCapabilities$(e){return tM.get(t5).request$(h.LookupCapabilities,e).pipe(t6())}lookupIntentions$(e){return tM.get(t5).request$(h.LookupIntentions,e).pipe(t6())}registerCapability(e){return tt(tM.get(t5).request$(h.RegisterCapability,e).pipe(t6()))}unregisterCapabilities(e){return new Promise((t,r)=>{tM.get(t5).request$(h.UnregisterCapabilities,e).subscribe({error:r,complete:t})})}registerIntention(e){return tt(tM.get(t5).request$(h.RegisterIntention,e).pipe(t6()))}unregisterIntentions(e){return new Promise((t,r)=>{tM.get(t5).request$(h.UnregisterIntentions,e).subscribe({error:r,complete:t})})}isApplicationQualified$(e,t){let r={appSymbolicName:e,capabilityId:t.capabilityId};return tM.get(t5).request$(h.IsApplicationQualifiedForCapability,r).pipe(t6())}}let r1="ɵCONTEXT_LOOKUP_OPTIONS";!function(e){function t(e){return`context/${e}`}e.contextTreeNamesLookupTopic=function(){return"contexttree/names"},e.contextTreeChangeTopic=function(){return"contexttree/change"},e.contextValueLookupTopic=t,e.newContextValueLookupRequest=function(e,r,i,n){return{transport:u.MicrofrontendToOutlet,channel:p.Topic,message:{topic:t(encodeURIComponent(e)),body:n||[],headers:new Map().set(d.MessageId,tU.randomUUID()).set(d.ReplyTo,r).set(r1,i)}}},e.newContextTreeNamesLookupRequest=function(t,r){return{transport:u.MicrofrontendToOutlet,channel:p.Topic,message:{topic:e.contextTreeNamesLookupTopic(),body:r||new Set,headers:new Map().set(d.MessageId,tU.randomUUID()).set(d.ReplyTo,t)}}},e.newContextTreeObserveRequest=function(t){return{transport:u.MicrofrontendToOutlet,channel:p.Topic,message:{topic:e.contextTreeChangeTopic(),headers:new Map().set(d.MessageId,tU.randomUUID()).set(d.ReplyTo,t)}}},e.RootContextSubscribeEvent="RootContextSubscribeEvent"}(w||(w={}));class r2{constructor(e){this._entries$=new eu(new Map),this._entryChange$=new ea,this._outletDisconnect$=new ea,this._microfrontendRequest$=e1(window,"message").pipe(eQ(t=>t.source===e.contentWindow),t9(u.MicrofrontendToOutlet),re(p.Topic),tS())}set(e,t){this._entries$.next(new Map(this._entries$.getValue()).set(e,t)),this._entryChange$.next({name:e,value:t,type:"set"})}remove(e){let t=new Map(this._entries$.getValue());return!!t.delete(e)&&(this._entries$.next(t),this._entryChange$.next({name:e,type:"remove"}),!0)}get entries$(){return this._entries$}onOutletMount(){this.installContextValueLookupListener(),this.installContextTreeNamesLookupListener(),this.installContextTreeObserveListener()}onOutletUnmount(){this._outletDisconnect$.next()}installContextValueLookupListener(){this._microfrontendRequest$.pipe(rt(w.contextValueLookupTopic(":name")),rr(),tT(this._outletDisconnect$)).subscribe(e=>ri(()=>{let t=decodeURIComponent(new t8(w.contextValueLookupTopic(":name")).match(e.topic).params.get("name")),r=e.headers.get(d.ReplyTo),i=e.headers.get(r1),n=this._entries$.getValue();if(i?.collect){let s=e.body||[];n.has(t)&&void 0!==n.get(t)&&s.push(n.get(t)),tM.get(tq)?tM.get(t5).publish(r,s,{headers:new Map().set(d.Status,b.OK)}):window.parent.postMessage(w.newContextValueLookupRequest(t,r,i,s),"*")}else n.has(t)&&void 0!==n.get(t)?tM.get(t5).publish(r,n.get(t),{headers:new Map().set(d.Status,b.OK)}):tM.get(tq)?tM.get(t5).publish(r,void 0,{headers:new Map().set(d.Status,b.NOT_FOUND)}):window.parent.postMessage(w.newContextValueLookupRequest(t,r,i),"*")}))}installContextTreeNamesLookupListener(){this._microfrontendRequest$.pipe(rt(w.contextTreeNamesLookupTopic()),rr(),tT(this._outletDisconnect$)).subscribe(e=>ri(()=>{let t=e.headers.get(d.ReplyTo),r=new Set([...this._entries$.getValue().keys(),...e.body||[]]);tM.get(tq)?tM.get(t5).publish(t,r,{headers:new Map().set(d.Status,b.OK)}):window.parent.postMessage(w.newContextTreeNamesLookupRequest(t,r),"*")}))}installContextTreeObserveListener(){this._microfrontendRequest$.pipe(rt(w.contextTreeChangeTopic()),rr(),tT(this._outletDisconnect$)).subscribe(e=>ri(()=>{let t=e.headers.get(d.ReplyTo);this._entryChange$.pipe(t4(t),tT(this._outletDisconnect$)).subscribe(e=>{tM.get(t5).publish(t,e)}),tM.get(tq)?tM.get(t5).publish(t,w.RootContextSubscribeEvent):window.parent.postMessage(w.newContextTreeObserveRequest(t),"*")}))}}class r5{assign(e,t,r){let i=this.patchUrl(t.url,r?.url);t.pushStateToSessionHistoryStack?e.contentWindow.location.assign(i):e.contentWindow.location.replace(i)}patchUrl(e,t){return ri(()=>{let r=t?y.newUrl(t):void 0,i=y.newUrl(e);if("about:"===i.protocol||"blob:"===i.protocol||window===tM.get(tz)||i.search||r?.origin===i.origin&&r?.pathname===i.pathname)return e;let n=y.newUrl(e);return n.searchParams.set("_",""),n.toString()})??e}}class r4{constructor(e,t,r,i){this.eventType=e;let n=[];n.push(e),r&&(r.control&&n.push("control"),r.alt&&n.push("alt"),r.shift&&n.push("shift"),r.meta&&n.push("meta")),n.push(t.toLowerCase()),this.parts=n.join("."),this.flags=i}withFlags(e){return this.flags=e,this}static fromEvent(e){if(!e)throw Error("[KeystrokeParseError] Cannot create the keystroke from `null` or `undefined`.");return new r4(e.type,function(e){switch(e){case".":return"dot";case" ":return"space";default:return e}}(e.key),{control:e.ctrlKey,shift:e.shiftKey,alt:e.altKey,meta:e.metaKey})}static fromString(e){if(!e)throw Error("[KeystrokeParseError] Cannot parse the keystroke from 'null' or 'undefined'.");let t=function(e){let t=e.match(/{(?<flagsDictionary>.*)}/)?.groups.flagsDictionary??null;if(null!==t)return""===t?{}:t.split(";").map(e=>e.split("=")).reduce((t,[r,i])=>"preventDefault"===r?{...t,preventDefault:"true"===i}:(tM.get(tK).warn(`[KeystrokeParseError] Ignore unkown flag '${e}'. Supported flags are: 'preventDefault'.`),t),{})}(e);void 0!==t&&(e=e.substring(0,e.indexOf("{")));let r=e.split(".");if(r.length<2)throw Error(`[KeystrokeParseError] Cannot parse the keystroke '${e}'. Requires at least the event type and keyboard key, and optionally some modifiers. Examples: 'keydown.control.z', 'keydown.escape', 'keyup.enter', 'keydown.control.alt.enter', 'keydown.control.space'`);let i=r[0];if("keydown"!==i&&"keyup"!==i)throw Error(`[KeystrokeParseError] Cannot parse the keystroke '${e}'. Unsupported event type. Supported event types are: 'keydown' or 'keyup'. Examples: 'keydown.control.z', 'keydown.escape', 'keyup.enter', 'keydown.control.alt.enter', 'keydown.control.space'`);let n=r[r.length-1];if(!n||new Set().add("alt").add("shift").add("control").add("meta").has(n.toLowerCase()))throw Error(`[KeystrokeParseError] Cannot parse the keystroke '${e}'. The keyboard key must be the last part. Examples: 'keydown.control.z', 'keydown.escape', 'keyup.enter', 'keydown.control.alt.enter', 'keydown.control.space'`);let s=new Set(r.slice(1,-1)),o=new r4(i,n,{control:s.delete("control"),shift:s.delete("shift"),alt:s.delete("alt"),meta:s.delete("meta")},t);if(s.size>0)throw Error(`[KeystrokeParseError] Cannot parse the keystroke '${e}'. Illegal modifier found. Supported modifiers are: 'alt', 'shift', 'control' or 'meta'. Examples: 'keydown.control.z', 'keydown.escape', 'keyup.enter', 'keydown.control.alt.enter', 'keydown.control.space'`);return o}}let r3="ɵPUSH_STATE_TO_SESSION_HISTORY_STACK",r6="ɵSHOW_SPLASH",r7="ɵCAPABILITY_ID",r8="sci-router-outlet",r9="name",ie="scrollable",it="keystrokes",ir=`
  <style>
    :host {
      display: block;
      overflow: hidden;
      position: relative; /* positioning context for splash */
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
      margin: 0;
    }
    
    /* Ensure transparent router-outlet if empty.
     *
     * An iframe is transparent only if the embedded content has the same color scheme as the embedding document.
     * An empty router-outlet loads the 'about:blank' page. This page has the user's preferred OS color scheme,
     * which may be different from the application's color scheme, making the iframe opaque. Therefore, we hide
     * the iframe to make the router-outlet transparent again.
     *
     * More information about iframe transparency:
     * - https://github.com/w3c/csswg-drafts/issues/4772#issuecomment-591553929
     * - https://fvsch.com/transparent-iframes
     */
    :host-context(.sci-empty) iframe {
      display: none;
    }

    div[part="splash"] {
      position: absolute;
      inset: 0;
    }
  </style>
  <iframe src="about:blank" scrolling="yes" marginheight="0" marginwidth="0"></iframe>
  
  <template id="splash">
    <div part="splash" class="e2e-splash">
      <slot></slot>
    </div>  
  </template>
`;class ii extends HTMLElement{constructor(){super(),this._disconnect$=new ea,this._uid=tU.randomUUID(),this._empty$=new eu(!0),this._outletName$=new eu(io),this._shadowRoot=this.attachShadow({mode:"open"}),this._shadowRoot.innerHTML=ir.trim(),this._iframe=this._shadowRoot.querySelector("iframe"),this._contextProvider=new r2(this._iframe),this._splash=new il(this._shadowRoot,this._iframe),this.empty$=this._empty$.pipe(tg())}set name(e){e?this.setAttribute(r9,e):this.removeAttribute(r9)}get name(){return this.getAttribute(r9)??void 0}set scrollable(e){e?this.setAttribute(ie,"true"):this.removeAttribute(ie)}get scrollable(){return"true"===this.getAttribute(ie)}set keystrokes(e){e&&e.length?this.setAttribute(it,E.join(e)):this.removeAttribute(it)}get keystrokes(){return E.split(this.getAttribute(it))}setContextValue(e,t){this._contextProvider.set(e,t)}removeContextValue(e){return this._contextProvider.remove(e)}get contextValues$(){return this._contextProvider.entries$}resetPreferredSize(){tM.get(t5).publish(_.preferredSizeTopic(this._uid),null)}get preferredSize(){let e={minWidth:this.style.minWidth||void 0,width:this.style.width||void 0,maxWidth:this.style.maxWidth||void 0,minHeight:this.style.minHeight||void 0,height:this.style.height||void 0,maxHeight:this.style.maxHeight||void 0};if(Object.values(e).some(Boolean))return e}get iframe(){return this._iframe}installOutletContext(){this._outletName$.pipe(tT(this._disconnect$)).subscribe(e=>{let t={name:e,uid:this._uid};this.iframe.name=e,this.setContextValue(is,t)})}installOutletUrlListener(){this._outletName$.pipe(tc(t=>(function(t){let r=_.urlTopic(t);return tM.get(t5).observe$(r).pipe(eA(t=>({url:t.body||"about:blank",pushStateToSessionHistoryStack:e.orElse(t.headers.get(r3),!1),showSplash:e.orElse(t.headers.get(r6),!1),capabilityId:t.headers.get(r7)})))})(t).pipe(t$(null))),tR(e=>this._empty$.next(!e||"about:blank"===e.url)),eT(function(e,t){var r,i=!1;e.subscribe(eC(t,function(e){var n=r;r=e,i&&t.next([n,e]),i=!0}))}),tT(this._disconnect$)).subscribe(([e,t])=>ri(()=>{t?.capabilityId&&t?.capabilityId===e?.capabilityId||(t?.showSplash?this._splash.attach():this._splash.detach()),e&&this.dispatchEvent(new CustomEvent("deactivate",{detail:e.url})),tM.get(r5).assign(this._iframe,t||{url:"about:blank"},e),t&&this.dispatchEvent(new CustomEvent("activate",{detail:t.url}))}))}installPreferredSizeListener(){tM.get(t5).observe$(_.preferredSizeTopic(this._uid)).pipe(t6(),tT(this._disconnect$)).subscribe(e=>{var t,r;t=this,Object.keys(r={"min-width":e?.minWidth??null,width:e?.width??null,"max-width":e?.maxWidth??null,"min-height":e?.minHeight??null,height:e?.height??null,"max-height":e?.maxHeight??null}).forEach(e=>t.style.setProperty(e,r[e]))})}installKeyboardEventDispatcher(){tM.get(t5).observe$(_.keyboardEventTopic(this._uid,":eventType")).pipe(tT(this._disconnect$)).subscribe(e=>{let t=e.params.get("eventType");this.dispatchEvent(new KeyboardEvent(t,e.body))})}installFocusWithinEventDispatcher(){var e;tM.get(t5).observe$(_.focusWithinOutletTopic(this._uid)).pipe(t6(),(e=e=>!1===e,eT(function(t,r){var i=!1,n=0;t.subscribe(eC(r,function(t){return(i||(i=!e(t,n++)))&&r.next(t)}))})),tT(this._disconnect$)).subscribe(e=>{this.dispatchEvent(new CustomEvent("focuswithin",{detail:e,bubbles:!1,cancelable:!1}))})}installHostElementDecorator(){this._empty$.pipe(tT(this._disconnect$)).subscribe(e=>{e?this._shadowRoot.host.classList.add("sci-empty"):this._shadowRoot.host.classList.remove("sci-empty")})}installSplashDisposer(){tM.get(t5).observe$(_.signalReadyTopic(this._uid)).pipe(tT(this._disconnect$)).subscribe(()=>{this._splash.detach()})}connectedCallback(){this.installOutletUrlListener(),this.installOutletContext(),this.installPreferredSizeListener(),this.installFocusWithinEventDispatcher(),this.installKeyboardEventDispatcher(),this.installHostElementDecorator(),this.installSplashDisposer(),this._contextProvider.onOutletMount()}disconnectedCallback(){this._disconnect$.next(),this._contextProvider.onOutletUnmount()}static{this.observedAttributes=[r9,ie,it]}attributeChangedCallback(e,t,r){switch(e){case r9:this._outletName$.next(r||io);break;case ie:var i;this._iframe.setAttribute("scrolling",null!=(i=r)&&"false"!=`${i}`?"yes":"no");break;case it:E.split(t).forEach(e=>this.removeContextValue(ia+r4.fromString(e).parts)),E.split(r).forEach(e=>{let t=r4.fromString(e);this.setContextValue(ia+t.parts,t.flags)})}}static define(){return customElements.get(r8)?Promise.resolve():(customElements.define(r8,ii),customElements.whenDefined(r8).then(()=>Promise.resolve()))}}let is="ɵOUTLET",io="primary";!function(e){e.urlTopic=function(e){return`sci-router-outlets/${e}/url`},e.signalReadyTopic=function(e){return`sci-router-outlets/${e}/ready`},e.keyboardEventTopic=function(e,t){return`sci-router-outlets/${e}/keyboard-events/${t}`},e.preferredSizeTopic=function(e){return`sci-router-outlets/${e}/preferred-size`},e.focusWithinOutletTopic=function(e){return`sci-router-outlets/${e}/focus-within`}}(_||(_={})),function(e){e.split=function(e){return e?e.split(","):[]},e.join=function(e){return e.join(",")}}(E||(E={}));let ia="keystroke:";class il{constructor(e,t){this._shadowRoot=e,this._iframeElement=t,this._template=this._shadowRoot.querySelector("template#splash")}attach(){if(this._element)return;let e=this._template.content.cloneNode(!0);this._element=this._shadowRoot.appendChild(e.querySelector('div[part="splash"]')),this._iframeElement.style.setProperty("visibility","hidden")}detach(){this._element&&(this._element.remove(),this._element=void 0,this._iframeElement.style.removeProperty("visibility"))}}class ic{constructor(){this._destroy$=new ea,this._contextTreeChange$=new ea,this._whenContextTreeChangeListenerInstalled=this.installContextTreeChangeListener(e=>this._contextTreeChange$.next(e))}observe$(e,t){return tM.get(tq)?eW(tn(t?.collect?[]:null),ti):this._contextTreeChange$.pipe(eQ(t=>t.name===e),t$(void 0),tc(()=>this.lookupContextValue$(e,t)),ro())}lookup(e,t){return eY(this.observe$(e,t))}isPresent(e){return this.lookup(e).then(e=>null!==e)}names$(){return tM.get(tq)?eW(tn(new Set),ti):this._contextTreeChange$.pipe(t$(void 0),tc(()=>this.lookupContextNames$()),ro())}lookupContextValue$(e,t){return new en(r=>{let i=tU.randomUUID(),n=new ea,s=w.newContextValueLookupRequest(e,i,t);return tM.get(t5).observe$(i).pipe(tw(1),eA(e=>e.headers.get(d.Status)===b.OK?e.body??null:null),tT(n)).subscribe(r),Promise.all([iu(i),this._whenContextTreeChangeListenerInstalled]).then(()=>window.parent.postMessage(s,"*")).catch(e=>r.error(e)),()=>n.next()})}lookupContextNames$(){return new en(e=>{let t=tU.randomUUID(),r=new ea,i=w.newContextTreeNamesLookupRequest(t);return tM.get(t5).observe$(t).pipe(tw(1),eA(e=>e.headers.get(d.Status)===b.OK?e.body:new Set),tT(r)).subscribe(e),Promise.all([iu(t),this._whenContextTreeChangeListenerInstalled]).then(()=>window.parent.postMessage(i,"*")).catch(t=>e.error(t)),()=>r.next()})}installContextTreeChangeListener(e){let t=tU.randomUUID(),r=w.newContextTreeObserveRequest(t);return new Promise((i,n)=>{tM.get(t5).observe$(t).pipe(t6(),tT(this._destroy$)).subscribe({next:t=>{t===w.RootContextSubscribeEvent?i():e(t)},error:n}),iu(t).then(()=>window.parent.postMessage(r,"*")).catch(e=>n(e))})}preDestroy(){this._destroy$.next()}}function iu(e){return new Promise((t,r)=>{tM.get(t5).subscriberCount$(e).pipe(tE(e=>1===e)).subscribe({error:r,complete:t})})}class ip{resolve(e,t){let r=y.newUrl(t.relativeTo);if(!r.hash?.startsWith("#/"))return y.newUrl(e,t.relativeTo).toString();{let{pathname:t,search:i,hash:n}=y.newUrl(e,`${r.origin}${r.hash.substring(1)}`);return r.origin+r.pathname+"#"+t+i+n}}}class ih{}class id{async navigate(e,t){e&&"string"!=typeof e?await this.navigateByIntent(e,t):await this.navigateByUrl(e,t)}async navigateByUrl(e,t){let r=t?.outlet||await this.resolveContextualOutlet()||io,i=_.urlTopic(r),n=this.computeNavigationUrl(e,t);await tM.get(t5).publish(i,n,{retain:!0,headers:new Map().set(r3,t?.pushStateToSessionHistoryStack??!1).set(r6,t?.showSplash??!1).set(r7,t?.ɵcapabilityId)}),null===e&&await tM.get(t5).publish(i,void 0,{retain:!0})}async navigateByIntent(e,t){if(t?.relativeTo)throw Error('[OutletRouterError][UnsupportedOptionError] Unsupported navigation option "relativeTo". This option is not supported in intent-based routing.');let r=await this.resolveContextualOutlet(),i={type:l.Microfrontend,qualifier:e,params:n.coerce(t?.params)},s=tM.get(ih).request$(i,t,{headers:new Map().set(ib,{[ig]:r})});try{await tt(s.pipe(t6()))}catch(e){throw e instanceof t7?e.message:e}}computeNavigationUrl(e,t){if(null==e)return"about:blank";let r=n.coerce(t?.params),i=this.substituteNamedParameters(e,r);if(y.isAbsoluteUrl(i))return i;{let e=t?.relativeTo??window.location.href;return tM.get(ip).resolve(i,{relativeTo:e})}}async resolveContextualOutlet(){if(!await tM.get(ic).isPresent(tF))return(await tM.get(ic).lookup(is))?.name}substituteNamedParameters(e,t){return e.replace(/:([^/;&?#]+)/g,(e,r)=>void 0!==t.get(r)?t.get(r):e).replace(/(?<delimiter>;)(?<paramName>[^=]+)=:(?<placeholder>[^;#?/]+)/g,()=>"").replace(/(?<delimiter>[?&])(?<paramName>[^=]+)=:(?<placeholder>[^&#]+)/g,(e,t)=>"?"===t?"ɵ__?__":"").replace(/ɵ__\?__&/,"?").replace(/ɵ__\?__/,"")}}let ib="context",ig="outlet";class im{intercept(e,t){return e.intent.type===l.Microfrontend?this.consumeMicrofrontendIntent(e):t.handle(e)}async consumeMicrofrontendIntent(e){let t=e.headers.get(d.ReplyTo);await this.navigate(e),await tM.get(t5).publish(t,null,{headers:new Map().set(d.Status,b.TERMINAL)})}async navigate(e){let t=e.capability,r=e.body,n=e.intent,s=t.properties?.path;if(null==s)throw Error(`[OutletRouterError][NullPathError] Microfrontend capability has no path to the microfrontend defined. [capability=${JSON.stringify(t)}]`);let o=t.metadata.appSymbolicName,a=tM.get(rg).getApplication(o,{orElse:null});if(!a)throw Error(`[OutletRouterError][NullApplicationError] Unexpected error. No application found with the symbolic name "${o}".`);await tM.get(id).navigate(s,{...r,outlet:this.resolveTargetOutlet(e),relativeTo:a.baseUrl,params:{...n.qualifier,...i.coerce(n.params)},showSplash:t.properties.showSplash,ɵcapabilityId:t.metadata.id})}resolveTargetOutlet(e){let t=e.capability,r=e.body;if(r?.outlet)return r.outlet;if(t.properties.outlet)return t.properties.outlet;let i=e.headers.get(ib)?.[ig];return i||io}}class iy{constructor(){this._clientsById=new Map,this._clientsByWindow=new Map,this.register$=new ea,this.unregister$=new ea}registerClient(e){let t=this._clientsByWindow.get(e.window);t&&(tM.get(tK).warn(`[StaleClient] Stale client registration detected when loading application '${e.application.symbolicName}'
        into the window of '${t.application.symbolicName}'. Removing stale registration. Most likely, the client could not disconnect
        from the broker, for example, because the client was disposed without notice, i.e., without receiving the browser's "unload" event, or
        because the browser discarded the 'DISCONNECT' message, maybe due to a high load on the client during unloading.`.replace(/\s+/g," "),new tJ(t.application.symbolicName,t.version)),this.unregisterClient(t)),this._clientsById.set(e.id,e),this._clientsByWindow.set(e.window,e),this.register$.next(e)}unregisterClient(e){this._clientsById.delete(e.id),this._clientsByWindow.delete(e.window),this.unregister$.next(e),e.dispose()}getByClientId(e){return this._clientsById.get(e)}getByWindow(e){return this._clientsByWindow.get(e)}getByApplication(e){return Array.from(this._clientsById.values()).filter(t=>t.application.symbolicName===e)}preDestroy(){this._clientsById.forEach(e=>this.unregisterClient(e))}}class iv{constructor(){}static createAppConfig(e){var t;return{symbolicName:e.symbolicName,manifestUrl:"string"==typeof(t=e.manifest)?t:function(e){let t=URL.createObjectURL(new Blob([JSON.stringify(e)],{type:"application/json"}));return tY.whenState(o.Stopped).then(()=>URL.revokeObjectURL(t)),t}(t||{name:"Host Application"}),scopeCheckDisabled:e.scopeCheckDisabled,intentionCheckDisabled:e.intentionCheckDisabled,intentionRegisterApiDisabled:e.intentionRegisterApiDisabled}}static interceptManifest(e){tM.all(t0).forEach(t=>t.intercept(e))}}class iw{constructor(){this._progress$=new eu(0),this._done$=new ea,this._hasSubMonitors=!1,this.progress$=this._progress$.pipe(tg(),eA(e=>Math.round(1e4*e)/100),tC(e=>e<100,!0))}split(...e){if(this._hasSubMonitors)throw Error("[IllegalMonitorStateError] Monitor cannot be split multiple times.");this._hasSubMonitors=!0;let t=e.map(()=>new iw);return eq(t.map(e=>e._progress$)).pipe(function(e){let t=e.reduce((e,t)=>e+t,0);return eA(r=>e.reduce((e,i,n)=>e+r[n]*(i/t),0))}(e),tC(e=>e<1,!0),tT(this._done$)).subscribe(e=>{this._progress$.next(e)}),t}splitEven(e){if(e<=0)throw Error(`[IllegalMonitorArgumentError] Monitor split count must be greater than 0, but was ${e}.`);return this.split(...Array(e).fill(1))}done(){this._progress$.next(1),this._done$.next()}}class i_ extends iw{}class iE extends iw{}class iS extends iw{}class iI{constructor(e,t){this._hostConfig=e,this._appConfigs=t.filter(e=>!e.exclude)}async install(){let e=iv.createAppConfig(this._hostConfig),t=[e,...this._appConfigs],r=tM.get(i_).splitEven(t.length);await Promise.all(t.map(async t=>{let i=r.shift();try{let r=await tM.get(rI).fetch(t);t===e&&iv.interceptManifest(r),await tM.get(rg).registerApplication(t,r),tM.get(tK).info(`Registered application '${t.symbolicName}' in the SCION Microfrontend Platform.`)}catch(e){tM.get(tK).error(`[AppInstaller] Failed to install application '${t.symbolicName}' in the SCION Microfrontend Platform.`,e)}finally{i.done()}}))}}class i${async init(){let e=await eY(tM.get(r0).lookupCapabilities$({type:l.Activator})),t=tM.get(iE);if(!e.length)return void t.done();let r=e.filter(this.skipInvalidActivators()).reduce((e,t)=>n.addListValue(e,t.metadata.appSymbolicName,t),new Map),i=t.splitEven(r.size),s=Array.from(r.entries()).reduce((e,[t,r],n)=>e.concat(this.waitForActivatorsToSignalReady(t,r,i[n])),[]);r.forEach(e=>{let t=e[0];e.forEach(e=>this.mountActivator(e,e===t))}),await Promise.all(s)}skipInvalidActivators(){return e=>!!e.properties&&!!e.properties.path||(tM.get(tK).error(`[ActivatorError] Failed to activate the application '${e.metadata.appSymbolicName}'. Missing required 'path' property in the provided activator capability.`,e),!1)}async waitForActivatorsToSignalReady(e,r,i){let n=Date.now(),s=tM.get(rg).getApplication(e).activatorLoadTimeout,o=r.reduce((e,r)=>e.concat(t.coerce(r.properties.readinessTopics)),[]).map(t=>{let r=()=>(tM.get(tK).error(`[ActivatorLoadTimeoutError] Timeout elapsed while waiting for application to signal readiness [app=${e}, timeout=${s}ms, readinessTopic=${t}].`),eG);return new Promise((i,n)=>tM.get(t5).observe$(t).pipe(tE(t=>t.headers.get(d.AppSymbolicName)===e),s?th({first:s,with:r}):et).subscribe({error:n,complete:i}))});if(!o.length)return void i.done();await Promise.all(o),i.done(),tM.get(tK).info(`Activator startup of '${e}' took ${Date.now()-n}ms.`)}mountActivator(e,t){let r=tM.get(rg).getApplication(e.metadata.appSymbolicName),i=document.createElement("sci-router-outlet");i.name=tU.randomUUID(),tM.get(id).navigate(e.properties.path,{outlet:i.name,relativeTo:r.baseUrl}).then(),i.setContextValue(tF,{primary:t,activator:e}),i.classList.add("sci-activator"),i.dataset.app=r.symbolicName,i.style.display="none",i.style.position="absolute",document.body.appendChild(i),tY.whenState(o.Stopped).then(()=>document.body.removeChild(i))}}class iT{constructor(){this.focusWithin$=tM.get(t5).request$(h.IsFocusWithin).pipe(t6()),this.focus$=tM.get(t5).request$(h.HasFocus).pipe(t6())}}class iC{constructor(){this._destroy$=new ea,this.installFocusEventDispatcher().then()}async installFocusEventDispatcher(){await tM.get(ic).isPresent(tF)||(this.publishFocusInEvent(),await this.notifyOutletAboutFocusChange())}publishFocusInEvent(){tM.get(iT).focus$.pipe(tc(e=>e?eG:ta(e1(window,"focusin",{once:!0}),e1(window,"mousedown",{once:!0,capture:!0}))),tT(this._destroy$)).subscribe(()=>{tM.get(t5).publish(h.FocusIn)})}async notifyOutletAboutFocusChange(){let e=await tM.get(ic).lookup(is);e&&tM.get(iT).focusWithin$.pipe(tT(this._destroy$)).subscribe(t=>{let r=_.focusWithinOutletTopic(e.uid);tM.get(t5).publish(r,t)})}preDestroy(){this._destroy$.next()}}class iR{constructor(){this._destroy$=new ea,this._dispatcherId=tU.randomUUID(),this.installMouseEventDispatcher().then()}async installMouseEventDispatcher(){await tM.get(ic).isPresent(tF)||(this.publishMouseMoveEvent(),this.receiveMouseMoveEvent())}publishMouseMoveEvent(){var e,t;tM.get(iT).focus$.pipe(tc(e=>e?eG:e1(document,"mousemove")),eQ(e=>e.buttons===ix),(void 0===e&&(e=e8),t=function(){return te(20,e)},eT(function(e,r){var i=!1,n=null,s=null,o=!1,a=function(){if(null==s||s.unsubscribe(),s=null,i){i=!1;var e=n;n=null,r.next(e)}o&&r.complete()},l=function(){s=null,o&&r.complete()};e.subscribe(eC(r,function(e){i=!0,n=e,s||eS(t(e)).subscribe(s=eC(r,a,l))},function(){o=!0,i&&s&&!s.closed||r.complete()}))})),tT(this._destroy$)).subscribe(e=>{let t={headers:new Map().set(iM,this._dispatcherId)};tM.get(t5).publish(iO,[e.screenX,e.screenY],t)})}receiveMouseMoveEvent(){tM.get(iT).focus$.pipe(tc(e=>e?tM.get(t5).observe$(iO):eG),eQ(e=>e.headers.get(iM)!==this._dispatcherId),t6(),tT(this._destroy$)).subscribe(([e,t])=>{let r=new Event("sci-mousemove");r.screenX=e,r.screenY=t,document.dispatchEvent(r)})}preDestroy(){this._destroy$.next()}}let ix=1,iM="ɵDISPATCHER_ID",iO="ɵMOUSEMOVE";class iN{constructor(){this._destroy$=new ea,this._dispatcherId=tU.randomUUID(),this.installMouseEventDispatcher().then()}async installMouseEventDispatcher(){await tM.get(ic).isPresent(tF)||(this.publishMouseUpEvent(),this.receiveMouseMoveEvent())}publishMouseUpEvent(){tM.get(iT).focus$.pipe(tc(e=>e?eG:e1(window,"mouseup",{capture:!0})),tT(this._destroy$)).subscribe(()=>{let e={headers:new Map().set(iA,this._dispatcherId)};tM.get(t5).publish(ik,void 0,e)})}receiveMouseMoveEvent(){tM.get(iT).focus$.pipe(tc(e=>e?tM.get(t5).observe$(ik):eG),eQ(e=>e.headers.get(iA)!==this._dispatcherId),t6(),tT(this._destroy$)).subscribe(()=>{document.dispatchEvent(new Event("sci-mouseup"))})}preDestroy(){this._destroy$.next()}}let iA="ɵDISPATCHER_ID",ik="ɵMOUSEUP";class iP{constructor(){this._destroy$=new ea,this._fromDimensionElementChange$=new ea,this._preferredSizePublisher=new iU}setPreferredSize(e){this._preferredSizePublisher.publish(e)}fromDimension(e){if(this._fromDimensionElementChange$.next(),!e)return void this.resetPreferredSize();new en(t=>{let r=new ResizeObserver(()=>{var r;return t.next({clientWidth:(r=e).clientWidth,offsetWidth:r.offsetWidth,clientHeight:r.clientHeight,offsetHeight:r.offsetHeight,element:r})});return r.observe(e),()=>{r.disconnect()}}).pipe(tT(tr(this._fromDimensionElementChange$,this._destroy$))).subscribe(e=>{document.body.contains(e.element)?this.setPreferredSize({minWidth:`${e.offsetWidth}px`,width:`${e.offsetWidth}px`,maxWidth:`${e.offsetWidth}px`,minHeight:`${e.offsetHeight}px`,height:`${e.offsetHeight}px`,maxHeight:`${e.offsetHeight}px`}):this.resetPreferredSize()})}resetPreferredSize(){this._preferredSizePublisher.publish(null)}preDestroy(){this._preferredSizePublisher.destroy(),this._destroy$.next()}}class iU{constructor(){this._preferredSize$=new ea,this._destroy$=new ea,this._preferredSize$.pipe(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return tb.apply(void 0,R([],C(e)))}(tM.get(ic).observe$(is).pipe(eQ(Boolean))),tT(this._destroy$)).subscribe(([e,t])=>ri(()=>{let r=_.preferredSizeTopic(t.uid);tM.get(t5).publish(r,e)}))}publish(e){this._preferredSize$.next(e)}destroy(){this._destroy$.next()}}class iD{constructor(){this._destroy$=new ea,this.installKeystrokeDispatcher().then()}async installKeystrokeDispatcher(){!await tM.get(ic).isPresent(is)||await tM.get(ic).isPresent(tF)||tM.get(ic).names$().pipe(eA(e=>Array.from(e)),tD(e=>e.startsWith(ia)),tB(e=>e.substring(ia.length)),tB(e=>this.observeKeyboardEvent$(e)),tc(e=>tr(...e)),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=eB(e);return eT(function(t,i){for(var n=e.length,s=Array(n),o=e.map(function(){return!1}),a=!1,l=function(t){eS(e[t]).subscribe(eC(i,function(e){s[t]=e,!a&&!o[t]&&(o[t]=!0,(a=o.every(et))&&(o=null))},V))},c=0;c<n;c++)l(c);t.subscribe(eC(i,function(e){if(a){var t=R([e],C(s));i.next(r?r.apply(void 0,R([],C(t))):t)}}))})}(tM.get(ic).observe$(is)),tT(this._destroy$)).subscribe(([e,t])=>ri(()=>{let r={key:e.key,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey,bubbles:e.bubbles},i=_.keyboardEventTopic(t.uid,e.type);tM.get(t5).publish(i,r)}))}observeKeyboardEvent$(e){return tM.get(ic).observe$(ia+e,{collect:!0}).pipe(tc(t=>{var r;let i=r4.fromString(e).withFlags(t.reduceRight((e,t)=>({...e,...t}),{}));return e1(document,i.eventType,{capture:!0}).pipe(eQ(e=>e.bubbles&&!!e.key),eQ(e=>r4.fromEvent(e).parts===i.parts),(r=i.flags,tR(e=>{r?.preventDefault&&e.preventDefault()})))}))}preDestroy(){this._destroy$.next()}}class iB{constructor(e,t){this._callback=t,this._messageClient=tM.get(t5),this.subscription=new k,this.subscription.add(e.subscribe(e=>{e.headers.has(d.ReplyTo)?this.handleMessage(e):this.consumeMessage(e)}))}consumeMessage(e){ri(()=>this._callback(e))}handleMessage(e){var t;let r,i=e.headers.get(d.ReplyTo),n=tY.state$.pipe(eQ(e=>e===o.Stopping));try{r=this._callback(e)}catch(e){r=tu(()=>e)}let s="alive";this.subscription.add((void 0===(t=r)?eG:t instanceof en?t:t instanceof Promise?eN(t).pipe(eQ(e=>void 0!==e)):tn(t)).pipe(t4(i),tT(n),tv(()=>{if("alive"===s){let e=new Map().set(d.Status,b.TERMINAL);this._messageClient.publish(i,void 0,{headers:e}).then()}})).subscribe({next:e=>{let t=new Map().set(d.Status,b.OK);this._messageClient.publish(i,e,{headers:t}).then()},error:e=>{s="errored";let t=new Map().set(d.Status,b.ERROR);this._messageClient.publish(i,rn(e),{headers:t}).then()},complete:()=>{s="completed";let e=new Map().set(d.Status,b.TERMINAL);this._messageClient.publish(i,void 0,{headers:e}).then()}}))}}class iL{constructor(){this._brokerGateway=tM.get(rl)}publish(e,t,r){let i={topic:e,retain:r?.retain??!1,headers:new Map(r?.headers),body:t};return this._brokerGateway.postMessage(p.Topic,i)}request$(e,t,r){let i=new Map(r?.headers);return eK(()=>{let n={topic:e,retain:r?.retain??!1,headers:new Map(i),body:t};return this._brokerGateway.requestReply$(p.Topic,n).pipe(t3())})}observe$(e){return this._brokerGateway.subscribe$({messageChannel:p.Topic,subscribeChannel:p.TopicSubscribe,unsubscribeChannel:p.TopicUnsubscribe,newSubscribeCommand:t=>({topic:e,subscriberId:t,headers:new Map})})}onMessage(e,t){return new iB(tM.get(t5).observe$(e),t).subscription}subscriberCount$(e){return new en(t=>{let r=new ea;return this.request$(h.RequestSubscriberCount,e).pipe(t6(),tT(r)).subscribe({next:e=>t.next(e),error:e=>t.error(e),complete:V}),()=>r.next()})}}class iq{constructor(){this._brokerGateway=tM.get(rl)}publish(e,t,r){let i={intent:e,retain:r?.retain??!1,headers:new Map(r?.headers),capability:void 0,body:t};return this._brokerGateway.postMessage(p.Intent,i)}request$(e,t,r){let i=new Map(r?.headers);return eK(()=>{let n={intent:e,retain:r?.retain??!1,headers:new Map(i),capability:void 0,body:t};return this._brokerGateway.requestReply$(p.Intent,n).pipe(t3())})}observe$(e){return this._brokerGateway.subscribe$({messageChannel:p.Intent,subscribeChannel:p.IntentSubscribe,unsubscribeChannel:p.IntentUnsubscribe,newSubscribeCommand:t=>({selector:e,subscriberId:t,headers:new Map})})}onIntent(e,t){return new iB(tM.get(ih).observe$(e),t).subscription}}class iV{constructor(){}static connect(e,t){return tY.startPlatform(()=>{tX({symbolicName:e,isPlatformHost:!1}),iF({...t,connectRunlevel:a.Zero}),tM.registerInitializer({useExisting:rh,runlevel:a.Two}),tM.registerInitializer({useExisting:r0,runlevel:a.Two}),tM.registerInitializer({useFunction:()=>ii.define(),runlevel:a.Two})})}static async isConnected(){if(tY.state===o.Stopped)return!1;let e=tM.opt(rl);return!!e&&e.isConnected()}static signalReady(){tM.get(ic).lookup(is).then(e=>e?tM.get(t5).publish(_.signalReadyTopic(e.uid)):Promise.reject(Error("[NullOutletContextError] not running in the context of a <sci-router-outlet>.")))}}function iF(e){var t;tM.registerIfAbsent(t5,{useClass:iL,eager:!0,destroyOrder:c.MESSAGING}),tM.registerIfAbsent(ih,{useClass:iq,eager:!0,destroyOrder:c.MESSAGING}),tM.registerIfAbsent(id),tM.registerIfAbsent(ip),tM.registerIfAbsent(r5),tM.register(iC,{eager:!0}),tM.register(iR,{eager:!0}),tM.register(iN,{eager:!0}),tM.register(iD,{eager:!0}),tM.register(iP,{eager:!0}),tM.register(ic),tM.register(r0),tM.register(rh),tM.register(iT),(t=e).connect??!0?(tM.register(ru,{useFactory:()=>new ru(t),destroyOrder:c.MESSAGING}),tM.register(rl,{useExisting:ru}),tM.registerInitializer({useExisting:ru,runlevel:t.connectRunlevel})):tM.register(rl,{useClass:rc})}class ij{constructor(){}static start(e){return tY.startPlatform(()=>{var t,r,i;let n=e.host?.symbolicName||"host";tX({symbolicName:n,isPlatformHost:!0}),iF({messageDeliveryTimeout:e.host?.messageDeliveryTimeout,brokerDiscoverTimeout:e.host?.brokerDiscoverTimeout,connectRunlevel:a.One}),t=e,tM.register(tZ,{useValue:t}),tM.register(t0,{useClass:t1,multi:!0}),tM.register(t2,{useClass:iy,destroyOrder:c.CORE}),tM.registerIfAbsent(rd),tM.register(rf,{useClass:rw,eager:!0}),tM.register(rg,{eager:!0}),tM.register(rS,{eager:!0}),tM.register(rW,{destroyOrder:c.BROKER}),tM.register(rI),tM.register(rR,{destroyOrder:c.BROKER}),tM.register(rq,{destroyOrder:c.BROKER}),tM.register(rO,{useClass:im,multi:!0}),function(e){let t=e?.interval??60,r=e?.timeout??10,i=t<=2*r;i&&tM.get(tK).warn(`[LivenessProbeConfig] Illegal config provided. The interval [${t}s] must be greater than twice the timeout period [${r}s]. Using platform defaults instead: [interval=60s, timeout=10s]`),tM.registerIfAbsent(rD,{useValue:(i?60:t)*1e3}),tM.registerIfAbsent(rB,{useValue:(i?10:r)*1e3})}(t.liveness),function(){let e=new iw,[t,r,i]=e.split(1,3,5);tM.register(iS,{useValue:e}),tM.register(i_,{useValue:r}),tM.register(iE,{useValue:i}),tY.whenState(o.Started).then(()=>t.done())}(),r=n,i=e,tM.registerInitializer({useExisting:rW,runlevel:a.Zero}),tM.registerInitializer({useFunction:()=>new iI({...i.host,symbolicName:r},i.applications).install(),runlevel:a.Zero}),tM.registerInitializer({useFunction:()=>tM.get(t5).publish(h.PlatformProperties,i.properties||{},{retain:!0}),runlevel:a.Two}),tM.registerInitializer({useFunction:()=>tM.get(t5).publish(h.Applications,tM.get(rg).getApplications(),{retain:!0}),runlevel:a.Two}),tM.registerInitializer({useFunction:()=>ii.define(),runlevel:a.Two}),tM.registerInitializer({useExisting:rh,runlevel:a.Three}),tM.registerInitializer({useExisting:r0,runlevel:a.Three}),tM.registerInitializer({useClass:i$,runlevel:a.Three})})}static get startupProgress$(){return this._startupProgress$=this._startupProgress$||new en(e=>{let t=new tl(1),r=eK(()=>tM.get(iS).progress$).pipe(tT(t));return tY.state===o.Stopped?tY.whenState(o.Starting).then(()=>r.subscribe(e)):r.subscribe(e),()=>t.next()}),this._startupProgress$}}window.__SCION_RCP=window.__SCION_RCP||{},window.__SCION_RCP.refs={get MicrofrontendPlatform(){return tY},get MicrofrontendPlatformHost(){return ij},get MicrofrontendPlatformClient(){return iV},get MessageClient(){return tM.get(t5)},get IntentClient(){return tM.get(ih)},get OutletRouter(){return tM.get(id)},get ManifestService(){return tM.get(r0)},get Beans(){return tM},get MessageInterceptor(){return rM},get IntentInterceptor(){return rO},get TopicMatcher(){return t8},get QualifierMatcher(){return rm},get UUID(){return tU}}})();
//# sourceMappingURL=refs.js.map
