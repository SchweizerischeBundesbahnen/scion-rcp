(()=>{var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};function t(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}function r(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))}function n(e,t){var r,n,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}Object.create;function i(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,s=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)o.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return o}function o(e,t,r){if(r||2===arguments.length)for(var n,i=0,s=t.length;i<s;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}function a(e){return this instanceof a?(this.v=e,this):new a(e)}function c(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(e){i[e]&&(n[e]=function(t){return new Promise((function(r,n){s.push([e,t,r,n])>1||c(e,t)}))})}function c(e,t){try{(r=i[e](t)).value instanceof a?Promise.resolve(r.value.v).then(u,l):p(s[0][2],r)}catch(e){p(s[0][3],e)}var r}function u(e){c("next",e)}function l(e){c("throw",e)}function p(e,t){e(t),s.shift(),s.length&&c(s[0][0],s[0][1])}}function u(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=i(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,i){(function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)})(n,i,(t=e[r](t)).done,t.value)}))}}}Object.create;function l(e){return"function"==typeof e}function p(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var d=p((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function h(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var f=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,r,n,a;if(!this.closed){this.closed=!0;var c=this._parentage;if(c)if(this._parentage=null,Array.isArray(c))try{for(var u=i(c),p=u.next();!p.done;p=u.next()){p.value.remove(this)}}catch(t){e={error:t}}finally{try{p&&!p.done&&(t=u.return)&&t.call(u)}finally{if(e)throw e.error}}else c.remove(this);var h=this.initialTeardown;if(l(h))try{h()}catch(e){a=e instanceof d?e.errors:[e]}var f=this._finalizers;if(f){this._finalizers=null;try{for(var b=i(f),g=b.next();!g.done;g=b.next()){var y=g.value;try{m(y)}catch(e){a=null!=a?a:[],e instanceof d?a=o(o([],s(a)),s(e.errors)):a.push(e)}}}catch(e){r={error:e}}finally{try{g&&!g.done&&(n=b.return)&&n.call(b)}finally{if(r)throw r.error}}}if(a)throw new d(a)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)m(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&h(t,e)},e.prototype.remove=function(t){var r=this._finalizers;r&&h(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}(),b=f.EMPTY;function g(e){return e instanceof f||e&&"closed"in e&&l(e.remove)&&l(e.add)&&l(e.unsubscribe)}function m(e){l(e)?e():e.unsubscribe()}var y={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},v={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=v.delegate;return(null==i?void 0:i.setTimeout)?i.setTimeout.apply(i,o([e,t],s(r))):setTimeout.apply(void 0,o([e,t],s(r)))},clearTimeout:function(e){var t=v.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function w(e){v.setTimeout((function(){var t=y.onUnhandledError;if(!t)throw e;t(e)}))}function _(){}var E=I("C",void 0,void 0);function S(e){return I("N",e,void 0)}function I(e,t,r){return{kind:e,value:t,error:r}}var $=null;function C(e){if(y.useDeprecatedSynchronousErrorHandling){var t=!$;if(t&&($={errorThrown:!1,error:null}),e(),t){var r=$,n=r.errorThrown,i=r.error;if($=null,n)throw i}}else e()}var T=function(e){function r(t){var r=e.call(this)||this;return r.isStopped=!1,t?(r.destination=t,g(t)&&t.add(r)):r.destination=P,r}return t(r,e),r.create=function(e,t,r){return new M(e,t,r)},r.prototype.next=function(e){this.isStopped?N(S(e),this):this._next(e)},r.prototype.error=function(e){this.isStopped?N(I("E",void 0,e),this):(this.isStopped=!0,this._error(e))},r.prototype.complete=function(){this.isStopped?N(E,this):(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},r.prototype._next=function(e){this.destination.next(e)},r.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},r.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},r}(f),x=Function.prototype.bind;function R(e,t){return x.call(e,t)}var O=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){A(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){A(e)}else A(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){A(e)}},e}(),M=function(e){function r(t,r,n){var i,s,o=e.call(this)||this;l(t)||!t?i={next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=n?n:void 0}:o&&y.useDeprecatedNextContext?((s=Object.create(t)).unsubscribe=function(){return o.unsubscribe()},i={next:t.next&&R(t.next,s),error:t.error&&R(t.error,s),complete:t.complete&&R(t.complete,s)}):i=t;return o.destination=new O(i),o}return t(r,e),r}(T);function A(e){var t;y.useDeprecatedSynchronousErrorHandling?(t=e,y.useDeprecatedSynchronousErrorHandling&&$&&($.errorThrown=!0,$.error=t)):w(e)}function N(e,t){var r=y.onStoppedNotification;r&&v.setTimeout((function(){return r(e,t)}))}var P={closed:!0,next:_,error:function(e){throw e},complete:_},k="function"==typeof Symbol&&Symbol.observable||"@@observable";function U(e){return e}function D(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return L(e)}function L(e){return 0===e.length?U:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var B=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var n,i=this,s=(n=e)&&n instanceof T||function(e){return e&&l(e.next)&&l(e.error)&&l(e.complete)}(n)&&g(n)?e:new M(e,t,r);return C((function(){var e=i,t=e.operator,r=e.source;s.add(t?t.call(s,r):r?i._subscribe(s):i._trySubscribe(s))})),s},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var r=this;return new(t=q(t))((function(t,n){var i=new M({next:function(t){try{e(t)}catch(e){n(e),i.unsubscribe()}},error:n,complete:t});r.subscribe(i)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[k]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return L(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=q(e))((function(e,r){var n;t.subscribe((function(e){return n=e}),(function(e){return r(e)}),(function(){return e(n)}))}))},e.create=function(t){return new e(t)},e}();function q(e){var t;return null!==(t=null!=e?e:y.Promise)&&void 0!==t?t:Promise}var j=p((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),V=function(e){function r(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return t(r,e),r.prototype.lift=function(e){var t=new F(this,this);return t.operator=e,t},r.prototype._throwIfClosed=function(){if(this.closed)throw new j},r.prototype.next=function(e){var t=this;C((function(){var r,n;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var s=i(t.currentObservers),o=s.next();!o.done;o=s.next()){o.value.next(e)}}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}}}))},r.prototype.error=function(e){var t=this;C((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var r=t.observers;r.length;)r.shift().error(e)}}))},r.prototype.complete=function(){var e=this;C((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},r.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(r.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),r.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},r.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},r.prototype._innerSubscribe=function(e){var t=this,r=this,n=r.hasError,i=r.isStopped,s=r.observers;return n||i?b:(this.currentObservers=null,s.push(e),new f((function(){t.currentObservers=null,h(s,e)})))},r.prototype._checkFinalizedStatuses=function(e){var t=this,r=t.hasError,n=t.thrownError,i=t.isStopped;r?e.error(n):i&&e.complete()},r.prototype.asObservable=function(){var e=new B;return e.source=this,e},r.create=function(e,t){return new F(e,t)},r}(B),F=function(e){function r(t,r){var n=e.call(this)||this;return n.destination=t,n.source=r,n}return t(r,e),r.prototype.next=function(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===r||r.call(t,e)},r.prototype.error=function(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===r||r.call(t,e)},r.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},r.prototype._subscribe=function(e){var t,r;return null!==(r=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==r?r:b},r}(V),z=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t._value=null,t._hasValue=!1,t._isComplete=!1,t}return t(r,e),r.prototype._checkFinalizedStatuses=function(e){var t=this,r=t.hasError,n=t._hasValue,i=t._value,s=t.thrownError,o=t.isStopped,a=t._isComplete;r?e.error(s):(o||a)&&(n&&e.next(i),e.complete())},r.prototype.next=function(e){this.isStopped||(this._value=e,this._hasValue=!0)},r.prototype.complete=function(){var t=this,r=t._hasValue,n=t._value;t._isComplete||(this._isComplete=!0,r&&e.prototype.next.call(this,n),e.prototype.complete.call(this))},r}(V),W=function(e){function r(t){var r=e.call(this)||this;return r._value=t,r}return t(r,e),Object.defineProperty(r.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),r.prototype._subscribe=function(t){var r=e.prototype._subscribe.call(this,t);return!r.closed&&t.next(this._value),r},r.prototype.getValue=function(){var e=this,t=e.hasError,r=e.thrownError,n=e._value;if(t)throw r;return this._throwIfClosed(),n},r.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},r}(V),H=Array.isArray,K=Object.getPrototypeOf,G=Object.prototype,Q=Object.keys;function J(e){if(1===e.length){var t=e[0];if(H(t))return{args:t,keys:null};if((n=t)&&"object"==typeof n&&K(n)===G){var r=Q(t);return{args:r.map((function(e){return t[e]})),keys:r}}}var n;return{args:e,keys:null}}var Y=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function X(e){return l(null==e?void 0:e.then)}function Z(e){return l(e[k])}function ee(e){return Symbol.asyncIterator&&l(null==e?void 0:e[Symbol.asyncIterator])}function te(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var re="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function ne(e){return l(null==e?void 0:e[re])}function ie(e){return c(this,arguments,(function(){var t,r,i;return n(this,(function(n){switch(n.label){case 0:t=e.getReader(),n.label=1;case 1:n.trys.push([1,,9,10]),n.label=2;case 2:return[4,a(t.read())];case 3:return r=n.sent(),i=r.value,r.done?[4,a(void 0)]:[3,5];case 4:return[2,n.sent()];case 5:return[4,a(i)];case 6:return[4,n.sent()];case 7:return n.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function se(e){return l(null==e?void 0:e.getReader)}function oe(e){if(e instanceof B)return e;if(null!=e){if(Z(e))return s=e,new B((function(e){var t=s[k]();if(l(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(Y(e))return n=e,new B((function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()}));if(X(e))return r=e,new B((function(e){r.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,w)}));if(ee(e))return ae(e);if(ne(e))return t=e,new B((function(e){var r,n;try{for(var s=i(t),o=s.next();!o.done;o=s.next()){var a=o.value;if(e.next(a),e.closed)return}}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}e.complete()}));if(se(e))return ae(ie(e))}var t,r,n,s;throw te(e)}function ae(e){return new B((function(t){(function(e,t){var i,s,o,a;return r(this,void 0,void 0,(function(){var r,c;return n(this,(function(n){switch(n.label){case 0:n.trys.push([0,5,6,11]),i=u(e),n.label=1;case 1:return[4,i.next()];case 2:if((s=n.sent()).done)return[3,4];if(r=s.value,t.next(r),t.closed)return[2];n.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return c=n.sent(),o={error:c},[3,11];case 6:return n.trys.push([6,,9,10]),s&&!s.done&&(a=i.return)?[4,a.call(i)]:[3,8];case 7:n.sent(),n.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function ce(e,t,r,n,i){void 0===n&&(n=0),void 0===i&&(i=!1);var s=t.schedule((function(){r(),i?e.add(this.schedule(null,n)):this.unsubscribe()}),n);if(e.add(s),!i)return s}function ue(e){return function(t){if(function(e){return l(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function le(e,t,r,n,i){return new pe(e,t,r,n,i)}var pe=function(e){function r(t,r,n,i,s,o){var a=e.call(this,t)||this;return a.onFinalize=s,a.shouldUnsubscribe=o,a._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=n?function(){try{n()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return t(r,e),r.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},r}(T);function de(e,t){return void 0===t&&(t=0),ue((function(r,n){r.subscribe(le(n,(function(r){return ce(n,e,(function(){return n.next(r)}),t)}),(function(){return ce(n,e,(function(){return n.complete()}),t)}),(function(r){return ce(n,e,(function(){return n.error(r)}),t)})))}))}function he(e,t){return void 0===t&&(t=0),ue((function(r,n){n.add(e.schedule((function(){return r.subscribe(n)}),t))}))}function fe(e,t){return oe(e).pipe(he(t),de(t))}function be(e,t){return oe(e).pipe(he(t),de(t))}function ge(e,t){return new B((function(r){var n=0;return t.schedule((function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())}))}))}function me(e,t){return new B((function(r){var n;return ce(r,t,(function(){n=e[re](),ce(r,t,(function(){var e,t,i;try{t=(e=n.next()).value,i=e.done}catch(e){return void r.error(e)}i?r.complete():r.next(t)}),0,!0)})),function(){return l(null==n?void 0:n.return)&&n.return()}}))}function ye(e,t){if(!e)throw new Error("Iterable cannot be null");return new B((function(r){ce(r,t,(function(){var n=e[Symbol.asyncIterator]();ce(r,t,(function(){n.next().then((function(e){e.done?r.complete():r.next(e.value)}))}),0,!0)}))}))}function ve(e,t){return ye(ie(e),t)}function we(e,t){if(null!=e){if(Z(e))return fe(e,t);if(Y(e))return ge(e,t);if(X(e))return be(e,t);if(ee(e))return ye(e,t);if(ne(e))return me(e,t);if(se(e))return ve(e,t)}throw te(e)}function _e(e,t){return t?we(e,t):oe(e)}function Ee(e,t){return ue((function(r,n){var i=0;r.subscribe(le(n,(function(r){n.next(e.call(t,r,i++))})))}))}var Se=Array.isArray;function Ie(e){return Ee((function(t){return function(e,t){return Se(t)?e.apply(void 0,o([],s(t))):e(t)}(e,t)}))}function $e(e){return e&&l(e.schedule)}function Ce(e){return e[e.length-1]}function Te(e){return l(Ce(e))?e.pop():void 0}function xe(e){return $e(Ce(e))?e.pop():void 0}function Re(e,t){return"number"==typeof Ce(e)?e.pop():t}function Oe(e,t){return e.reduce((function(e,r,n){return e[r]=t[n],e}),{})}function Me(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=xe(e),n=Te(e),i=J(e),s=i.args,o=i.keys;if(0===s.length)return _e([],r);var a=new B(Ae(s,r,o?function(e){return Oe(o,e)}:U));return n?a.pipe(Ie(n)):a}function Ae(e,t,r){return void 0===r&&(r=U),function(n){Ne(t,(function(){for(var i=e.length,s=new Array(i),o=i,a=i,c=function(i){Ne(t,(function(){var c=_e(e[i],t),u=!1;c.subscribe(le(n,(function(e){s[i]=e,u||(u=!0,a--),a||n.next(r(s.slice()))}),(function(){--o||n.complete()})))}),n)},u=0;u<i;u++)c(u)}),n)}}function Ne(e,t,r){e?ce(r,e,t):t()}function Pe(e,t,r,n,i,s,o,a){var c=[],u=0,l=0,p=!1,d=function(){!p||c.length||u||t.complete()},h=function(e){return u<n?f(e):c.push(e)},f=function(e){s&&t.next(e),u++;var a=!1;oe(r(e,l++)).subscribe(le(t,(function(e){null==i||i(e),s?h(e):t.next(e)}),(function(){a=!0}),void 0,(function(){if(a)try{u--;for(var e=function(){var e=c.shift();o?ce(t,o,(function(){return f(e)})):f(e)};c.length&&u<n;)e();d()}catch(e){t.error(e)}})))};return e.subscribe(le(t,h,(function(){p=!0,d()}))),function(){null==a||a()}}function ke(e,t,r){return void 0===r&&(r=1/0),l(t)?ke((function(r,n){return Ee((function(e,i){return t(r,e,n,i)}))(oe(e(r,n)))}),r):("number"==typeof t&&(r=t),ue((function(t,n){return Pe(t,n,e,r)})))}function Ue(e){return void 0===e&&(e=1/0),ke(U,e)}function De(){return Ue(1)}function Le(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return De()(_e(e,xe(e)))}function Be(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=xe(e);return ue((function(t,n){De()(_e(o([t],s(e)),r)).subscribe(n)}))}function qe(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Be.apply(void 0,o([],s(e)))}function je(e){return new B((function(t){oe(e()).subscribe(t)}))}var Ve=new B((function(e){return e.complete()}));function Fe(e,t){return ue((function(r,n){var i=0;r.subscribe(le(n,(function(r){return e.call(t,r,i++)&&n.next(r)})))}))}var ze=p((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}}));function We(e,t){var r="object"==typeof t;return new Promise((function(n,i){var s=new M({next:function(e){n(e),s.unsubscribe()},error:i,complete:function(){r?n(t.defaultValue):i(new ze)}});e.subscribe(s)}))}var He=["addListener","removeListener"],Ke=["addEventListener","removeEventListener"],Ge=["on","off"];function Qe(e,t,r,n){if(l(r)&&(n=r,r=void 0),n)return Qe(e,t,r).pipe(Ie(n));var i=s(function(e){return l(e.addEventListener)&&l(e.removeEventListener)}(e)?Ke.map((function(n){return function(i){return e[n](t,i,r)}})):function(e){return l(e.addListener)&&l(e.removeListener)}(e)?He.map(Je(e,t)):function(e){return l(e.on)&&l(e.off)}(e)?Ge.map(Je(e,t)):[],2),o=i[0],a=i[1];if(!o&&Y(e))return ke((function(e){return Qe(e,t,r)}))(oe(e));if(!o)throw new TypeError("Invalid event target");return new B((function(e){var t=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.next(1<t.length?t:t[0])};return o(t),function(){return a(t)}}))}function Je(e,t){return function(r){return function(n){return e[r](t,n)}}}var Ye=function(e){function r(t,r){return e.call(this)||this}return t(r,e),r.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},r}(f),Xe={setInterval:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=Xe.delegate;return(null==i?void 0:i.setInterval)?i.setInterval.apply(i,o([e,t],s(r))):setInterval.apply(void 0,o([e,t],s(r)))},clearInterval:function(e){var t=Xe.delegate;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},Ze=function(e){function r(t,r){var n=e.call(this,t,r)||this;return n.scheduler=t,n.work=r,n.pending=!1,n}return t(r,e),r.prototype.schedule=function(e,t){var r;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.id,i=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(i,n,t)),this.pending=!0,this.delay=t,this.id=null!==(r=this.id)&&void 0!==r?r:this.requestAsyncId(i,this.id,t),this},r.prototype.requestAsyncId=function(e,t,r){return void 0===r&&(r=0),Xe.setInterval(e.flush.bind(e,this),r)},r.prototype.recycleAsyncId=function(e,t,r){if(void 0===r&&(r=0),null!=r&&this.delay===r&&!1===this.pending)return t;null!=t&&Xe.clearInterval(t)},r.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(e,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},r.prototype._execute=function(e,t){var r,n=!1;try{this.work(e)}catch(e){n=!0,r=e||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),r},r.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,r=this.scheduler,n=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,h(n,this),null!=t&&(this.id=this.recycleAsyncId(r,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},r}(Ye),et={now:function(){return(et.delegate||Date).now()},delegate:void 0},tt=function(){function e(t,r){void 0===r&&(r=e.now),this.schedulerActionCtor=t,this.now=r}return e.prototype.schedule=function(e,t,r){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},e.now=et.now,e}(),rt=new(function(e){function r(t,r){void 0===r&&(r=tt.now);var n=e.call(this,t,r)||this;return n.actions=[],n._active=!1,n}return t(r,e),r.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var r;this._active=!0;do{if(r=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,r){for(;e=t.shift();)e.unsubscribe();throw r}}},r}(tt))(Ze),nt=rt;function it(e){return e instanceof Date&&!isNaN(e)}function st(e,t,r){void 0===e&&(e=0),void 0===r&&(r=nt);var n=-1;return null!=t&&($e(t)?r=t:n=t),new B((function(t){var i=it(e)?+e-r.now():e;i<0&&(i=0);var s=0;return r.schedule((function(){t.closed||(t.next(s++),0<=n?this.schedule(void 0,n):t.complete())}),i)}))}function ot(e,t){var r="object"==typeof t;return new Promise((function(n,i){var s,o=!1;e.subscribe({next:function(e){s=e,o=!0},error:i,complete:function(){o?n(s):r?n(t.defaultValue):i(new ze)}})}))}function at(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=xe(e),n=Re(e,1/0),i=e;return i.length?1===i.length?oe(i[0]):Ue(n)(_e(i,r)):Ve}var ct=new B(_);function ut(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=xe(e);return _e(e,r)}var lt=Array.isArray;function pt(e){return 1===e.length&&lt(e[0])?e[0]:e}function dt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 1===(e=pt(e)).length?oe(e[0]):new B(ht(e))}function ht(e){return function(t){for(var r=[],n=function(n){r.push(oe(e[n]).subscribe(le(t,(function(e){if(r){for(var i=0;i<r.length;i++)i!==n&&r[i].unsubscribe();r=null}t.next(e)}))))},i=0;r&&!t.closed&&i<e.length;i++)n(i)}}var ft=function(e){function r(t,r,n){void 0===t&&(t=1/0),void 0===r&&(r=1/0),void 0===n&&(n=et);var i=e.call(this)||this;return i._bufferSize=t,i._windowTime=r,i._timestampProvider=n,i._buffer=[],i._infiniteTimeWindow=!0,i._infiniteTimeWindow=r===1/0,i._bufferSize=Math.max(1,t),i._windowTime=Math.max(1,r),i}return t(r,e),r.prototype.next=function(t){var r=this,n=r.isStopped,i=r._buffer,s=r._infiniteTimeWindow,o=r._timestampProvider,a=r._windowTime;n||(i.push(t),!s&&i.push(o.now()+a)),this._trimBuffer(),e.prototype.next.call(this,t)},r.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),r=this._infiniteTimeWindow,n=this._buffer.slice(),i=0;i<n.length&&!e.closed;i+=r?1:2)e.next(n[i]);return this._checkFinalizedStatuses(e),t},r.prototype._trimBuffer=function(){var e=this,t=e._bufferSize,r=e._timestampProvider,n=e._buffer,i=e._infiniteTimeWindow,s=(i?1:2)*t;if(t<1/0&&s<n.length&&n.splice(0,n.length-s),!i){for(var o=r.now(),a=0,c=1;c<n.length&&n[c]<=o;c+=2)a=c;a&&n.splice(0,a+1)}},r}(V);function bt(e){var t;void 0===e&&(e=1/0);var r=(t=e&&"object"==typeof e?e:{count:e}).count,n=void 0===r?1/0:r,i=t.delay,s=t.resetOnSuccess,o=void 0!==s&&s;return n<=0?U:ue((function(e,t){var r,s=0,a=function(){var c=!1;r=e.subscribe(le(t,(function(e){o&&(s=0),t.next(e)}),void 0,(function(e){if(s++<n){var o=function(){r?(r.unsubscribe(),r=null,a()):c=!0};if(null!=i){var u="number"==typeof i?st(i):oe(i(e,s)),l=le(t,(function(){l.unsubscribe(),o()}),(function(){t.complete()}));u.subscribe(l)}else o()}else t.error(e)}))),c&&(r.unsubscribe(),r=null,a())};a()}))}function gt(e,t){return ue((function(r,n){var i=null,s=0,o=!1,a=function(){return o&&!i&&n.complete()};r.subscribe(le(n,(function(r){null==i||i.unsubscribe();var o=0,c=s++;oe(e(r,c)).subscribe(i=le(n,(function(e){return n.next(t?t(r,e,c,o++):e)}),(function(){i=null,a()})))}),(function(){o=!0,a()})))}))}function mt(e,t){var r=l(e)?e:function(){return e},n=function(e){return e.error(r())};return new B(t?function(e){return t.schedule(n,0,e)}:n)}var yt,vt,wt,_t,Et,St,It,$t,Ct,Tt,xt=p((function(e){return function(t){void 0===t&&(t=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}}));function Rt(e,t){var r=it(e)?{first:e}:"number"==typeof e?{each:e}:e,n=r.first,i=r.each,s=r.with,o=void 0===s?Ot:s,a=r.scheduler,c=void 0===a?null!=t?t:rt:a,u=r.meta,l=void 0===u?null:u;if(null==n&&null==i)throw new TypeError("No timeout provided.");return ue((function(e,t){var r,s,a=null,u=0,p=function(e){s=ce(t,c,(function(){try{r.unsubscribe(),oe(o({meta:l,lastValue:a,seen:u})).subscribe(t)}catch(e){t.error(e)}}),e)};r=e.subscribe(le(t,(function(e){null==s||s.unsubscribe(),u++,t.next(a=e),i>0&&p(i)}),void 0,void 0,(function(){(null==s?void 0:s.closed)||null==s||s.unsubscribe(),a=null}))),!u&&p(null!=n?"number"==typeof n?n:+n-c.now():i)}))}function Ot(e){throw new xt(e)}function Mt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Te(e);return ue((function(t,n){for(var i=e.length,a=new Array(i),c=e.map((function(){return!1})),u=!1,l=function(t){oe(e[t]).subscribe(le(n,(function(e){a[t]=e,u||c[t]||(c[t]=!0,(u=c.every(U))&&(c=null))}),_))},p=0;p<i;p++)l(p);t.subscribe(le(n,(function(e){if(u){var t=o([e],s(a));n.next(r?r.apply(void 0,o([],s(t))):t)}})))}))}function At(e,t){return void 0===t&&(t=rt),r=function(){return st(e,t)},ue((function(e,t){var n=!1,i=null,s=null,o=!1,a=function(){if(null==s||s.unsubscribe(),s=null,n){n=!1;var e=i;i=null,t.next(e)}o&&t.complete()},c=function(){s=null,o&&t.complete()};e.subscribe(le(t,(function(e){n=!0,i=e,s||oe(r(e)).subscribe(s=le(t,a,c))}),(function(){o=!0,(!n||!s||s.closed)&&t.complete()})))}));var r}function Nt(e){return ue((function(t,r){var n,i=null,s=!1;i=t.subscribe(le(r,void 0,void 0,(function(o){n=oe(e(o,Nt(e)(t))),i?(i.unsubscribe(),i=null,n.subscribe(r)):s=!0}))),s&&(i.unsubscribe(),i=null,n.subscribe(r))}))}function Pt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Te(e);return r?D(Pt.apply(void 0,o([],s(e))),Ie(r)):ue((function(t,r){Ae(o([t],s(pt(e))))(r)}))}function kt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Pt.apply(void 0,o([],s(e)))}function Ut(e,t){return void 0===t&&(t=U),e=null!=e?e:Dt,ue((function(r,n){var i,s=!0;r.subscribe(le(n,(function(r){var o=t(r);!s&&e(i,o)||(s=!1,i=o,n.next(r))})))}))}function Dt(e,t){return e===t}function Lt(e,t,r){return void 0===t&&(t=1/0),t=(t||0)<1?1/0:t,ue((function(n,i){return Pe(n,i,e,t,void 0,!0,r)}))}function Bt(e){return ue((function(t,r){try{t.subscribe(r)}finally{r.add(e)}}))}function qt(e){return e<=0?function(){return Ve}:ue((function(t,r){var n=0;t.subscribe(le(r,(function(t){++n<=e&&(r.next(t),e<=n&&r.complete())})))}))}function jt(e){return ue((function(t,r){var n=!1;t.subscribe(le(r,(function(e){n=!0,r.next(e)}),(function(){n||r.next(e),r.complete()})))}))}function Vt(e){return void 0===e&&(e=Ft),ue((function(t,r){var n=!1;t.subscribe(le(r,(function(e){n=!0,r.next(e)}),(function(){return n?r.complete():r.error(e())})))}))}function Ft(){return new ze}function zt(e,t){var r=arguments.length>=2;return function(n){return n.pipe(e?Fe((function(t,r){return e(t,r,n)})):U,qt(1),r?jt(t):Vt((function(){return new ze})))}}function Wt(e){void 0===e&&(e={});var t=e.connector,r=void 0===t?function(){return new V}:t,n=e.resetOnError,i=void 0===n||n,s=e.resetOnComplete,o=void 0===s||s,a=e.resetOnRefCountZero,c=void 0===a||a;return function(e){var t,n,s,a=0,u=!1,l=!1,p=function(){null==n||n.unsubscribe(),n=void 0},d=function(){p(),t=s=void 0,u=l=!1},h=function(){var e=t;d(),null==e||e.unsubscribe()};return ue((function(e,f){a++,l||u||p();var b=s=null!=s?s:r();f.add((function(){0!==--a||l||u||(n=Ht(h,c))})),b.subscribe(f),!t&&a>0&&(t=new M({next:function(e){return b.next(e)},error:function(e){l=!0,p(),n=Ht(d,i,e),b.error(e)},complete:function(){u=!0,p(),n=Ht(d,o),b.complete()}}),oe(e).subscribe(t))}))(e)}}function Ht(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];if(!0!==t){if(!1!==t){var i=new M({next:function(){i.unsubscribe(),e()}});return t.apply(void 0,o([],s(r))).subscribe(i)}}else e()}function Kt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=xe(e);return ue((function(t,n){(r?Le(e,t,r):Le(e,t)).subscribe(n)}))}function Gt(e){return ue((function(t,r){oe(e).subscribe(le(r,(function(){return r.complete()}),_)),!r.closed&&t.subscribe(r)}))}function Qt(e,t){return void 0===t&&(t=!1),ue((function(r,n){var i=0;r.subscribe(le(n,(function(r){var s=e(r,i++);(s||t)&&n.next(r),!s&&n.complete()})))}))}function Jt(e,t,r){var n=l(e)||t||r?{next:e,error:t,complete:r}:e;return n?ue((function(e,t){var r;null===(r=n.subscribe)||void 0===r||r.call(n);var i=!0;e.subscribe(le(t,(function(e){var r;null===(r=n.next)||void 0===r||r.call(n,e),t.next(e)}),(function(){var e;i=!1,null===(e=n.complete)||void 0===e||e.call(n),t.complete()}),(function(e){var r;i=!1,null===(r=n.error)||void 0===r||r.call(n,e),t.error(e)}),(function(){var e,t;i&&(null===(e=n.unsubscribe)||void 0===e||e.call(n)),null===(t=n.finalize)||void 0===t||t.call(n)})))})):U}function Yt(e){return Array.from(e.entries()).reduce(((e,[t,r])=>(e[t]=r,e)),{})}(vt=yt||(yt={})).orElse=function(e,t){return void 0!==e?e:"function"==typeof t?t():t},vt.orElseThrow=function(e,t){if(void 0!==e)return e;throw t()},(_t=wt||(wt={})).coerce=function(e,t){return null==e?yt.orElse(t&&t.coerceNullOrUndefined,!0)?[]:e:Array.isArray(e)?e:[e]},_t.isEqual=function(e,t,r){if(e===t)return!0;if(!e||!t)return!1;if(e.length!==t.length)return!1;const n=yt.orElse(r&&r.exactOrder,!0);return e.every(((e,r)=>n?e===t[r]:t.includes(e)))},_t.remove=function(e,t,r){const n=yt.orElse(r&&r.firstOnly,!1),i=(()=>{if("function"==typeof t){const r=t;return()=>e.findIndex(r)}return()=>e.indexOf(t)})(),s=[];for(let t=i();-1!==t&&(s.push(...e.splice(t,1)),!n);t=i());return s},_t.distinct=function(e,t=U){const r=new Set(e.map(t));return e.filter((e=>r.delete(t(e))))},_t.intersect=function(...e){const t=e.filter((e=>null!=e));if(!t.length)return[];const r=t.pop();return t.reduce(((e,t)=>e.filter((e=>t.includes(e)))),[...r])},_t.last=function(e,t){if(e){if(!t)return e[e.length-1];for(let r=e.length-1;r>=0;r--)if(t(e[r]))return e[r]}},(Et||(Et={})).isEqual=function(e,t){return e===t||!(!e||!t)&&Object.keys(e).length===Object.keys(t).length&&Object.entries(e).every((([e,r])=>t[e]===r))},(It=St||(St={})).coerce=function(e,t){if(null==e)return yt.orElse(t&&t.coerceNullOrUndefined,!0)?{}:e;if(e instanceof Map)return Yt(e);try{return Yt(new Map(e))}catch{}return e},It.withoutUndefinedEntries=function(e){return Object.entries(e).reduce(((e,[t,r])=>(void 0!==r&&(e[t]=r),e)),{})},(Ct=$t||($t={})).coerce=function(e,t){if(null==e)return yt.orElse(t&&t.coerceNullOrUndefined,!0)?new Map:e;if(e instanceof Map)return e;try{return new Map(e)}catch{}return Object.entries(e).reduce(((e,[t,r])=>e.set(t,r)),new Map)},Ct.addSetValue=function(e,t,r){const n=e.get(t)||new Set;return e.set(t,n.add(r))},Ct.removeSetValue=function(e,t,r){const n=e.get(t)||new Set;let i;if("function"==typeof r){const e=r;i=Array.from(n).filter(e).reduce(((e,t)=>n.delete(t)||e),!1)}else i=n.delete(r);return i&&!n.size&&e.delete(t),i},Ct.addListValue=function(e,t,r){const n=e.get(t)||[];return e.set(t,n.concat(r))},Ct.removeListValue=function(e,t,r){const n=e.get(t)||[],i=wt.remove(n,r,{firstOnly:!1}).length>0;return i&&!n.length&&e.delete(t),i},(Tt||(Tt={})).coerce=function(e){return e instanceof B?e:e instanceof Promise?_e(e):ut(e)};const Xt=new class{constructor(){this._beanRegistry=new Map,this._decoratorRegistry=new Map,this._initializers=[],this._sequence=0,this._runlevel$=new W(-1),this._eagerBeansConstructed=!1,this._started=!1}register(e,t){if(!e)throw Error("[BeanRegisterError] Missing bean lookup symbol.");t&&function(e){return Object.keys(e).some((e=>e.startsWith("use")))}(t)||(t={...t,useClass:e}),tr(e,t);const r=yt.orElse(t.multi,!1);if(r&&this._beanRegistry.has(e)&&Array.from(this._beanRegistry.get(e)).some((e=>!e.multi)))throw Error("[BeanRegisterError] Trying to register a bean as 'multi-bean' on a symbol that has already registered a 'non-multi-bean'. This is probably not what was intended.");if(!r&&this._beanRegistry.has(e)&&Array.from(this._beanRegistry.get(e)).some((e=>e.multi)))throw Error("[BeanRegisterError] Trying to register a bean on a symbol that has already registered a 'multi-bean'. This is probably not what was intended.");!r&&this._beanRegistry.has(e)&&this.disposeBean(this._beanRegistry.get(e).values().next().value);const n={symbol:e,beanConstructFn:er(t),eager:yt.orElse(t.eager||void 0!==t.useValue,!1),multi:r,instructions:t,constructing:!1};if(r){const t=this._beanRegistry.get(e)||new Set;this._beanRegistry.set(e,t.add(n))}else this._beanRegistry.set(e,new Set([n]));return n.eager&&this._eagerBeansConstructed&&this.getOrConstructBeanInstance(n),{unregister:()=>this.disposeBean(n)}}registerIfAbsent(e,t){if(!e)throw Error("[BeanRegisterError] Missing bean lookup symbol.");return this._beanRegistry.has(e)?{unregister:_}:this.register(e,t)}registerDecorator(e,t){if(this._started)throw Error("[BeanManagerLifecycleError] Decorators can only be registered before starting the bean manager.");if(!e)throw Error("[BeanDecoratorRegisterError] A decorator requires a symbol.");tr(e,t);const r=er(t)();$t.addListValue(this._decoratorRegistry,e,r)}registerInitializer(e){if(this._started)throw Error("[BeanManagerLifecycleError] Initializers can only be registered before starting the bean manager.");const t=(()=>{if("function"==typeof e)return{fn:e};if(void 0!==e.runlevel&&e.runlevel<0)throw Error(`[InitializerRegisterError] The runlevel of an initializer must be >= 0, but was ${e.runlevel}.`);if(e.useFunction)return{fn:e.useFunction,runlevel:e.runlevel};if(e.useClass){const t=e.useClass;return{fn:()=>(new t).init(),runlevel:e.runlevel}}if(e.useExisting){const t=e.useExisting;return{fn:()=>Xt.get(t).init(),runlevel:e.runlevel}}throw Error("[NullInitializerError] No initializer specified.")})();this._initializers.push(t)}get(e,t){const r=this.all(e);switch(r.length){case 0:if(void 0!==t?.orElseGet)return t.orElseGet;if(t?.orElseSupply)return t.orElseSupply();throw Error(`[NullBeanError] No bean registered under the symbol '${rr(e)}'.`);case 1:return r[0];default:throw Error(`[MultiBeanError] Multiple beans registered under the symbol '${rr(e)}'.`)}}opt(e){return this.get(e,{orElseSupply:()=>{}})}all(e){const t=Array.from(this._beanRegistry.get(e)||new Set);if(!t||!t.length)return[];if(t.some((e=>e.constructing)))throw Error(`[BeanConstructError] Circular bean construction cycle detected [bean={${rr(e)}}].`);return t.map((e=>this.getOrConstructBeanInstance(e)))}async start(e){if(this._started)throw Error("[BeanManagerLifecycleError] Bean manager already started.");const t=e?.initializerDefaultRunlevel??0,r=e?.eagerBeanConstructRunlevel??(()=>0===this._initializers.length?t+1:Math.max(...this._initializers.map((e=>e.runlevel??t)))+1)();this.registerInitializer({useFunction:async()=>{this.constructEagerBeans(),this._eagerBeansConstructed=!0},runlevel:r}),await this.runInitializers(t),this._started=!0}destroy(){this.getBeanInfos().sort(Zt).forEach((e=>this.disposeBean(e))),this._beanRegistry.clear(),this._decoratorRegistry.clear(),this._initializers.length=0,this._runlevel$.next(-1),this._eagerBeansConstructed=!1,this._started=!1}disposeBean(e){if((e.instructions.useClass||e.instructions.useFactory)&&e.instance&&"function"==typeof e.instance.preDestroy)try{e.instance.preDestroy()}catch(e){console?.error("Bean threw an error in `preDestroy`",e)}e.instance=void 0,e.constructing=!1,$t.removeSetValue(this._beanRegistry,e.symbol,e)}async whenRunlevel(e){return We(this._runlevel$.pipe(Fe((t=>t>=e)))).then((()=>Promise.resolve()))}getBeanInfos(){return Array.from(this._beanRegistry.values()).reduce(((e,t)=>e.concat(Array.from(t))),[])}async runInitializers(e){const t=this._initializers.reduce(((t,r)=>$t.addListValue(t,r.runlevel??e,r.fn)),new Map),r=Array.from(t.keys()).sort(((e,t)=>e-t));for(const e of r){this._runlevel$.next(e);try{await Promise.all(t.get(e).map((e=>e())))}catch(t){throw Error(`[InitializerError] Initializer rejected with an error: ${t} [runlevel=${e}]`)}}}constructEagerBeans(){this.getBeanInfos().filter((e=>e.eager)).forEach((e=>this.getOrConstructBeanInstance(e)))}getOrConstructBeanInstance(e){if(e.instance)return e.instance;e.constructing=!0;try{const t=e.beanConstructFn(),r=this._decoratorRegistry.get(e.symbol)||[];return e.instance=[...r].reverse().reduce(((e,t)=>t.decorate(e)),t),e.constructInstant=++this._sequence,e.instance}finally{e.constructing=!1}}};function Zt(e,t){return(e.instructions.destroyOrder??0)<(t.instructions.destroyOrder??0)?-1:(e.instructions.destroyOrder??0)>(t.instructions.destroyOrder??0)?1:(t.constructInstant??0)-(e.constructInstant??0)}function er(e){if(void 0!==e.useValue){const t=e.useValue;return()=>t}if(e.useClass){const t=e.useClass;return()=>new t}if(e.useFactory){const t=e.useFactory;return()=>t()}if(e.useExisting){const t=e.useExisting;return()=>Xt.get(t)}throw Error("[BeanConstructError] Missing bean construction strategy")}function tr(e,t){switch(Object.keys(t).filter((e=>e.startsWith("use"))).length){case 0:throw Error(`[BeanRegisterError] Missing bean construction strategy. Expected one of 'useValue', 'useClass', 'useFactory' or 'useExisting' [bean=${e.toString()}, instructions=${JSON.stringify(t)}]`);case 1:break;default:throw Error(`[BeanRegisterError] Multiple bean construction strategies specified. Expected one of 'useValue', 'useClass', 'useFactory' or 'useExisting' [bean=${e.toString()}, instructions=${JSON.stringify(t)}]`)}if(Object.keys(t).includes("useValue")&&void 0===t.useValue)throw Error(`[BeanRegisterError] Passing \`undefined\` as bean value is not supported [bean=${e.toString()}].`)}function rr(e){return"function"==typeof e?e.name:e.toString()}class nr{constructor(){}static randomUUID(){let e=Date.now();return"undefined"!=typeof window&&void 0!==window.performance&&"function"==typeof window.performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?r:3&r|8).toString(16)}))}}function ir(e){return e?gt((t=>{if(!t.length)return ut([]);const r=t.map(e);return r.every((e=>"boolean"==typeof e))?ut(t.filter(((e,t)=>r[t]))):Me(r.map((e=>Tt.coerce(e).pipe(jt(!1),Nt((()=>ut(!1))))))).pipe(Ut(((e,t)=>wt.isEqual(e,t))),Ee((e=>t.filter(((t,r)=>e[r])))))})):U}function sr(e){return Ee((t=>t.map((t=>e(t)))))}function or(e){const t=_e(e).pipe(qt(1),ke((()=>Ve)),Wt({resetOnComplete:!1,resetOnError:!1,resetOnRefCountZero:!1}));return ke((e=>Le(t,ut(e))))}function ar(e){return new B((t=>{const r=new ResizeObserver((()=>{return t.next({clientWidth:(r=e).clientWidth,offsetWidth:r.offsetWidth,clientHeight:r.clientHeight,offsetHeight:r.offsetHeight,element:r});var r}));return r.observe(e),()=>{r.disconnect()}}))}var cr,ur;(ur=cr||(cr={})).Activator="activator",ur.Microfrontend="microfrontend";const lr=Symbol("IS_PLATFORM_HOST"),pr=Symbol("APP_IDENTITY"),dr=Symbol("ɵVERSION"),hr=Symbol("ɵWINDOW_TOP"),fr="ɵACTIVATION_CONTEXT";var br,gr,mr,yr,vr,wr,_r,Er,Sr,Ir,$r,Cr,Tr;function xr(){return D(ke((e=>{var t;const r=null!==(t=e.headers.get(br.Status))&&void 0!==t?t:vr.OK;if(r<400)return ut(e);if("string"==typeof e.body){const t=e.body;return mt((()=>new Or(t,r,e)))}switch(r){case vr.BAD_REQUEST:return mt((()=>new Or("The receiver could not understand the request due to invalid syntax.",r,e)));case vr.NOT_FOUND:return mt((()=>new Or("The receiver could not find the requested resource.",r,e)));case vr.ERROR:return mt((()=>new Or("The receiver encountered an internal error.",r,e)));default:return mt((()=>new Or("Request error.",r,e)))}})),Qt((e=>e.headers.get(br.Status)!==vr.TERMINAL),!0),Fe((e=>!(e.headers.get(br.Status)===vr.TERMINAL)||void 0!==e.body)))}function Rr(){return Ee((e=>e.body))}(gr=br||(br={})).ClientId="ɵCLIENT_ID",gr.AppSymbolicName="ɵAPP_SYMBOLIC_NAME",gr.MessageId="ɵMESSAGE_ID",gr.ReplyTo="ɵREPLY_TO",gr.Timestamp="ɵTIMESTAMP",gr.Version="ɵVERSION",gr.Method="ɵMETHOD",gr.Status="ɵSTATUS",gr["ɵSubscriberId"]="ɵSUBSCRIBER_ID",(yr=mr||(mr={})).GET="GET",yr.DELETE="DELETE",yr.PUT="PUT",yr.POST="POST",yr.OBSERVE="OBSERVE",(wr=vr||(vr={}))[wr.OK=200]="OK",wr[wr.TERMINAL=250]="TERMINAL",wr[wr.BAD_REQUEST=400]="BAD_REQUEST",wr[wr.NOT_FOUND=404]="NOT_FOUND",wr[wr.ERROR=500]="ERROR";class Or extends Error{constructor(e,t,r){super(e),this.status=t,this.msg=r,this.name="RequestError"}}class Mr{}function Ar(e){return Gt(Xt.get(Mr).subscriberCount$(e).pipe(zt((e=>0===e))))}(Er=_r||(_r={})).ClientToBroker="sci://microfrontend-platform/client-to-broker",Er.BrokerToClient="sci://microfrontend-platform/broker-to-client",Er.MicrofrontendToOutlet="sci://microfrontend-platform/microfrontend-to-outlet",(Ir=Sr||(Sr={})).TopicSubscribe="topic-subscribe",Ir.TopicUnsubscribe="topic-unsubscribe",Ir.IntentSubscribe="intent-subscribe",Ir.IntentUnsubscribe="intent-unsubscribe",Ir.Topic="topic",Ir.Intent="intent",Ir.ClientConnect="client-connect",Ir.ClientDisconnect="client-disconnect",(Cr=$r||($r={})).RequestSubscriberCount="ɵREQUEST_SUBSCRIBER_COUNT",Cr.FocusIn="ɵFOCUS_IN",Cr.IsFocusWithin="ɵIS_FOCUS_WITHIN",Cr.HasFocus="ɵHAS_FOCUS",Cr.PlatformProperties="ɵPLATFORM_PROPERTIES",Cr.Applications="ɵAPPLICATIONS",Cr.ping=function(e){return`ɵclient/${e}/ping`},function(e){function t(e){return e.startsWith(":")&&e.length>1}function r(e){var t;return null!==(t=null==e?void 0:e.split("/").filter(Boolean))&&void 0!==t?t:[]}e.containsWildcardSegments=function(e){return r(e).some(t)},e.containsEmptySegments=function(e){return e.split("/").some((e=>!e.length))},e.isWildcardSegment=t,e.split=r,e.computeWildcardSegmentPermutations=function t(r,n){const i="string"==typeof r?e.split(r):r;return 1===i.length?[i[0],n]:t(i.slice(1),n).reduce(((e,t)=>(e.push(`${i[0]}/${t}`),e.push(`${n}/${t}`),e)),new Array)},e.replaceWildcardSegments=function(e,t){return e.replace(/:[^/]+/g,t)},e.validateTopic=function(t,r){return t?e.containsEmptySegments(t)?Error(`[IllegalTopicError] Topic must not contain empty segments [topic='${t}']`):r.exactTopic&&e.containsWildcardSegments(t)?Error(`[IllegalTopicError] Topic must be exact, i.e., not contain wildcard segments [topic='${t}']`):null:Error("[IllegalTopicError] Topic must not be `null`, `undefined` or empty")}}(Tr||(Tr={}));class Nr{constructor(e){if(this._patternSegments=Tr.split(e),!this._patternSegments.length)throw Error("[TopicMatcherError] Invalid pattern syntax. The pattern must consist of one or more topic segments, each separated by a forward slash.")}match(e){const t=Tr.split(e),r=this._patternSegments;if(!t.length)throw Error("[TopicMatcherError] Invalid topic. The topic must consist of one or more segments, each separated by a forward slash.");if(t.some(Tr.isWildcardSegment))throw Error("[TopicMatcherError] Invalid topic. Wildcard segments not allowed in an exact topic.");return r.length!==t.length?{matches:!1}:wt.isEqual(t,r,{exactOrder:!0})?{matches:!0,params:new Map}:r.some(Tr.isWildcardSegment)&&r.every(((e,r)=>e===t[r]||Tr.isWildcardSegment(e)))?{matches:!0,params:r.reduce(((e,r,n)=>Tr.isWildcardSegment(r)?e.set(r.substring(1),t[n]):e),new Map)}:{matches:!1}}}function Pr(e){return Fe((t=>{var r;const n=t.data;return(null==n?void 0:n.transport)===e&&!!n.channel&&!!(null===(r=n.message)||void 0===r?void 0:r.headers)}))}function kr(...e){const t=new Set(wt.coerce(e));return Fe((e=>t.has(e.data.channel)))}function Ur(e){return D(kr(Sr.Topic),Fe((t=>{const r=t.data.message.topic;return!!r&&new Nr(e).match(r).matches})))}function Dr(e){return Fe((t=>{const r=t.data.message.headers;return r.has(e.name)&&r.get(e.name)===e.value}))}function Lr(){return Ee((e=>e.data.message))}class Br{}class qr{debug(e,...t){this.log("debug",e,t)}info(e,...t){this.log("info",e,t)}warn(e,...t){this.log("warn",e,t)}error(e,...t){this.log("error",e,t)}log(e,t,r){const n=r[0]instanceof Vr?r.shift():{appSymbolicName:Xt.get(pr),version:Xt.get(dr)},i=(new Array).concat(n.version?`[@scion/microfrontend-platform@${n.version}]`:"[@scion/microfrontend-platform]").concat(`[${n.appSymbolicName}]`).join("");if(console&&"function"==typeof console[e]){const n=console[e];(null==r?void 0:r.length)?n(`${i} ${t}`,...r):n(`${i} ${t}`)}}}const jr=new class extends Br{debug(e,...t){}info(e,...t){}warn(e,...t){}error(e,...t){}};class Vr{constructor(e,t){this.appSymbolicName=e,this.version=t}}var Fr,zr,Wr,Hr,Kr,Gr;(zr=Fr||(Fr={}))[zr.Starting=1]="Starting",zr[zr.Started=2]="Started",zr[zr.Stopping=3]="Stopping",zr[zr.Stopped=4]="Stopped",(Hr=Wr||(Wr={}))[Hr.Zero=0]="Zero",Hr[Hr.One=1]="One",Hr[Hr.Two=2]="Two",Hr[Hr.Three=3]="Three";class Qr{}function Jr(e){var t;let r;try{r=e()}catch(e){return void(null===(t=Xt.opt(Br))||void 0===t||t.error("[UnexpectedError] An unexpected error occurred.",e))}return r instanceof Promise?r.catch((e=>{var t;null===(t=Xt.opt(Br))||void 0===t||t.error("[UnexpectedError] An unexpected error occurred.",e)})):r}function Yr(e){return e instanceof Error?e.message:`${e}`}class Xr{}function Zr(){return e=>{var t,r;return null!==(r=null===(t=Xt.opt(Xr))||void 0===t?void 0:t.decorate$(e))&&void 0!==r?r:e}}class en{}class tn{constructor(){console.log("[NullBrokerGateway] Using 'NullBrokerGateway'. Messages cannot be sent or received.")}isConnected(){return Promise.resolve(!0)}get message$(){return ct}postMessage(e,t){return r(this,void 0,void 0,(function*(){return Promise.resolve()}))}requestReply$(e,t){return ct}subscribe$(e){return ct}}class rn{constructor(e){var t,r;this._platformStopping$=new ft(1),this._session=null,this._session$=new z,this._message$=new V,this._appSymbolicName=Xt.get(pr),this._brokerDiscoverTimeout=null!==(t=null==e?void 0:e.brokerDiscoverTimeout)&&void 0!==t?t:1e4,this._messageDeliveryTimeout=null!==(r=null==e?void 0:e.messageDeliveryTimeout)&&void 0!==r?r:1e4}init(){return r(this,void 0,void 0,(function*(){try{const e=yield this.connectToBroker();this.installBrokerMessageListener(e),this.installPingReplier(e),this._session=e,this._session$.next(e),this._session$.complete()}catch(e){throw this._session$.error(e),e}}))}isConnected(){return ot(this._session$).then((()=>!0)).catch((()=>!1))}get session(){return this._session}postMessage(e,t){return r(this,void 0,void 0,(function*(){if(nn())throw Kr.PLATFORM_STOPPED_ERROR;const r=this._session||(yield ot(this._session$)),n=nr.randomUUID(),i={transport:_r.ClientToBroker,channel:e,message:t};i.message.headers.set(br.MessageId,n).set(br.Timestamp,Date.now()).set(br.AppSymbolicName,this._appSymbolicName).set(br.ClientId,r.clientId);const s=new V,o=new Promise(((e,t)=>{at(this._message$,s).pipe(Ur(n),qt(1),Lr(),Rt({first:this._messageDeliveryTimeout,with:()=>mt((()=>Kr.MESSAGE_DISPATCH_ERROR(this._messageDeliveryTimeout,i)))}),ke((e=>e.body.ok?Ve:mt((()=>Error(e.body.details))))),Gt(this._platformStopping$)).subscribe({error:t,complete:e})}));try{r.broker.window.postMessage(i,r.broker.origin)}catch(e){s.error(e)}yield o}))}requestReply$(e,t){return new B((r=>{if(nn())return r.error(Kr.PLATFORM_STOPPED_ERROR),_;const n=nr.randomUUID(),i=nr.randomUUID(),s=new V,o=new V;return t.headers.set(br.ReplyTo,n).set(br.ɵSubscriberId,i),at(this._message$,o).pipe(kr(Sr.Topic),Dr({name:br.ɵSubscriberId,value:i}),Lr(),Zr(),Gt(at(this._platformStopping$,s)),Bt((()=>this.unsubscribe({unsubscribeChannel:Sr.TopicUnsubscribe,subscriberId:i,logContext:`[subscriberId=${i}, topic=${n}]`})))).subscribe({next:e=>r.next(e),error:e=>r.error(e),complete:_}),this.postMessage(e,t).catch((e=>o.error(e))),()=>s.next()}))}subscribe$(e){const{messageChannel:t,subscribeChannel:r,unsubscribeChannel:n,newSubscribeCommand:i}=e;return new B((e=>{if(nn())return e.error(Kr.PLATFORM_STOPPED_ERROR),_;const s=nr.randomUUID(),o=new V,a=new V;return at(this._message$,a).pipe(kr(t),Dr({name:br.ɵSubscriberId,value:s}),Lr(),Zr(),Gt(at(this._platformStopping$,o)),Bt((()=>this.unsubscribe({unsubscribeChannel:n,subscriberId:s,logContext:JSON.stringify(i(s))})))).subscribe({next:t=>e.next(t),error:t=>e.error(t),complete:_}),this.postMessage(r,i(s)).catch((e=>a.error(e))),()=>o.next()}))}unsubscribe(e){return r(this,void 0,void 0,(function*(){if(nn())return;const{unsubscribeChannel:t,subscriberId:r,logContext:n}=e,i={subscriberId:r,headers:new Map};try{yield this.postMessage(t,i)}catch(e){Xt.get(Br,{orElseGet:jr}).error(`[UnsubscribeError] Failed to unsubscribe from destination: '${n}'. Caused by: ${e}`)}}))}installBrokerMessageListener(e){var t,r;Qe(window,"message").pipe((r=e.broker.window,Fe((e=>e.source===r))),(t=e.broker.origin,Fe((e=>e.origin===t))),Pr(_r.BrokerToClient),Ee((e=>{const t=e.data;if(t.message.headers=new Map(t.message.headers||[]),t.channel===Sr.Intent){const e=t.message;e.intent.params=new Map(e.intent.params||[])}if(t.channel===Sr.Topic){const e=t.message;e.params=new Map(e.params||[])}return e})),Gt(this._platformStopping$)).subscribe(this._message$)}installPingReplier(e){Xt.get(lr)||Xt.get(Mr).observe$($r.ping(e.clientId)).pipe(Gt(this._platformStopping$)).subscribe((e=>Jr((()=>{const t=e.headers.get(br.ReplyTo);Xt.get(Mr).publish(t,void 0,{headers:(new Map).set(br.Status,vr.TERMINAL)}).then()}))))}connectToBroker(){const e=nr.randomUUID(),t=We(Qe(window,"message").pipe(Pr(_r.BrokerToClient),Ur(e),ke((e=>{const t=e.data.message.body;return"accepted"!==(null==t?void 0:t.returnCode)?mt((()=>{var e,r;return Error(`${null!==(e=null==t?void 0:t.returnMessage)&&void 0!==e?e:"UNEXPECTED: Empty broker discovery response"} [code: '${null!==(r=null==t?void 0:t.returnCode)&&void 0!==r?r:"n/a"}']`)})):ut({clientId:t.clientId,broker:{window:e.source,origin:e.origin}})})),Rt({first:this._brokerDiscoverTimeout,with:()=>mt((()=>Kr.BROKER_DISCOVER_ERROR(this._brokerDiscoverTimeout)))}),Jt({error:e=>Xt.get(Br,{orElseGet:jr}).error(Yr(e))}),Gt(this._platformStopping$))),r={transport:_r.ClientToBroker,channel:Sr.ClientConnect,message:{headers:(new Map).set(br.MessageId,nr.randomUUID()).set(br.Timestamp,Date.now()).set(br.AppSymbolicName,this._appSymbolicName).set(br.ReplyTo,e).set(br.Version,Xt.get(dr))}};if(Xt.get(lr))window.postMessage(r,window.origin);else if(window===Xt.get(hr)){const e=this.collectWindowHierarchy();st(0,25).pipe(Gt(t.catch((()=>null)))).subscribe((()=>{e.forEach((e=>e.postMessage(r,"*")))}))}else this.collectWindowHierarchy().forEach((e=>e.postMessage(r,"*")));return t}disconnectFromBroker(){if(!this._session)return;const e={transport:_r.ClientToBroker,channel:Sr.ClientDisconnect,message:{headers:(new Map).set(br.MessageId,nr.randomUUID()).set(br.Timestamp,Date.now()).set(br.AppSymbolicName,this._appSymbolicName).set(br.ClientId,this._session.clientId)}};try{this._session.broker.window.postMessage(e,this._session.broker.origin)}catch(e){Xt.get(Br,{orElseGet:jr}).warn(`[ClientDisconnectError] Failed to disconnect from the broker. Caused by: ${e}`)}}collectWindowHierarchy(){const e=[];for(let t=window;t!==Xt.get(hr);t=t.parent)e.unshift(t);return e.unshift(Xt.get(hr)),e}preDestroy(){this.disconnectFromBroker(),this._platformStopping$.next()}}function nn(){const e=Xt.opt(Qr);return!e||e.state>=Fr.Stopped}(Gr=Kr||(Kr={})).PLATFORM_STOPPED_ERROR=Error("[GatewayError] Platform is stopped. Messages cannot be published or received."),Gr.MESSAGE_DISPATCH_ERROR=function(e,t){return Error(`[GatewayError] No acknowledgement received within ${e}ms for a message sent to the broker. [msg=${r=t,JSON.stringify(r,((e,t)=>t instanceof Map?St.coerce(t):t))}]`);var r},Gr.BROKER_DISCOVER_ERROR=function(e){return Error(`[GatewayError] Message broker not discovered within ${e}ms. Messages cannot be published or received.`)};class sn{constructor(){this._properties=new Map}init(){return r(this,void 0,void 0,(function*(){if(Xt.get(en)instanceof tn)return;const e=Xt.get(Mr).observe$($r.PlatformProperties);this._properties=yield We(e.pipe(Rr(),Ee((e=>$t.coerce(e)))))}))}contains(e){return this._properties.has(e)}get(e,t){if(this._properties.has(e))return this._properties.get(e);if(void 0!==t)return t;throw Error(`[PropertyNotFoundError] No property of given name found [prop=${e}]`)}properties(){return this._properties}}class on{}class an{}const cn=/^http[s]?:\/\//;var un,ln;(ln=un||(un={})).isAbsoluteUrl=function(e){return"about:blank"===e||cn.test(e)},ln.newUrl=function(e,t){if(t){const r=new URL(t);return r.pathname&&!r.pathname.endsWith("/")&&(r.pathname+="/"),new URL(e,r)}return new URL(e)},ln.ensureTrailingSlash=function(e){return e.endsWith("/")?e:e+"/"};class pn{}class dn{constructor(){this._applications=new Map}registerApplication(e,t){var n,i,s,o,a;return r(this,void 0,void 0,(function*(){if(yt.orElseThrow(e.symbolicName,(()=>Error(`[ApplicationRegistrationError] Invalid application config. Missing required property 'symbolicName'. [appConfig="${JSON.stringify(e)}", manifest="${JSON.stringify(t)}"]`))),yt.orElseThrow(e.manifestUrl,(()=>Error(`[ApplicationRegistrationError] Invalid application config. Missing required property 'manifestUrl'. [appConfig="${JSON.stringify(e)}", manifest="${JSON.stringify(t)}"]`))),!dn.SYMBOLIC_NAME_REGEXP.test(e.symbolicName))throw Error(`[ApplicationRegistrationError] Symbolic name must be lowercase and contain alphanumeric and dash characters [symbolicName='${e.symbolicName}'].`);if(Array.from(this._applications.values()).some((t=>t.symbolicName===e.symbolicName)))throw Error(`[ApplicationRegistrationError] Symbolic name must be unique [symbolicName='${e.symbolicName}'].`);const r=this.computeBaseUrl(e,t);this._applications.set(e.symbolicName,{symbolicName:e.symbolicName,name:null!==(n=t.name)&&void 0!==n?n:e.symbolicName,baseUrl:r,manifestUrl:un.newUrl(e.manifestUrl,un.isAbsoluteUrl(e.manifestUrl)?e.manifestUrl:window.origin).toString(),manifestLoadTimeout:null!==(i=e.manifestLoadTimeout)&&void 0!==i?i:Xt.get(pn).manifestLoadTimeout,activatorLoadTimeout:null!==(s=e.activatorLoadTimeout)&&void 0!==s?s:Xt.get(pn).activatorLoadTimeout,allowedMessageOrigins:new Set(wt.coerce(e.secondaryOrigin)).add(un.newUrl(r).origin),scopeCheckDisabled:yt.orElse(e.scopeCheckDisabled,!1),intentionCheckDisabled:yt.orElse(e.intentionCheckDisabled,!1),intentionRegisterApiDisabled:yt.orElse(e.intentionRegisterApiDisabled,!0)});for(const r of null!==(o=t.capabilities)&&void 0!==o?o:[])try{yield Xt.get(an).registerCapability(r,e.symbolicName)}catch(t){Xt.get(Br).error(`[CapabilityRegisterError] Failed to register capability for application '${e.symbolicName}'. [capability=${JSON.stringify(r)}]`,t)}null===(a=t.intentions)||void 0===a||a.forEach((t=>{try{Xt.get(an).registerIntention(t,e.symbolicName)}catch(r){Xt.get(Br).error(`[IntentionRegisterError] Failed to register intention for application '${e.symbolicName}' [intention=${JSON.stringify(t)}].`,r)}}))}))}getApplication(e){return this._applications.get(e)}getApplications(){return Array.from(this._applications.values())}isScopeCheckDisabled(e){return yt.orElseThrow(this._applications.get(e),(()=>Error(`[NullApplicationError] No application registered under the symbolic name '${e}'.`))).scopeCheckDisabled}isIntentionRegisterApiDisabled(e){return yt.orElseThrow(this._applications.get(e),(()=>Error(`[NullApplicationError] No application registered under the symbolic name '${e}'.`))).intentionRegisterApiDisabled}isIntentionCheckDisabled(e){return yt.orElseThrow(this._applications.get(e),(()=>Error(`[NullApplicationError] No application registered under the symbolic name '${e}'.`))).intentionCheckDisabled}computeBaseUrl(e,t){const r=un.isAbsoluteUrl(e.manifestUrl)?un.newUrl(e.manifestUrl):un.newUrl(e.manifestUrl,window.origin);return t.baseUrl?un.isAbsoluteUrl(t.baseUrl)?un.ensureTrailingSlash(t.baseUrl):un.ensureTrailingSlash(un.newUrl(t.baseUrl,r.origin).toString()):un.ensureTrailingSlash(r.origin)}}dn.SYMBOLIC_NAME_REGEXP=/^[a-z0-9-]+$/;class hn{fetch(e,t){return fetch(e,t)}}class fn{fetch(e){var t;return r(this,void 0,void 0,(function*(){if(!e.symbolicName)throw Error("[ManifestFetchError] Invalid application config. Missing required property 'symbolicName'.");if(!e.manifestUrl)throw Error("[ManifestFetchError] Invalid application config. Missing required property 'manifestUrl'.");const r=_e(Xt.get(hn).fetch(e.manifestUrl)),n=null!==(t=e.manifestLoadTimeout)&&void 0!==t?t:Xt.get(pn).manifestLoadTimeout,i=yield We(r.pipe(n?Rt({first:n,with:()=>mt((()=>Error(`[ManifestFetchError] Failed to fetch manifest for application '${e.symbolicName}'. Timeout of ${n}ms elapsed.`)))}):U));if(!i.ok)throw Error(`[ManifestFetchError] Failed to fetch manifest for application '${e.symbolicName}'. Maybe the application is currently unavailable. [httpStatusCode=${i.status}, httpStatusText=${i.statusText}]`);return yield i.json()}))}}class bn{}class gn{constructor(){this._destroy$=new V,this._subscriptions=new Map,this._subscriptionsByApp=new Map,this._subscriptionsByClient=new Map,this._register$=new V,this._unregister$=new V,Xt.get(bn).unregister$.pipe(Gt(this._destroy$)).subscribe((e=>Jr((()=>{this.unregister({clientId:e.id})}))))}register(e){var t;this._subscriptions.set(e.subscriberId,e),$t.addSetValue(this._subscriptionsByApp,e.client.application.symbolicName,e),$t.addSetValue(this._subscriptionsByClient,e.client.id,e),null===(t=this.onRegister)||void 0===t||t.call(this,e),this._register$.next(e)}unregister(e){const t=this.subscriptions(e);t.forEach((e=>{var t;this._subscriptions.delete(e.subscriberId),$t.removeSetValue(this._subscriptionsByApp,e.client.application.symbolicName,e),$t.removeSetValue(this._subscriptionsByClient,e.client.id,e),null===(t=this.onUnregister)||void 0===t||t.call(this,e),e.notifyUnsubscribe()})),this._unregister$.next(t)}subscriptions(e){const t=null==e?void 0:e.subscriberId,r=null==e?void 0:e.clientId,n=null==e?void 0:e.appSymbolicName;return wt.intersect(t?this.subscriptionById(t):void 0,r?this.subscriptionsByClient(r):void 0,n?this.subscriptionsByApp(n):void 0,t||n||r?void 0:Array.from(this._subscriptions.values()))}subscriptionById(e){const t=this._subscriptions.get(e);return t?[t]:[]}subscriptionsByClient(e){const t=this._subscriptionsByClient.get(e);return t?Array.from(t):[]}subscriptionsByApp(e){const t=this._subscriptionsByApp.get(e);return t?Array.from(t):[]}get register$(){return this._register$}get unregister$(){return this._unregister$}preDestroy(){this._destroy$.next()}}class mn{constructor(e,t){this.subscriberId=e,this.client=t,this.whenUnsubscribe=new Promise((e=>this.notifyUnsubscribe=e))}}const yn=":ɵANY";class vn extends gn{constructor(){super(...arguments),this._subscriptionsByTopic=new Map}onRegister(e){const t=Tr.replaceWildcardSegments(e.topic,yn);$t.addSetValue(this._subscriptionsByTopic,t,e)}onUnregister(e){const t=Tr.replaceWildcardSegments(e.topic,yn);$t.removeSetValue(this._subscriptionsByTopic,t,e)}subscriptions(e){const t=null==e?void 0:e.topic,r=null==e?void 0:e.subscriberId,n=null==e?void 0:e.clientId,i=null==e?void 0:e.appSymbolicName;return wt.intersect(t?this.subscriptionsByTopic(t):void 0,r||i||n?super.subscriptions(e):void 0,r||i||n||t?void 0:super.subscriptions())}subscriptionsByTopic(e){const t=new Array;return Tr.computeWildcardSegmentPermutations(e,yn).forEach((e=>{t.push(...this._subscriptionsByTopic.get(e)||[])})),t}subscriptionCount$(e){const t=Tr.validateTopic(e,{exactTopic:!0});return t?mt((()=>t)):new B((t=>{const r=new V;let n=this.subscriptions({topic:e}).length;return t.next(n),this.register$.pipe(Fe((t=>t.matches(e))),Gt(r)).subscribe((()=>{n++,t.next(n)})),this.unregister$.pipe(ir((t=>t.matches(e))),Fe((e=>e.length>0)),Gt(r)).subscribe((e=>{n-=e.length,t.next(n)})),()=>r.next()}))}}class wn extends mn{constructor(e,t,r){super(t,r),this.topic=e}matches(e){return e===this.topic||new Nr(this.topic).match(e).matches}}class _n{}class En{}function Sn(e,t){const r=new class extends In{handle(e){return t(e)}},n=e.reduceRight(((e,t)=>new class extends In{handle(r){return t.intercept(r,e)}}),r);return new class{interceptAndPublish(e){return n.handle(e)}}}class In{}const $n=/(?<major>\d+)\.(?<minor>\d+)\.(?<patch>\d+)(-(?<prerelease>.+))?/;var Cn;!function(e){function t(e){var t;const r=e.match($n);if(!r)throw Error(`[SemVerError] Version '${e}' is not a valid semantic version (semver).`);return{major:+r.groups.major,minor:+r.groups.minor,patch:+r.groups.patch,preRelease:null===(t=r.groups.prerelease)||void 0===t?void 0:t.split(".").map((e=>{const t=+e;return Number.isNaN(t)?e:t}))}}e.major=function(e){return t(null!=e?e:"0.0.0").major},e.lt=function(e,r){return function(e,r){if(!e&&r)return-1;if(!e&&!r)return 0;if(e&&!r)return 1;const n=t(e),i=t(r),s=Math.sign(n.major-i.major);if(0!==s)return s;const o=Math.sign(n.minor-i.minor);if(0!==o)return o;const a=Math.sign(n.patch-i.patch);return 0!==a?a:function(e,t){if(e.preRelease&&!t.preRelease)return-1;if(!e.preRelease&&!t.preRelease)return 0;if(!e.preRelease&&t.preRelease)return 1;for(let r=0;r<Math.max(e.preRelease.length,t.preRelease.length);r++){const n=e.preRelease[r],i=t.preRelease[r];if(void 0===n)return-1;if(void 0===i)return 1;if("number"==typeof n&&"string"==typeof i)return-1;if("string"==typeof n&&"number"==typeof i)return 1;if(n<i)return-1;if(n>i)return 1}return 0}(n,i)}(e,r)<0}}(Cn||(Cn={}));const Tn=Symbol("CLIENT_PING_INTERVAL"),xn=Symbol("CLIENT_PING_TIMEOUT");class Rn{constructor(e){this._pattern=e||{},this._patternKeys=Object.keys(this._pattern)}matches(e){const t=e||{},r=Object.keys(t),{_patternKeys:n,_pattern:i}=this;return!(!n.includes("*")&&r.some((e=>!n.includes(e))))&&n.filter((e=>"*"!==e)).every((e=>i[e]===t[e]||"*"===i[e]&&void 0!==t[e]&&null!==t[e]))}}class On extends gn{subscriptions(e){return super.subscriptions(e).filter((t=>!(null==e?void 0:e.intent)||t.matches(e.intent)))}}class Mn extends mn{constructor(e,t,r){super(t,r),this.selector=e}matches(e){return(!this.selector.type||this.selector.type===e.type)&&!(this.selector.qualifier&&!new Rn(this.selector.qualifier).matches(e.qualifier))}}class An{constructor(e,t,r,n,i){this.id=e,this.window=t,this.origin=r,this.application=n,this.version=null!=i?i:"0.0.0",this.deprecations={legacyIntentSubscriptionProtocol:Cn.lt(this.version,"1.0.0-rc.8"),legacyRequestResponseSubscriptionProtocol:Cn.lt(this.version,"1.0.0-rc.9"),legacyHeartbeatLivenessProtocol:Cn.lt(this.version,"1.0.0-rc.11")},this.deprecations.legacyIntentSubscriptionProtocol&&(this.installLegacyClientIntentSubscription(),Xt.get(Br).warn(`[DEPRECATION][FE93C94] Application "${n.symbolicName}" is using a legacy protocol for subscribing to intents. Please update @scion/microfrontend-platform to version '${Xt.get(dr)}'. Legacy support will be dropped in version '2.0.0'.`,new Vr(n.symbolicName,this.version))),this.deprecations.legacyRequestResponseSubscriptionProtocol&&Xt.get(Br).warn(`[DEPRECATION][F6DC38E] Application "${n.symbolicName}" is using a legacy request-response communication protocol. Please update @scion/microfrontend-platform to version '${Xt.get(dr)}'. Legacy support will be dropped in version '2.0.0'.`,new Vr(n.symbolicName,this.version)),this.deprecations.legacyHeartbeatLivenessProtocol&&Xt.get(Br).warn(`[DEPRECATION][CD981D7] Application "${n.symbolicName}" is using a legacy liveness probe protocol. Please update @scion/microfrontend-platform to version '${Xt.get(dr)}'. Legacy support will be dropped in version '2.0.0'.`,new Vr(n.symbolicName,this.version)),this.installLivenessDetector()}installLivenessDetector(){if(this.application.symbolicName===Xt.get(pr))return;if(this.deprecations.legacyHeartbeatLivenessProtocol)return;const e=Xt.get(Mr).request$($r.ping(this.id)).pipe(Rt(Xt.get(xn)),bt(1));var t,r;this._livenessDetector=(t=Xt.get(Tn),void 0===t&&(t=0),void 0===r&&(r=rt),t<0&&(t=0),st(t,t,r)).pipe(gt((()=>e))).subscribe({error:()=>{this.logStaleClientWarning(),Xt.get(bn).unregisterClient(this)}})}get stale(){return window.closed}dispose(){var e;null===(e=this._livenessDetector)||void 0===e||e.unsubscribe()}logStaleClientWarning(){Xt.get(Br).warn(`[StaleClient] Stale client registration of application '${this.application.symbolicName}' detected.\n       Removing stale registration. Most likely, the client could not disconnect from the broker, for example, because the client was\n       disposed without notice, i.e., without receiving the browser's "unload" event, or because the browser discarded the 'DISCONNECT'\n       message. Typically, the browser discards messages for windows that are already closed or if another page has been loaded into the\n       window, both indicating a high load on the client during unloading.`.replace(/\s+/g," "),new Vr(this.application.symbolicName,this.version))}installLegacyClientIntentSubscription(){const e=new Mn({},nr.randomUUID(),this);Xt.get(On).register(e)}}var Nn,Pn,kn,Un;(Pn=Nn||(Nn={})).not=function(e){return t=>!e(t)},Pn.alwaysTrue=()=>!0,function(e){const t=(new Set).add("string").add("number").add("boolean");e.validateQualifier=function(e,r){return e&&0!==Object.keys(e).length?r.exactQualifier&&Object.entries(e).some((([e,t])=>"*"===e||"*"===t))?Error(`[IllegalQualifierError] Qualifier must be exact, i.e., not contain wildcards. [qualifier='${JSON.stringify(e)}']`):Object.values(e).some((e=>""===e||null==e))?Error(`[IllegalQualifierError] Qualifier must not contain empty, \`null\`, or \`undefined\` entries. [qualifier='${JSON.stringify(e)}']`):Object.values(e).some((e=>!t.has(typeof e)))?Error(`[IllegalQualifierError] Qualifier contains entries with an illegal data type. Supported data types are [${[...t].join(", ")}]. [qualifier='${JSON.stringify(e)}']`):null:null},e.validateLegacyIntentionQualifier=function(e){return e&&0!==Object.keys(e).length&&Object.values(e).some((e=>"?"===e))?Error("[IllegalQualifierError] Optional wildcard ('?') not allowed in the intention qualifier anymore. To migrate, define optional params in the capability instead."):null},e.validateLegacyCapabilityQualifier=function(e){return e&&0!==Object.keys(e).length?Object.keys(e).some((e=>"*"===e))?Error("[IllegalQualifierError] Asterisk wildcard ('*') not allowed in the capability qualifier anymore. To migrate, use required or optional params instead."):Object.values(e).some((e=>"?"===e))?Error("[IllegalQualifierError] Optional wildcard ('?') not allowed in the capability qualifier anymore. To migrate, use optional params instead."):Object.values(e).some((e=>"*"===e))?Error("[IllegalQualifierError] Asterisk wildcard ('*') not allowed in the capability qualifier anymore. To migrate, use required params instead."):null:null}}(kn||(kn={}));class Dn{constructor(e){this._requiredParamDefs=new Array,this._optionalParamDefs=new Array,this._deprecatedParamDefs=new Array,e.forEach((e=>{var t;null===(t=e.required)||void 0===t||t?this._requiredParamDefs.push(e):this._optionalParamDefs.push(e),e.deprecated&&this._deprecatedParamDefs.push(e)}))}match(e){const t=new Map(e||[]),r={matches:!0,params:t,missingParams:[],unexpectedParams:[],deprecatedParams:[]};return this._deprecatedParamDefs.filter((e=>t.has(e.name))).forEach((e=>{r.deprecatedParams.push(e);const n=e.deprecated;"object"==typeof n&&n.useInstead&&(t.set(n.useInstead,t.get(e.name)),t.delete(e.name))})),this._requiredParamDefs.filter((e=>!t.has(e.name)||void 0===t.get(e.name))).filter((e=>!this._deprecatedParamDefs.includes(e))).forEach((e=>{r.matches=!1,r.missingParams.push(e)})),Array.from(t.keys()).filter((e=>!this._requiredParamDefs.some((t=>t.name===e))&&!this._optionalParamDefs.some((t=>t.name===e)))).forEach((e=>{r.matches=!1,r.unexpectedParams.push(e)})),r.matches||(r.params=void 0),r}}(Un||(Un={})).validateParams=function(e){const{intent:t,capability:r}=e,n=e.headers.get(br.AppSymbolicName);t.params=new Map(t.params),t.params.forEach(((e,r)=>{void 0===e&&t.params.delete(r)}));const i=new Dn(r.params||[]).match(t.params);if(!i.matches){const e=function(e,t){const r=JSON.stringify(t,((e,t)=>"params"===e?void 0:t)),n=e.missingParams.map((e=>e.name)),i=e.unexpectedParams;return`Params of intent do not match expected params of capability. The intent must have required params and not have additional params. [intent=${r}, missingParams=[${n}], unexpectedParams=[${i}]].`}(i,t);throw Error(`[IntentParamValidationError] ${e}`)}i.deprecatedParams.length&&(i.deprecatedParams.forEach((e=>{const r=function(e,t){const r=e.deprecated,n="object"==typeof r&&r.useInstead||void 0,i="object"==typeof r&&r.message||void 0;return(new Array).concat(`Application '${t.appSymbolicName}' passes a deprecated parameter in the intent: '${e.name}'.`).concat(n?`Pass parameter '${n}' instead.`:[]).concat(i||[]).join(" ")}(e,{appSymbolicName:n});Xt.get(Br).warn(`[DEPRECATION][4EAC5956] ${r}`,new Vr(n),t)})),t.params=i.params)};class Ln{constructor(){this._destroy$=new V,this._clientRegistry=Xt.get(bn),this._topicSubscriptionRegistry=Xt.get(vn),this._intentSubscriptionRegistry=Xt.get(On),this._retainedMessageStore=new Map,this._retainedIntentStore=new Map,this._applicationRegistry=Xt.get(dn),this._manifestRegistry=Xt.get(an),this._clientMessage$=Qe(window,"message").pipe(Pr(_r.ClientToBroker),kr(Sr.Intent,Sr.Topic,Sr.TopicSubscribe,Sr.TopicUnsubscribe,Sr.IntentSubscribe,Sr.IntentUnsubscribe),or(Xt.whenRunlevel(Wr.Two)),qn(),zn(),Wt()),this.installClientConnectListener(),this.installClientDisconnectListener(),this.installMessageDispatcher(),this.installTopicSubscribeListener(),this.installTopicUnsubscribeListener(),this.installTopicSubscriberCountObserver(),this.sendRetainedMessageOnSubscribe(),this.installIntentDispatcher(),this.installIntentSubscribeListener(),this.installIntentUnsubscribeListener(),this.sendRetainedIntentOnSubscribe(),this.deleteRetainedIntentOnCapabilityUnregister(),this._messagePublisher=this.createMessagePublisher(),this._intentPublisher=this.createIntentPublisher()}init(){return Promise.resolve()}installClientConnectListener(){Qe(window,"message").pipe(Pr(_r.ClientToBroker),kr(Sr.ClientConnect),or(Xt.whenRunlevel(Wr.One)),zn(),Gt(this._destroy$)).subscribe((e=>Jr((()=>{if(!e.source)return void Xt.get(Br).debug(`[CONNECT] Ignoring stale connect request from "${e.origin}".`);const t=e.source,r=e.data,n=r.message.headers.get(br.AppSymbolicName),i=new Hn(e),s=r.message.headers.get(br.ReplyTo);if(!n){const t=`Client connect attempt rejected: Bad request. [origin='${e.origin}']`;return Xt.get(Br).warn(`[CONNECT] ${t}`),void Fn(i,{topic:s,body:{returnCode:"refused:bad-request",returnMessage:`[ClientConnectError] ${t}`},headers:new Map})}const o=this._applicationRegistry.getApplication(n);if(!o){const e=`Client connect attempt rejected: Unknown client. [app='${n}']`;return Xt.get(Br).warn(`[CONNECT] ${e}`),void Fn(i,{topic:s,body:{returnCode:"refused:rejected",returnMessage:`[ClientConnectError] ${e}`},headers:new Map})}if(!o.allowedMessageOrigins.has(e.origin)){const t=`Client connect attempt blocked: Wrong origin [actual='${e.origin}', expected='${Array.from(o.allowedMessageOrigins)}', app='${o.symbolicName}']`;return Xt.get(Br).warn(`[CONNECT] ${t}`),void Fn(i,{topic:s,body:{returnCode:"refused:blocked",returnMessage:`[ClientConnectError] ${t}`},headers:new Map})}const a=this._clientRegistry.getByWindow(t);if(a&&a.origin===e.origin&&a.application.symbolicName===o.symbolicName)return void Fn(a,{topic:s,body:Object.assign({returnCode:"accepted",clientId:a.id},a.deprecations.legacyHeartbeatLivenessProtocol?{heartbeatInterval:864e5}:{}),headers:new Map});const c=new An(nr.randomUUID(),t,e.origin,o,r.message.headers.get(br.Version));this._clientRegistry.registerClient(c),Cn.major(c.version)!==Cn.major(Xt.get(dr))&&Xt.get(Br).warn(`[VersionMismatch] Application '${o.symbolicName}' uses a different major version of the @scion/microfrontend-platform than the host application, which may not be compatible. Please upgrade @scion/microfrontend-platform of application '${o.symbolicName}' from version '${c.version}' to version '${Xt.get(dr)}'.`,new Vr(o.symbolicName,c.version)),Fn(c,{topic:s,body:Object.assign({returnCode:"accepted",clientId:c.id},c.deprecations.legacyHeartbeatLivenessProtocol?{heartbeatInterval:864e5}:{}),headers:new Map})}))))}installClientDisconnectListener(){Qe(window,"message").pipe(Pr(_r.ClientToBroker),kr(Sr.ClientDisconnect),or(Xt.whenRunlevel(Wr.One)),qn(),zn(),Gt(this._destroy$)).subscribe((e=>Jr((()=>{const t=Bn(e);this._clientRegistry.unregisterClient(t)}))))}installTopicSubscriberCountObserver(){Xt.get(Mr).observe$($r.RequestSubscriberCount).pipe(Gt(this._destroy$)).subscribe((e=>Jr((()=>{const t=e.body,r=e.headers.get(br.ReplyTo),n=this._topicSubscriptionRegistry.subscriptionCount$(r).pipe(Fe((e=>0===e)));this._topicSubscriptionRegistry.subscriptionCount$(t).pipe(Gt(at(this._destroy$,n))).subscribe({next:e=>Xt.get(Mr).publish(r,e),error:e=>Xt.get(Mr).publish(r,Yr(e),{headers:(new Map).set(br.Status,vr.ERROR)})})}))))}installMessageDispatcher(){this._clientMessage$.pipe(kr(Sr.Topic),Gt(this._destroy$)).subscribe((e=>Jr((()=>r(this,void 0,void 0,(function*(){const t=Bn(e),r=e.data.message,n=r.headers.get(br.MessageId),i=Tr.validateTopic(r.topic,{exactTopic:!0});if(i)Vn(t,n,i);else{if(r.retain&&!Wn(r)&&void 0===r.body)return $t.removeListValue(this._retainedMessageStore,r.topic,Nn.not(Wn)),void jn(t,n);try{const e=this.subscribeForRepliesIfRequest(r,t);r.headers.delete(br.ɵSubscriberId),yield this._messagePublisher.interceptAndPublish(r),this.storeMessageIfRetained(r,e),jn(t,n)}catch(e){Vn(t,n,e)}}}))))))}installIntentDispatcher(){this._clientMessage$.pipe(kr(Sr.Intent),Gt(this._destroy$)).subscribe((e=>Jr((()=>r(this,void 0,void 0,(function*(){const t=Bn(e),n=e.data.message,i=n.headers.get(br.MessageId);if(!n.intent){return void Vn(t,i,"[MessagingError] Missing message property: intent")}if(!n.intent.type){return void Vn(t,i,"[MessagingError] Missing message property: type")}const s=kn.validateQualifier(n.intent.qualifier,{exactQualifier:!0});if(s)return void Vn(t,i,s);if(!this._manifestRegistry.hasIntention(n.intent,t.application.symbolicName)){const e=`[NotQualifiedError] Application '${t.application.symbolicName}' is not qualified to publish intents of the type '${n.intent.type}' and qualifier '${JSON.stringify(n.intent.qualifier||{})}'. Ensure to have listed the intention in the application manifest.`;return void Vn(t,i,e)}const o=this._manifestRegistry.resolveCapabilitiesByIntent(n.intent,t.application.symbolicName);if(0!==o.length)if(!n.retain||Wn(n)||void 0!==n.body)try{const e=this.subscribeForRepliesIfRequest(n,t);n.headers.delete(br.ɵSubscriberId),yield Promise.all(o.map((e=>Object.assign(Object.assign({},n),{capability:e}))).map((t=>r(this,void 0,void 0,(function*(){Un.validateParams(t),yield this._intentPublisher.interceptAndPublish(t),this.storeIntentIfRetained(t,e)}))))),jn(t,i)}catch(e){Vn(t,i,e)}else o.forEach((e=>{$t.removeListValue(this._retainedIntentStore,e.metadata.id,Nn.not(Wn)),jn(t,i)}));else{const e=`[NullProviderError] No application found to provide a capability of the type '${n.intent.type}' and qualifiers '${JSON.stringify(n.intent.qualifier||{})}'. Maybe, the capability is not public API or the providing application not available.`;Vn(t,i,e)}}))))))}sendRetainedMessageOnSubscribe(){this._topicSubscriptionRegistry.register$.pipe(Gt(this._destroy$)).subscribe((e=>Jr((()=>{Array.from(this._retainedMessageStore.values()).flat().filter((t=>e.matches(t.topic))).forEach((t=>this._messagePublisher.interceptAndPublish(Object.assign(Object.assign({},t),{headers:new Map(t.headers).set(br.ɵSubscriberId,e.subscriberId)}))))}))))}sendRetainedIntentOnSubscribe(){this._intentSubscriptionRegistry.register$.pipe(Gt(this._destroy$)).subscribe((e=>Jr((()=>{Array.from(this._retainedIntentStore.values()).flat().filter((t=>e.client.application.symbolicName===t.capability.metadata.appSymbolicName)).filter((t=>e.matches(t.intent))).forEach((t=>this._intentPublisher.interceptAndPublish(Object.assign(Object.assign({},t),{headers:new Map(t.headers).set(br.ɵSubscriberId,e.subscriberId)}))))}))))}deleteRetainedIntentOnCapabilityUnregister(){this._manifestRegistry.capabilityUnregister$.pipe(ke((e=>_e(e))),Gt(this._destroy$)).subscribe((e=>Jr((()=>{$t.removeListValue(this._retainedIntentStore,e.metadata.id,Nn.alwaysTrue)}))))}installTopicSubscribeListener(){this._clientMessage$.pipe(kr(Sr.TopicSubscribe),Gt(this._destroy$)).subscribe((e=>Jr((()=>{const t=Bn(e),r=e.data,n=r.message.headers.get(br.MessageId),i=r.message.topic,s=Tr.validateTopic(i,{exactTopic:!1});if(s)Vn(t,n,s);else try{const e=yt.orElseThrow(r.message.subscriberId,(()=>Error("[TopicSubscribeError] Missing property: subscriberId")));this._topicSubscriptionRegistry.register(new wn(i,e,t)),jn(t,n)}catch(e){Vn(t,n,e)}}))))}installTopicUnsubscribeListener(){this._clientMessage$.pipe(kr(Sr.TopicUnsubscribe),Gt(this._destroy$)).subscribe((e=>Jr((()=>{const t=Bn(e),r=e.data,n=r.message.headers.get(br.MessageId);try{const e=yt.orElseThrow(r.message.subscriberId,(()=>Error("[TopicUnsubscribeError] Missing property: subscriberId")));this._topicSubscriptionRegistry.unregister({subscriberId:e}),jn(t,n)}catch(e){Vn(t,n,e)}}))))}installIntentSubscribeListener(){this._clientMessage$.pipe(kr(Sr.IntentSubscribe),Gt(this._destroy$)).subscribe((e=>Jr((()=>{var t;const r=Bn(e),n=e.data,i=n.message.headers.get(br.MessageId),s=kn.validateQualifier(null===(t=n.message.selector)||void 0===t?void 0:t.qualifier,{exactQualifier:!1});if(s)Vn(r,i,s);else try{const e=yt.orElseThrow(n.message.subscriberId,(()=>Error("[IntentSubscribeError] Missing property: subscriberId")));this._intentSubscriptionRegistry.register(new Mn(n.message.selector||{},e,r)),jn(r,i)}catch(e){Vn(r,i,e)}}))))}installIntentUnsubscribeListener(){this._clientMessage$.pipe(kr(Sr.IntentUnsubscribe),Gt(this._destroy$)).subscribe((e=>Jr((()=>{const t=Bn(e),r=e.data,n=r.message.headers.get(br.MessageId);try{const e=yt.orElseThrow(r.message.subscriberId,(()=>Error("[IntentUnsubscribeError] Missing property: subscriberId")));this._intentSubscriptionRegistry.unregister({subscriberId:e}),jn(t,n)}catch(e){Vn(t,n,e)}}))))}createMessagePublisher(){return Sn(Xt.all(_n),(e=>r(this,void 0,void 0,(function*(){const t=this._topicSubscriptionRegistry.subscriptions({subscriberId:e.headers.get(br.ɵSubscriberId),topic:e.topic});if(Wn(e)&&!e.retain&&!t.length)throw Error(`[MessagingError] No subscriber registered to answer the request [topic=${e.topic}]`);t.forEach((t=>Jr((()=>Fn(t,e)))))}))))}createIntentPublisher(){return Sn(Xt.all(En),(e=>r(this,void 0,void 0,(function*(){const t=this._intentSubscriptionRegistry.subscriptions({subscriberId:e.headers.get(br.ɵSubscriberId),appSymbolicName:e.capability.metadata.appSymbolicName,intent:e.intent});if(Wn(e)&&!e.retain&&!t.length)throw Error(`[MessagingError] No subscriber registered to answer the intent [intent=${JSON.stringify(e.intent)}]`);t.forEach((t=>Jr((()=>function(e,t){var r,n;const i={transport:_r.BrokerToClient,channel:Sr.Intent,message:Object.assign(Object.assign({},t),{headers:new Map(t.headers).set(br.ɵSubscriberId,e.subscriberId).set(br.MessageId,null!==(r=t.headers.get(br.MessageId))&&void 0!==r?r:nr.randomUUID()).set(br.AppSymbolicName,null!==(n=t.headers.get(br.AppSymbolicName))&&void 0!==n?n:Xt.get(pr))})},s=e.client;!s.stale&&s.window.postMessage(i,s.origin)}(t,e)))))}))))}subscribeForRepliesIfRequest(e,t){if(!Wn(e))return null;if(t.deprecations.legacyRequestResponseSubscriptionProtocol)return null;const r=yt.orElseThrow(e.headers.get(br.ɵSubscriberId),(()=>Error("[MessagingError] Missing message header: subscriberId"))),n=e.headers.get(br.ReplyTo),i=new wn(n,r,t);return this._topicSubscriptionRegistry.register(i),i}storeMessageIfRetained(e,t){e.retain&&(Wn(e)?(yt.orElseThrow(t,(()=>Error("[InternalMessagingError] An unexpected error occurred. Expected subscription not to be null."))),$t.addListValue(this._retainedMessageStore,e.topic,e),t.whenUnsubscribe.then((()=>$t.removeListValue(this._retainedMessageStore,e.topic,e)))):($t.removeListValue(this._retainedMessageStore,e.topic,Nn.not(Wn)),$t.addListValue(this._retainedMessageStore,e.topic,e)))}storeIntentIfRetained(e,t){if(!e.retain)return;const r=e.capability.metadata.id;Wn(e)?(yt.orElseThrow(t,(()=>Error("[InternalMessagingError] An unexpected error occurred. Expected subscription not to be null."))),$t.addListValue(this._retainedIntentStore,r,e),t.whenUnsubscribe.then((()=>$t.removeListValue(this._retainedIntentStore,r,e)))):($t.removeListValue(this._retainedIntentStore,r,Nn.not(Wn)),$t.addListValue(this._retainedIntentStore,r,e))}preDestroy(){this._destroy$.next()}}function Bn(e){const t=e.data.message.headers.get(br.ClientId),r=Xt.get(bn).getByClientId(t);if(!r)throw Error(`[NullClientError] Client not found in client registry. [clientId=${t}]`);return r}function qn(){return ke((e=>{const t=e.data,r=t.message.headers.get(br.MessageId),n=t.message.headers.get(br.ClientId),i=Xt.get(bn).getByClientId(n);if(!i){if(null!==e.source){Vn(new Hn(e),r,`[MessagingError] Message rejected: Client not registered [origin=${e.origin}]`)}return Ve}if(e.origin!==i.origin){if(null!==e.source){Vn(new Hn(e),r,`[MessagingError] Message rejected: Wrong origin [actual=${e.origin}, expected=${i.origin}, application=${i.application.symbolicName}]`)}return Ve}if(null!==e.source&&e.source!==i.window){return Vn(new Hn(e),r,`[MessagingError] Message rejected: Wrong window [origin=${e.origin}]`),Ve}return ut(e)}))}function jn(e,t){Fn(e,{topic:t,body:{ok:!0},headers:new Map})}function Vn(e,t,r){Fn(e,{topic:t,body:{ok:!1,details:Yr(r)},headers:new Map})}function Fn(e,t){var r,n;const i={transport:_r.BrokerToClient,channel:Sr.Topic,message:Object.assign(Object.assign({},t),{params:new Map(t.params),headers:new Map(t.headers).set(br.MessageId,null!==(r=t.headers.get(br.MessageId))&&void 0!==r?r:nr.randomUUID()).set(br.AppSymbolicName,null!==(n=t.headers.get(br.AppSymbolicName))&&void 0!==n?n:Xt.get(pr))})};if(e instanceof Hn)!e.window.closed&&e.window.postMessage(i,e.origin);else if(e instanceof wn){const r=e,n=r.client;i.message.headers.set(n.deprecations.legacyIntentSubscriptionProtocol?"ɵTOPIC_SUBSCRIBER_ID":br.ɵSubscriberId,e.subscriberId),i.message.params=new Nr(r.topic).match(t.topic).params,!n.stale&&n.window.postMessage(i,n.origin)}else!e.stale&&e.window.postMessage(i,e.origin)}function zn(){return Nt(((e,t)=>(Xt.get(Br).error("[UnexpectedError] An unexpected error occurred.",e),t)))}function Wn(e){return e.headers.has(br.ReplyTo)}class Hn{constructor(e){this.window=e.source,this.origin=e.origin}}const Kn="ɵCONTEXT_LOOKUP_OPTIONS";var Gn;!function(e){function t(e){return`context/${e}`}e.contextTreeNamesLookupTopic=function(){return"contexttree/names"},e.contextTreeChangeTopic=function(){return"contexttree/change"},e.contextValueLookupTopic=t,e.newContextValueLookupRequest=function(e,r,n,i){return{transport:_r.MicrofrontendToOutlet,channel:Sr.Topic,message:{topic:t(encodeURIComponent(e)),body:i||[],headers:(new Map).set(br.MessageId,nr.randomUUID()).set(br.ReplyTo,r).set(Kn,n)}}},e.newContextTreeNamesLookupRequest=function(t,r){return{transport:_r.MicrofrontendToOutlet,channel:Sr.Topic,message:{topic:e.contextTreeNamesLookupTopic(),body:r||new Set,headers:(new Map).set(br.MessageId,nr.randomUUID()).set(br.ReplyTo,t)}}},e.newContextTreeObserveRequest=function(t){return{transport:_r.MicrofrontendToOutlet,channel:Sr.Topic,message:{topic:e.contextTreeChangeTopic(),headers:(new Map).set(br.MessageId,nr.randomUUID()).set(br.ReplyTo,t)}}},e.RootContextSubscribeEvent="RootContextSubscribeEvent"}(Gn||(Gn={}));class Qn{constructor(e){this._entries$=new W(new Map),this._entryChange$=new V,this._outletDisconnect$=new V,this._microfrontendRequest$=Qe(window,"message").pipe(Fe((t=>t.source===e.contentWindow)),Pr(_r.MicrofrontendToOutlet),kr(Sr.Topic),Wt())}set(e,t){this._entries$.next(new Map(this._entries$.getValue()).set(e,t)),this._entryChange$.next({name:e,value:t,type:"set"})}remove(e){const t=new Map(this._entries$.getValue());return!!t.delete(e)&&(this._entries$.next(t),this._entryChange$.next({name:e,type:"remove"}),!0)}get entries$(){return this._entries$}onOutletMount(){this.installContextValueLookupListener(),this.installContextTreeNamesLookupListener(),this.installContextTreeObserveListener()}onOutletUnmount(){this._outletDisconnect$.next()}installContextValueLookupListener(){this._microfrontendRequest$.pipe(Ur(Gn.contextValueLookupTopic(":name")),Lr(),Gt(this._outletDisconnect$)).subscribe((e=>Jr((()=>{const t=new Nr(Gn.contextValueLookupTopic(":name")).match(e.topic).params.get("name"),r=decodeURIComponent(t),n=e.headers.get(br.ReplyTo),i=e.headers.get(Kn),s=this._entries$.getValue();if(null==i?void 0:i.collect){const t=e.body||[];s.has(r)&&void 0!==s.get(r)&&t.push(s.get(r)),Xt.get(lr)?Xt.get(Mr).publish(n,t,{headers:(new Map).set(br.Status,vr.OK)}):window.parent.postMessage(Gn.newContextValueLookupRequest(r,n,i,t),"*")}else s.has(r)&&void 0!==s.get(r)?Xt.get(Mr).publish(n,s.get(r),{headers:(new Map).set(br.Status,vr.OK)}):Xt.get(lr)?Xt.get(Mr).publish(n,void 0,{headers:(new Map).set(br.Status,vr.NOT_FOUND)}):window.parent.postMessage(Gn.newContextValueLookupRequest(r,n,i),"*")}))))}installContextTreeNamesLookupListener(){this._microfrontendRequest$.pipe(Ur(Gn.contextTreeNamesLookupTopic()),Lr(),Gt(this._outletDisconnect$)).subscribe((e=>Jr((()=>{const t=e.headers.get(br.ReplyTo),r=this._entries$.getValue(),n=new Set([...r.keys(),...e.body||[]]);Xt.get(lr)?Xt.get(Mr).publish(t,n,{headers:(new Map).set(br.Status,vr.OK)}):window.parent.postMessage(Gn.newContextTreeNamesLookupRequest(t,n),"*")}))))}installContextTreeObserveListener(){this._microfrontendRequest$.pipe(Ur(Gn.contextTreeChangeTopic()),Lr(),Gt(this._outletDisconnect$)).subscribe((e=>Jr((()=>{const t=e.headers.get(br.ReplyTo);this._entryChange$.pipe(Ar(t),Gt(this._outletDisconnect$)).subscribe((e=>{Xt.get(Mr).publish(t,e)})),Xt.get(lr)?Xt.get(Mr).publish(t,Gn.RootContextSubscribeEvent):window.parent.postMessage(Gn.newContextTreeObserveRequest(t),"*")}))))}}class Jn{assign(e,t,r){const n=this.patchUrl(t.url,r&&r.url);t.pushStateToSessionHistoryStack?e.contentWindow.location.assign(n):e.contentWindow.location.replace(n)}patchUrl(e,t){const r=Jr((()=>{const r=t?un.newUrl(t):void 0,n=un.newUrl(e);if("about:"===n.protocol||"blob:"===n.protocol)return e;if(window===Xt.get(hr))return e;if(n.search)return e;if((null==r?void 0:r.origin)===n.origin&&(null==r?void 0:r.pathname)===n.pathname)return e;const i=un.newUrl(e);return i.searchParams.set("_",""),i.toString()}));return null!=r?r:e}}class Yn{constructor(e,t,r,n){this.eventType=e;const i=[];i.push(e),r&&(r.control&&i.push("control"),r.alt&&i.push("alt"),r.shift&&i.push("shift"),r.meta&&i.push("meta")),i.push(t.toLowerCase()),this.parts=i.join("."),this.flags=n}withFlags(e){return this.flags=e,this}static fromEvent(e){if(!e)throw Error("[KeystrokeParseError] Cannot create the keystroke from `null` or `undefined`.");return new Yn(e.type,function(e){switch(e){case".":return"dot";case" ":return"space";default:return e}}(e.key),{control:e.ctrlKey,shift:e.shiftKey,alt:e.altKey,meta:e.metaKey})}static fromString(e){if(!e)throw Error("[KeystrokeParseError] Cannot parse the keystroke from 'null' or 'undefined'.");const t=function(e){var t,r;const n=null!==(r=null===(t=e.match(/{(?<flagsDictionary>.*)}/))||void 0===t?void 0:t.groups.flagsDictionary)&&void 0!==r?r:null;return null===n?void 0:""===n?{}:n.split(";").map((e=>e.split("="))).reduce(((t,[r,n])=>"preventDefault"===r?Object.assign(Object.assign({},t),{preventDefault:"true"===n}):(Xt.get(Br).warn(`[KeystrokeParseError] Ignore unkown flag '${e}'. Supported flags are: 'preventDefault'.`),t)),{})}(e);void 0!==t&&(e=e.substring(0,e.indexOf("{")));const r=e.split(".");if(r.length<2)throw Error(`[KeystrokeParseError] Cannot parse the keystroke '${e}'. Requires at least the event type and keyboard key, and optionally some modifiers. Examples: 'keydown.control.z', 'keydown.escape', 'keyup.enter', 'keydown.control.alt.enter', 'keydown.control.space'`);const n=r[0];if("keydown"!==n&&"keyup"!==n)throw Error(`[KeystrokeParseError] Cannot parse the keystroke '${e}'. Unsupported event type. Supported event types are: 'keydown' or 'keyup'. Examples: 'keydown.control.z', 'keydown.escape', 'keyup.enter', 'keydown.control.alt.enter', 'keydown.control.space'`);const i=r[r.length-1];if(!i||(new Set).add("alt").add("shift").add("control").add("meta").has(i.toLowerCase()))throw Error(`[KeystrokeParseError] Cannot parse the keystroke '${e}'. The keyboard key must be the last part. Examples: 'keydown.control.z', 'keydown.escape', 'keyup.enter', 'keydown.control.alt.enter', 'keydown.control.space'`);const s=new Set(r.slice(1,-1)),o=new Yn(n,i,{control:s.delete("control"),shift:s.delete("shift"),alt:s.delete("alt"),meta:s.delete("meta")},t);if(s.size>0)throw Error(`[KeystrokeParseError] Cannot parse the keystroke '${e}'. Illegal modifier found. Supported modifiers are: 'alt', 'shift', 'control' or 'meta'. Examples: 'keydown.control.z', 'keydown.escape', 'keyup.enter', 'keydown.control.alt.enter', 'keydown.control.space'`);return o}}const Xn="ɵPUSH_STATE_TO_SESSION_HISTORY_STACK",Zn="sci-router-outlet",ei="name",ti="scrollable",ri="keystrokes",ni='\n  <style>\n    :host {\n      display: block;\n      overflow: hidden;\n    }\n\n    iframe {\n      width: 100%;\n      height: 100%;\n      border: none;\n      margin: 0;\n    }\n  </style>\n  <iframe src="about:blank" scrolling="yes" marginheight="0" marginwidth="0"></iframe>\n';class ii extends HTMLElement{constructor(){super(),this._disconnect$=new V,this._uid=nr.randomUUID(),this._empty$=new W(!0),this._outletName$=new W(oi),this._shadowRoot=this.attachShadow({mode:"open"}),this._shadowRoot.innerHTML=ni.trim(),this._iframe=this._shadowRoot.querySelector("iframe"),this._contextProvider=new Qn(this._iframe),this.empty$=this._empty$.pipe(Ut())}set name(e){e?this.setAttribute(ei,e):this.removeAttribute(ei)}get name(){var e;return null!==(e=this.getAttribute(ei))&&void 0!==e?e:void 0}set scrollable(e){e?this.setAttribute(ti,"true"):this.removeAttribute(ti)}get scrollable(){return"true"===this.getAttribute(ti)}set keystrokes(e){e&&e.length?this.setAttribute(ri,ui.join(e)):this.removeAttribute(ri)}get keystrokes(){return ui.split(this.getAttribute(ri))}setContextValue(e,t){this._contextProvider.set(e,t)}removeContextValue(e){return this._contextProvider.remove(e)}get contextValues$(){return this._contextProvider.entries$}resetPreferredSize(){Xt.get(Mr).publish(ai.preferredSizeTopic(this._uid),null)}get preferredSize(){const e={minWidth:this.style.minWidth||void 0,width:this.style.width||void 0,maxWidth:this.style.maxWidth||void 0,minHeight:this.style.minHeight||void 0,height:this.style.height||void 0,maxHeight:this.style.maxHeight||void 0};if(Object.values(e).some(Boolean))return e}get iframe(){return this._iframe}installOutletContext(){this._outletName$.pipe(Gt(this._disconnect$)).subscribe((e=>{const t={name:e,uid:this._uid};this.iframe.name=e,this.setContextValue(si,t)}))}installOutletUrlListener(){this._outletName$.pipe(gt((e=>function(e){const t=ai.urlTopic(e);return Xt.get(Mr).observe$(t).pipe(Ee((e=>({url:e.body||"about:blank",pushStateToSessionHistoryStack:yt.orElse(e.headers.get(Xn),!1)}))))}(e).pipe(Kt(null)))),Jt((e=>this._empty$.next(!e||"about:blank"===e.url))),ue((function(e,t){var r,n=!1;e.subscribe(le(t,(function(e){var i=r;r=e,n&&t.next([i,e]),n=!0})))})),Gt(this._disconnect$)).subscribe((([e,t])=>Jr((()=>{e&&this.dispatchEvent(new CustomEvent("deactivate",{detail:e.url})),Xt.get(Jn).assign(this._iframe,t||{url:"about:blank",pushStateToSessionHistoryStack:!1},e),t&&this.dispatchEvent(new CustomEvent("activate",{detail:t.url}))}))))}installPreferredSizeListener(){Xt.get(Mr).observe$(ai.preferredSizeTopic(this._uid)).pipe(Rr(),Gt(this._disconnect$)).subscribe((e=>{var t,r,n,i,s,o,a,c;a=this,c={"min-width":null!==(t=null==e?void 0:e.minWidth)&&void 0!==t?t:null,width:null!==(r=null==e?void 0:e.width)&&void 0!==r?r:null,"max-width":null!==(n=null==e?void 0:e.maxWidth)&&void 0!==n?n:null,"min-height":null!==(i=null==e?void 0:e.minHeight)&&void 0!==i?i:null,height:null!==(s=null==e?void 0:e.height)&&void 0!==s?s:null,"max-height":null!==(o=null==e?void 0:e.maxHeight)&&void 0!==o?o:null},Object.keys(c).forEach((e=>a.style.setProperty(e,c[e])))}))}installKeyboardEventDispatcher(){Xt.get(Mr).observe$(ai.keyboardEventTopic(this._uid,":eventType")).pipe(Gt(this._disconnect$)).subscribe((e=>{const t=e.params.get("eventType");this.dispatchEvent(new KeyboardEvent(t,e.body))}))}installFocusWithinEventDispatcher(){var e;Xt.get(Mr).observe$(ai.focusWithinOutletTopic(this._uid)).pipe(Rr(),(e=e=>!1===e,ue((function(t,r){var n=!1,i=0;t.subscribe(le(r,(function(t){return(n||(n=!e(t,i++)))&&r.next(t)})))}))),Gt(this._disconnect$)).subscribe((e=>{this.dispatchEvent(new CustomEvent("focuswithin",{detail:e,bubbles:!1,cancelable:!1}))}))}installHostElementDecorator(){this._empty$.pipe(Gt(this._disconnect$)).subscribe((e=>{e?this._shadowRoot.host.classList.add("sci-empty"):this._shadowRoot.host.classList.remove("sci-empty")}))}connectedCallback(){this.installOutletUrlListener(),this.installOutletContext(),this.installPreferredSizeListener(),this.installFocusWithinEventDispatcher(),this.installKeyboardEventDispatcher(),this.installHostElementDecorator(),this._contextProvider.onOutletMount()}disconnectedCallback(){this._disconnect$.next(),this._contextProvider.onOutletUnmount()}attributeChangedCallback(e,t,r){switch(e){case ei:this._outletName$.next(r||oi);break;case ti:this._iframe.setAttribute("scrolling",null!=(n=r)&&"false"!=`${n}`?"yes":"no");break;case ri:ui.split(t).forEach((e=>this.removeContextValue(pi+Yn.fromString(e).parts))),ui.split(r).forEach((e=>{const t=Yn.fromString(e);this.setContextValue(pi+t.parts,t.flags)}))}var n}static define(){return customElements.get(Zn)?Promise.resolve():(customElements.define(Zn,ii),customElements.whenDefined(Zn).then((()=>Promise.resolve())))}}ii.observedAttributes=[ei,ti,ri];const si="ɵOUTLET",oi="primary";var ai,ci,ui,li;(ci=ai||(ai={})).urlTopic=function(e){return`sci-router-outlets/${e}/url`},ci.keyboardEventTopic=function(e,t){return`sci-router-outlets/${e}/keyboard-events/${t}`},ci.preferredSizeTopic=function(e){return`sci-router-outlets/${e}/preferred-size`},ci.focusWithinOutletTopic=function(e){return`sci-router-outlets/${e}/focus-within`},(li=ui||(ui={})).split=function(e){return e?e.split(","):[]},li.join=function(e){return e.join(",")};const pi="keystroke:";class di{constructor(){this._destroy$=new V,this._contextTreeChange$=new V,this._whenContextTreeChangeListenerInstalled=this.installContextTreeChangeListener((e=>this._contextTreeChange$.next(e)))}observe$(e,t){return Xt.get(lr)?Le(ut((null==t?void 0:t.collect)?[]:null),ct):this._contextTreeChange$.pipe(Fe((t=>t.name===e)),Kt(void 0),gt((()=>this.lookupContextValue$(e,t))),Zr())}lookup(e,t){return We(this.observe$(e,t))}isPresent(e){return this.lookup(e).then((e=>null!==e))}names$(){return Xt.get(lr)?Le(ut(new Set),ct):this._contextTreeChange$.pipe(Kt(void 0),gt((()=>this.lookupContextNames$())),Zr())}lookupContextValue$(e,t){return new B((r=>{const n=nr.randomUUID(),i=new V,s=Gn.newContextValueLookupRequest(e,n,t);return Xt.get(Mr).observe$(n).pipe(qt(1),Ee((e=>{var t;return e.headers.get(br.Status)===vr.OK&&null!==(t=e.body)&&void 0!==t?t:null})),Gt(i)).subscribe(r),Promise.all([hi(n),this._whenContextTreeChangeListenerInstalled]).then((()=>window.parent.postMessage(s,"*"))).catch((e=>r.error(e))),()=>i.next()}))}lookupContextNames$(){return new B((e=>{const t=nr.randomUUID(),r=new V,n=Gn.newContextTreeNamesLookupRequest(t);return Xt.get(Mr).observe$(t).pipe(qt(1),Ee((e=>e.headers.get(br.Status)===vr.OK?e.body:new Set)),Gt(r)).subscribe(e),Promise.all([hi(t),this._whenContextTreeChangeListenerInstalled]).then((()=>window.parent.postMessage(n,"*"))).catch((t=>e.error(t))),()=>r.next()}))}installContextTreeChangeListener(e){const t=nr.randomUUID(),r=Gn.newContextTreeObserveRequest(t);return new Promise(((n,i)=>{Xt.get(Mr).observe$(t).pipe(Rr(),Gt(this._destroy$)).subscribe({next:t=>{t===Gn.RootContextSubscribeEvent?n():e(t)},error:i}),hi(t).then((()=>window.parent.postMessage(r,"*"))).catch((e=>i(e)))}))}preDestroy(){this._destroy$.next()}}function hi(e){return new Promise(((t,r)=>{Xt.get(Mr).subscriberCount$(e).pipe(zt((e=>1===e))).subscribe({error:r,complete:t})}))}class fi{resolve(e,t){var r;const n=un.newUrl(t.relativeTo);if(null===(r=n.hash)||void 0===r?void 0:r.startsWith("#/")){const{pathname:t,search:r,hash:i}=un.newUrl(e,`${n.origin}${n.hash.substring(1)}`);return n.origin+n.pathname+"#"+t+r+i}return un.newUrl(e,t.relativeTo).toString()}}class bi{navigate(e,t){return r(this,void 0,void 0,(function*(){e&&"string"!=typeof e?yield this.navigateByIntent(e,t):yield this.navigateByUrl(e,t)}))}navigateByUrl(e,t){var n;return r(this,void 0,void 0,(function*(){const r=(null==t?void 0:t.outlet)||(yield this.resolveContextualOutlet())||oi,i=ai.urlTopic(r),s=this.computeNavigationUrl(e,t);return Xt.get(Mr).publish(i,s,{retain:!0,headers:(new Map).set(Xn,null!==(n=null==t?void 0:t.pushStateToSessionHistoryStack)&&void 0!==n&&n)})}))}navigateByIntent(e,t){return r(this,void 0,void 0,(function*(){if(null==t?void 0:t.relativeTo)throw Error('[OutletRouterError][UnsupportedOptionError] Unsupported navigation option "relativeTo". This option is not supported in intent-based routing.');const r=yield this.resolveContextualOutlet(),n={type:cr.Microfrontend,qualifier:e,params:$t.coerce(null==t?void 0:t.params)},i=Xt.get(on).request$(n,t,{headers:(new Map).set(gi,{[mi]:r})});try{yield ot(i.pipe(Rr()))}catch(e){throw e instanceof Or?e.message:e}}))}computeNavigationUrl(e,t){var r;if(null==e)return"about:blank";const n=$t.coerce(null==t?void 0:t.params),i=this.substituteNamedParameters(e,n);if(un.isAbsoluteUrl(i))return i;{const e=null!==(r=null==t?void 0:t.relativeTo)&&void 0!==r?r:window.location.href;return Xt.get(fi).resolve(i,{relativeTo:e})}}resolveContextualOutlet(){var e;return r(this,void 0,void 0,(function*(){if(!(yield Xt.get(di).isPresent(fr)))return null===(e=yield Xt.get(di).lookup(si))||void 0===e?void 0:e.name}))}substituteNamedParameters(e,t){return e.replace(/:([^/;&?#]+)/g,((e,r)=>void 0!==t.get(r)?t.get(r):e)).replace(/(?<delimiter>;)(?<paramName>[^=]+)=:(?<placeholder>[^;#?/]+)/g,(()=>"")).replace(/(?<delimiter>[?&])(?<paramName>[^=]+)=:(?<placeholder>[^&#]+)/g,((e,t)=>"?"===t?"ɵ__?__":"")).replace(/ɵ__\?__&/,"?").replace(/ɵ__\?__/,"")}}const gi="context",mi="outlet";class yi{constructor(){this.focusWithin$=Xt.get(Mr).request$($r.IsFocusWithin).pipe(Rr()),this.focus$=Xt.get(Mr).request$($r.HasFocus).pipe(Rr())}}class vi{constructor(){this._destroy$=new V,this.installFocusEventDispatcher().then()}installFocusEventDispatcher(){return r(this,void 0,void 0,(function*(){(yield Xt.get(di).isPresent(fr))||(this.publishFocusInEvent(),yield this.notifyOutletAboutFocusChange())}))}publishFocusInEvent(){Xt.get(yi).focus$.pipe(gt((e=>e?Ve:dt(Qe(window,"focusin",{once:!0}),Qe(window,"mousedown",{once:!0,capture:!0})))),Gt(this._destroy$)).subscribe((()=>{Xt.get(Mr).publish($r.FocusIn)}))}notifyOutletAboutFocusChange(){return r(this,void 0,void 0,(function*(){const e=yield Xt.get(di).lookup(si);e&&Xt.get(yi).focusWithin$.pipe(Gt(this._destroy$)).subscribe((t=>{const r=ai.focusWithinOutletTopic(e.uid);Xt.get(Mr).publish(r,t)}))}))}preDestroy(){this._destroy$.next()}}class wi{constructor(){this._focusOwner$=new W(void 0),this._subscriptions=new Set,this._subscriptions.add(this.monitorFocusInEvents()),this._subscriptions.add(this.replyToIsFocusWithinRequests()),this._subscriptions.add(this.replyToHasFocusRequests())}monitorFocusInEvents(){return Xt.get(Mr).observe$($r.FocusIn).pipe(Ee((e=>e.headers.get(br.ClientId))),Ut()).subscribe((e=>Jr((()=>{this._focusOwner$.next(Xt.get(bn).getByClientId(e)||void 0)}))))}replyToIsFocusWithinRequests(){return Xt.get(Mr).onMessage($r.IsFocusWithin,(e=>{const t=e.headers.get(br.ClientId);return this._focusOwner$.pipe(Ee((e=>this.isFocusWithin(t,e))),Ut())}))}replyToHasFocusRequests(){return Xt.get(Mr).onMessage($r.HasFocus,(e=>{const t=e.headers.get(br.ClientId);return this._focusOwner$.pipe(Ee((e=>(null==e?void 0:e.id)===t)),Ut())}))}isFocusWithin(e,t){for(let r=t;void 0!==r;r=this.getParentClient(r))if(r.id===e)return!0;return!1}getParentClient(e){if(e.window.parent!==e.window)return Xt.get(bn).getByWindow(e.window.parent)}preDestroy(){this._subscriptions.forEach((e=>e.unsubscribe()))}}class _i{constructor(){this._destroy$=new V,this._fromDimensionElementChange$=new V,this._preferredSizePublisher=new Ei}setPreferredSize(e){this._preferredSizePublisher.publish(e)}fromDimension(e){this._fromDimensionElementChange$.next(),e?ar(e).pipe(Gt(at(this._fromDimensionElementChange$,this._destroy$))).subscribe((e=>{document.body.contains(e.element)?this.setPreferredSize({minWidth:`${e.offsetWidth}px`,width:`${e.offsetWidth}px`,maxWidth:`${e.offsetWidth}px`,minHeight:`${e.offsetHeight}px`,height:`${e.offsetHeight}px`,maxHeight:`${e.offsetHeight}px`}):this.resetPreferredSize()})):this.resetPreferredSize()}resetPreferredSize(){this._preferredSizePublisher.publish(null)}preDestroy(){this._preferredSizePublisher.destroy(),this._destroy$.next()}}class Ei{constructor(){this._preferredSize$=new V,this._destroy$=new V,this._preferredSize$.pipe(kt(Xt.get(di).observe$(si).pipe(Fe(Boolean))),Gt(this._destroy$)).subscribe((([e,t])=>Jr((()=>{const r=ai.preferredSizeTopic(t.uid);Xt.get(Mr).publish(r,e)}))))}publish(e){this._preferredSize$.next(e)}destroy(){this._destroy$.next()}}class Si{constructor(){this._destroy$=new V,this._dispatcherId=nr.randomUUID(),this.installMouseEventDispatcher().then()}installMouseEventDispatcher(){return r(this,void 0,void 0,(function*(){(yield Xt.get(di).isPresent(fr))||(this.publishMouseMoveEvent(),this.receiveMouseMoveEvent())}))}publishMouseMoveEvent(){Xt.get(yi).focus$.pipe(gt((e=>e?Ve:Qe(document,"mousemove"))),Fe((e=>e.buttons===Ii)),At(20),Gt(this._destroy$)).subscribe((e=>{const t={headers:(new Map).set($i,this._dispatcherId)};Xt.get(Mr).publish(Ci,[e.screenX,e.screenY],t)}))}receiveMouseMoveEvent(){Xt.get(yi).focus$.pipe(gt((e=>e?Xt.get(Mr).observe$(Ci):Ve)),Fe((e=>e.headers.get($i)!==this._dispatcherId)),Rr(),Gt(this._destroy$)).subscribe((([e,t])=>{const r=new Event("sci-mousemove");r.screenX=e,r.screenY=t,document.dispatchEvent(r)}))}preDestroy(){this._destroy$.next()}}const Ii=1,$i="ɵDISPATCHER_ID",Ci="ɵMOUSEMOVE";class Ti{constructor(){this._destroy$=new V,this._dispatcherId=nr.randomUUID(),this.installMouseEventDispatcher().then()}installMouseEventDispatcher(){return r(this,void 0,void 0,(function*(){(yield Xt.get(di).isPresent(fr))||(this.publishMouseUpEvent(),this.receiveMouseMoveEvent())}))}publishMouseUpEvent(){Xt.get(yi).focus$.pipe(gt((e=>e?Ve:Qe(window,"mouseup",{capture:!0}))),Gt(this._destroy$)).subscribe((()=>{const e={headers:(new Map).set(xi,this._dispatcherId)};Xt.get(Mr).publish(Ri,void 0,e)}))}receiveMouseMoveEvent(){Xt.get(yi).focus$.pipe(gt((e=>e?Xt.get(Mr).observe$(Ri):Ve)),Fe((e=>e.headers.get(xi)!==this._dispatcherId)),Rr(),Gt(this._destroy$)).subscribe((()=>{document.dispatchEvent(new Event("sci-mouseup"))}))}preDestroy(){this._destroy$.next()}}const xi="ɵDISPATCHER_ID",Ri="ɵMOUSEUP";class Oi{constructor(){this._destroy$=new V,this.installKeystrokeDispatcher().then()}installKeystrokeDispatcher(){return r(this,void 0,void 0,(function*(){(yield Xt.get(di).isPresent(si))&&!(yield Xt.get(di).isPresent(fr))&&Xt.get(di).names$().pipe(Ee((e=>Array.from(e))),ir((e=>e.startsWith(pi))),sr((e=>e.substring(pi.length))),sr((e=>this.observeKeyboardEvent$(e))),gt((e=>at(...e))),Mt(Xt.get(di).observe$(si)),Gt(this._destroy$)).subscribe((([e,t])=>Jr((()=>{const r={key:e.key,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey,bubbles:e.bubbles},n=ai.keyboardEventTopic(t.uid,e.type);Xt.get(Mr).publish(n,r)}))))}))}observeKeyboardEvent$(e){return Xt.get(di).observe$(pi+e,{collect:!0}).pipe(gt((t=>{const r=Yn.fromString(e).withFlags(t.reduceRight(((e,t)=>Object.assign(Object.assign({},e),t)),{}));return Qe(document,r.eventType,{capture:!0}).pipe(Fe((e=>e.bubbles&&!!e.key)),Fe((e=>Yn.fromEvent(e).parts===r.parts)),(n=r.flags,Jt((e=>{(null==n?void 0:n.preventDefault)&&e.preventDefault()}))));var n})))}preDestroy(){this._destroy$.next()}}class Mi{constructor(){this._objectById=new Map,this._objectsByType=new Map,this._objectsByApplication=new Map,this._add$=new V,this._remove$=new V}add(e){this._objectById.set(e.metadata.id,e),$t.addListValue(this._objectsByType,e.type,e),$t.addListValue(this._objectsByApplication,e.metadata.appSymbolicName,e),this._add$.next(e)}remove(e){const t=this.find(e);this._remove(t)}find(e){const t=void 0!==e.id,r=void 0!==e.type,n=void 0!==e.appSymbolicName;return wt.intersect(t?wt.coerce(this._objectById.get(e.id)):void 0,r?wt.coerce(this._objectsByType.get(e.type)):void 0,n?wt.coerce(this._objectsByApplication.get(e.appSymbolicName)):void 0,t||r||n?void 0:Array.from(this._objectById.values())).filter((t=>void 0===e.qualifier||("function"==typeof e.qualifier?e.qualifier(t.qualifier||{}):new Rn(e.qualifier).matches(t.qualifier))))}get change$(){return at(this.add$,this.remove$).pipe(Ee((()=>{})))}get add$(){return this._add$}get remove$(){return this._remove$}_remove(e){const t=new Set;e.forEach((e=>{const r=e.metadata.id;this._objectById.delete(r)&&($t.removeListValue(this._objectsByType,e.type,(e=>{var t;return(null===(t=e.metadata)||void 0===t?void 0:t.id)===r})),$t.removeListValue(this._objectsByApplication,e.metadata.appSymbolicName,(e=>{var t;return(null===(t=e.metadata)||void 0===t?void 0:t.id)===r})),t.add(e))})),t.size&&this._remove$.next(e)}}class Ai{}class Ni{constructor(){this._subscriptions=new Set,this._capabilityStore=new Mi,this._intentionStore=new Mi,this.capabilityRegister$=this._capabilityStore.add$,this.capabilityUnregister$=this._capabilityStore.remove$,this.installCapabilityRegisterRequestHandler(),this.installCapabilityUnregisterRequestHandler(),this.installIntentionRegisterRequestHandler(),this.installIntentionUnregisterRequestHandler(),this.installCapabilitiesLookupRequestHandler(),this.installIntentionsLookupRequestHandler(),this.installVersionLookupHandler()}resolveCapabilitiesByIntent(e,t){const r=kn.validateQualifier(e.qualifier,{exactQualifier:!0});if(r)throw r;const n={type:e.type,qualifier:e.qualifier||{}};return this._capabilityStore.find(n).filter((e=>this.isApplicationQualifiedForCapability(t,e)))}hasIntention(e,t){const r=kn.validateQualifier(e.qualifier,{exactQualifier:!0});if(r)throw r;const n={appSymbolicName:t,type:e.type};return Xt.get(dn).isIntentionCheckDisabled(t)||this._intentionStore.find(Object.assign(Object.assign({},n),{qualifier:t=>new Rn(t).matches(e.qualifier)})).length>0||this._capabilityStore.find(Object.assign(Object.assign({},n),{qualifier:e.qualifier||{}})).length>0}isApplicationQualifiedForCapability(e,t){if(t.metadata.appSymbolicName===e)return!0;const r=!t.private,n=Xt.get(dn).isScopeCheckDisabled(e),i=Xt.get(dn).isIntentionCheckDisabled(e);return(n||r)&&(i||this.hasIntentionForCapability(e,t))}hasIntentionForCapability(e,t){const r={appSymbolicName:e,type:t.type,qualifier:e=>new Rn(e).matches(t.qualifier)};return this._intentionStore.find(r).length>0}registerCapability(e,t){var n,i;return r(this,void 0,void 0,(function*(){if(!e)throw Error("[CapabilityRegisterError] Capability must not be null or undefined.");if(!e.type)throw Error("[CapabilityRegisterError] Missing capability property: type");const s=kn.validateLegacyCapabilityQualifier(e.qualifier)||kn.validateQualifier(e.qualifier,{exactQualifier:!0});if(s)throw s;const o=yield function(e){return r(this,void 0,void 0,(function*(){const t=Xt.all(Ai);for(const r of t)e=yield r.intercept(e);return e}))}(Object.assign(Object.assign({},e),{qualifier:null!==(n=e.qualifier)&&void 0!==n?n:{},params:Li(e,t),requiredParams:void 0,optionalParams:void 0,private:null===(i=e.private)||void 0===i||i,metadata:{id:nr.randomUUID(),appSymbolicName:t}}));return this._capabilityStore.add(o),o.metadata.id}))}unregisterCapabilities(e,t){this._capabilityStore.remove(Object.assign(Object.assign({},t),{appSymbolicName:e}))}registerIntention(e,t){if(!e)throw Error("[IntentionRegisterError] Intention must not be null or undefined.");if(!e.type)throw Error("[IntentionRegisterError] Missing intention property: type");const r=kn.validateLegacyIntentionQualifier(e.qualifier)||kn.validateQualifier(e.qualifier,{exactQualifier:!1});if(r)throw r;const n=Object.assign(Object.assign({},e),{metadata:{id:nr.randomUUID(),appSymbolicName:t}});return this._intentionStore.add(n),n.metadata.id}unregisterIntention(e,t){this._intentionStore.remove(Object.assign(Object.assign({},t),{appSymbolicName:e}))}installCapabilityRegisterRequestHandler(){this._subscriptions.add(Xt.get(Mr).onMessage(Pi.RegisterCapability,(e=>{const t=e.body,r=e.headers.get(br.AppSymbolicName);return this.registerCapability(t,r)})))}installCapabilityUnregisterRequestHandler(){this._subscriptions.add(Xt.get(Mr).onMessage(Pi.UnregisterCapabilities,(e=>{const t=e.body||{},r=e.headers.get(br.AppSymbolicName);this.unregisterCapabilities(r,t)})))}installIntentionRegisterRequestHandler(){this._subscriptions.add(Xt.get(Mr).onMessage(Pi.RegisterIntention,(e=>{const t=e.body,r=e.headers.get(br.AppSymbolicName);return Di(r),this.registerIntention(t,r)})))}installIntentionUnregisterRequestHandler(){this._subscriptions.add(Xt.get(Mr).onMessage(Pi.UnregisterIntentions,(e=>{const t=e.body||{},r=e.headers.get(br.AppSymbolicName);Di(r),this.unregisterIntention(r,t)})))}installCapabilitiesLookupRequestHandler(){this._subscriptions.add(Xt.get(Mr).onMessage(Pi.LookupCapabilities,(e=>{const t=e.headers.get(br.AppSymbolicName),r=e.body||{},n=kn.validateQualifier(r.qualifier,{exactQualifier:!1});if(n)throw n;const i=at(this._capabilityStore.change$,this._intentionStore.change$),s=je((()=>ut(this._capabilityStore.find(r))));return s.pipe(Lt((()=>i.pipe(qt(1),ke((()=>s))))),ir((e=>this.isApplicationQualifiedForCapability(t,e))),Ut(((e,t)=>JSON.stringify(e)===JSON.stringify(t))))})))}installIntentionsLookupRequestHandler(){this._subscriptions.add(Xt.get(Mr).onMessage(Pi.LookupIntentions,(e=>{const t=e.body||{},r=kn.validateQualifier(t.qualifier,{exactQualifier:!1});if(r)throw r;const n=je((()=>ut(this._intentionStore.find(t))));return n.pipe(Lt((()=>this._intentionStore.change$.pipe(qt(1),ke((()=>n))))),Ut(((e,t)=>JSON.stringify(e)===JSON.stringify(t))))})))}installVersionLookupHandler(){this._subscriptions.add(Xt.get(Mr).onMessage(Pi.platformVersion(":appSymbolicName"),(e=>{const t=e.params.get("appSymbolicName"),r=Xt.get(bn).register$.pipe(Fe((e=>e.application.symbolicName===t))),n=je((()=>{const e=Xt.get(bn).getByApplication(t);return e.length?ut(e[0].version):Ve}));return n.pipe(qe(r.pipe(ke((()=>n)))),qt(1))})))}preDestroy(){this._subscriptions.forEach((e=>e.unsubscribe()))}}var Pi,ki,Ui;function Di(e){if(Xt.get(dn).isIntentionRegisterApiDisabled(e))throw Error(`[IntentionRegisterError] The 'Intention Registration API' is disabled for the application '${e}'. Contact the platform administrator to enable this API.`)}function Li(e,t){var r,n,i;const s=[];return null===(r=e.requiredParams)||void 0===r||r.forEach((r=>{s.push({name:r,required:!0});const n=`{ params: [{name: '${r}', required: true}] }`;Xt.get(Br).warn(`[DEPRECATION][AC3A912] The '${t}' application uses a deprecated API for declaring required parameters of a capability. The API will be removed in a future release. To migrate, declare parameters by using the 'Capability#params' property, as follows: ${n}`,new Vr(t),e)})),null===(n=e.optionalParams)||void 0===n||n.forEach((r=>{s.push({name:r,required:!1});const n=`{ params: [{name: '${r}', required: false}] }`;Xt.get(Br).warn(`[DEPRECATION][97C70E9] The '${t}' application uses a deprecated API for declaring optional parameters of a capability. The API will be removed in a future release. To migrate, declare parameters by using the 'Capability#params' property, as follows: ${n}`,new Vr(t),e)})),null===(i=e.params)||void 0===i||i.forEach((e=>{s.push(e)})),function(e){const t=e.filter((e=>!e.deprecated)).map((e=>e.name));e.forEach((e=>{if(void 0===e.required)throw Error(`[CapabilityParamError] Parameter '${e.name}' must be explicitly defined as required or optional.`);if(void 0!==e.deprecated){if(e.required)throw Error(`[CapabilityParamError] Deprecated parameters must be optional, not required. Alternatively, deprecated parameters can define a mapping to a required parameter via the 'useInstead' property. [param='${e.name}']`);if("object"==typeof e.deprecated&&e.deprecated.useInstead&&!t.includes(e.deprecated.useInstead))throw Error(`[CapabilityParamError] The deprecated parameter '${e.name}' defines an invalid substitute '${e.deprecated.useInstead}'. Valid substitutes are: [${t}]`)}return e}))}(s),s}(ki=Pi||(Pi={})).LookupCapabilities="ɵLOOKUP_CAPABILITIES",ki.LookupIntentions="ɵLOOKUP_INTENTIONS",ki.RegisterCapability="ɵREGISTER_CAPABILITY",ki.UnregisterCapabilities="ɵUNREGISTER_CAPABILITIES",ki.RegisterIntention="ɵREGISTER_INTENTION",ki.UnregisterIntentions="ɵUNREGISTER_INTENTIONS",ki.platformVersion=function(e){return`ɵapplication/${e}/platform/version`};class Bi{constructor(){this._applications=[]}init(){return r(this,void 0,void 0,(function*(){if(Xt.get(en)instanceof tn)return;const e=Xt.get(Mr).observe$($r.Applications);this._applications=yield We(e.pipe(Rr(),qi()))}))}get applications(){return this._applications}lookupApplications$(){return Xt.get(Mr).observe$($r.Applications).pipe(qt(1),Rr(),qi())}lookupCapabilities$(e){return Xt.get(Mr).request$(Pi.LookupCapabilities,e).pipe(Rr())}lookupIntentions$(e){return Xt.get(Mr).request$(Pi.LookupIntentions,e).pipe(Rr())}registerCapability(e){return ot(Xt.get(Mr).request$(Pi.RegisterCapability,e).pipe(Rr()))}unregisterCapabilities(e){return new Promise(((t,r)=>{Xt.get(Mr).request$(Pi.UnregisterCapabilities,e).subscribe({error:r,complete:t})}))}registerIntention(e){return ot(Xt.get(Mr).request$(Pi.RegisterIntention,e).pipe(Rr()))}unregisterIntentions(e){return new Promise(((t,r)=>{Xt.get(Mr).request$(Pi.UnregisterIntentions,e).subscribe({error:r,complete:t})}))}}function qi(){return sr((e=>Object.assign(Object.assign({},e),{platformVersion:We(Xt.get(Mr).request$(Pi.platformVersion(e.symbolicName)).pipe(Rr()))})))}class ji{constructor(){this._progress$=new W(0),this._done$=new V,this._hasSubMonitors=!1,this.progress$=this._progress$.pipe(Ut(),Ee((e=>Math.round(1e4*e)/100)),Qt((e=>e<100),!0))}split(...e){if(this._hasSubMonitors)throw Error("[IllegalMonitorStateError] Monitor cannot be split multiple times.");this._hasSubMonitors=!0;const t=e.map((()=>new ji));return Me(t.map((e=>e._progress$))).pipe(function(e){const t=e.reduce(((e,t)=>e+t),0);return Ee((r=>e.reduce(((e,n,i)=>e+r[i]*(n/t)),0)))}(e),Qt((e=>e<1),!0),Gt(this._done$)).subscribe((e=>{this._progress$.next(e)})),t}splitEven(e){if(e<=0)throw Error(`[IllegalMonitorArgumentError] Monitor split count must be greater than 0, but was ${e}.`);return this.split(...new Array(e).fill(1))}done(){this._progress$.next(1),this._done$.next()}}class Vi extends ji{}class Fi extends ji{}class zi{init(){return r(this,void 0,void 0,(function*(){const e=yield We(Xt.get(Bi).lookupCapabilities$({type:cr.Activator})),t=Xt.get(Fi);if(!e.length)return void t.done();const r=e.filter(this.skipInvalidActivators()).reduce(((e,t)=>$t.addListValue(e,t.metadata.appSymbolicName,t)),new Map),n=t.splitEven(r.size),i=Array.from(r.entries()).reduce(((e,[t,r],i)=>e.concat(this.waitForActivatorsToSignalReady(t,r,n[i]))),[]);r.forEach((e=>{const t=e[0];e.forEach((e=>this.mountActivator(e,e===t)))})),yield Promise.all(i)}))}skipInvalidActivators(){return e=>!(!e.properties||!e.properties.path)||(Xt.get(Br).error(`[ActivatorError] Failed to activate the application '${e.metadata.appSymbolicName}'. Missing required 'path' property in the provided activator capability.`,e),!1)}waitForActivatorsToSignalReady(e,t,n){return r(this,void 0,void 0,(function*(){const r=Date.now(),i=Xt.get(dn).getApplication(e).activatorLoadTimeout,s=t.reduce(((e,t)=>e.concat(wt.coerce(t.properties.readinessTopics))),new Array).map((t=>{const r=()=>(Xt.get(Br).error(`[ActivatorLoadTimeoutError] Timeout elapsed while waiting for application to signal readiness [app=${e}, timeout=${i}ms, readinessTopic=${t}].`),Ve);return new Promise(((n,s)=>Xt.get(Mr).observe$(t).pipe(zt((t=>t.headers.get(br.AppSymbolicName)===e)),i?Rt({first:i,with:r}):U).subscribe({error:s,complete:n})))}));s.length?(yield Promise.all(s),n.done(),Xt.get(Br).info(`Activator startup of '${e}' took ${Date.now()-r}ms.`)):n.done()}))}mountActivator(e,t){const r=Xt.get(dn).getApplication(e.metadata.appSymbolicName),n=document.createElement("sci-router-outlet");n.name=nr.randomUUID(),Xt.get(bi).navigate(e.properties.path,{outlet:n.name,relativeTo:r.baseUrl}).then(),n.setContextValue(fr,{primary:t,activator:e}),n.classList.add("sci-activator"),n.dataset.app=r.symbolicName,n.style.display="none",n.style.position="absolute",document.body.appendChild(n),Xt.get(Qr).whenState(Fr.Stopped).then((()=>document.body.removeChild(n)))}}class Wi{constructor(e,t){this._callback=t,this._messageClient=Xt.get(Mr),this.subscription=new f,this.subscription.add(e.subscribe((e=>{e.headers.has(br.ReplyTo)?this.handleMessage(e):this.consumeMessage(e)})))}consumeMessage(e){Jr((()=>this._callback(e)))}handleMessage(e){const t=e.headers.get(br.ReplyTo),r=Xt.get(Qr).state$.pipe(Fe((e=>e===Fr.Stopping)));let n;try{n=this._callback(e)}catch(e){n=mt((()=>e))}let i="alive";var s;this.subscription.add((s=n,void 0===s?Ve:s instanceof B?s:s instanceof Promise?_e(s).pipe(Fe((e=>void 0!==e))):ut(s)).pipe(Ar(t),Gt(r),Bt((()=>{if("alive"===i){const e=(new Map).set(br.Status,vr.TERMINAL);this._messageClient.publish(t,void 0,{headers:e}).then()}}))).subscribe({next:e=>{const r=(new Map).set(br.Status,vr.OK);this._messageClient.publish(t,e,{headers:r}).then()},error:e=>{i="errored";const r=(new Map).set(br.Status,vr.ERROR);this._messageClient.publish(t,Yr(e),{headers:r}).then()},complete:()=>{i="completed";const e=(new Map).set(br.Status,vr.TERMINAL);this._messageClient.publish(t,void 0,{headers:e}).then()}}))}}class Hi{constructor(){this._brokerGateway=Xt.get(en)}publish(e,t,r){var n;const i={intent:e,retain:null!==(n=null==r?void 0:r.retain)&&void 0!==n&&n,headers:new Map(null==r?void 0:r.headers),capability:void 0,body:t};return this._brokerGateway.postMessage(Sr.Intent,i)}request$(e,t,r){const n=new Map(null==r?void 0:r.headers);return je((()=>{var i;const s={intent:e,retain:null!==(i=null==r?void 0:r.retain)&&void 0!==i&&i,headers:new Map(n),capability:void 0,body:t};return this._brokerGateway.requestReply$(Sr.Intent,s).pipe(xr())}))}observe$(e){return this._brokerGateway.subscribe$({messageChannel:Sr.Intent,subscribeChannel:Sr.IntentSubscribe,unsubscribeChannel:Sr.IntentUnsubscribe,newSubscribeCommand:t=>({selector:e,subscriberId:t,headers:new Map})})}onIntent(e,t){return new Wi(Xt.get(on).observe$(e),t).subscription}}class Ki{constructor(){this._brokerGateway=Xt.get(en)}publish(e,t,r){var n;const i={topic:e,retain:null!==(n=null==r?void 0:r.retain)&&void 0!==n&&n,headers:new Map(null==r?void 0:r.headers),body:t};return this._brokerGateway.postMessage(Sr.Topic,i)}request$(e,t,r){const n=new Map(null==r?void 0:r.headers);return je((()=>{var i;const s={topic:e,retain:null!==(i=null==r?void 0:r.retain)&&void 0!==i&&i,headers:new Map(n),body:t};return this._brokerGateway.requestReply$(Sr.Topic,s).pipe(xr())}))}observe$(e){return this._brokerGateway.subscribe$({messageChannel:Sr.Topic,subscribeChannel:Sr.TopicSubscribe,unsubscribeChannel:Sr.TopicUnsubscribe,newSubscribeCommand:t=>({topic:e,subscriberId:t,headers:new Map})})}onMessage(e,t){return new Wi(Xt.get(Mr).observe$(e),t).subscription}subscriberCount$(e){return new B((t=>{const r=new V;return this.request$($r.RequestSubscriberCount,e).pipe(Rr(),Gt(r)).subscribe({next:e=>t.next(e),error:e=>t.error(e),complete:_}),()=>r.next()}))}}class Gi{}class Qi{intercept(e){e.intentions=[...e.intentions||[],...Ji()]}}function Ji(){var e;return null!==(e=Xt.get(pn).activatorApiDisabled)&&void 0!==e&&e?[]:[{type:cr.Activator,qualifier:{"*":"*"}}]}class Yi{}class Xi{constructor(){this._destroy$=new V,dt(Qe(window,"beforeunload"),Qe(window,"unload")).pipe(qt(1),Gt(this._destroy$)).subscribe((()=>{Xt.get(Qr).destroy()}))}preDestroy(){this._destroy$.next()}}class Zi{constructor(){this._clientsById=new Map,this._clientsByWindow=new Map,this.register$=new V,this.unregister$=new V}registerClient(e){const t=this._clientsByWindow.get(e.window);t&&(Xt.get(Br).warn(`[StaleClient] Stale client registration detected when loading application '${e.application.symbolicName}'\n        into the window of '${t.application.symbolicName}'. Removing stale registration. Most likely, the client could not disconnect\n        from the broker, for example, because the client was disposed without notice, i.e., without receiving the browser's "unload" event, or\n        because the browser discarded the 'DISCONNECT' message, maybe due to a high load on the client during unloading.`.replace(/\s+/g," "),new Vr(t.application.symbolicName,t.version)),this.unregisterClient(t)),this._clientsById.set(e.id,e),this._clientsByWindow.set(e.window,e),this.register$.next(e)}unregisterClient(e){this._clientsById.delete(e.id),this._clientsByWindow.delete(e.window),this.unregister$.next(e),e.dispose()}getByClientId(e){return this._clientsById.get(e)}getByWindow(e){return this._clientsByWindow.get(e)}getByApplication(e){return Array.from(this._clientsById.values()).filter((t=>t.application.symbolicName===e))}preDestroy(){this._clientsById.forEach((e=>this.unregisterClient(e)))}}class es{intercept(e,t){return e.intent.type===cr.Microfrontend?this.consumeMicrofrontendIntent(e):t.handle(e)}consumeMicrofrontendIntent(e){return r(this,void 0,void 0,(function*(){const t=e.headers.get(br.ReplyTo);yield this.navigate(e),yield Xt.get(Mr).publish(t,null,{headers:(new Map).set(br.Status,vr.TERMINAL)})}))}navigate(e){var t;return r(this,void 0,void 0,(function*(){const r=e.capability,n=e.body,i=e.intent,s=null===(t=r.properties)||void 0===t?void 0:t.path;if(null==s)throw Error(`[OutletRouterError][NullPathError] Microfrontend capability has no path to the microfrontend defined. [capability=${JSON.stringify(r)}]`);const o=r.metadata.appSymbolicName,a=Xt.get(dn).getApplication(o);if(!a)throw Error(`[OutletRouterError][NullApplicationError] Unexpected error. No application found with the symbolic name "${o}".`);yield Xt.get(bi).navigate(s,Object.assign(Object.assign({},n),{outlet:this.resolveTargetOutlet(e),relativeTo:a.baseUrl,params:Object.assign(Object.assign({},i.qualifier),St.coerce(i.params))}))}))}resolveTargetOutlet(e){var t;const r=e.capability,n=e.body;if(null==n?void 0:n.outlet)return n.outlet;if(r.properties.outlet)return r.properties.outlet;const i=null===(t=e.headers.get(gi))||void 0===t?void 0:t[mi];return i||oi}}!function(e){function t(e){return"string"==typeof e?e:function(e){const t=URL.createObjectURL(new Blob([JSON.stringify(e)],{type:"application/json"}));return Xt.get(Qr).whenState(Fr.Stopped).then((()=>URL.revokeObjectURL(t))),t}(e||{name:"Host Application"})}e.createAppConfig=function(e){return{symbolicName:e.symbolicName,manifestUrl:t(e.manifest),scopeCheckDisabled:e.scopeCheckDisabled,intentionCheckDisabled:e.intentionCheckDisabled,intentionRegisterApiDisabled:e.intentionRegisterApiDisabled}},e.interceptManifest=function(e){Xt.all(Gi).forEach((t=>t.intercept(e)))}}(Ui||(Ui={}));class ts{constructor(e,t){this._hostConfig=e,this._appConfigs=t.filter((e=>!e.exclude))}install(){return r(this,void 0,void 0,(function*(){const e=Ui.createAppConfig(this._hostConfig),t=[e,...this._appConfigs],n=Xt.get(Vi).splitEven(t.length);yield Promise.all(t.map((t=>r(this,void 0,void 0,(function*(){const r=n.shift();try{const n=yield Xt.get(fn).fetch(t);t===e&&Ui.interceptManifest(n),yield Xt.get(dn).registerApplication(t,n),Xt.get(Br).info(`Registered application '${t.symbolicName}' in the SCION Microfrontend Platform.`)}catch(e){Xt.get(Br).error(`[AppInstaller] Failed to install application '${t.symbolicName}' in the SCION Microfrontend Platform.`,e)}finally{r.done()}})))))}))}}const rs="1.0.0-rc.11";class ns{static startHost(e){return ns.startPlatform((()=>{var t,r,n;ns.installHostStartupProgressMonitor();const i=Object.assign(Object.assign({},e.host),{symbolicName:(null===(t=e.host)||void 0===t?void 0:t.symbolicName)||"host"});Xt.register(lr,{useValue:!0}),Xt.registerIfAbsent(hr,{useValue:window.top}),Xt.registerIfAbsent(dr,{useValue:rs,destroyOrder:as.CORE}),Xt.register(pr,{useValue:i.symbolicName}),Xt.register(pn,{useValue:e}),Xt.registerIfAbsent(Yi,{useClass:Xi,eager:!0}),Xt.register(Gi,{useClass:Qi,multi:!0}),Xt.register(bn,{useClass:Zi,destroyOrder:as.CORE}),Xt.registerIfAbsent(Br,{useClass:qr,destroyOrder:as.CORE}),Xt.register(sn),Xt.registerIfAbsent(hn),Xt.register(an,{useClass:Ni,eager:!0}),Xt.register(dn,{eager:!0}),Xt.register(di),Xt.register(wi,{eager:!0}),Xt.register(vi,{eager:!0}),Xt.register(Si,{eager:!0}),Xt.register(Ti,{eager:!0}),Xt.register(Ln,{destroyOrder:as.BROKER}),Xt.register(fn),Xt.register(vn,{destroyOrder:as.BROKER}),Xt.register(On,{destroyOrder:as.BROKER}),Xt.registerIfAbsent(bi),Xt.registerIfAbsent(fi),Xt.registerIfAbsent(Jn),Xt.register(Qr,{useValue:ns,destroyOrder:as.CORE}),Xt.registerIfAbsent(Mr,ss()),Xt.registerIfAbsent(on,os()),Xt.register(yi),Xt.register(_i,{eager:!0}),Xt.register(Bi),Xt.register(Oi,{eager:!0}),Xt.register(En,{useClass:es,multi:!0});const{interval:s,timeout:o}=function(e){var t,r;const n={interval:60,timeout:10},i=null!==(t=null==e?void 0:e.interval)&&void 0!==t?t:n.interval,s=null!==(r=null==e?void 0:e.timeout)&&void 0!==r?r:n.timeout;if(!i||!s||i<=2*s)return Xt.get(Br).warn(`[LivenessProbeConfig] Illegal config provided. The interval [${i}s] must be greater than twice the timeout period [${s}s]. Using platform defaults instead: [interval=${n.interval}s, timeout=${n.timeout}s]`),{interval:n.interval,timeout:n.timeout};return{interval:i,timeout:s}}(e.liveness);Xt.registerIfAbsent(Tn,{useValue:1e3*s}),Xt.registerIfAbsent(xn,{useValue:1e3*o}),is({messageDeliveryTimeout:null===(r=e.host)||void 0===r?void 0:r.messageDeliveryTimeout,brokerDiscoverTimeout:null===(n=e.host)||void 0===n?void 0:n.brokerDiscoverTimeout,connectRunlevel:Wr.One}),function(e,t){Xt.registerInitializer({useExisting:Ln,runlevel:Wr.Zero}),Xt.registerInitializer({useFunction:()=>new ts(e,t).install(),runlevel:Wr.Zero})}(i,e.applications),Xt.registerInitializer({useFunction:()=>Xt.get(Mr).publish($r.PlatformProperties,e.properties||{},{retain:!0}),runlevel:Wr.Two}),Xt.registerInitializer({useFunction:()=>Xt.get(Mr).publish($r.Applications,Xt.get(dn).getApplications(),{retain:!0}),runlevel:Wr.Two}),Xt.registerInitializer({useFunction:()=>ii.define(),runlevel:Wr.Two}),Xt.registerInitializer({useExisting:sn,runlevel:Wr.Three}),Xt.registerInitializer({useExisting:Bi,runlevel:Wr.Three}),Xt.registerInitializer({useClass:zi,runlevel:Wr.Three})}))}static connectToHost(e,t){return ns.startPlatform((()=>{this.installClientStartupProgressMonitor(),Xt.register(lr,{useValue:!1}),Xt.registerIfAbsent(hr,{useValue:window.top}),Xt.register(pr,{useValue:e}),Xt.registerIfAbsent(dr,{useValue:rs,destroyOrder:as.CORE}),Xt.registerIfAbsent(Yi,{useClass:Xi,eager:!0}),Xt.register(sn),Xt.registerIfAbsent(Br,{useClass:qr,destroyOrder:as.CORE}),Xt.registerIfAbsent(hn),Xt.registerIfAbsent(Mr,ss()),Xt.registerIfAbsent(on,os()),Xt.registerIfAbsent(bi),Xt.registerIfAbsent(fi),Xt.registerIfAbsent(Jn),Xt.register(vi,{eager:!0}),Xt.register(yi),Xt.register(Si,{eager:!0}),Xt.register(Ti,{eager:!0}),Xt.register(_i,{eager:!0}),Xt.register(di),Xt.register(Bi),Xt.register(Oi,{eager:!0}),Xt.register(Qr,{useValue:ns,destroyOrder:as.CORE}),is(Object.assign(Object.assign({},t),{connectRunlevel:Wr.Zero})),Xt.registerInitializer({useExisting:sn,runlevel:Wr.Two}),Xt.registerInitializer({useExisting:Bi,runlevel:Wr.Two}),Xt.registerInitializer({useFunction:()=>ii.define(),runlevel:Wr.Two})}))}static isConnectedToHost(){return r(this,void 0,void 0,(function*(){if(ns.state===Fr.Stopped)return!1;const e=Xt.opt(en);return!!e&&e.isConnected()}))}static destroy(){return r(this,void 0,void 0,(function*(){yield ns.enterState(Fr.Stopping),Xt.destroy(),yield ns.enterState(Fr.Stopped)}))}static startPlatform(e){return r(this,void 0,void 0,(function*(){if(ns.state===Fr.Started)return Promise.reject(Error("[MicrofrontendPlatformStartupError] Platform already started"));try{return null==e||e(),yield ns.enterState(Fr.Starting),yield Xt.start({eagerBeanConstructRunlevel:Wr.One,initializerDefaultRunlevel:Wr.Two}),yield ns.enterState(Fr.Started),Promise.resolve()}catch(e){return yield ns.destroy(),Promise.reject(Error(`[MicrofrontendPlatformStartupError] Microfrontend platform failed to start: ${e}`))}}))}static get state(){return this._state$.getValue()}static whenState(e){return r(this,void 0,void 0,(function*(){return new Promise(((t,r)=>{this._state$.pipe(zt((t=>t===e))).subscribe({error:r,complete:t})}))}))}static get state$(){return this._state$}static enterState(e){return r(this,void 0,void 0,(function*(){if((this.state===Fr.Stopped?-1:this.state)>=e)throw Error(`[PlatformStateError] Failed to enter platform state [prevState=${Fr[this.state]}, newState=${Fr[e]}].`);this._state$.next(e),yield this.whenState(e)}))}static get startupProgress$(){return this._startupProgress$}static installHostStartupProgressMonitor(){const e=new ji,[t,r,n]=e.split(1,3,5);Xt.register(Vi,{useValue:r}),Xt.register(Fi,{useValue:n}),ns.whenState(Fr.Started).then((()=>{t.done()})),ns.whenState(Fr.Stopped).then((()=>{ns._startupProgress$=new V})),e.progress$.pipe(Gt(_e(ns.whenState(Fr.Started)))).subscribe(ns._startupProgress$)}static installClientStartupProgressMonitor(){const e=new ji;ns.whenState(Fr.Started).then((()=>{e.done()})),ns.whenState(Fr.Stopped).then((()=>{ns._startupProgress$=new V})),e.progress$.pipe(Gt(_e(ns.whenState(Fr.Started)))).subscribe(ns._startupProgress$)}}function is(e){var t;null===(t=e.connect)||void 0===t||t?(Xt.register(rn,{useFactory:()=>new rn(e),destroyOrder:as.MESSAGING}),Xt.register(en,{useExisting:rn}),Xt.registerInitializer({useExisting:rn,runlevel:e.connectRunlevel})):Xt.register(en,{useClass:tn})}function ss(){return{useClass:Ki,eager:!0,destroyOrder:as.MESSAGING}}function os(){return{useClass:Hi,eager:!0,destroyOrder:as.MESSAGING}}var as,cs;ns._state$=new W(Fr.Stopped),ns._startupProgress$=new V,(cs=as||(as={}))[cs.CORE=Number.MAX_SAFE_INTEGER]="CORE",cs[cs.BROKER=cs.CORE-1]="BROKER",cs[cs.MESSAGING=cs.BROKER-1]="MESSAGING";window.__SCION_RCP=window.__SCION_RCP||{},window.__SCION_RCP.refs={get MicrofrontendPlatform(){return ns},get MessageClient(){return Xt.get(Mr)},get IntentClient(){return Xt.get(on)},get OutletRouter(){return Xt.get(bi)},get ManifestService(){return Xt.get(Bi)},get Beans(){return Xt},get MessageInterceptor(){return _n},get IntentInterceptor(){return En},get TopicMatcher(){return Nr},get QualifierMatcher(){return Rn},get UUID(){return nr}}})();
//# sourceMappingURL=refs.js.map
